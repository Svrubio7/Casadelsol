(function(){const g=document.createElement("link").relList;if(g&&g.supports&&g.supports("modulepreload"))return;for(const M of document.querySelectorAll('link[rel="modulepreload"]'))C(M);new MutationObserver(M=>{for(const k of M)if(k.type==="childList")for(const j of k.addedNodes)j.tagName==="LINK"&&j.rel==="modulepreload"&&C(j)}).observe(document,{childList:!0,subtree:!0});function T(M){const k={};return M.integrity&&(k.integrity=M.integrity),M.referrerPolicy&&(k.referrerPolicy=M.referrerPolicy),M.crossOrigin==="use-credentials"?k.credentials="include":M.crossOrigin==="anonymous"?k.credentials="omit":k.credentials="same-origin",k}function C(M){if(M.ep)return;M.ep=!0;const k=T(M);fetch(M.href,k)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function j0(f){const g=Object.create(null);for(const T of f.split(","))g[T]=1;return T=>T in g}const xn={},Id=[],il=()=>{},fP=()=>!1,Lg=f=>f.charCodeAt(0)===111&&f.charCodeAt(1)===110&&(f.charCodeAt(2)>122||f.charCodeAt(2)<97),G0=f=>f.startsWith("onUpdate:"),Bs=Object.assign,H0=(f,g)=>{const T=f.indexOf(g);T>-1&&f.splice(T,1)},pP=Object.prototype.hasOwnProperty,hn=(f,g)=>pP.call(f,g),pr=Array.isArray,Cd=f=>zg(f)==="[object Map]",I2=f=>zg(f)==="[object Set]",Tr=f=>typeof f=="function",cs=f=>typeof f=="string",Rc=f=>typeof f=="symbol",Bn=f=>f!==null&&typeof f=="object",C2=f=>(Bn(f)||Tr(f))&&Tr(f.then)&&Tr(f.catch),P2=Object.prototype.toString,zg=f=>P2.call(f),mP=f=>zg(f).slice(8,-1),M2=f=>zg(f)==="[object Object]",q0=f=>cs(f)&&f!=="NaN"&&f[0]!=="-"&&""+parseInt(f,10)===f,Up=j0(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),Og=f=>{const g=Object.create(null);return T=>g[T]||(g[T]=f(T))},_P=/-(\w)/g,Yo=Og(f=>f.replace(_P,(g,T)=>T?T.toUpperCase():"")),gP=/\B([A-Z])/g,Ou=Og(f=>f.replace(gP,"-$1").toLowerCase()),kg=Og(f=>f.charAt(0).toUpperCase()+f.slice(1)),e0=Og(f=>f?`on${kg(f)}`:""),Ic=(f,g)=>!Object.is(f,g),hg=(f,...g)=>{for(let T=0;T<f.length;T++)f[T](...g)},g0=(f,g,T,C=!1)=>{Object.defineProperty(f,g,{configurable:!0,enumerable:!1,writable:C,value:T})},y0=f=>{const g=parseFloat(f);return isNaN(g)?f:g};let cT;const Fg=()=>cT||(cT=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Bg(f){if(pr(f)){const g={};for(let T=0;T<f.length;T++){const C=f[T],M=cs(C)?bP(C):Bg(C);if(M)for(const k in M)g[k]=M[k]}return g}else if(cs(f)||Bn(f))return f}const yP=/;(?![^(]*\))/g,xP=/:([^]+)/,vP=/\/\*[^]*?\*\//g;function bP(f){const g={};return f.replace(vP,"").split(yP).forEach(T=>{if(T){const C=T.split(xP);C.length>1&&(g[C[0].trim()]=C[1].trim())}}),g}function sm(f){let g="";if(cs(f))g=f;else if(pr(f))for(let T=0;T<f.length;T++){const C=sm(f[T]);C&&(g+=C+" ")}else if(Bn(f))for(const T in f)f[T]&&(g+=T+" ");return g.trim()}const wP="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",TP=j0(wP);function R2(f){return!!f||f===""}const D2=f=>!!(f&&f.__v_isRef===!0),an=f=>cs(f)?f:f==null?"":pr(f)||Bn(f)&&(f.toString===P2||!Tr(f.toString))?D2(f)?an(f.value):JSON.stringify(f,L2,2):String(f),L2=(f,g)=>D2(g)?L2(f,g.value):Cd(g)?{[`Map(${g.size})`]:[...g.entries()].reduce((T,[C,M],k)=>(T[t0(C,k)+" =>"]=M,T),{})}:I2(g)?{[`Set(${g.size})`]:[...g.values()].map(T=>t0(T))}:Rc(g)?t0(g):Bn(g)&&!pr(g)&&!M2(g)?String(g):g,t0=(f,g="")=>{var T;return Rc(f)?`Symbol(${(T=f.description)!=null?T:g})`:f};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let co;class SP{constructor(g=!1){this.detached=g,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=co,!g&&co&&(this.index=(co.scopes||(co.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let g,T;if(this.scopes)for(g=0,T=this.scopes.length;g<T;g++)this.scopes[g].pause();for(g=0,T=this.effects.length;g<T;g++)this.effects[g].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let g,T;if(this.scopes)for(g=0,T=this.scopes.length;g<T;g++)this.scopes[g].resume();for(g=0,T=this.effects.length;g<T;g++)this.effects[g].resume()}}run(g){if(this._active){const T=co;try{return co=this,g()}finally{co=T}}}on(){++this._on===1&&(this.prevScope=co,co=this)}off(){this._on>0&&--this._on===0&&(co=this.prevScope,this.prevScope=void 0)}stop(g){if(this._active){this._active=!1;let T,C;for(T=0,C=this.effects.length;T<C;T++)this.effects[T].stop();for(this.effects.length=0,T=0,C=this.cleanups.length;T<C;T++)this.cleanups[T]();if(this.cleanups.length=0,this.scopes){for(T=0,C=this.scopes.length;T<C;T++)this.scopes[T].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!g){const M=this.parent.scopes.pop();M&&M!==this&&(this.parent.scopes[this.index]=M,M.index=this.index)}this.parent=void 0}}}function EP(){return co}let In;const i0=new WeakSet;class z2{constructor(g){this.fn=g,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,co&&co.active&&co.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,i0.has(this)&&(i0.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||k2(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,uT(this),F2(this);const g=In,T=Ia;In=this,Ia=!0;try{return this.fn()}finally{B2(this),In=g,Ia=T,this.flags&=-3}}stop(){if(this.flags&1){for(let g=this.deps;g;g=g.nextDep)Z0(g);this.deps=this.depsTail=void 0,uT(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?i0.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){x0(this)&&this.run()}get dirty(){return x0(this)}}let O2=0,jp,Gp;function k2(f,g=!1){if(f.flags|=8,g){f.next=Gp,Gp=f;return}f.next=jp,jp=f}function $0(){O2++}function W0(){if(--O2>0)return;if(Gp){let g=Gp;for(Gp=void 0;g;){const T=g.next;g.next=void 0,g.flags&=-9,g=T}}let f;for(;jp;){let g=jp;for(jp=void 0;g;){const T=g.next;if(g.next=void 0,g.flags&=-9,g.flags&1)try{g.trigger()}catch(C){f||(f=C)}g=T}}if(f)throw f}function F2(f){for(let g=f.deps;g;g=g.nextDep)g.version=-1,g.prevActiveLink=g.dep.activeLink,g.dep.activeLink=g}function B2(f){let g,T=f.depsTail,C=T;for(;C;){const M=C.prevDep;C.version===-1?(C===T&&(T=M),Z0(C),AP(C)):g=C,C.dep.activeLink=C.prevActiveLink,C.prevActiveLink=void 0,C=M}f.deps=g,f.depsTail=T}function x0(f){for(let g=f.deps;g;g=g.nextDep)if(g.dep.version!==g.version||g.dep.computed&&(N2(g.dep.computed)||g.dep.version!==g.version))return!0;return!!f._dirty}function N2(f){if(f.flags&4&&!(f.flags&16)||(f.flags&=-17,f.globalVersion===Yp)||(f.globalVersion=Yp,!f.isSSR&&f.flags&128&&(!f.deps&&!f._dirty||!x0(f))))return;f.flags|=2;const g=f.dep,T=In,C=Ia;In=f,Ia=!0;try{F2(f);const M=f.fn(f._value);(g.version===0||Ic(M,f._value))&&(f.flags|=128,f._value=M,g.version++)}catch(M){throw g.version++,M}finally{In=T,Ia=C,B2(f),f.flags&=-3}}function Z0(f,g=!1){const{dep:T,prevSub:C,nextSub:M}=f;if(C&&(C.nextSub=M,f.prevSub=void 0),M&&(M.prevSub=C,f.nextSub=void 0),T.subs===f&&(T.subs=C,!C&&T.computed)){T.computed.flags&=-5;for(let k=T.computed.deps;k;k=k.nextDep)Z0(k,!0)}!g&&!--T.sc&&T.map&&T.map.delete(T.key)}function AP(f){const{prevDep:g,nextDep:T}=f;g&&(g.nextDep=T,f.prevDep=void 0),T&&(T.prevDep=g,f.nextDep=void 0)}let Ia=!0;const V2=[];function Nl(){V2.push(Ia),Ia=!1}function Vl(){const f=V2.pop();Ia=f===void 0?!0:f}function uT(f){const{cleanup:g}=f;if(f.cleanup=void 0,g){const T=In;In=void 0;try{g()}finally{In=T}}}let Yp=0;class IP{constructor(g,T){this.sub=g,this.dep=T,this.version=T.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class X0{constructor(g){this.computed=g,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(g){if(!In||!Ia||In===this.computed)return;let T=this.activeLink;if(T===void 0||T.sub!==In)T=this.activeLink=new IP(In,this),In.deps?(T.prevDep=In.depsTail,In.depsTail.nextDep=T,In.depsTail=T):In.deps=In.depsTail=T,U2(T);else if(T.version===-1&&(T.version=this.version,T.nextDep)){const C=T.nextDep;C.prevDep=T.prevDep,T.prevDep&&(T.prevDep.nextDep=C),T.prevDep=In.depsTail,T.nextDep=void 0,In.depsTail.nextDep=T,In.depsTail=T,In.deps===T&&(In.deps=C)}return T}trigger(g){this.version++,Yp++,this.notify(g)}notify(g){$0();try{for(let T=this.subs;T;T=T.prevSub)T.sub.notify()&&T.sub.dep.notify()}finally{W0()}}}function U2(f){if(f.dep.sc++,f.sub.flags&4){const g=f.dep.computed;if(g&&!f.dep.subs){g.flags|=20;for(let C=g.deps;C;C=C.nextDep)U2(C)}const T=f.dep.subs;T!==f&&(f.prevSub=T,T&&(T.nextSub=f)),f.dep.subs=f}}const v0=new WeakMap,Du=Symbol(""),b0=Symbol(""),Jp=Symbol("");function Os(f,g,T){if(Ia&&In){let C=v0.get(f);C||v0.set(f,C=new Map);let M=C.get(T);M||(C.set(T,M=new X0),M.map=C,M.key=T),M.track()}}function Fl(f,g,T,C,M,k){const j=v0.get(f);if(!j){Yp++;return}const o=Q=>{Q&&Q.trigger()};if($0(),g==="clear")j.forEach(o);else{const Q=pr(f),pe=Q&&q0(T);if(Q&&T==="length"){const he=Number(C);j.forEach((ye,Oe)=>{(Oe==="length"||Oe===Jp||!Rc(Oe)&&Oe>=he)&&o(ye)})}else switch((T!==void 0||j.has(void 0))&&o(j.get(T)),pe&&o(j.get(Jp)),g){case"add":Q?pe&&o(j.get("length")):(o(j.get(Du)),Cd(f)&&o(j.get(b0)));break;case"delete":Q||(o(j.get(Du)),Cd(f)&&o(j.get(b0)));break;case"set":Cd(f)&&o(j.get(Du));break}}W0()}function Td(f){const g=un(f);return g===f?g:(Os(g,"iterate",Jp),Ko(f)?g:g.map(Ps))}function Ng(f){return Os(f=un(f),"iterate",Jp),f}const CP={__proto__:null,[Symbol.iterator](){return r0(this,Symbol.iterator,Ps)},concat(...f){return Td(this).concat(...f.map(g=>pr(g)?Td(g):g))},entries(){return r0(this,"entries",f=>(f[1]=Ps(f[1]),f))},every(f,g){return zl(this,"every",f,g,void 0,arguments)},filter(f,g){return zl(this,"filter",f,g,T=>T.map(Ps),arguments)},find(f,g){return zl(this,"find",f,g,Ps,arguments)},findIndex(f,g){return zl(this,"findIndex",f,g,void 0,arguments)},findLast(f,g){return zl(this,"findLast",f,g,Ps,arguments)},findLastIndex(f,g){return zl(this,"findLastIndex",f,g,void 0,arguments)},forEach(f,g){return zl(this,"forEach",f,g,void 0,arguments)},includes(...f){return n0(this,"includes",f)},indexOf(...f){return n0(this,"indexOf",f)},join(f){return Td(this).join(f)},lastIndexOf(...f){return n0(this,"lastIndexOf",f)},map(f,g){return zl(this,"map",f,g,void 0,arguments)},pop(){return kp(this,"pop")},push(...f){return kp(this,"push",f)},reduce(f,...g){return hT(this,"reduce",f,g)},reduceRight(f,...g){return hT(this,"reduceRight",f,g)},shift(){return kp(this,"shift")},some(f,g){return zl(this,"some",f,g,void 0,arguments)},splice(...f){return kp(this,"splice",f)},toReversed(){return Td(this).toReversed()},toSorted(f){return Td(this).toSorted(f)},toSpliced(...f){return Td(this).toSpliced(...f)},unshift(...f){return kp(this,"unshift",f)},values(){return r0(this,"values",Ps)}};function r0(f,g,T){const C=Ng(f),M=C[g]();return C!==f&&!Ko(f)&&(M._next=M.next,M.next=()=>{const k=M._next();return k.value&&(k.value=T(k.value)),k}),M}const PP=Array.prototype;function zl(f,g,T,C,M,k){const j=Ng(f),o=j!==f&&!Ko(f),Q=j[g];if(Q!==PP[g]){const ye=Q.apply(f,k);return o?Ps(ye):ye}let pe=T;j!==f&&(o?pe=function(ye,Oe){return T.call(this,Ps(ye),Oe,f)}:T.length>2&&(pe=function(ye,Oe){return T.call(this,ye,Oe,f)}));const he=Q.call(j,pe,C);return o&&M?M(he):he}function hT(f,g,T,C){const M=Ng(f);let k=T;return M!==f&&(Ko(f)?T.length>3&&(k=function(j,o,Q){return T.call(this,j,o,Q,f)}):k=function(j,o,Q){return T.call(this,j,Ps(o),Q,f)}),M[g](k,...C)}function n0(f,g,T){const C=un(f);Os(C,"iterate",Jp);const M=C[g](...T);return(M===-1||M===!1)&&J0(T[0])?(T[0]=un(T[0]),C[g](...T)):M}function kp(f,g,T=[]){Nl(),$0();const C=un(f)[g].apply(f,T);return W0(),Vl(),C}const MP=j0("__proto__,__v_isRef,__isVue"),j2=new Set(Object.getOwnPropertyNames(Symbol).filter(f=>f!=="arguments"&&f!=="caller").map(f=>Symbol[f]).filter(Rc));function RP(f){Rc(f)||(f=String(f));const g=un(this);return Os(g,"has",f),g.hasOwnProperty(f)}class G2{constructor(g=!1,T=!1){this._isReadonly=g,this._isShallow=T}get(g,T,C){if(T==="__v_skip")return g.__v_skip;const M=this._isReadonly,k=this._isShallow;if(T==="__v_isReactive")return!M;if(T==="__v_isReadonly")return M;if(T==="__v_isShallow")return k;if(T==="__v_raw")return C===(M?k?UP:W2:k?$2:q2).get(g)||Object.getPrototypeOf(g)===Object.getPrototypeOf(C)?g:void 0;const j=pr(g);if(!M){let Q;if(j&&(Q=CP[T]))return Q;if(T==="hasOwnProperty")return RP}const o=Reflect.get(g,T,Fs(g)?g:C);return(Rc(T)?j2.has(T):MP(T))||(M||Os(g,"get",T),k)?o:Fs(o)?j&&q0(T)?o:o.value:Bn(o)?M?X2(o):Vg(o):o}}class H2 extends G2{constructor(g=!1){super(!1,g)}set(g,T,C,M){let k=g[T];if(!this._isShallow){const Q=Pc(k);if(!Ko(C)&&!Pc(C)&&(k=un(k),C=un(C)),!pr(g)&&Fs(k)&&!Fs(C))return Q?!1:(k.value=C,!0)}const j=pr(g)&&q0(T)?Number(T)<g.length:hn(g,T),o=Reflect.set(g,T,C,Fs(g)?g:M);return g===un(M)&&(j?Ic(C,k)&&Fl(g,"set",T,C):Fl(g,"add",T,C)),o}deleteProperty(g,T){const C=hn(g,T);g[T];const M=Reflect.deleteProperty(g,T);return M&&C&&Fl(g,"delete",T,void 0),M}has(g,T){const C=Reflect.has(g,T);return(!Rc(T)||!j2.has(T))&&Os(g,"has",T),C}ownKeys(g){return Os(g,"iterate",pr(g)?"length":Du),Reflect.ownKeys(g)}}class DP extends G2{constructor(g=!1){super(!0,g)}set(g,T){return!0}deleteProperty(g,T){return!0}}const LP=new H2,zP=new DP,OP=new H2(!0);const w0=f=>f,ag=f=>Reflect.getPrototypeOf(f);function kP(f,g,T){return function(...C){const M=this.__v_raw,k=un(M),j=Cd(k),o=f==="entries"||f===Symbol.iterator&&j,Q=f==="keys"&&j,pe=M[f](...C),he=T?w0:g?bg:Ps;return!g&&Os(k,"iterate",Q?b0:Du),{next(){const{value:ye,done:Oe}=pe.next();return Oe?{value:ye,done:Oe}:{value:o?[he(ye[0]),he(ye[1])]:he(ye),done:Oe}},[Symbol.iterator](){return this}}}}function lg(f){return function(...g){return f==="delete"?!1:f==="clear"?void 0:this}}function FP(f,g){const T={get(M){const k=this.__v_raw,j=un(k),o=un(M);f||(Ic(M,o)&&Os(j,"get",M),Os(j,"get",o));const{has:Q}=ag(j),pe=g?w0:f?bg:Ps;if(Q.call(j,M))return pe(k.get(M));if(Q.call(j,o))return pe(k.get(o));k!==j&&k.get(M)},get size(){const M=this.__v_raw;return!f&&Os(un(M),"iterate",Du),Reflect.get(M,"size",M)},has(M){const k=this.__v_raw,j=un(k),o=un(M);return f||(Ic(M,o)&&Os(j,"has",M),Os(j,"has",o)),M===o?k.has(M):k.has(M)||k.has(o)},forEach(M,k){const j=this,o=j.__v_raw,Q=un(o),pe=g?w0:f?bg:Ps;return!f&&Os(Q,"iterate",Du),o.forEach((he,ye)=>M.call(k,pe(he),pe(ye),j))}};return Bs(T,f?{add:lg("add"),set:lg("set"),delete:lg("delete"),clear:lg("clear")}:{add(M){!g&&!Ko(M)&&!Pc(M)&&(M=un(M));const k=un(this);return ag(k).has.call(k,M)||(k.add(M),Fl(k,"add",M,M)),this},set(M,k){!g&&!Ko(k)&&!Pc(k)&&(k=un(k));const j=un(this),{has:o,get:Q}=ag(j);let pe=o.call(j,M);pe||(M=un(M),pe=o.call(j,M));const he=Q.call(j,M);return j.set(M,k),pe?Ic(k,he)&&Fl(j,"set",M,k):Fl(j,"add",M,k),this},delete(M){const k=un(this),{has:j,get:o}=ag(k);let Q=j.call(k,M);Q||(M=un(M),Q=j.call(k,M)),o&&o.call(k,M);const pe=k.delete(M);return Q&&Fl(k,"delete",M,void 0),pe},clear(){const M=un(this),k=M.size!==0,j=M.clear();return k&&Fl(M,"clear",void 0,void 0),j}}),["keys","values","entries",Symbol.iterator].forEach(M=>{T[M]=kP(M,f,g)}),T}function K0(f,g){const T=FP(f,g);return(C,M,k)=>M==="__v_isReactive"?!f:M==="__v_isReadonly"?f:M==="__v_raw"?C:Reflect.get(hn(T,M)&&M in C?T:C,M,k)}const BP={get:K0(!1,!1)},NP={get:K0(!1,!0)},VP={get:K0(!0,!1)};const q2=new WeakMap,$2=new WeakMap,W2=new WeakMap,UP=new WeakMap;function jP(f){switch(f){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function GP(f){return f.__v_skip||!Object.isExtensible(f)?0:jP(mP(f))}function Vg(f){return Pc(f)?f:Y0(f,!1,LP,BP,q2)}function Z2(f){return Y0(f,!1,OP,NP,$2)}function X2(f){return Y0(f,!0,zP,VP,W2)}function Y0(f,g,T,C,M){if(!Bn(f)||f.__v_raw&&!(g&&f.__v_isReactive))return f;const k=GP(f);if(k===0)return f;const j=M.get(f);if(j)return j;const o=new Proxy(f,k===2?C:T);return M.set(f,o),o}function Pd(f){return Pc(f)?Pd(f.__v_raw):!!(f&&f.__v_isReactive)}function Pc(f){return!!(f&&f.__v_isReadonly)}function Ko(f){return!!(f&&f.__v_isShallow)}function J0(f){return f?!!f.__v_raw:!1}function un(f){const g=f&&f.__v_raw;return g?un(g):f}function HP(f){return!hn(f,"__v_skip")&&Object.isExtensible(f)&&g0(f,"__v_skip",!0),f}const Ps=f=>Bn(f)?Vg(f):f,bg=f=>Bn(f)?X2(f):f;function Fs(f){return f?f.__v_isRef===!0:!1}function T0(f){return K2(f,!1)}function qP(f){return K2(f,!0)}function K2(f,g){return Fs(f)?f:new $P(f,g)}class $P{constructor(g,T){this.dep=new X0,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=T?g:un(g),this._value=T?g:Ps(g),this.__v_isShallow=T}get value(){return this.dep.track(),this._value}set value(g){const T=this._rawValue,C=this.__v_isShallow||Ko(g)||Pc(g);g=C?g:un(g),Ic(g,T)&&(this._rawValue=g,this._value=C?g:Ps(g),this.dep.trigger())}}function Cc(f){return Fs(f)?f.value:f}const WP={get:(f,g,T)=>g==="__v_raw"?f:Cc(Reflect.get(f,g,T)),set:(f,g,T,C)=>{const M=f[g];return Fs(M)&&!Fs(T)?(M.value=T,!0):Reflect.set(f,g,T,C)}};function Y2(f){return Pd(f)?f:new Proxy(f,WP)}class ZP{constructor(g,T,C){this.fn=g,this.setter=T,this._value=void 0,this.dep=new X0(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Yp-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!T,this.isSSR=C}notify(){if(this.flags|=16,!(this.flags&8)&&In!==this)return k2(this,!0),!0}get value(){const g=this.dep.track();return N2(this),g&&(g.version=this.dep.version),this._value}set value(g){this.setter&&this.setter(g)}}function XP(f,g,T=!1){let C,M;return Tr(f)?C=f:(C=f.get,M=f.set),new ZP(C,M,T)}const cg={},wg=new WeakMap;let Mu;function KP(f,g=!1,T=Mu){if(T){let C=wg.get(T);C||wg.set(T,C=[]),C.push(f)}}function YP(f,g,T=xn){const{immediate:C,deep:M,once:k,scheduler:j,augmentJob:o,call:Q}=T,pe=Zt=>M?Zt:Ko(Zt)||M===!1||M===0?Bl(Zt,1):Bl(Zt);let he,ye,Oe,je,ft=!1,rt=!1;if(Fs(f)?(ye=()=>f.value,ft=Ko(f)):Pd(f)?(ye=()=>pe(f),ft=!0):pr(f)?(rt=!0,ft=f.some(Zt=>Pd(Zt)||Ko(Zt)),ye=()=>f.map(Zt=>{if(Fs(Zt))return Zt.value;if(Pd(Zt))return pe(Zt);if(Tr(Zt))return Q?Q(Zt,2):Zt()})):Tr(f)?g?ye=Q?()=>Q(f,2):f:ye=()=>{if(Oe){Nl();try{Oe()}finally{Vl()}}const Zt=Mu;Mu=he;try{return Q?Q(f,3,[je]):f(je)}finally{Mu=Zt}}:ye=il,g&&M){const Zt=ye,Li=M===!0?1/0:M;ye=()=>Bl(Zt(),Li)}const mt=EP(),Wt=()=>{he.stop(),mt&&mt.active&&H0(mt.effects,he)};if(k&&g){const Zt=g;g=(...Li)=>{Zt(...Li),Wt()}}let wt=rt?new Array(f.length).fill(cg):cg;const Xt=Zt=>{if(!(!(he.flags&1)||!he.dirty&&!Zt))if(g){const Li=he.run();if(M||ft||(rt?Li.some((Sr,mr)=>Ic(Sr,wt[mr])):Ic(Li,wt))){Oe&&Oe();const Sr=Mu;Mu=he;try{const mr=[Li,wt===cg?void 0:rt&&wt[0]===cg?[]:wt,je];wt=Li,Q?Q(g,3,mr):g(...mr)}finally{Mu=Sr}}}else he.run()};return o&&o(Xt),he=new z2(ye),he.scheduler=j?()=>j(Xt,!1):Xt,je=Zt=>KP(Zt,!1,he),Oe=he.onStop=()=>{const Zt=wg.get(he);if(Zt){if(Q)Q(Zt,4);else for(const Li of Zt)Li();wg.delete(he)}},g?C?Xt(!0):wt=he.run():j?j(Xt.bind(null,!0),!0):he.run(),Wt.pause=he.pause.bind(he),Wt.resume=he.resume.bind(he),Wt.stop=Wt,Wt}function Bl(f,g=1/0,T){if(g<=0||!Bn(f)||f.__v_skip||(T=T||new Set,T.has(f)))return f;if(T.add(f),g--,Fs(f))Bl(f.value,g,T);else if(pr(f))for(let C=0;C<f.length;C++)Bl(f[C],g,T);else if(I2(f)||Cd(f))f.forEach(C=>{Bl(C,g,T)});else if(M2(f)){for(const C in f)Bl(f[C],g,T);for(const C of Object.getOwnPropertySymbols(f))Object.prototype.propertyIsEnumerable.call(f,C)&&Bl(f[C],g,T)}return f}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function om(f,g,T,C){try{return C?f(...C):f()}catch(M){Ug(M,g,T)}}function nl(f,g,T,C){if(Tr(f)){const M=om(f,g,T,C);return M&&C2(M)&&M.catch(k=>{Ug(k,g,T)}),M}if(pr(f)){const M=[];for(let k=0;k<f.length;k++)M.push(nl(f[k],g,T,C));return M}}function Ug(f,g,T,C=!0){const M=g?g.vnode:null,{errorHandler:k,throwUnhandledErrorInProduction:j}=g&&g.appContext.config||xn;if(g){let o=g.parent;const Q=g.proxy,pe=`https://vuejs.org/error-reference/#runtime-${T}`;for(;o;){const he=o.ec;if(he){for(let ye=0;ye<he.length;ye++)if(he[ye](f,Q,pe)===!1)return}o=o.parent}if(k){Nl(),om(k,null,10,[f,Q,pe]),Vl();return}}JP(f,T,M,C,j)}function JP(f,g,T,C=!0,M=!1){if(M)throw f;console.error(f)}const Ks=[];let el=-1;const Md=[];let Tc=null,Sd=0;const J2=Promise.resolve();let Tg=null;function Q0(f){const g=Tg||J2;return f?g.then(this?f.bind(this):f):g}function QP(f){let g=el+1,T=Ks.length;for(;g<T;){const C=g+T>>>1,M=Ks[C],k=Qp(M);k<f||k===f&&M.flags&2?g=C+1:T=C}return g}function ev(f){if(!(f.flags&1)){const g=Qp(f),T=Ks[Ks.length-1];!T||!(f.flags&2)&&g>=Qp(T)?Ks.push(f):Ks.splice(QP(g),0,f),f.flags|=1,Q2()}}function Q2(){Tg||(Tg=J2.then(tS))}function eM(f){pr(f)?Md.push(...f):Tc&&f.id===-1?Tc.splice(Sd+1,0,f):f.flags&1||(Md.push(f),f.flags|=1),Q2()}function dT(f,g,T=el+1){for(;T<Ks.length;T++){const C=Ks[T];if(C&&C.flags&2){if(f&&C.id!==f.uid)continue;Ks.splice(T,1),T--,C.flags&4&&(C.flags&=-2),C(),C.flags&4||(C.flags&=-2)}}}function eS(f){if(Md.length){const g=[...new Set(Md)].sort((T,C)=>Qp(T)-Qp(C));if(Md.length=0,Tc){Tc.push(...g);return}for(Tc=g,Sd=0;Sd<Tc.length;Sd++){const T=Tc[Sd];T.flags&4&&(T.flags&=-2),T.flags&8||T(),T.flags&=-2}Tc=null,Sd=0}}const Qp=f=>f.id==null?f.flags&2?-1:1/0:f.id;function tS(f){try{for(el=0;el<Ks.length;el++){const g=Ks[el];g&&!(g.flags&8)&&(g.flags&4&&(g.flags&=-2),om(g,g.i,g.i?15:14),g.flags&4||(g.flags&=-2))}}finally{for(;el<Ks.length;el++){const g=Ks[el];g&&(g.flags&=-2)}el=-1,Ks.length=0,eS(),Tg=null,(Ks.length||Md.length)&&tS()}}let ho=null,iS=null;function Sg(f){const g=ho;return ho=f,iS=f&&f.type.__scopeId||null,g}function jg(f,g=ho,T){if(!g||f._n)return f;const C=(...M)=>{C._d&&TT(-1);const k=Sg(g);let j;try{j=f(...M)}finally{Sg(k),C._d&&TT(1)}return j};return C._n=!0,C._c=!0,C._d=!0,C}function fT(f,g){if(ho===null)return f;const T=$g(ho),C=f.dirs||(f.dirs=[]);for(let M=0;M<g.length;M++){let[k,j,o,Q=xn]=g[M];k&&(Tr(k)&&(k={mounted:k,updated:k}),k.deep&&Bl(j),C.push({dir:k,instance:T,value:j,oldValue:void 0,arg:o,modifiers:Q}))}return f}function Cu(f,g,T,C){const M=f.dirs,k=g&&g.dirs;for(let j=0;j<M.length;j++){const o=M[j];k&&(o.oldValue=k[j].value);let Q=o.dir[C];Q&&(Nl(),nl(Q,T,8,[f.el,o,f,g]),Vl())}}const tM=Symbol("_vte"),iM=f=>f.__isTeleport;function tv(f,g){f.shapeFlag&6&&f.component?(f.transition=g,tv(f.component.subTree,g)):f.shapeFlag&128?(f.ssContent.transition=g.clone(f.ssContent),f.ssFallback.transition=g.clone(f.ssFallback)):f.transition=g}/*! #__NO_SIDE_EFFECTS__ */function rS(f,g){return Tr(f)?Bs({name:f.name},g,{setup:f}):f}function nS(f){f.ids=[f.ids[0]+f.ids[2]+++"-",0,0]}function Hp(f,g,T,C,M=!1){if(pr(f)){f.forEach((ft,rt)=>Hp(ft,g&&(pr(g)?g[rt]:g),T,C,M));return}if(qp(C)&&!M){C.shapeFlag&512&&C.type.__asyncResolved&&C.component.subTree.component&&Hp(f,g,T,C.component.subTree);return}const k=C.shapeFlag&4?$g(C.component):C.el,j=M?null:k,{i:o,r:Q}=f,pe=g&&g.r,he=o.refs===xn?o.refs={}:o.refs,ye=o.setupState,Oe=un(ye),je=ye===xn?()=>!1:ft=>hn(Oe,ft);if(pe!=null&&pe!==Q&&(cs(pe)?(he[pe]=null,je(pe)&&(ye[pe]=null)):Fs(pe)&&(pe.value=null)),Tr(Q))om(Q,o,12,[j,he]);else{const ft=cs(Q),rt=Fs(Q);if(ft||rt){const mt=()=>{if(f.f){const Wt=ft?je(Q)?ye[Q]:he[Q]:Q.value;M?pr(Wt)&&H0(Wt,k):pr(Wt)?Wt.includes(k)||Wt.push(k):ft?(he[Q]=[k],je(Q)&&(ye[Q]=he[Q])):(Q.value=[k],f.k&&(he[f.k]=Q.value))}else ft?(he[Q]=j,je(Q)&&(ye[Q]=j)):rt&&(Q.value=j,f.k&&(he[f.k]=j))};j?(mt.id=-1,Po(mt,T)):mt()}}}Fg().requestIdleCallback;Fg().cancelIdleCallback;const qp=f=>!!f.type.__asyncLoader,sS=f=>f.type.__isKeepAlive;function oS(f,g){lS(f,"a",g)}function aS(f,g){lS(f,"da",g)}function lS(f,g,T=Ms){const C=f.__wdc||(f.__wdc=()=>{let M=T;for(;M;){if(M.isDeactivated)return;M=M.parent}return f()});if(Gg(g,C,T),T){let M=T.parent;for(;M&&M.parent;)sS(M.parent.vnode)&&rM(C,g,T,M),M=M.parent}}function rM(f,g,T,C){const M=Gg(g,f,C,!0);uS(()=>{H0(C[g],M)},T)}function Gg(f,g,T=Ms,C=!1){if(T){const M=T[f]||(T[f]=[]),k=g.__weh||(g.__weh=(...j)=>{Nl();const o=am(T),Q=nl(g,T,f,j);return o(),Vl(),Q});return C?M.unshift(k):M.push(k),k}}const Ul=f=>(g,T=Ms)=>{(!tm||f==="sp")&&Gg(f,(...C)=>g(...C),T)},nM=Ul("bm"),sM=Ul("m"),oM=Ul("bu"),aM=Ul("u"),cS=Ul("bum"),uS=Ul("um"),lM=Ul("sp"),cM=Ul("rtg"),uM=Ul("rtc");function hM(f,g=Ms){Gg("ec",f,g)}const dM="components";function Dd(f,g){return pM(dM,f,!0,g)||f}const fM=Symbol.for("v-ndc");function pM(f,g,T=!0,C=!1){const M=ho||Ms;if(M){const k=M.type;{const o=rR(k,!1);if(o&&(o===g||o===Yo(g)||o===kg(Yo(g))))return k}const j=pT(M[f]||k[f],g)||pT(M.appContext[f],g);return!j&&C?k:j}}function pT(f,g){return f&&(f[g]||f[Yo(g)]||f[kg(Yo(g))])}function iv(f,g,T,C){let M;const k=T,j=pr(f);if(j||cs(f)){const o=j&&Pd(f);let Q=!1,pe=!1;o&&(Q=!Ko(f),pe=Pc(f),f=Ng(f)),M=new Array(f.length);for(let he=0,ye=f.length;he<ye;he++)M[he]=g(Q?pe?bg(Ps(f[he])):Ps(f[he]):f[he],he,void 0,k)}else if(typeof f=="number"){M=new Array(f);for(let o=0;o<f;o++)M[o]=g(o+1,o,void 0,k)}else if(Bn(f))if(f[Symbol.iterator])M=Array.from(f,(o,Q)=>g(o,Q,void 0,k));else{const o=Object.keys(f);M=new Array(o.length);for(let Q=0,pe=o.length;Q<pe;Q++){const he=o[Q];M[Q]=g(f[he],he,Q,k)}}else M=[];return M}const S0=f=>f?MS(f)?$g(f):S0(f.parent):null,$p=Bs(Object.create(null),{$:f=>f,$el:f=>f.vnode.el,$data:f=>f.data,$props:f=>f.props,$attrs:f=>f.attrs,$slots:f=>f.slots,$refs:f=>f.refs,$parent:f=>S0(f.parent),$root:f=>S0(f.root),$host:f=>f.ce,$emit:f=>f.emit,$options:f=>dS(f),$forceUpdate:f=>f.f||(f.f=()=>{ev(f.update)}),$nextTick:f=>f.n||(f.n=Q0.bind(f.proxy)),$watch:f=>kM.bind(f)}),s0=(f,g)=>f!==xn&&!f.__isScriptSetup&&hn(f,g),mM={get({_:f},g){if(g==="__v_skip")return!0;const{ctx:T,setupState:C,data:M,props:k,accessCache:j,type:o,appContext:Q}=f;let pe;if(g[0]!=="$"){const je=j[g];if(je!==void 0)switch(je){case 1:return C[g];case 2:return M[g];case 4:return T[g];case 3:return k[g]}else{if(s0(C,g))return j[g]=1,C[g];if(M!==xn&&hn(M,g))return j[g]=2,M[g];if((pe=f.propsOptions[0])&&hn(pe,g))return j[g]=3,k[g];if(T!==xn&&hn(T,g))return j[g]=4,T[g];E0&&(j[g]=0)}}const he=$p[g];let ye,Oe;if(he)return g==="$attrs"&&Os(f.attrs,"get",""),he(f);if((ye=o.__cssModules)&&(ye=ye[g]))return ye;if(T!==xn&&hn(T,g))return j[g]=4,T[g];if(Oe=Q.config.globalProperties,hn(Oe,g))return Oe[g]},set({_:f},g,T){const{data:C,setupState:M,ctx:k}=f;return s0(M,g)?(M[g]=T,!0):C!==xn&&hn(C,g)?(C[g]=T,!0):hn(f.props,g)||g[0]==="$"&&g.slice(1)in f?!1:(k[g]=T,!0)},has({_:{data:f,setupState:g,accessCache:T,ctx:C,appContext:M,propsOptions:k}},j){let o;return!!T[j]||f!==xn&&hn(f,j)||s0(g,j)||(o=k[0])&&hn(o,j)||hn(C,j)||hn($p,j)||hn(M.config.globalProperties,j)},defineProperty(f,g,T){return T.get!=null?f._.accessCache[g]=0:hn(T,"value")&&this.set(f,g,T.value,null),Reflect.defineProperty(f,g,T)}};function mT(f){return pr(f)?f.reduce((g,T)=>(g[T]=null,g),{}):f}let E0=!0;function _M(f){const g=dS(f),T=f.proxy,C=f.ctx;E0=!1,g.beforeCreate&&_T(g.beforeCreate,f,"bc");const{data:M,computed:k,methods:j,watch:o,provide:Q,inject:pe,created:he,beforeMount:ye,mounted:Oe,beforeUpdate:je,updated:ft,activated:rt,deactivated:mt,beforeDestroy:Wt,beforeUnmount:wt,destroyed:Xt,unmounted:Zt,render:Li,renderTracked:Sr,renderTriggered:mr,errorCaptured:vn,serverPrefetch:Zn,expose:fs,inheritAttrs:Rs,components:Ns,directives:Fi,filters:Ro}=g;if(pe&&gM(pe,C,null),j)for(const Ei in j){const Oi=j[Ei];Tr(Oi)&&(C[Ei]=Oi.bind(T))}if(M){const Ei=M.call(T,T);Bn(Ei)&&(f.data=Vg(Ei))}if(E0=!0,k)for(const Ei in k){const Oi=k[Ei],Gn=Tr(Oi)?Oi.bind(T,T):Tr(Oi.get)?Oi.get.bind(T,T):il,Hn=!Tr(Oi)&&Tr(Oi.set)?Oi.set.bind(T):il,Nn=Aa({get:Gn,set:Hn});Object.defineProperty(C,Ei,{enumerable:!0,configurable:!0,get:()=>Nn.value,set:fn=>Nn.value=fn})}if(o)for(const Ei in o)hS(o[Ei],C,T,Ei);if(Q){const Ei=Tr(Q)?Q.call(T):Q;Reflect.ownKeys(Ei).forEach(Oi=>{dg(Oi,Ei[Oi])})}he&&_T(he,f,"c");function Qi(Ei,Oi){pr(Oi)?Oi.forEach(Gn=>Ei(Gn.bind(T))):Oi&&Ei(Oi.bind(T))}if(Qi(nM,ye),Qi(sM,Oe),Qi(oM,je),Qi(aM,ft),Qi(oS,rt),Qi(aS,mt),Qi(hM,vn),Qi(uM,Sr),Qi(cM,mr),Qi(cS,wt),Qi(uS,Zt),Qi(lM,Zn),pr(fs))if(fs.length){const Ei=f.exposed||(f.exposed={});fs.forEach(Oi=>{Object.defineProperty(Ei,Oi,{get:()=>T[Oi],set:Gn=>T[Oi]=Gn})})}else f.exposed||(f.exposed={});Li&&f.render===il&&(f.render=Li),Rs!=null&&(f.inheritAttrs=Rs),Ns&&(f.components=Ns),Fi&&(f.directives=Fi),Zn&&nS(f)}function gM(f,g,T=il){pr(f)&&(f=A0(f));for(const C in f){const M=f[C];let k;Bn(M)?"default"in M?k=rl(M.from||C,M.default,!0):k=rl(M.from||C):k=rl(M),Fs(k)?Object.defineProperty(g,C,{enumerable:!0,configurable:!0,get:()=>k.value,set:j=>k.value=j}):g[C]=k}}function _T(f,g,T){nl(pr(f)?f.map(C=>C.bind(g.proxy)):f.bind(g.proxy),g,T)}function hS(f,g,T,C){let M=C.includes(".")?SS(T,C):()=>T[C];if(cs(f)){const k=g[f];Tr(k)&&Wp(M,k)}else if(Tr(f))Wp(M,f.bind(T));else if(Bn(f))if(pr(f))f.forEach(k=>hS(k,g,T,C));else{const k=Tr(f.handler)?f.handler.bind(T):g[f.handler];Tr(k)&&Wp(M,k,f)}}function dS(f){const g=f.type,{mixins:T,extends:C}=g,{mixins:M,optionsCache:k,config:{optionMergeStrategies:j}}=f.appContext,o=k.get(g);let Q;return o?Q=o:!M.length&&!T&&!C?Q=g:(Q={},M.length&&M.forEach(pe=>Eg(Q,pe,j,!0)),Eg(Q,g,j)),Bn(g)&&k.set(g,Q),Q}function Eg(f,g,T,C=!1){const{mixins:M,extends:k}=g;k&&Eg(f,k,T,!0),M&&M.forEach(j=>Eg(f,j,T,!0));for(const j in g)if(!(C&&j==="expose")){const o=yM[j]||T&&T[j];f[j]=o?o(f[j],g[j]):g[j]}return f}const yM={data:gT,props:yT,emits:yT,methods:Vp,computed:Vp,beforeCreate:Xs,created:Xs,beforeMount:Xs,mounted:Xs,beforeUpdate:Xs,updated:Xs,beforeDestroy:Xs,beforeUnmount:Xs,destroyed:Xs,unmounted:Xs,activated:Xs,deactivated:Xs,errorCaptured:Xs,serverPrefetch:Xs,components:Vp,directives:Vp,watch:vM,provide:gT,inject:xM};function gT(f,g){return g?f?function(){return Bs(Tr(f)?f.call(this,this):f,Tr(g)?g.call(this,this):g)}:g:f}function xM(f,g){return Vp(A0(f),A0(g))}function A0(f){if(pr(f)){const g={};for(let T=0;T<f.length;T++)g[f[T]]=f[T];return g}return f}function Xs(f,g){return f?[...new Set([].concat(f,g))]:g}function Vp(f,g){return f?Bs(Object.create(null),f,g):g}function yT(f,g){return f?pr(f)&&pr(g)?[...new Set([...f,...g])]:Bs(Object.create(null),mT(f),mT(g??{})):g}function vM(f,g){if(!f)return g;if(!g)return f;const T=Bs(Object.create(null),f);for(const C in g)T[C]=Xs(f[C],g[C]);return T}function fS(){return{app:null,config:{isNativeTag:fP,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let bM=0;function wM(f,g){return function(C,M=null){Tr(C)||(C=Bs({},C)),M!=null&&!Bn(M)&&(M=null);const k=fS(),j=new WeakSet,o=[];let Q=!1;const pe=k.app={_uid:bM++,_component:C,_props:M,_container:null,_context:k,_instance:null,version:LS,get config(){return k.config},set config(he){},use(he,...ye){return j.has(he)||(he&&Tr(he.install)?(j.add(he),he.install(pe,...ye)):Tr(he)&&(j.add(he),he(pe,...ye))),pe},mixin(he){return k.mixins.includes(he)||k.mixins.push(he),pe},component(he,ye){return ye?(k.components[he]=ye,pe):k.components[he]},directive(he,ye){return ye?(k.directives[he]=ye,pe):k.directives[he]},mount(he,ye,Oe){if(!Q){const je=pe._ceVNode||ls(C,M);return je.appContext=k,Oe===!0?Oe="svg":Oe===!1&&(Oe=void 0),f(je,he,Oe),Q=!0,pe._container=he,he.__vue_app__=pe,$g(je.component)}},onUnmount(he){o.push(he)},unmount(){Q&&(nl(o,pe._instance,16),f(null,pe._container),delete pe._container.__vue_app__)},provide(he,ye){return k.provides[he]=ye,pe},runWithContext(he){const ye=Rd;Rd=pe;try{return he()}finally{Rd=ye}}};return pe}}let Rd=null;function dg(f,g){if(Ms){let T=Ms.provides;const C=Ms.parent&&Ms.parent.provides;C===T&&(T=Ms.provides=Object.create(C)),T[f]=g}}function rl(f,g,T=!1){const C=Ms||ho;if(C||Rd){let M=Rd?Rd._context.provides:C?C.parent==null||C.ce?C.vnode.appContext&&C.vnode.appContext.provides:C.parent.provides:void 0;if(M&&f in M)return M[f];if(arguments.length>1)return T&&Tr(g)?g.call(C&&C.proxy):g}}const pS={},mS=()=>Object.create(pS),_S=f=>Object.getPrototypeOf(f)===pS;function TM(f,g,T,C=!1){const M={},k=mS();f.propsDefaults=Object.create(null),gS(f,g,M,k);for(const j in f.propsOptions[0])j in M||(M[j]=void 0);T?f.props=C?M:Z2(M):f.type.props?f.props=M:f.props=k,f.attrs=k}function SM(f,g,T,C){const{props:M,attrs:k,vnode:{patchFlag:j}}=f,o=un(M),[Q]=f.propsOptions;let pe=!1;if((C||j>0)&&!(j&16)){if(j&8){const he=f.vnode.dynamicProps;for(let ye=0;ye<he.length;ye++){let Oe=he[ye];if(Hg(f.emitsOptions,Oe))continue;const je=g[Oe];if(Q)if(hn(k,Oe))je!==k[Oe]&&(k[Oe]=je,pe=!0);else{const ft=Yo(Oe);M[ft]=I0(Q,o,ft,je,f,!1)}else je!==k[Oe]&&(k[Oe]=je,pe=!0)}}}else{gS(f,g,M,k)&&(pe=!0);let he;for(const ye in o)(!g||!hn(g,ye)&&((he=Ou(ye))===ye||!hn(g,he)))&&(Q?T&&(T[ye]!==void 0||T[he]!==void 0)&&(M[ye]=I0(Q,o,ye,void 0,f,!0)):delete M[ye]);if(k!==o)for(const ye in k)(!g||!hn(g,ye))&&(delete k[ye],pe=!0)}pe&&Fl(f.attrs,"set","")}function gS(f,g,T,C){const[M,k]=f.propsOptions;let j=!1,o;if(g)for(let Q in g){if(Up(Q))continue;const pe=g[Q];let he;M&&hn(M,he=Yo(Q))?!k||!k.includes(he)?T[he]=pe:(o||(o={}))[he]=pe:Hg(f.emitsOptions,Q)||(!(Q in C)||pe!==C[Q])&&(C[Q]=pe,j=!0)}if(k){const Q=un(T),pe=o||xn;for(let he=0;he<k.length;he++){const ye=k[he];T[ye]=I0(M,Q,ye,pe[ye],f,!hn(pe,ye))}}return j}function I0(f,g,T,C,M,k){const j=f[T];if(j!=null){const o=hn(j,"default");if(o&&C===void 0){const Q=j.default;if(j.type!==Function&&!j.skipFactory&&Tr(Q)){const{propsDefaults:pe}=M;if(T in pe)C=pe[T];else{const he=am(M);C=pe[T]=Q.call(null,g),he()}}else C=Q;M.ce&&M.ce._setProp(T,C)}j[0]&&(k&&!o?C=!1:j[1]&&(C===""||C===Ou(T))&&(C=!0))}return C}const EM=new WeakMap;function yS(f,g,T=!1){const C=T?EM:g.propsCache,M=C.get(f);if(M)return M;const k=f.props,j={},o=[];let Q=!1;if(!Tr(f)){const he=ye=>{Q=!0;const[Oe,je]=yS(ye,g,!0);Bs(j,Oe),je&&o.push(...je)};!T&&g.mixins.length&&g.mixins.forEach(he),f.extends&&he(f.extends),f.mixins&&f.mixins.forEach(he)}if(!k&&!Q)return Bn(f)&&C.set(f,Id),Id;if(pr(k))for(let he=0;he<k.length;he++){const ye=Yo(k[he]);xT(ye)&&(j[ye]=xn)}else if(k)for(const he in k){const ye=Yo(he);if(xT(ye)){const Oe=k[he],je=j[ye]=pr(Oe)||Tr(Oe)?{type:Oe}:Bs({},Oe),ft=je.type;let rt=!1,mt=!0;if(pr(ft))for(let Wt=0;Wt<ft.length;++Wt){const wt=ft[Wt],Xt=Tr(wt)&&wt.name;if(Xt==="Boolean"){rt=!0;break}else Xt==="String"&&(mt=!1)}else rt=Tr(ft)&&ft.name==="Boolean";je[0]=rt,je[1]=mt,(rt||hn(je,"default"))&&o.push(ye)}}const pe=[j,o];return Bn(f)&&C.set(f,pe),pe}function xT(f){return f[0]!=="$"&&!Up(f)}const rv=f=>f[0]==="_"||f==="$stable",nv=f=>pr(f)?f.map(tl):[tl(f)],AM=(f,g,T)=>{if(g._n)return g;const C=jg((...M)=>nv(g(...M)),T);return C._c=!1,C},xS=(f,g,T)=>{const C=f._ctx;for(const M in f){if(rv(M))continue;const k=f[M];if(Tr(k))g[M]=AM(M,k,C);else if(k!=null){const j=nv(k);g[M]=()=>j}}},vS=(f,g)=>{const T=nv(g);f.slots.default=()=>T},bS=(f,g,T)=>{for(const C in g)(T||!rv(C))&&(f[C]=g[C])},IM=(f,g,T)=>{const C=f.slots=mS();if(f.vnode.shapeFlag&32){const M=g.__;M&&g0(C,"__",M,!0);const k=g._;k?(bS(C,g,T),T&&g0(C,"_",k,!0)):xS(g,C)}else g&&vS(f,g)},CM=(f,g,T)=>{const{vnode:C,slots:M}=f;let k=!0,j=xn;if(C.shapeFlag&32){const o=g._;o?T&&o===1?k=!1:bS(M,g,T):(k=!g.$stable,xS(g,M)),j=g}else g&&(vS(f,g),j={default:1});if(k)for(const o in M)!rv(o)&&j[o]==null&&delete M[o]},Po=GM;function PM(f){return MM(f)}function MM(f,g){const T=Fg();T.__VUE__=!0;const{insert:C,remove:M,patchProp:k,createElement:j,createText:o,createComment:Q,setText:pe,setElementText:he,parentNode:ye,nextSibling:Oe,setScopeId:je=il,insertStaticContent:ft}=f,rt=(Ie,Ae,$e,It=null,Ct=null,bt=null,jt=void 0,ri=null,Jt=!!Ae.dynamicChildren)=>{if(Ie===Ae)return;Ie&&!Fp(Ie,Ae)&&(It=Rt(Ie),fn(Ie,Ct,bt,!0),Ie=null),Ae.patchFlag===-2&&(Jt=!1,Ae.dynamicChildren=null);const{type:Gt,ref:Ai,shapeFlag:ni}=Ae;switch(Gt){case qg:mt(Ie,Ae,$e,It);break;case Mc:Wt(Ie,Ae,$e,It);break;case fg:Ie==null&&wt(Ae,$e,It,jt);break;case Xo:Ns(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt);break;default:ni&1?Li(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt):ni&6?Fi(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt):(ni&64||ni&128)&&Gt.process(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt,Yt)}Ai!=null&&Ct?Hp(Ai,Ie&&Ie.ref,bt,Ae||Ie,!Ae):Ai==null&&Ie&&Ie.ref!=null&&Hp(Ie.ref,null,bt,Ie,!0)},mt=(Ie,Ae,$e,It)=>{if(Ie==null)C(Ae.el=o(Ae.children),$e,It);else{const Ct=Ae.el=Ie.el;Ae.children!==Ie.children&&pe(Ct,Ae.children)}},Wt=(Ie,Ae,$e,It)=>{Ie==null?C(Ae.el=Q(Ae.children||""),$e,It):Ae.el=Ie.el},wt=(Ie,Ae,$e,It)=>{[Ie.el,Ie.anchor]=ft(Ie.children,Ae,$e,It,Ie.el,Ie.anchor)},Xt=({el:Ie,anchor:Ae},$e,It)=>{let Ct;for(;Ie&&Ie!==Ae;)Ct=Oe(Ie),C(Ie,$e,It),Ie=Ct;C(Ae,$e,It)},Zt=({el:Ie,anchor:Ae})=>{let $e;for(;Ie&&Ie!==Ae;)$e=Oe(Ie),M(Ie),Ie=$e;M(Ae)},Li=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt)=>{Ae.type==="svg"?jt="svg":Ae.type==="math"&&(jt="mathml"),Ie==null?Sr(Ae,$e,It,Ct,bt,jt,ri,Jt):Zn(Ie,Ae,Ct,bt,jt,ri,Jt)},Sr=(Ie,Ae,$e,It,Ct,bt,jt,ri)=>{let Jt,Gt;const{props:Ai,shapeFlag:ni,transition:hi,dirs:Bi}=Ie;if(Jt=Ie.el=j(Ie.type,bt,Ai&&Ai.is,Ai),ni&8?he(Jt,Ie.children):ni&16&&vn(Ie.children,Jt,null,It,Ct,o0(Ie,bt),jt,ri),Bi&&Cu(Ie,null,It,"created"),mr(Jt,Ie,Ie.scopeId,jt,It),Ai){for(const Dr in Ai)Dr!=="value"&&!Up(Dr)&&k(Jt,Dr,null,Ai[Dr],bt,It);"value"in Ai&&k(Jt,"value",null,Ai.value,bt),(Gt=Ai.onVnodeBeforeMount)&&Ja(Gt,It,Ie)}Bi&&Cu(Ie,null,It,"beforeMount");const vr=RM(Ct,hi);vr&&hi.beforeEnter(Jt),C(Jt,Ae,$e),((Gt=Ai&&Ai.onVnodeMounted)||vr||Bi)&&Po(()=>{Gt&&Ja(Gt,It,Ie),vr&&hi.enter(Jt),Bi&&Cu(Ie,null,It,"mounted")},Ct)},mr=(Ie,Ae,$e,It,Ct)=>{if($e&&je(Ie,$e),It)for(let bt=0;bt<It.length;bt++)je(Ie,It[bt]);if(Ct){let bt=Ct.subTree;if(Ae===bt||AS(bt.type)&&(bt.ssContent===Ae||bt.ssFallback===Ae)){const jt=Ct.vnode;mr(Ie,jt,jt.scopeId,jt.slotScopeIds,Ct.parent)}}},vn=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt=0)=>{for(let Gt=Jt;Gt<Ie.length;Gt++){const Ai=Ie[Gt]=ri?Sc(Ie[Gt]):tl(Ie[Gt]);rt(null,Ai,Ae,$e,It,Ct,bt,jt,ri)}},Zn=(Ie,Ae,$e,It,Ct,bt,jt)=>{const ri=Ae.el=Ie.el;let{patchFlag:Jt,dynamicChildren:Gt,dirs:Ai}=Ae;Jt|=Ie.patchFlag&16;const ni=Ie.props||xn,hi=Ae.props||xn;let Bi;if($e&&Pu($e,!1),(Bi=hi.onVnodeBeforeUpdate)&&Ja(Bi,$e,Ae,Ie),Ai&&Cu(Ae,Ie,$e,"beforeUpdate"),$e&&Pu($e,!0),(ni.innerHTML&&hi.innerHTML==null||ni.textContent&&hi.textContent==null)&&he(ri,""),Gt?fs(Ie.dynamicChildren,Gt,ri,$e,It,o0(Ae,Ct),bt):jt||Oi(Ie,Ae,ri,null,$e,It,o0(Ae,Ct),bt,!1),Jt>0){if(Jt&16)Rs(ri,ni,hi,$e,Ct);else if(Jt&2&&ni.class!==hi.class&&k(ri,"class",null,hi.class,Ct),Jt&4&&k(ri,"style",ni.style,hi.style,Ct),Jt&8){const vr=Ae.dynamicProps;for(let Dr=0;Dr<vr.length;Dr++){const Pr=vr[Dr],Yr=ni[Pr],Dn=hi[Pr];(Dn!==Yr||Pr==="value")&&k(ri,Pr,Yr,Dn,Ct,$e)}}Jt&1&&Ie.children!==Ae.children&&he(ri,Ae.children)}else!jt&&Gt==null&&Rs(ri,ni,hi,$e,Ct);((Bi=hi.onVnodeUpdated)||Ai)&&Po(()=>{Bi&&Ja(Bi,$e,Ae,Ie),Ai&&Cu(Ae,Ie,$e,"updated")},It)},fs=(Ie,Ae,$e,It,Ct,bt,jt)=>{for(let ri=0;ri<Ae.length;ri++){const Jt=Ie[ri],Gt=Ae[ri],Ai=Jt.el&&(Jt.type===Xo||!Fp(Jt,Gt)||Jt.shapeFlag&198)?ye(Jt.el):$e;rt(Jt,Gt,Ai,null,It,Ct,bt,jt,!0)}},Rs=(Ie,Ae,$e,It,Ct)=>{if(Ae!==$e){if(Ae!==xn)for(const bt in Ae)!Up(bt)&&!(bt in $e)&&k(Ie,bt,Ae[bt],null,Ct,It);for(const bt in $e){if(Up(bt))continue;const jt=$e[bt],ri=Ae[bt];jt!==ri&&bt!=="value"&&k(Ie,bt,ri,jt,Ct,It)}"value"in $e&&k(Ie,"value",Ae.value,$e.value,Ct)}},Ns=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt)=>{const Gt=Ae.el=Ie?Ie.el:o(""),Ai=Ae.anchor=Ie?Ie.anchor:o("");let{patchFlag:ni,dynamicChildren:hi,slotScopeIds:Bi}=Ae;Bi&&(ri=ri?ri.concat(Bi):Bi),Ie==null?(C(Gt,$e,It),C(Ai,$e,It),vn(Ae.children||[],$e,Ai,Ct,bt,jt,ri,Jt)):ni>0&&ni&64&&hi&&Ie.dynamicChildren?(fs(Ie.dynamicChildren,hi,$e,Ct,bt,jt,ri),(Ae.key!=null||Ct&&Ae===Ct.subTree)&&wS(Ie,Ae,!0)):Oi(Ie,Ae,$e,Ai,Ct,bt,jt,ri,Jt)},Fi=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt)=>{Ae.slotScopeIds=ri,Ie==null?Ae.shapeFlag&512?Ct.ctx.activate(Ae,$e,It,jt,Jt):Ro(Ae,$e,It,Ct,bt,jt,Jt):ln(Ie,Ae,Jt)},Ro=(Ie,Ae,$e,It,Ct,bt,jt)=>{const ri=Ie.component=YM(Ie,It,Ct);if(sS(Ie)&&(ri.ctx.renderer=Yt),QM(ri,!1,jt),ri.asyncDep){if(Ct&&Ct.registerDep(ri,Qi,jt),!Ie.el){const Jt=ri.subTree=ls(Mc);Wt(null,Jt,Ae,$e)}}else Qi(ri,Ie,Ae,$e,Ct,bt,jt)},ln=(Ie,Ae,$e)=>{const It=Ae.component=Ie.component;if(UM(Ie,Ae,$e))if(It.asyncDep&&!It.asyncResolved){Ei(It,Ae,$e);return}else It.next=Ae,It.update();else Ae.el=Ie.el,It.vnode=Ae},Qi=(Ie,Ae,$e,It,Ct,bt,jt)=>{const ri=()=>{if(Ie.isMounted){let{next:ni,bu:hi,u:Bi,parent:vr,vnode:Dr}=Ie;{const ts=TS(Ie);if(ts){ni&&(ni.el=Dr.el,Ei(Ie,ni,jt)),ts.asyncDep.then(()=>{Ie.isUnmounted||ri()});return}}let Pr=ni,Yr;Pu(Ie,!1),ni?(ni.el=Dr.el,Ei(Ie,ni,jt)):ni=Dr,hi&&hg(hi),(Yr=ni.props&&ni.props.onVnodeBeforeUpdate)&&Ja(Yr,vr,ni,Dr),Pu(Ie,!0);const Dn=bT(Ie),es=Ie.subTree;Ie.subTree=Dn,rt(es,Dn,ye(es.el),Rt(es),Ie,Ct,bt),ni.el=Dn.el,Pr===null&&jM(Ie,Dn.el),Bi&&Po(Bi,Ct),(Yr=ni.props&&ni.props.onVnodeUpdated)&&Po(()=>Ja(Yr,vr,ni,Dr),Ct)}else{let ni;const{el:hi,props:Bi}=Ae,{bm:vr,m:Dr,parent:Pr,root:Yr,type:Dn}=Ie,es=qp(Ae);Pu(Ie,!1),vr&&hg(vr),!es&&(ni=Bi&&Bi.onVnodeBeforeMount)&&Ja(ni,Pr,Ae),Pu(Ie,!0);{Yr.ce&&Yr.ce._def.shadowRoot!==!1&&Yr.ce._injectChildStyle(Dn);const ts=Ie.subTree=bT(Ie);rt(null,ts,$e,It,Ie,Ct,bt),Ae.el=ts.el}if(Dr&&Po(Dr,Ct),!es&&(ni=Bi&&Bi.onVnodeMounted)){const ts=Ae;Po(()=>Ja(ni,Pr,ts),Ct)}(Ae.shapeFlag&256||Pr&&qp(Pr.vnode)&&Pr.vnode.shapeFlag&256)&&Ie.a&&Po(Ie.a,Ct),Ie.isMounted=!0,Ae=$e=It=null}};Ie.scope.on();const Jt=Ie.effect=new z2(ri);Ie.scope.off();const Gt=Ie.update=Jt.run.bind(Jt),Ai=Ie.job=Jt.runIfDirty.bind(Jt);Ai.i=Ie,Ai.id=Ie.uid,Jt.scheduler=()=>ev(Ai),Pu(Ie,!0),Gt()},Ei=(Ie,Ae,$e)=>{Ae.component=Ie;const It=Ie.vnode.props;Ie.vnode=Ae,Ie.next=null,SM(Ie,Ae.props,It,$e),CM(Ie,Ae.children,$e),Nl(),dT(Ie),Vl()},Oi=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt=!1)=>{const Gt=Ie&&Ie.children,Ai=Ie?Ie.shapeFlag:0,ni=Ae.children,{patchFlag:hi,shapeFlag:Bi}=Ae;if(hi>0){if(hi&128){Hn(Gt,ni,$e,It,Ct,bt,jt,ri,Jt);return}else if(hi&256){Gn(Gt,ni,$e,It,Ct,bt,jt,ri,Jt);return}}Bi&8?(Ai&16&&Qn(Gt,Ct,bt),ni!==Gt&&he($e,ni)):Ai&16?Bi&16?Hn(Gt,ni,$e,It,Ct,bt,jt,ri,Jt):Qn(Gt,Ct,bt,!0):(Ai&8&&he($e,""),Bi&16&&vn(ni,$e,It,Ct,bt,jt,ri,Jt))},Gn=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt)=>{Ie=Ie||Id,Ae=Ae||Id;const Gt=Ie.length,Ai=Ae.length,ni=Math.min(Gt,Ai);let hi;for(hi=0;hi<ni;hi++){const Bi=Ae[hi]=Jt?Sc(Ae[hi]):tl(Ae[hi]);rt(Ie[hi],Bi,$e,null,Ct,bt,jt,ri,Jt)}Gt>Ai?Qn(Ie,Ct,bt,!0,!1,ni):vn(Ae,$e,It,Ct,bt,jt,ri,Jt,ni)},Hn=(Ie,Ae,$e,It,Ct,bt,jt,ri,Jt)=>{let Gt=0;const Ai=Ae.length;let ni=Ie.length-1,hi=Ai-1;for(;Gt<=ni&&Gt<=hi;){const Bi=Ie[Gt],vr=Ae[Gt]=Jt?Sc(Ae[Gt]):tl(Ae[Gt]);if(Fp(Bi,vr))rt(Bi,vr,$e,null,Ct,bt,jt,ri,Jt);else break;Gt++}for(;Gt<=ni&&Gt<=hi;){const Bi=Ie[ni],vr=Ae[hi]=Jt?Sc(Ae[hi]):tl(Ae[hi]);if(Fp(Bi,vr))rt(Bi,vr,$e,null,Ct,bt,jt,ri,Jt);else break;ni--,hi--}if(Gt>ni){if(Gt<=hi){const Bi=hi+1,vr=Bi<Ai?Ae[Bi].el:It;for(;Gt<=hi;)rt(null,Ae[Gt]=Jt?Sc(Ae[Gt]):tl(Ae[Gt]),$e,vr,Ct,bt,jt,ri,Jt),Gt++}}else if(Gt>hi)for(;Gt<=ni;)fn(Ie[Gt],Ct,bt,!0),Gt++;else{const Bi=Gt,vr=Gt,Dr=new Map;for(Gt=vr;Gt<=hi;Gt++){const rn=Ae[Gt]=Jt?Sc(Ae[Gt]):tl(Ae[Gt]);rn.key!=null&&Dr.set(rn.key,Gt)}let Pr,Yr=0;const Dn=hi-vr+1;let es=!1,ts=0;const Ys=new Array(Dn);for(Gt=0;Gt<Dn;Gt++)Ys[Gt]=0;for(Gt=Bi;Gt<=ni;Gt++){const rn=Ie[Gt];if(Yr>=Dn){fn(rn,Ct,bt,!0);continue}let ps;if(rn.key!=null)ps=Dr.get(rn.key);else for(Pr=vr;Pr<=hi;Pr++)if(Ys[Pr-vr]===0&&Fp(rn,Ae[Pr])){ps=Pr;break}ps===void 0?fn(rn,Ct,bt,!0):(Ys[ps-vr]=Gt+1,ps>=ts?ts=ps:es=!0,rt(rn,Ae[ps],$e,null,Ct,bt,jt,ri,Jt),Yr++)}const bn=es?DM(Ys):Id;for(Pr=bn.length-1,Gt=Dn-1;Gt>=0;Gt--){const rn=vr+Gt,ps=Ae[rn],mo=rn+1<Ai?Ae[rn+1].el:It;Ys[Gt]===0?rt(null,ps,$e,mo,Ct,bt,jt,ri,Jt):es&&(Pr<0||Gt!==bn[Pr]?Nn(ps,$e,mo,2):Pr--)}}},Nn=(Ie,Ae,$e,It,Ct=null)=>{const{el:bt,type:jt,transition:ri,children:Jt,shapeFlag:Gt}=Ie;if(Gt&6){Nn(Ie.component.subTree,Ae,$e,It);return}if(Gt&128){Ie.suspense.move(Ae,$e,It);return}if(Gt&64){jt.move(Ie,Ae,$e,Yt);return}if(jt===Xo){C(bt,Ae,$e);for(let ni=0;ni<Jt.length;ni++)Nn(Jt[ni],Ae,$e,It);C(Ie.anchor,Ae,$e);return}if(jt===fg){Xt(Ie,Ae,$e);return}if(It!==2&&Gt&1&&ri)if(It===0)ri.beforeEnter(bt),C(bt,Ae,$e),Po(()=>ri.enter(bt),Ct);else{const{leave:ni,delayLeave:hi,afterLeave:Bi}=ri,vr=()=>{Ie.ctx.isUnmounted?M(bt):C(bt,Ae,$e)},Dr=()=>{ni(bt,()=>{vr(),Bi&&Bi()})};hi?hi(bt,vr,Dr):Dr()}else C(bt,Ae,$e)},fn=(Ie,Ae,$e,It=!1,Ct=!1)=>{const{type:bt,props:jt,ref:ri,children:Jt,dynamicChildren:Gt,shapeFlag:Ai,patchFlag:ni,dirs:hi,cacheIndex:Bi}=Ie;if(ni===-2&&(Ct=!1),ri!=null&&(Nl(),Hp(ri,null,$e,Ie,!0),Vl()),Bi!=null&&(Ae.renderCache[Bi]=void 0),Ai&256){Ae.ctx.deactivate(Ie);return}const vr=Ai&1&&hi,Dr=!qp(Ie);let Pr;if(Dr&&(Pr=jt&&jt.onVnodeBeforeUnmount)&&Ja(Pr,Ae,Ie),Ai&6)Jo(Ie.component,$e,It);else{if(Ai&128){Ie.suspense.unmount($e,It);return}vr&&Cu(Ie,null,Ae,"beforeUnmount"),Ai&64?Ie.type.remove(Ie,Ae,$e,Yt,It):Gt&&!Gt.hasOnce&&(bt!==Xo||ni>0&&ni&64)?Qn(Gt,Ae,$e,!1,!0):(bt===Xo&&ni&384||!Ct&&Ai&16)&&Qn(Jt,Ae,$e),It&&Cr(Ie)}(Dr&&(Pr=jt&&jt.onVnodeUnmounted)||vr)&&Po(()=>{Pr&&Ja(Pr,Ae,Ie),vr&&Cu(Ie,null,Ae,"unmounted")},$e)},Cr=Ie=>{const{type:Ae,el:$e,anchor:It,transition:Ct}=Ie;if(Ae===Xo){qn($e,It);return}if(Ae===fg){Zt(Ie);return}const bt=()=>{M($e),Ct&&!Ct.persisted&&Ct.afterLeave&&Ct.afterLeave()};if(Ie.shapeFlag&1&&Ct&&!Ct.persisted){const{leave:jt,delayLeave:ri}=Ct,Jt=()=>jt($e,bt);ri?ri(Ie.el,bt,Jt):Jt()}else bt()},qn=(Ie,Ae)=>{let $e;for(;Ie!==Ae;)$e=Oe(Ie),M(Ie),Ie=$e;M(Ae)},Jo=(Ie,Ae,$e)=>{const{bum:It,scope:Ct,job:bt,subTree:jt,um:ri,m:Jt,a:Gt,parent:Ai,slots:{__:ni}}=Ie;vT(Jt),vT(Gt),It&&hg(It),Ai&&pr(ni)&&ni.forEach(hi=>{Ai.renderCache[hi]=void 0}),Ct.stop(),bt&&(bt.flags|=8,fn(jt,Ie,Ae,$e)),ri&&Po(ri,Ae),Po(()=>{Ie.isUnmounted=!0},Ae),Ae&&Ae.pendingBranch&&!Ae.isUnmounted&&Ie.asyncDep&&!Ie.asyncResolved&&Ie.suspenseId===Ae.pendingId&&(Ae.deps--,Ae.deps===0&&Ae.resolve())},Qn=(Ie,Ae,$e,It=!1,Ct=!1,bt=0)=>{for(let jt=bt;jt<Ie.length;jt++)fn(Ie[jt],Ae,$e,It,Ct)},Rt=Ie=>{if(Ie.shapeFlag&6)return Rt(Ie.component.subTree);if(Ie.shapeFlag&128)return Ie.suspense.next();const Ae=Oe(Ie.anchor||Ie.el),$e=Ae&&Ae[tM];return $e?Oe($e):Ae};let ci=!1;const zt=(Ie,Ae,$e)=>{Ie==null?Ae._vnode&&fn(Ae._vnode,null,null,!0):rt(Ae._vnode||null,Ie,Ae,null,null,null,$e),Ae._vnode=Ie,ci||(ci=!0,dT(),eS(),ci=!1)},Yt={p:rt,um:fn,m:Nn,r:Cr,mt:Ro,mc:vn,pc:Oi,pbc:fs,n:Rt,o:f};return{render:zt,hydrate:void 0,createApp:wM(zt)}}function o0({type:f,props:g},T){return T==="svg"&&f==="foreignObject"||T==="mathml"&&f==="annotation-xml"&&g&&g.encoding&&g.encoding.includes("html")?void 0:T}function Pu({effect:f,job:g},T){T?(f.flags|=32,g.flags|=4):(f.flags&=-33,g.flags&=-5)}function RM(f,g){return(!f||f&&!f.pendingBranch)&&g&&!g.persisted}function wS(f,g,T=!1){const C=f.children,M=g.children;if(pr(C)&&pr(M))for(let k=0;k<C.length;k++){const j=C[k];let o=M[k];o.shapeFlag&1&&!o.dynamicChildren&&((o.patchFlag<=0||o.patchFlag===32)&&(o=M[k]=Sc(M[k]),o.el=j.el),!T&&o.patchFlag!==-2&&wS(j,o)),o.type===qg&&(o.el=j.el),o.type===Mc&&!o.el&&(o.el=j.el)}}function DM(f){const g=f.slice(),T=[0];let C,M,k,j,o;const Q=f.length;for(C=0;C<Q;C++){const pe=f[C];if(pe!==0){if(M=T[T.length-1],f[M]<pe){g[C]=M,T.push(C);continue}for(k=0,j=T.length-1;k<j;)o=k+j>>1,f[T[o]]<pe?k=o+1:j=o;pe<f[T[k]]&&(k>0&&(g[C]=T[k-1]),T[k]=C)}}for(k=T.length,j=T[k-1];k-- >0;)T[k]=j,j=g[j];return T}function TS(f){const g=f.subTree.component;if(g)return g.asyncDep&&!g.asyncResolved?g:TS(g)}function vT(f){if(f)for(let g=0;g<f.length;g++)f[g].flags|=8}const LM=Symbol.for("v-scx"),zM=()=>rl(LM);function OM(f,g){return sv(f,null,g)}function Wp(f,g,T){return sv(f,g,T)}function sv(f,g,T=xn){const{immediate:C,deep:M,flush:k,once:j}=T,o=Bs({},T),Q=g&&C||!g&&k!=="post";let pe;if(tm){if(k==="sync"){const je=zM();pe=je.__watcherHandles||(je.__watcherHandles=[])}else if(!Q){const je=()=>{};return je.stop=il,je.resume=il,je.pause=il,je}}const he=Ms;o.call=(je,ft,rt)=>nl(je,he,ft,rt);let ye=!1;k==="post"?o.scheduler=je=>{Po(je,he&&he.suspense)}:k!=="sync"&&(ye=!0,o.scheduler=(je,ft)=>{ft?je():ev(je)}),o.augmentJob=je=>{g&&(je.flags|=4),ye&&(je.flags|=2,he&&(je.id=he.uid,je.i=he))};const Oe=YP(f,g,o);return tm&&(pe?pe.push(Oe):Q&&Oe()),Oe}function kM(f,g,T){const C=this.proxy,M=cs(f)?f.includes(".")?SS(C,f):()=>C[f]:f.bind(C,C);let k;Tr(g)?k=g:(k=g.handler,T=g);const j=am(this),o=sv(M,k.bind(C),T);return j(),o}function SS(f,g){const T=g.split(".");return()=>{let C=f;for(let M=0;M<T.length&&C;M++)C=C[T[M]];return C}}const FM=(f,g)=>g==="modelValue"||g==="model-value"?f.modelModifiers:f[`${g}Modifiers`]||f[`${Yo(g)}Modifiers`]||f[`${Ou(g)}Modifiers`];function BM(f,g,...T){if(f.isUnmounted)return;const C=f.vnode.props||xn;let M=T;const k=g.startsWith("update:"),j=k&&FM(C,g.slice(7));j&&(j.trim&&(M=T.map(he=>cs(he)?he.trim():he)),j.number&&(M=T.map(y0)));let o,Q=C[o=e0(g)]||C[o=e0(Yo(g))];!Q&&k&&(Q=C[o=e0(Ou(g))]),Q&&nl(Q,f,6,M);const pe=C[o+"Once"];if(pe){if(!f.emitted)f.emitted={};else if(f.emitted[o])return;f.emitted[o]=!0,nl(pe,f,6,M)}}function ES(f,g,T=!1){const C=g.emitsCache,M=C.get(f);if(M!==void 0)return M;const k=f.emits;let j={},o=!1;if(!Tr(f)){const Q=pe=>{const he=ES(pe,g,!0);he&&(o=!0,Bs(j,he))};!T&&g.mixins.length&&g.mixins.forEach(Q),f.extends&&Q(f.extends),f.mixins&&f.mixins.forEach(Q)}return!k&&!o?(Bn(f)&&C.set(f,null),null):(pr(k)?k.forEach(Q=>j[Q]=null):Bs(j,k),Bn(f)&&C.set(f,j),j)}function Hg(f,g){return!f||!Lg(g)?!1:(g=g.slice(2).replace(/Once$/,""),hn(f,g[0].toLowerCase()+g.slice(1))||hn(f,Ou(g))||hn(f,g))}function bT(f){const{type:g,vnode:T,proxy:C,withProxy:M,propsOptions:[k],slots:j,attrs:o,emit:Q,render:pe,renderCache:he,props:ye,data:Oe,setupState:je,ctx:ft,inheritAttrs:rt}=f,mt=Sg(f);let Wt,wt;try{if(T.shapeFlag&4){const Zt=M||C,Li=Zt;Wt=tl(pe.call(Li,Zt,he,ye,je,Oe,ft)),wt=o}else{const Zt=g;Wt=tl(Zt.length>1?Zt(ye,{attrs:o,slots:j,emit:Q}):Zt(ye,null)),wt=g.props?o:NM(o)}}catch(Zt){Zp.length=0,Ug(Zt,f,1),Wt=ls(Mc)}let Xt=Wt;if(wt&&rt!==!1){const Zt=Object.keys(wt),{shapeFlag:Li}=Xt;Zt.length&&Li&7&&(k&&Zt.some(G0)&&(wt=VM(wt,k)),Xt=Ld(Xt,wt,!1,!0))}return T.dirs&&(Xt=Ld(Xt,null,!1,!0),Xt.dirs=Xt.dirs?Xt.dirs.concat(T.dirs):T.dirs),T.transition&&tv(Xt,T.transition),Wt=Xt,Sg(mt),Wt}const NM=f=>{let g;for(const T in f)(T==="class"||T==="style"||Lg(T))&&((g||(g={}))[T]=f[T]);return g},VM=(f,g)=>{const T={};for(const C in f)(!G0(C)||!(C.slice(9)in g))&&(T[C]=f[C]);return T};function UM(f,g,T){const{props:C,children:M,component:k}=f,{props:j,children:o,patchFlag:Q}=g,pe=k.emitsOptions;if(g.dirs||g.transition)return!0;if(T&&Q>=0){if(Q&1024)return!0;if(Q&16)return C?wT(C,j,pe):!!j;if(Q&8){const he=g.dynamicProps;for(let ye=0;ye<he.length;ye++){const Oe=he[ye];if(j[Oe]!==C[Oe]&&!Hg(pe,Oe))return!0}}}else return(M||o)&&(!o||!o.$stable)?!0:C===j?!1:C?j?wT(C,j,pe):!0:!!j;return!1}function wT(f,g,T){const C=Object.keys(g);if(C.length!==Object.keys(f).length)return!0;for(let M=0;M<C.length;M++){const k=C[M];if(g[k]!==f[k]&&!Hg(T,k))return!0}return!1}function jM({vnode:f,parent:g},T){for(;g;){const C=g.subTree;if(C.suspense&&C.suspense.activeBranch===f&&(C.el=f.el),C===f)(f=g.vnode).el=T,g=g.parent;else break}}const AS=f=>f.__isSuspense;function GM(f,g){g&&g.pendingBranch?pr(f)?g.effects.push(...f):g.effects.push(f):eM(f)}const Xo=Symbol.for("v-fgt"),qg=Symbol.for("v-txt"),Mc=Symbol.for("v-cmt"),fg=Symbol.for("v-stc"),Zp=[];let Mo=null;function Rn(f=!1){Zp.push(Mo=f?null:[])}function HM(){Zp.pop(),Mo=Zp[Zp.length-1]||null}let em=1;function TT(f,g=!1){em+=f,f<0&&Mo&&g&&(Mo.hasOnce=!0)}function IS(f){return f.dynamicChildren=em>0?Mo||Id:null,HM(),em>0&&Mo&&Mo.push(f),f}function Fn(f,g,T,C,M,k){return IS(ot(f,g,T,C,M,k,!0))}function qM(f,g,T,C,M){return IS(ls(f,g,T,C,M,!0))}function Ag(f){return f?f.__v_isVNode===!0:!1}function Fp(f,g){return f.type===g.type&&f.key===g.key}const CS=({key:f})=>f??null,pg=({ref:f,ref_key:g,ref_for:T})=>(typeof f=="number"&&(f=""+f),f!=null?cs(f)||Fs(f)||Tr(f)?{i:ho,r:f,k:g,f:!!T}:f:null);function ot(f,g=null,T=null,C=0,M=null,k=f===Xo?0:1,j=!1,o=!1){const Q={__v_isVNode:!0,__v_skip:!0,type:f,props:g,key:g&&CS(g),ref:g&&pg(g),scopeId:iS,slotScopeIds:null,children:T,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:k,patchFlag:C,dynamicProps:M,dynamicChildren:null,appContext:null,ctx:ho};return o?(ov(Q,T),k&128&&f.normalize(Q)):T&&(Q.shapeFlag|=cs(T)?8:16),em>0&&!j&&Mo&&(Q.patchFlag>0||k&6)&&Q.patchFlag!==32&&Mo.push(Q),Q}const ls=$M;function $M(f,g=null,T=null,C=0,M=null,k=!1){if((!f||f===fM)&&(f=Mc),Ag(f)){const o=Ld(f,g,!0);return T&&ov(o,T),em>0&&!k&&Mo&&(o.shapeFlag&6?Mo[Mo.indexOf(f)]=o:Mo.push(o)),o.patchFlag=-2,o}if(nR(f)&&(f=f.__vccOpts),g){g=WM(g);let{class:o,style:Q}=g;o&&!cs(o)&&(g.class=sm(o)),Bn(Q)&&(J0(Q)&&!pr(Q)&&(Q=Bs({},Q)),g.style=Bg(Q))}const j=cs(f)?1:AS(f)?128:iM(f)?64:Bn(f)?4:Tr(f)?2:0;return ot(f,g,T,C,M,j,k,!0)}function WM(f){return f?J0(f)||_S(f)?Bs({},f):f:null}function Ld(f,g,T=!1,C=!1){const{props:M,ref:k,patchFlag:j,children:o,transition:Q}=f,pe=g?ZM(M||{},g):M,he={__v_isVNode:!0,__v_skip:!0,type:f.type,props:pe,key:pe&&CS(pe),ref:g&&g.ref?T&&k?pr(k)?k.concat(pg(g)):[k,pg(g)]:pg(g):k,scopeId:f.scopeId,slotScopeIds:f.slotScopeIds,children:o,target:f.target,targetStart:f.targetStart,targetAnchor:f.targetAnchor,staticCount:f.staticCount,shapeFlag:f.shapeFlag,patchFlag:g&&f.type!==Xo?j===-1?16:j|16:j,dynamicProps:f.dynamicProps,dynamicChildren:f.dynamicChildren,appContext:f.appContext,dirs:f.dirs,transition:Q,component:f.component,suspense:f.suspense,ssContent:f.ssContent&&Ld(f.ssContent),ssFallback:f.ssFallback&&Ld(f.ssFallback),el:f.el,anchor:f.anchor,ctx:f.ctx,ce:f.ce};return Q&&C&&tv(he,Q.clone(he)),he}function uo(f=" ",g=0){return ls(qg,null,f,g)}function PS(f,g){const T=ls(fg,null,f);return T.staticCount=g,T}function Ea(f="",g=!1){return g?(Rn(),qM(Mc,null,f)):ls(Mc,null,f)}function tl(f){return f==null||typeof f=="boolean"?ls(Mc):pr(f)?ls(Xo,null,f.slice()):Ag(f)?Sc(f):ls(qg,null,String(f))}function Sc(f){return f.el===null&&f.patchFlag!==-1||f.memo?f:Ld(f)}function ov(f,g){let T=0;const{shapeFlag:C}=f;if(g==null)g=null;else if(pr(g))T=16;else if(typeof g=="object")if(C&65){const M=g.default;M&&(M._c&&(M._d=!1),ov(f,M()),M._c&&(M._d=!0));return}else{T=32;const M=g._;!M&&!_S(g)?g._ctx=ho:M===3&&ho&&(ho.slots._===1?g._=1:(g._=2,f.patchFlag|=1024))}else Tr(g)?(g={default:g,_ctx:ho},T=32):(g=String(g),C&64?(T=16,g=[uo(g)]):T=8);f.children=g,f.shapeFlag|=T}function ZM(...f){const g={};for(let T=0;T<f.length;T++){const C=f[T];for(const M in C)if(M==="class")g.class!==C.class&&(g.class=sm([g.class,C.class]));else if(M==="style")g.style=Bg([g.style,C.style]);else if(Lg(M)){const k=g[M],j=C[M];j&&k!==j&&!(pr(k)&&k.includes(j))&&(g[M]=k?[].concat(k,j):j)}else M!==""&&(g[M]=C[M])}return g}function Ja(f,g,T,C=null){nl(f,g,7,[T,C])}const XM=fS();let KM=0;function YM(f,g,T){const C=f.type,M=(g?g.appContext:f.appContext)||XM,k={uid:KM++,vnode:f,type:C,parent:g,appContext:M,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new SP(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:g?g.provides:Object.create(M.provides),ids:g?g.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:yS(C,M),emitsOptions:ES(C,M),emit:null,emitted:null,propsDefaults:xn,inheritAttrs:C.inheritAttrs,ctx:xn,data:xn,props:xn,attrs:xn,slots:xn,refs:xn,setupState:xn,setupContext:null,suspense:T,suspenseId:T?T.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return k.ctx={_:k},k.root=g?g.root:k,k.emit=BM.bind(null,k),f.ce&&f.ce(k),k}let Ms=null;const JM=()=>Ms||ho;let Ig,C0;{const f=Fg(),g=(T,C)=>{let M;return(M=f[T])||(M=f[T]=[]),M.push(C),k=>{M.length>1?M.forEach(j=>j(k)):M[0](k)}};Ig=g("__VUE_INSTANCE_SETTERS__",T=>Ms=T),C0=g("__VUE_SSR_SETTERS__",T=>tm=T)}const am=f=>{const g=Ms;return Ig(f),f.scope.on(),()=>{f.scope.off(),Ig(g)}},ST=()=>{Ms&&Ms.scope.off(),Ig(null)};function MS(f){return f.vnode.shapeFlag&4}let tm=!1;function QM(f,g=!1,T=!1){g&&C0(g);const{props:C,children:M}=f.vnode,k=MS(f);TM(f,C,k,g),IM(f,M,T||g);const j=k?eR(f,g):void 0;return g&&C0(!1),j}function eR(f,g){const T=f.type;f.accessCache=Object.create(null),f.proxy=new Proxy(f.ctx,mM);const{setup:C}=T;if(C){Nl();const M=f.setupContext=C.length>1?iR(f):null,k=am(f),j=om(C,f,0,[f.props,M]),o=C2(j);if(Vl(),k(),(o||f.sp)&&!qp(f)&&nS(f),o){if(j.then(ST,ST),g)return j.then(Q=>{ET(f,Q)}).catch(Q=>{Ug(Q,f,0)});f.asyncDep=j}else ET(f,j)}else RS(f)}function ET(f,g,T){Tr(g)?f.type.__ssrInlineRender?f.ssrRender=g:f.render=g:Bn(g)&&(f.setupState=Y2(g)),RS(f)}function RS(f,g,T){const C=f.type;f.render||(f.render=C.render||il);{const M=am(f);Nl();try{_M(f)}finally{Vl(),M()}}}const tR={get(f,g){return Os(f,"get",""),f[g]}};function iR(f){const g=T=>{f.exposed=T||{}};return{attrs:new Proxy(f.attrs,tR),slots:f.slots,emit:f.emit,expose:g}}function $g(f){return f.exposed?f.exposeProxy||(f.exposeProxy=new Proxy(Y2(HP(f.exposed)),{get(g,T){if(T in g)return g[T];if(T in $p)return $p[T](f)},has(g,T){return T in g||T in $p}})):f.proxy}function rR(f,g=!0){return Tr(f)?f.displayName||f.name:f.name||g&&f.__name}function nR(f){return Tr(f)&&"__vccOpts"in f}const Aa=(f,g)=>XP(f,g,tm);function DS(f,g,T){const C=arguments.length;return C===2?Bn(g)&&!pr(g)?Ag(g)?ls(f,null,[g]):ls(f,g):ls(f,null,g):(C>3?T=Array.prototype.slice.call(arguments,2):C===3&&Ag(T)&&(T=[T]),ls(f,g,T))}const LS="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let P0;const AT=typeof window<"u"&&window.trustedTypes;if(AT)try{P0=AT.createPolicy("vue",{createHTML:f=>f})}catch{}const zS=P0?f=>P0.createHTML(f):f=>f,sR="http://www.w3.org/2000/svg",oR="http://www.w3.org/1998/Math/MathML",kl=typeof document<"u"?document:null,IT=kl&&kl.createElement("template"),aR={insert:(f,g,T)=>{g.insertBefore(f,T||null)},remove:f=>{const g=f.parentNode;g&&g.removeChild(f)},createElement:(f,g,T,C)=>{const M=g==="svg"?kl.createElementNS(sR,f):g==="mathml"?kl.createElementNS(oR,f):T?kl.createElement(f,{is:T}):kl.createElement(f);return f==="select"&&C&&C.multiple!=null&&M.setAttribute("multiple",C.multiple),M},createText:f=>kl.createTextNode(f),createComment:f=>kl.createComment(f),setText:(f,g)=>{f.nodeValue=g},setElementText:(f,g)=>{f.textContent=g},parentNode:f=>f.parentNode,nextSibling:f=>f.nextSibling,querySelector:f=>kl.querySelector(f),setScopeId(f,g){f.setAttribute(g,"")},insertStaticContent(f,g,T,C,M,k){const j=T?T.previousSibling:g.lastChild;if(M&&(M===k||M.nextSibling))for(;g.insertBefore(M.cloneNode(!0),T),!(M===k||!(M=M.nextSibling)););else{IT.innerHTML=zS(C==="svg"?`<svg>${f}</svg>`:C==="mathml"?`<math>${f}</math>`:f);const o=IT.content;if(C==="svg"||C==="mathml"){const Q=o.firstChild;for(;Q.firstChild;)o.appendChild(Q.firstChild);o.removeChild(Q)}g.insertBefore(o,T)}return[j?j.nextSibling:g.firstChild,T?T.previousSibling:g.lastChild]}},lR=Symbol("_vtc");function cR(f,g,T){const C=f[lR];C&&(g=(g?[g,...C]:[...C]).join(" ")),g==null?f.removeAttribute("class"):T?f.setAttribute("class",g):f.className=g}const CT=Symbol("_vod"),uR=Symbol("_vsh"),hR=Symbol(""),dR=/(^|;)\s*display\s*:/;function fR(f,g,T){const C=f.style,M=cs(T);let k=!1;if(T&&!M){if(g)if(cs(g))for(const j of g.split(";")){const o=j.slice(0,j.indexOf(":")).trim();T[o]==null&&mg(C,o,"")}else for(const j in g)T[j]==null&&mg(C,j,"");for(const j in T)j==="display"&&(k=!0),mg(C,j,T[j])}else if(M){if(g!==T){const j=C[hR];j&&(T+=";"+j),C.cssText=T,k=dR.test(T)}}else g&&f.removeAttribute("style");CT in f&&(f[CT]=k?C.display:"",f[uR]&&(C.display="none"))}const PT=/\s*!important$/;function mg(f,g,T){if(pr(T))T.forEach(C=>mg(f,g,C));else if(T==null&&(T=""),g.startsWith("--"))f.setProperty(g,T);else{const C=pR(f,g);PT.test(T)?f.setProperty(Ou(C),T.replace(PT,""),"important"):f[C]=T}}const MT=["Webkit","Moz","ms"],a0={};function pR(f,g){const T=a0[g];if(T)return T;let C=Yo(g);if(C!=="filter"&&C in f)return a0[g]=C;C=kg(C);for(let M=0;M<MT.length;M++){const k=MT[M]+C;if(k in f)return a0[g]=k}return g}const RT="http://www.w3.org/1999/xlink";function DT(f,g,T,C,M,k=TP(g)){C&&g.startsWith("xlink:")?T==null?f.removeAttributeNS(RT,g.slice(6,g.length)):f.setAttributeNS(RT,g,T):T==null||k&&!R2(T)?f.removeAttribute(g):f.setAttribute(g,k?"":Rc(T)?String(T):T)}function LT(f,g,T,C,M){if(g==="innerHTML"||g==="textContent"){T!=null&&(f[g]=g==="innerHTML"?zS(T):T);return}const k=f.tagName;if(g==="value"&&k!=="PROGRESS"&&!k.includes("-")){const o=k==="OPTION"?f.getAttribute("value")||"":f.value,Q=T==null?f.type==="checkbox"?"on":"":String(T);(o!==Q||!("_value"in f))&&(f.value=Q),T==null&&f.removeAttribute(g),f._value=T;return}let j=!1;if(T===""||T==null){const o=typeof f[g];o==="boolean"?T=R2(T):T==null&&o==="string"?(T="",j=!0):o==="number"&&(T=0,j=!0)}try{f[g]=T}catch{}j&&f.removeAttribute(M||g)}function Ed(f,g,T,C){f.addEventListener(g,T,C)}function mR(f,g,T,C){f.removeEventListener(g,T,C)}const zT=Symbol("_vei");function _R(f,g,T,C,M=null){const k=f[zT]||(f[zT]={}),j=k[g];if(C&&j)j.value=C;else{const[o,Q]=gR(g);if(C){const pe=k[g]=vR(C,M);Ed(f,o,pe,Q)}else j&&(mR(f,o,j,Q),k[g]=void 0)}}const OT=/(?:Once|Passive|Capture)$/;function gR(f){let g;if(OT.test(f)){g={};let C;for(;C=f.match(OT);)f=f.slice(0,f.length-C[0].length),g[C[0].toLowerCase()]=!0}return[f[2]===":"?f.slice(3):Ou(f.slice(2)),g]}let l0=0;const yR=Promise.resolve(),xR=()=>l0||(yR.then(()=>l0=0),l0=Date.now());function vR(f,g){const T=C=>{if(!C._vts)C._vts=Date.now();else if(C._vts<=T.attached)return;nl(bR(C,T.value),g,5,[C])};return T.value=f,T.attached=xR(),T}function bR(f,g){if(pr(g)){const T=f.stopImmediatePropagation;return f.stopImmediatePropagation=()=>{T.call(f),f._stopped=!0},g.map(C=>M=>!M._stopped&&C&&C(M))}else return g}const kT=f=>f.charCodeAt(0)===111&&f.charCodeAt(1)===110&&f.charCodeAt(2)>96&&f.charCodeAt(2)<123,wR=(f,g,T,C,M,k)=>{const j=M==="svg";g==="class"?cR(f,C,j):g==="style"?fR(f,T,C):Lg(g)?G0(g)||_R(f,g,T,C,k):(g[0]==="."?(g=g.slice(1),!0):g[0]==="^"?(g=g.slice(1),!1):TR(f,g,C,j))?(LT(f,g,C),!f.tagName.includes("-")&&(g==="value"||g==="checked"||g==="selected")&&DT(f,g,C,j,k,g!=="value")):f._isVueCE&&(/[A-Z]/.test(g)||!cs(C))?LT(f,Yo(g),C,k,g):(g==="true-value"?f._trueValue=C:g==="false-value"&&(f._falseValue=C),DT(f,g,C,j))};function TR(f,g,T,C){if(C)return!!(g==="innerHTML"||g==="textContent"||g in f&&kT(g)&&Tr(T));if(g==="spellcheck"||g==="draggable"||g==="translate"||g==="autocorrect"||g==="form"||g==="list"&&f.tagName==="INPUT"||g==="type"&&f.tagName==="TEXTAREA")return!1;if(g==="width"||g==="height"){const M=f.tagName;if(M==="IMG"||M==="VIDEO"||M==="CANVAS"||M==="SOURCE")return!1}return kT(g)&&cs(T)?!1:g in f}const FT=f=>{const g=f.props["onUpdate:modelValue"]||!1;return pr(g)?T=>hg(g,T):g};function SR(f){f.target.composing=!0}function BT(f){const g=f.target;g.composing&&(g.composing=!1,g.dispatchEvent(new Event("input")))}const c0=Symbol("_assign"),NT={created(f,{modifiers:{lazy:g,trim:T,number:C}},M){f[c0]=FT(M);const k=C||M.props&&M.props.type==="number";Ed(f,g?"change":"input",j=>{if(j.target.composing)return;let o=f.value;T&&(o=o.trim()),k&&(o=y0(o)),f[c0](o)}),T&&Ed(f,"change",()=>{f.value=f.value.trim()}),g||(Ed(f,"compositionstart",SR),Ed(f,"compositionend",BT),Ed(f,"change",BT))},mounted(f,{value:g}){f.value=g??""},beforeUpdate(f,{value:g,oldValue:T,modifiers:{lazy:C,trim:M,number:k}},j){if(f[c0]=FT(j),f.composing)return;const o=(k||f.type==="number")&&!/^0\d/.test(f.value)?y0(f.value):f.value,Q=g??"";o!==Q&&(document.activeElement===f&&f.type!=="range"&&(C&&g===T||M&&f.value.trim()===Q)||(f.value=Q))}},ER=["ctrl","shift","alt","meta"],AR={stop:f=>f.stopPropagation(),prevent:f=>f.preventDefault(),self:f=>f.target!==f.currentTarget,ctrl:f=>!f.ctrlKey,shift:f=>!f.shiftKey,alt:f=>!f.altKey,meta:f=>!f.metaKey,left:f=>"button"in f&&f.button!==0,middle:f=>"button"in f&&f.button!==1,right:f=>"button"in f&&f.button!==2,exact:(f,g)=>ER.some(T=>f[`${T}Key`]&&!g.includes(T))},VT=(f,g)=>{const T=f._withMods||(f._withMods={}),C=g.join(".");return T[C]||(T[C]=(M,...k)=>{for(let j=0;j<g.length;j++){const o=AR[g[j]];if(o&&o(M,g))return}return f(M,...k)})},IR=Bs({patchProp:wR},aR);let UT;function CR(){return UT||(UT=PM(IR))}const PR=(...f)=>{const g=CR().createApp(...f),{mount:T}=g;return g.mount=C=>{const M=RR(C);if(!M)return;const k=g._component;!Tr(k)&&!k.render&&!k.template&&(k.template=M.innerHTML),M.nodeType===1&&(M.textContent="");const j=T(M,!1,MR(M));return M instanceof Element&&(M.removeAttribute("v-cloak"),M.setAttribute("data-v-app","")),j},g};function MR(f){if(f instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&f instanceof MathMLElement)return"mathml"}function RR(f){return cs(f)?document.querySelector(f):f}const DR=new Set(["title","titleTemplate","script","style","noscript"]),_g=new Set(["base","meta","link","style","script","noscript"]),LR=new Set(["title","titleTemplate","templateParams","base","htmlAttrs","bodyAttrs","meta","link","style","script","noscript"]),zR=new Set(["base","title","titleTemplate","bodyAttrs","htmlAttrs","templateParams"]),OS=new Set(["tagPosition","tagPriority","tagDuplicateStrategy","children","innerHTML","textContent","processTemplateParams"]),OR=typeof window<"u";function Cg(f){let g=9;for(let T=0;T<f.length;)g=Math.imul(g^f.charCodeAt(T++),9**9);return((g^g>>>9)+65536).toString(16).substring(1,8).toLowerCase()}function M0(f){if(f._h)return f._h;if(f._d)return Cg(f._d);let g=`${f.tag}:${f.textContent||f.innerHTML||""}:`;for(const T in f.props)g+=`${T}:${String(f.props[T])},`;return Cg(g)}function kR(f,g){return f instanceof Promise?f.then(g):g(f)}function R0(f,g,T,C){const M=C||FS(typeof g=="object"&&typeof g!="function"&&!(g instanceof Promise)?{...g}:{[f==="script"||f==="noscript"||f==="style"?"innerHTML":"textContent"]:g},f==="templateParams"||f==="titleTemplate");if(M instanceof Promise)return M.then(j=>R0(f,g,T,j));const k={tag:f,props:M};for(const j of OS){const o=k.props[j]!==void 0?k.props[j]:T[j];o!==void 0&&((!(j==="innerHTML"||j==="textContent"||j==="children")||DR.has(k.tag))&&(k[j==="children"?"innerHTML":j]=o),delete k.props[j])}return k.props.body&&(k.tagPosition="bodyClose",delete k.props.body),k.tag==="script"&&typeof k.innerHTML=="object"&&(k.innerHTML=JSON.stringify(k.innerHTML),k.props.type=k.props.type||"application/json"),Array.isArray(k.props.content)?k.props.content.map(j=>({...k,props:{...k.props,content:j}})):k}function FR(f,g){const T=f==="class"?" ":";";return g&&typeof g=="object"&&!Array.isArray(g)&&(g=Object.entries(g).filter(([,C])=>C).map(([C,M])=>f==="style"?`${C}:${M}`:C)),String(Array.isArray(g)?g.join(T):g)?.split(T).filter(C=>!!C.trim()).join(T)}function kS(f,g,T,C){for(let M=C;M<T.length;M+=1){const k=T[M];if(k==="class"||k==="style"){f[k]=FR(k,f[k]);continue}if(f[k]instanceof Promise)return f[k].then(j=>(f[k]=j,kS(f,g,T,M)));if(!g&&!OS.has(k)){const j=String(f[k]),o=k.startsWith("data-");j==="true"||j===""?f[k]=o?"true":!0:f[k]||(o&&j==="false"?f[k]="false":delete f[k])}}}function FS(f,g=!1){const T=kS(f,g,Object.keys(f),0);return T instanceof Promise?T.then(()=>f):f}const BR=10;function BS(f,g,T){for(let C=T;C<g.length;C+=1){const M=g[C];if(M instanceof Promise)return M.then(k=>(g[C]=k,BS(f,g,C)));Array.isArray(M)?f.push(...M):f.push(M)}}function NR(f){const g=[],T=f.resolvedInput;for(const M in T){if(!Object.prototype.hasOwnProperty.call(T,M))continue;const k=T[M];if(!(k===void 0||!LR.has(M))){if(Array.isArray(k)){for(const j of k)g.push(R0(M,j,f));continue}g.push(R0(M,k,f))}}if(g.length===0)return[];const C=[];return kR(BS(C,g,0),()=>C.map((M,k)=>(M._e=f._i,f.mode&&(M._m=f.mode),M._p=(f._i<<BR)+k,M)))}const jT=new Set(["onload","onerror","onabort","onprogress","onloadstart"]),GT={base:-10,title:10},HT={critical:-80,high:-10,low:20};function Pg(f){const g=f.tagPriority;if(typeof g=="number")return g;let T=100;return f.tag==="meta"?f.props["http-equiv"]==="content-security-policy"?T=-30:f.props.charset?T=-20:f.props.name==="viewport"&&(T=-15):f.tag==="link"&&f.props.rel==="preconnect"?T=20:f.tag in GT&&(T=GT[f.tag]),g&&g in HT?T+HT[g]:T}const VR=[{prefix:"before:",offset:-1},{prefix:"after:",offset:1}],UR=["name","property","http-equiv"];function NS(f){const{props:g,tag:T}=f;if(zR.has(T))return T;if(T==="link"&&g.rel==="canonical")return"canonical";if(g.charset)return"charset";if(g.id)return`${T}:id:${g.id}`;for(const C of UR)if(g[C]!==void 0)return`${T}:${C}:${g[C]}`;return!1}const Ec="%separator";function jR(f,g,T=!1){let C;if(g==="s"||g==="pageTitle")C=f.pageTitle;else if(g.includes(".")){const M=g.indexOf(".");C=f[g.substring(0,M)]?.[g.substring(M+1)]}else C=f[g];if(C!==void 0)return T?(C||"").replace(/"/g,'\\"'):C||""}const GR=new RegExp(`${Ec}(?:\\s*${Ec})*`,"g");function ug(f,g,T,C=!1){if(typeof f!="string"||!f.includes("%"))return f;let M=f;try{M=decodeURI(f)}catch{}const k=M.match(/%\w+(?:\.\w+)?/g);if(!k)return f;const j=f.includes(Ec);return f=f.replace(/%\w+(?:\.\w+)?/g,o=>{if(o===Ec||!k.includes(o))return o;const Q=jR(g,o.slice(1),C);return Q!==void 0?Q:o}).trim(),j&&(f.endsWith(Ec)&&(f=f.slice(0,-Ec.length)),f.startsWith(Ec)&&(f=f.slice(Ec.length)),f=f.replace(GR,T).trim()),f}function qT(f,g){return f==null?g||null:typeof f=="function"?f(g):f}async function HR(f,g={}){const T=g.document||f.resolvedOptions.document;if(!T||!f.dirty)return;const C={shouldRender:!0,tags:[]};if(await f.hooks.callHook("dom:beforeRender",C),!!C.shouldRender)return f._domUpdatePromise||(f._domUpdatePromise=new Promise(async M=>{const k=(await f.resolveTags()).map(ye=>({tag:ye,id:_g.has(ye.tag)?M0(ye):ye.tag,shouldRender:!0}));let j=f._dom;if(!j){j={elMap:{htmlAttrs:T.documentElement,bodyAttrs:T.body}};const ye=new Set;for(const Oe of["body","head"]){const je=T[Oe]?.children;for(const ft of je){const rt=ft.tagName.toLowerCase();if(!_g.has(rt))continue;const mt={tag:rt,props:await FS(ft.getAttributeNames().reduce((Zt,Li)=>({...Zt,[Li]:ft.getAttribute(Li)}),{})),innerHTML:ft.innerHTML},Wt=NS(mt);let wt=Wt,Xt=1;for(;wt&&ye.has(wt);)wt=`${Wt}:${Xt++}`;wt&&(mt._d=wt,ye.add(wt)),j.elMap[ft.getAttribute("data-hid")||M0(mt)]=ft}}}j.pendingSideEffects={...j.sideEffects},j.sideEffects={};function o(ye,Oe,je){const ft=`${ye}:${Oe}`;j.sideEffects[ft]=je,delete j.pendingSideEffects[ft]}function Q({id:ye,$el:Oe,tag:je}){const ft=je.tag.endsWith("Attrs");if(j.elMap[ye]=Oe,ft||(je.textContent&&je.textContent!==Oe.textContent&&(Oe.textContent=je.textContent),je.innerHTML&&je.innerHTML!==Oe.innerHTML&&(Oe.innerHTML=je.innerHTML),o(ye,"el",()=>{j.elMap[ye]?.remove(),delete j.elMap[ye]})),je._eventHandlers)for(const rt in je._eventHandlers)Object.prototype.hasOwnProperty.call(je._eventHandlers,rt)&&Oe.getAttribute(`data-${rt}`)!==""&&((je.tag==="bodyAttrs"?T.defaultView:Oe).addEventListener(rt.substring(2),je._eventHandlers[rt].bind(Oe)),Oe.setAttribute(`data-${rt}`,""));for(const rt in je.props){if(!Object.prototype.hasOwnProperty.call(je.props,rt))continue;const mt=je.props[rt],Wt=`attr:${rt}`;if(rt==="class"){if(!mt)continue;for(const wt of mt.split(" "))ft&&o(ye,`${Wt}:${wt}`,()=>Oe.classList.remove(wt)),!Oe.classList.contains(wt)&&Oe.classList.add(wt)}else if(rt==="style"){if(!mt)continue;for(const wt of mt.split(";")){const Xt=wt.indexOf(":"),Zt=wt.substring(0,Xt).trim(),Li=wt.substring(Xt+1).trim();o(ye,`${Wt}:${Zt}`,()=>{Oe.style.removeProperty(Zt)}),Oe.style.setProperty(Zt,Li)}}else Oe.getAttribute(rt)!==mt&&Oe.setAttribute(rt,mt===!0?"":String(mt)),ft&&o(ye,Wt,()=>Oe.removeAttribute(rt))}}const pe=[],he={bodyClose:void 0,bodyOpen:void 0,head:void 0};for(const ye of k){const{tag:Oe,shouldRender:je,id:ft}=ye;if(je){if(Oe.tag==="title"){T.title=Oe.textContent;continue}ye.$el=ye.$el||j.elMap[ft],ye.$el?Q(ye):_g.has(Oe.tag)&&pe.push(ye)}}for(const ye of pe){const Oe=ye.tag.tagPosition||"head";ye.$el=T.createElement(ye.tag.tag),Q(ye),he[Oe]=he[Oe]||T.createDocumentFragment(),he[Oe].appendChild(ye.$el)}for(const ye of k)await f.hooks.callHook("dom:renderTag",ye,T,o);he.head&&T.head.appendChild(he.head),he.bodyOpen&&T.body.insertBefore(he.bodyOpen,T.body.firstChild),he.bodyClose&&T.body.appendChild(he.bodyClose);for(const ye in j.pendingSideEffects)j.pendingSideEffects[ye]();f._dom=j,await f.hooks.callHook("dom:rendered",{renders:k}),M()}).finally(()=>{f._domUpdatePromise=void 0,f.dirty=!1})),f._domUpdatePromise}function qR(f,g={}){const T=g.delayFn||(C=>setTimeout(C,10));return f._domDebouncedUpdatePromise=f._domDebouncedUpdatePromise||new Promise(C=>T(()=>HR(f,g).then(()=>{delete f._domDebouncedUpdatePromise,C()})))}function $R(f){return g=>{const T=g.resolvedOptions.document?.head.querySelector('script[id="unhead:payload"]')?.innerHTML||!1;return T&&g.push(JSON.parse(T)),{mode:"client",hooks:{"entries:updated":C=>{qR(C,f)}}}}}function D0(f,g={},T){for(const C in f){const M=f[C],k=T?`${T}:${C}`:C;typeof M=="object"&&M!==null?D0(M,g,k):typeof M=="function"&&(g[k]=M)}return g}const WR={run:f=>f()},ZR=()=>WR,VS=typeof console.createTask<"u"?console.createTask:ZR;function XR(f,g){const T=g.shift(),C=VS(T);return f.reduce((M,k)=>M.then(()=>C.run(()=>k(...g))),Promise.resolve())}function KR(f,g){const T=g.shift(),C=VS(T);return Promise.all(f.map(M=>C.run(()=>M(...g))))}function u0(f,g){for(const T of[...f])T(g)}class YR{constructor(){this._hooks={},this._before=void 0,this._after=void 0,this._deprecatedMessages=void 0,this._deprecatedHooks={},this.hook=this.hook.bind(this),this.callHook=this.callHook.bind(this),this.callHookWith=this.callHookWith.bind(this)}hook(g,T,C={}){if(!g||typeof T!="function")return()=>{};const M=g;let k;for(;this._deprecatedHooks[g];)k=this._deprecatedHooks[g],g=k.to;if(k&&!C.allowDeprecated){let j=k.message;j||(j=`${M} hook has been deprecated`+(k.to?`, please use ${k.to}`:"")),this._deprecatedMessages||(this._deprecatedMessages=new Set),this._deprecatedMessages.has(j)||(console.warn(j),this._deprecatedMessages.add(j))}if(!T.name)try{Object.defineProperty(T,"name",{get:()=>"_"+g.replace(/\W+/g,"_")+"_hook_cb",configurable:!0})}catch{}return this._hooks[g]=this._hooks[g]||[],this._hooks[g].push(T),()=>{T&&(this.removeHook(g,T),T=void 0)}}hookOnce(g,T){let C,M=(...k)=>(typeof C=="function"&&C(),C=void 0,M=void 0,T(...k));return C=this.hook(g,M),C}removeHook(g,T){if(this._hooks[g]){const C=this._hooks[g].indexOf(T);C!==-1&&this._hooks[g].splice(C,1),this._hooks[g].length===0&&delete this._hooks[g]}}deprecateHook(g,T){this._deprecatedHooks[g]=typeof T=="string"?{to:T}:T;const C=this._hooks[g]||[];delete this._hooks[g];for(const M of C)this.hook(g,M)}deprecateHooks(g){Object.assign(this._deprecatedHooks,g);for(const T in g)this.deprecateHook(T,g[T])}addHooks(g){const T=D0(g),C=Object.keys(T).map(M=>this.hook(M,T[M]));return()=>{for(const M of C.splice(0,C.length))M()}}removeHooks(g){const T=D0(g);for(const C in T)this.removeHook(C,T[C])}removeAllHooks(){for(const g in this._hooks)delete this._hooks[g]}callHook(g,...T){return T.unshift(g),this.callHookWith(XR,g,...T)}callHookParallel(g,...T){return T.unshift(g),this.callHookWith(KR,g,...T)}callHookWith(g,T,...C){const M=this._before||this._after?{name:T,args:C,context:{}}:void 0;this._before&&u0(this._before,M);const k=g(T in this._hooks?[...this._hooks[T]]:[],C);return k instanceof Promise?k.finally(()=>{this._after&&M&&u0(this._after,M)}):(this._after&&M&&u0(this._after,M),k)}beforeEach(g){return this._before=this._before||[],this._before.push(g),()=>{if(this._before!==void 0){const T=this._before.indexOf(g);T!==-1&&this._before.splice(T,1)}}}afterEach(g){return this._after=this._after||[],this._after.push(g),()=>{if(this._after!==void 0){const T=this._after.indexOf(g);T!==-1&&this._after.splice(T,1)}}}}function JR(){return new YR}const QR=new Set(["templateParams","htmlAttrs","bodyAttrs"]),eD={hooks:{"tag:normalise":({tag:f})=>{f.props.hid&&(f.key=f.props.hid,delete f.props.hid),f.props.vmid&&(f.key=f.props.vmid,delete f.props.vmid),f.props.key&&(f.key=f.props.key,delete f.props.key);const g=NS(f);g&&!g.startsWith("meta:og:")&&!g.startsWith("meta:twitter:")&&delete f.key;const T=g||(f.key?`${f.tag}:${f.key}`:!1);T&&(f._d=T)},"tags:resolve":f=>{const g=Object.create(null);for(const C of f.tags){const M=(C.key?`${C.tag}:${C.key}`:C._d)||M0(C),k=g[M];if(k){let o=C?.tagDuplicateStrategy;if(!o&&QR.has(C.tag)&&(o="merge"),o==="merge"){const Q=k.props;Q.style&&C.props.style&&(Q.style[Q.style.length-1]!==";"&&(Q.style+=";"),C.props.style=`${Q.style} ${C.props.style}`),Q.class&&C.props.class?C.props.class=`${Q.class} ${C.props.class}`:Q.class&&(C.props.class=Q.class),g[M].props={...Q,...C.props};continue}else if(C._e===k._e){k._duped=k._duped||[],C._d=`${k._d}:${k._duped.length+1}`,k._duped.push(C);continue}else if(Pg(C)>Pg(k))continue}if(!(C.innerHTML||C.textContent||Object.keys(C.props).length!==0)&&_g.has(C.tag)){delete g[M];continue}g[M]=C}const T=[];for(const C in g){const M=g[C],k=M._duped;T.push(M),k&&(delete M._duped,T.push(...k))}f.tags=T,f.tags=f.tags.filter(C=>!(C.tag==="meta"&&(C.props.name||C.props.property)&&!C.props.content))}}},tD=new Set(["script","link","bodyAttrs"]),iD=f=>({hooks:{"tags:resolve":g=>{for(const T of g.tags){if(!tD.has(T.tag))continue;const C=T.props;for(const M in C){if(M[0]!=="o"||M[1]!=="n"||!Object.prototype.hasOwnProperty.call(C,M))continue;const k=C[M];typeof k=="function"&&(f.ssr&&jT.has(M)?C[M]=`this.dataset.${M}fired = true`:delete C[M],T._eventHandlers=T._eventHandlers||{},T._eventHandlers[M]=k)}f.ssr&&T._eventHandlers&&(T.props.src||T.props.href)&&(T.key=T.key||Cg(T.props.src||T.props.href))}},"dom:renderTag":({$el:g,tag:T})=>{const C=g?.dataset;if(C)for(const M in C){if(!M.endsWith("fired"))continue;const k=M.slice(0,-5);jT.has(k)&&T._eventHandlers?.[k]?.call(g,new Event(k.substring(2)))}}}}),rD=new Set(["link","style","script","noscript"]),nD={hooks:{"tag:normalise":({tag:f})=>{f.key&&rD.has(f.tag)&&(f.props["data-hid"]=f._h=Cg(f.key))}}},sD={mode:"server",hooks:{"tags:beforeResolve":f=>{const g={};let T=!1;for(const C of f.tags)C._m!=="server"||C.tag!=="titleTemplate"&&C.tag!=="templateParams"&&C.tag!=="title"||(g[C.tag]=C.tag==="title"||C.tag==="titleTemplate"?C.textContent:C.props,T=!0);T&&f.tags.push({tag:"script",innerHTML:JSON.stringify(g),props:{id:"unhead:payload",type:"application/json"}})}}},oD={hooks:{"tags:resolve":f=>{for(const g of f.tags)if(typeof g.tagPriority=="string")for(const{prefix:T,offset:C}of VR){if(!g.tagPriority.startsWith(T))continue;const M=g.tagPriority.substring(T.length),k=f.tags.find(j=>j._d===M)?._p;if(k!==void 0){g._p=k+C;break}}f.tags.sort((g,T)=>{const C=Pg(g),M=Pg(T);return C<M?-1:C>M?1:g._p-T._p})}}},aD={meta:"content",link:"href",htmlAttrs:"lang"},lD=["innerHTML","textContent"],cD=f=>({hooks:{"tags:resolve":g=>{const{tags:T}=g;let C;for(let j=0;j<T.length;j+=1)T[j].tag==="templateParams"&&(C=g.tags.splice(j,1)[0].props,j-=1);const M=C||{},k=M.separator||"|";delete M.separator,M.pageTitle=ug(M.pageTitle||T.find(j=>j.tag==="title")?.textContent||"",M,k);for(const j of T){if(j.processTemplateParams===!1)continue;const o=aD[j.tag];if(o&&typeof j.props[o]=="string")j.props[o]=ug(j.props[o],M,k);else if(j.processTemplateParams||j.tag==="titleTemplate"||j.tag==="title")for(const Q of lD)typeof j[Q]=="string"&&(j[Q]=ug(j[Q],M,k,j.tag==="script"&&j.props.type.endsWith("json")))}f._templateParams=M,f._separator=k},"tags:afterResolve":({tags:g})=>{let T;for(let C=0;C<g.length;C+=1){const M=g[C];M.tag==="title"&&M.processTemplateParams!==!1&&(T=M)}T?.textContent&&(T.textContent=ug(T.textContent,f._templateParams,f._separator))}}}),uD={hooks:{"tags:resolve":f=>{const{tags:g}=f;let T,C;for(let M=0;M<g.length;M+=1){const k=g[M];k.tag==="title"?T=k:k.tag==="titleTemplate"&&(C=k)}if(C&&T){const M=qT(C.textContent,T.textContent);M!==null?T.textContent=M||T.textContent:f.tags.splice(f.tags.indexOf(T),1)}else if(C){const M=qT(C.textContent);M!==null&&(C.textContent=M,C.tag="title",C=void 0)}C&&f.tags.splice(f.tags.indexOf(C),1)}}},hD={hooks:{"tags:afterResolve":f=>{for(const g of f.tags)typeof g.innerHTML=="string"&&(g.innerHTML&&(g.props.type==="application/ld+json"||g.props.type==="application/json")?g.innerHTML=g.innerHTML.replace(/</g,"\\u003C"):g.innerHTML=g.innerHTML.replace(new RegExp(`</${g.tag}`,"g"),`<\\/${g.tag}`))}}};let US;function dD(f={}){const g=fD(f);return g.use($R()),US=g}function $T(f,g){return!f||f==="server"&&g||f==="client"&&!g}function fD(f={}){const g=JR();g.addHooks(f.hooks||{}),f.document=f.document||(OR?document:void 0);const T=!f.document,C=()=>{o.dirty=!0,g.callHook("entries:updated",o)};let M=0,k=[];const j=[],o={plugins:j,dirty:!1,resolvedOptions:f,hooks:g,headEntries(){return k},use(Q){const pe=typeof Q=="function"?Q(o):Q;(!pe.key||!j.some(he=>he.key===pe.key))&&(j.push(pe),$T(pe.mode,T)&&g.addHooks(pe.hooks||{}))},push(Q,pe){delete pe?.head;const he={_i:M++,input:Q,...pe};return $T(he.mode,T)&&(k.push(he),C()),{dispose(){k=k.filter(ye=>ye._i!==he._i),C()},patch(ye){for(const Oe of k)Oe._i===he._i&&(Oe.input=he.input=ye);C()}}},async resolveTags(){const Q={tags:[],entries:[...k]};await g.callHook("entries:resolve",Q);for(const pe of Q.entries){const he=pe.resolvedInput||pe.input;if(pe.resolvedInput=await(pe.transform?pe.transform(he):he),pe.resolvedInput)for(const ye of await NR(pe)){const Oe={tag:ye,entry:pe,resolvedOptions:o.resolvedOptions};await g.callHook("tag:normalise",Oe),Q.tags.push(Oe.tag)}}return await g.callHook("tags:beforeResolve",Q),await g.callHook("tags:resolve",Q),await g.callHook("tags:afterResolve",Q),Q.tags},ssr:T};return[eD,sD,iD,nD,oD,cD,uD,hD,...f?.plugins||[]].forEach(Q=>o.use(Q)),o.hooks.callHook("init",o),o}function pD(){return US}const mD=LS[0]==="3";function _D(f){return typeof f=="function"?f():Cc(f)}function Mg(f){if(f instanceof Promise||f instanceof Date||f instanceof RegExp)return f;const g=_D(f);if(!f||!g)return g;if(Array.isArray(g))return g.map(T=>Mg(T));if(typeof g=="object"){const T={};for(const C in g)if(Object.prototype.hasOwnProperty.call(g,C)){if(C==="titleTemplate"||C[0]==="o"&&C[1]==="n"){T[C]=Cc(g[C]);continue}T[C]=Mg(g[C])}return T}return g}const gD={hooks:{"entries:resolve":f=>{for(const g of f.entries)g.resolvedInput=Mg(g.input)}}},jS="usehead";function yD(f){return{install(T){mD&&(T.config.globalProperties.$unhead=f,T.config.globalProperties.$head=f,T.provide(jS,f))}}.install}function xD(f={}){f.domDelayFn=f.domDelayFn||(T=>Q0(()=>setTimeout(()=>T(),0)));const g=dD(f);return g.use(gD),g.install=yD(g),g}const WT=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ZT="__unhead_injection_handler__";function vD(){return ZT in WT?WT[ZT]():rl(jS)||pD()}function GS(f,g={}){const T=g.head||vD();if(T)return T.ssr?T.push(f,g):bD(T,f,g)}function bD(f,g,T={}){const C=T0(!1),M=T0({});OM(()=>{M.value=C.value?{}:Mg(g)});const k=f.push(M.value,T);return Wp(M,o=>{k.patch(o)}),JM()&&(cS(()=>{k.dispose()}),aS(()=>{C.value=!0}),oS(()=>{C.value=!1})),k}function wD(f){const g=f;return g.headTags=f.resolveTags,g.addEntry=f.push,g.addHeadObjs=f.push,g.addReactiveEntry=(T,C)=>{const M=GS(T,C);return M!==void 0?M.dispose:()=>{}},g.removeHeadObjs=()=>{},g.updateDOM=()=>{f.hooks.callHook("entries:updated",f)},g.unhead=f,g}function TD(f,g){const T=xD({});return wD(T)}const SD="/static/paglogodark.jpg",kd=(f,g)=>{const T=f.__vccOpts||f;for(const[C,M]of g)T[C]=M;return T},ED={name:"App"},AD={class:"min-h-screen flex flex-col bg-palette-light text-palette-black"},ID={class:"bg-white/50 shadow-sm border-b border-gray-200 fixed w-full z-30 h-12 md:h-16 backdrop-blur"},CD={class:"container mx-auto px-4 py-0 flex justify-between items-center h-full"},PD={class:"flex-1 flex items-center"},MD={class:"flex-1 pt-12 md:pt-16"},RD={class:"bg-palette-yellow text-palette-light py-6 mt-12 border-t border-gray-200"},DD={class:"container mx-auto px-4"},LD={class:"flex justify-between items-center"},zD={class:"text-sm"};function OD(f,g,T,C,M,k){const j=Dd("router-link"),o=Dd("router-view");return Rn(),Fn("div",AD,[ot("nav",ID,[ot("div",CD,[ot("div",PD,[ls(j,{to:"/",class:"flex items-center space-x-2 md:space-x-3"},{default:jg(()=>g[0]||(g[0]=[ot("img",{src:SD,alt:"Casa del Sol Logo",class:"h-6 w-auto max-h-8 md:h-8 md:max-h-10"},null,-1),ot("span",{class:"text-sm md:text-xl font-bold text-palette-taupe"},[ot("span",{class:"notranslate"},"CASA DEL SOL")],-1)])),_:1,__:[0]})]),g[1]||(g[1]=ot("div",{class:"flex-1 flex justify-end space-x-4 md:space-x-6 font-bold text-palette-yellow"},[ot("a",{href:"https://wa.me/message/LN7BEZCQDMBWP1",target:"_blank",class:"text-sm md:text-base hover:text-palette-taupe font-bold"},"Contctanos")],-1))])]),ot("main",MD,[ls(o)]),ot("footer",RD,[ot("div",DD,[ot("div",LD,[ot("div",zD,[uo("  "+an(new Date().getFullYear())+" ",1),g[2]||(g[2]=ot("span",{class:"notranslate"},"Casa del Sol",-1)),g[3]||(g[3]=uo(". "))]),g[4]||(g[4]=PS('<div class="text-right" data-v-d562bfd2><h4 class="text-sm font-bold mb-1" data-v-d562bfd2>Contctanos</h4><div class="text-xs space-y-0.5" data-v-d562bfd2><p data-v-d562bfd2>Email: <a href="mailto:casadelsolholidays@gmail.com" class="hover:underline" data-v-d562bfd2>casadelsolholidays@gmail.com</a></p><p data-v-d562bfd2>WhatsApp: <a href="https://wa.me/34678318713" target="_blank" class="hover:underline" data-v-d562bfd2>+34 678 31 87 13</a></p></div></div>',1))])])])])}const kD=kd(ED,[["render",OD],["__scopeId","data-v-d562bfd2"]]);/*!
  * vue-router v4.5.1
  * (c) 2025 Eduardo San Martin Morote
  * @license MIT
  */const Ad=typeof document<"u";function HS(f){return typeof f=="object"||"displayName"in f||"props"in f||"__vccOpts"in f}function FD(f){return f.__esModule||f[Symbol.toStringTag]==="Module"||f.default&&HS(f.default)}const cn=Object.assign;function h0(f,g){const T={};for(const C in g){const M=g[C];T[C]=Ca(M)?M.map(f):f(M)}return T}const Xp=()=>{},Ca=Array.isArray,qS=/#/g,BD=/&/g,ND=/\//g,VD=/=/g,UD=/\?/g,$S=/\+/g,jD=/%5B/g,GD=/%5D/g,WS=/%5E/g,HD=/%60/g,ZS=/%7B/g,qD=/%7C/g,XS=/%7D/g,$D=/%20/g;function av(f){return encodeURI(""+f).replace(qD,"|").replace(jD,"[").replace(GD,"]")}function WD(f){return av(f).replace(ZS,"{").replace(XS,"}").replace(WS,"^")}function L0(f){return av(f).replace($S,"%2B").replace($D,"+").replace(qS,"%23").replace(BD,"%26").replace(HD,"`").replace(ZS,"{").replace(XS,"}").replace(WS,"^")}function ZD(f){return L0(f).replace(VD,"%3D")}function XD(f){return av(f).replace(qS,"%23").replace(UD,"%3F")}function KD(f){return f==null?"":XD(f).replace(ND,"%2F")}function im(f){try{return decodeURIComponent(""+f)}catch{}return""+f}const YD=/\/$/,JD=f=>f.replace(YD,"");function d0(f,g,T="/"){let C,M={},k="",j="";const o=g.indexOf("#");let Q=g.indexOf("?");return o<Q&&o>=0&&(Q=-1),Q>-1&&(C=g.slice(0,Q),k=g.slice(Q+1,o>-1?o:g.length),M=f(k)),o>-1&&(C=C||g.slice(0,o),j=g.slice(o,g.length)),C=iL(C??g,T),{fullPath:C+(k&&"?")+k+j,path:C,query:M,hash:im(j)}}function QD(f,g){const T=g.query?f(g.query):"";return g.path+(T&&"?")+T+(g.hash||"")}function XT(f,g){return!g||!f.toLowerCase().startsWith(g.toLowerCase())?f:f.slice(g.length)||"/"}function eL(f,g,T){const C=g.matched.length-1,M=T.matched.length-1;return C>-1&&C===M&&zd(g.matched[C],T.matched[M])&&KS(g.params,T.params)&&f(g.query)===f(T.query)&&g.hash===T.hash}function zd(f,g){return(f.aliasOf||f)===(g.aliasOf||g)}function KS(f,g){if(Object.keys(f).length!==Object.keys(g).length)return!1;for(const T in f)if(!tL(f[T],g[T]))return!1;return!0}function tL(f,g){return Ca(f)?KT(f,g):Ca(g)?KT(g,f):f===g}function KT(f,g){return Ca(g)?f.length===g.length&&f.every((T,C)=>T===g[C]):f.length===1&&f[0]===g}function iL(f,g){if(f.startsWith("/"))return f;if(!f)return g;const T=g.split("/"),C=f.split("/"),M=C[C.length-1];(M===".."||M===".")&&C.push("");let k=T.length-1,j,o;for(j=0;j<C.length;j++)if(o=C[j],o!==".")if(o==="..")k>1&&k--;else break;return T.slice(0,k).join("/")+"/"+C.slice(j).join("/")}const wc={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0};var rm;(function(f){f.pop="pop",f.push="push"})(rm||(rm={}));var Kp;(function(f){f.back="back",f.forward="forward",f.unknown=""})(Kp||(Kp={}));function rL(f){if(!f)if(Ad){const g=document.querySelector("base");f=g&&g.getAttribute("href")||"/",f=f.replace(/^\w+:\/\/[^\/]+/,"")}else f="/";return f[0]!=="/"&&f[0]!=="#"&&(f="/"+f),JD(f)}const nL=/^[^#]+#/;function sL(f,g){return f.replace(nL,"#")+g}function oL(f,g){const T=document.documentElement.getBoundingClientRect(),C=f.getBoundingClientRect();return{behavior:g.behavior,left:C.left-T.left-(g.left||0),top:C.top-T.top-(g.top||0)}}const Wg=()=>({left:window.scrollX,top:window.scrollY});function aL(f){let g;if("el"in f){const T=f.el,C=typeof T=="string"&&T.startsWith("#"),M=typeof T=="string"?C?document.getElementById(T.slice(1)):document.querySelector(T):T;if(!M)return;g=oL(M,f)}else g=f;"scrollBehavior"in document.documentElement.style?window.scrollTo(g):window.scrollTo(g.left!=null?g.left:window.scrollX,g.top!=null?g.top:window.scrollY)}function YT(f,g){return(history.state?history.state.position-g:-1)+f}const z0=new Map;function lL(f,g){z0.set(f,g)}function cL(f){const g=z0.get(f);return z0.delete(f),g}let uL=()=>location.protocol+"//"+location.host;function YS(f,g){const{pathname:T,search:C,hash:M}=g,k=f.indexOf("#");if(k>-1){let o=M.includes(f.slice(k))?f.slice(k).length:1,Q=M.slice(o);return Q[0]!=="/"&&(Q="/"+Q),XT(Q,"")}return XT(T,f)+C+M}function hL(f,g,T,C){let M=[],k=[],j=null;const o=({state:Oe})=>{const je=YS(f,location),ft=T.value,rt=g.value;let mt=0;if(Oe){if(T.value=je,g.value=Oe,j&&j===ft){j=null;return}mt=rt?Oe.position-rt.position:0}else C(je);M.forEach(Wt=>{Wt(T.value,ft,{delta:mt,type:rm.pop,direction:mt?mt>0?Kp.forward:Kp.back:Kp.unknown})})};function Q(){j=T.value}function pe(Oe){M.push(Oe);const je=()=>{const ft=M.indexOf(Oe);ft>-1&&M.splice(ft,1)};return k.push(je),je}function he(){const{history:Oe}=window;Oe.state&&Oe.replaceState(cn({},Oe.state,{scroll:Wg()}),"")}function ye(){for(const Oe of k)Oe();k=[],window.removeEventListener("popstate",o),window.removeEventListener("beforeunload",he)}return window.addEventListener("popstate",o),window.addEventListener("beforeunload",he,{passive:!0}),{pauseListeners:Q,listen:pe,destroy:ye}}function JT(f,g,T,C=!1,M=!1){return{back:f,current:g,forward:T,replaced:C,position:window.history.length,scroll:M?Wg():null}}function dL(f){const{history:g,location:T}=window,C={value:YS(f,T)},M={value:g.state};M.value||k(C.value,{back:null,current:C.value,forward:null,position:g.length-1,replaced:!0,scroll:null},!0);function k(Q,pe,he){const ye=f.indexOf("#"),Oe=ye>-1?(T.host&&document.querySelector("base")?f:f.slice(ye))+Q:uL()+f+Q;try{g[he?"replaceState":"pushState"](pe,"",Oe),M.value=pe}catch(je){console.error(je),T[he?"replace":"assign"](Oe)}}function j(Q,pe){const he=cn({},g.state,JT(M.value.back,Q,M.value.forward,!0),pe,{position:M.value.position});k(Q,he,!0),C.value=Q}function o(Q,pe){const he=cn({},M.value,g.state,{forward:Q,scroll:Wg()});k(he.current,he,!0);const ye=cn({},JT(C.value,Q,null),{position:he.position+1},pe);k(Q,ye,!1),C.value=Q}return{location:C,state:M,push:o,replace:j}}function fL(f){f=rL(f);const g=dL(f),T=hL(f,g.state,g.location,g.replace);function C(k,j=!0){j||T.pauseListeners(),history.go(k)}const M=cn({location:"",base:f,go:C,createHref:sL.bind(null,f)},g,T);return Object.defineProperty(M,"location",{enumerable:!0,get:()=>g.location.value}),Object.defineProperty(M,"state",{enumerable:!0,get:()=>g.state.value}),M}function pL(f){return typeof f=="string"||f&&typeof f=="object"}function JS(f){return typeof f=="string"||typeof f=="symbol"}const QS=Symbol("");var QT;(function(f){f[f.aborted=4]="aborted",f[f.cancelled=8]="cancelled",f[f.duplicated=16]="duplicated"})(QT||(QT={}));function Od(f,g){return cn(new Error,{type:f,[QS]:!0},g)}function Ol(f,g){return f instanceof Error&&QS in f&&(g==null||!!(f.type&g))}const e2="[^/]+?",mL={sensitive:!1,strict:!1,start:!0,end:!0},_L=/[.+*?^${}()[\]/\\]/g;function gL(f,g){const T=cn({},mL,g),C=[];let M=T.start?"^":"";const k=[];for(const pe of f){const he=pe.length?[]:[90];T.strict&&!pe.length&&(M+="/");for(let ye=0;ye<pe.length;ye++){const Oe=pe[ye];let je=40+(T.sensitive?.25:0);if(Oe.type===0)ye||(M+="/"),M+=Oe.value.replace(_L,"\\$&"),je+=40;else if(Oe.type===1){const{value:ft,repeatable:rt,optional:mt,regexp:Wt}=Oe;k.push({name:ft,repeatable:rt,optional:mt});const wt=Wt||e2;if(wt!==e2){je+=10;try{new RegExp(`(${wt})`)}catch(Zt){throw new Error(`Invalid custom RegExp for param "${ft}" (${wt}): `+Zt.message)}}let Xt=rt?`((?:${wt})(?:/(?:${wt}))*)`:`(${wt})`;ye||(Xt=mt&&pe.length<2?`(?:/${Xt})`:"/"+Xt),mt&&(Xt+="?"),M+=Xt,je+=20,mt&&(je+=-8),rt&&(je+=-20),wt===".*"&&(je+=-50)}he.push(je)}C.push(he)}if(T.strict&&T.end){const pe=C.length-1;C[pe][C[pe].length-1]+=.7000000000000001}T.strict||(M+="/?"),T.end?M+="$":T.strict&&!M.endsWith("/")&&(M+="(?:/|$)");const j=new RegExp(M,T.sensitive?"":"i");function o(pe){const he=pe.match(j),ye={};if(!he)return null;for(let Oe=1;Oe<he.length;Oe++){const je=he[Oe]||"",ft=k[Oe-1];ye[ft.name]=je&&ft.repeatable?je.split("/"):je}return ye}function Q(pe){let he="",ye=!1;for(const Oe of f){(!ye||!he.endsWith("/"))&&(he+="/"),ye=!1;for(const je of Oe)if(je.type===0)he+=je.value;else if(je.type===1){const{value:ft,repeatable:rt,optional:mt}=je,Wt=ft in pe?pe[ft]:"";if(Ca(Wt)&&!rt)throw new Error(`Provided param "${ft}" is an array but it is not repeatable (* or + modifiers)`);const wt=Ca(Wt)?Wt.join("/"):Wt;if(!wt)if(mt)Oe.length<2&&(he.endsWith("/")?he=he.slice(0,-1):ye=!0);else throw new Error(`Missing required param "${ft}"`);he+=wt}}return he||"/"}return{re:j,score:C,keys:k,parse:o,stringify:Q}}function yL(f,g){let T=0;for(;T<f.length&&T<g.length;){const C=g[T]-f[T];if(C)return C;T++}return f.length<g.length?f.length===1&&f[0]===80?-1:1:f.length>g.length?g.length===1&&g[0]===80?1:-1:0}function eE(f,g){let T=0;const C=f.score,M=g.score;for(;T<C.length&&T<M.length;){const k=yL(C[T],M[T]);if(k)return k;T++}if(Math.abs(M.length-C.length)===1){if(t2(C))return 1;if(t2(M))return-1}return M.length-C.length}function t2(f){const g=f[f.length-1];return f.length>0&&g[g.length-1]<0}const xL={type:0,value:""},vL=/[a-zA-Z0-9_]/;function bL(f){if(!f)return[[]];if(f==="/")return[[xL]];if(!f.startsWith("/"))throw new Error(`Invalid path "${f}"`);function g(je){throw new Error(`ERR (${T})/"${pe}": ${je}`)}let T=0,C=T;const M=[];let k;function j(){k&&M.push(k),k=[]}let o=0,Q,pe="",he="";function ye(){pe&&(T===0?k.push({type:0,value:pe}):T===1||T===2||T===3?(k.length>1&&(Q==="*"||Q==="+")&&g(`A repeatable param (${pe}) must be alone in its segment. eg: '/:ids+.`),k.push({type:1,value:pe,regexp:he,repeatable:Q==="*"||Q==="+",optional:Q==="*"||Q==="?"})):g("Invalid state to consume buffer"),pe="")}function Oe(){pe+=Q}for(;o<f.length;){if(Q=f[o++],Q==="\\"&&T!==2){C=T,T=4;continue}switch(T){case 0:Q==="/"?(pe&&ye(),j()):Q===":"?(ye(),T=1):Oe();break;case 4:Oe(),T=C;break;case 1:Q==="("?T=2:vL.test(Q)?Oe():(ye(),T=0,Q!=="*"&&Q!=="?"&&Q!=="+"&&o--);break;case 2:Q===")"?he[he.length-1]=="\\"?he=he.slice(0,-1)+Q:T=3:he+=Q;break;case 3:ye(),T=0,Q!=="*"&&Q!=="?"&&Q!=="+"&&o--,he="";break;default:g("Unknown state");break}}return T===2&&g(`Unfinished custom RegExp for param "${pe}"`),ye(),j(),M}function wL(f,g,T){const C=gL(bL(f.path),T),M=cn(C,{record:f,parent:g,children:[],alias:[]});return g&&!M.record.aliasOf==!g.record.aliasOf&&g.children.push(M),M}function TL(f,g){const T=[],C=new Map;g=s2({strict:!1,end:!0,sensitive:!1},g);function M(ye){return C.get(ye)}function k(ye,Oe,je){const ft=!je,rt=r2(ye);rt.aliasOf=je&&je.record;const mt=s2(g,ye),Wt=[rt];if("alias"in ye){const Zt=typeof ye.alias=="string"?[ye.alias]:ye.alias;for(const Li of Zt)Wt.push(r2(cn({},rt,{components:je?je.record.components:rt.components,path:Li,aliasOf:je?je.record:rt})))}let wt,Xt;for(const Zt of Wt){const{path:Li}=Zt;if(Oe&&Li[0]!=="/"){const Sr=Oe.record.path,mr=Sr[Sr.length-1]==="/"?"":"/";Zt.path=Oe.record.path+(Li&&mr+Li)}if(wt=wL(Zt,Oe,mt),je?je.alias.push(wt):(Xt=Xt||wt,Xt!==wt&&Xt.alias.push(wt),ft&&ye.name&&!n2(wt)&&j(ye.name)),tE(wt)&&Q(wt),rt.children){const Sr=rt.children;for(let mr=0;mr<Sr.length;mr++)k(Sr[mr],wt,je&&je.children[mr])}je=je||wt}return Xt?()=>{j(Xt)}:Xp}function j(ye){if(JS(ye)){const Oe=C.get(ye);Oe&&(C.delete(ye),T.splice(T.indexOf(Oe),1),Oe.children.forEach(j),Oe.alias.forEach(j))}else{const Oe=T.indexOf(ye);Oe>-1&&(T.splice(Oe,1),ye.record.name&&C.delete(ye.record.name),ye.children.forEach(j),ye.alias.forEach(j))}}function o(){return T}function Q(ye){const Oe=AL(ye,T);T.splice(Oe,0,ye),ye.record.name&&!n2(ye)&&C.set(ye.record.name,ye)}function pe(ye,Oe){let je,ft={},rt,mt;if("name"in ye&&ye.name){if(je=C.get(ye.name),!je)throw Od(1,{location:ye});mt=je.record.name,ft=cn(i2(Oe.params,je.keys.filter(Xt=>!Xt.optional).concat(je.parent?je.parent.keys.filter(Xt=>Xt.optional):[]).map(Xt=>Xt.name)),ye.params&&i2(ye.params,je.keys.map(Xt=>Xt.name))),rt=je.stringify(ft)}else if(ye.path!=null)rt=ye.path,je=T.find(Xt=>Xt.re.test(rt)),je&&(ft=je.parse(rt),mt=je.record.name);else{if(je=Oe.name?C.get(Oe.name):T.find(Xt=>Xt.re.test(Oe.path)),!je)throw Od(1,{location:ye,currentLocation:Oe});mt=je.record.name,ft=cn({},Oe.params,ye.params),rt=je.stringify(ft)}const Wt=[];let wt=je;for(;wt;)Wt.unshift(wt.record),wt=wt.parent;return{name:mt,path:rt,params:ft,matched:Wt,meta:EL(Wt)}}f.forEach(ye=>k(ye));function he(){T.length=0,C.clear()}return{addRoute:k,resolve:pe,removeRoute:j,clearRoutes:he,getRoutes:o,getRecordMatcher:M}}function i2(f,g){const T={};for(const C of g)C in f&&(T[C]=f[C]);return T}function r2(f){const g={path:f.path,redirect:f.redirect,name:f.name,meta:f.meta||{},aliasOf:f.aliasOf,beforeEnter:f.beforeEnter,props:SL(f),children:f.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in f?f.components||null:f.component&&{default:f.component}};return Object.defineProperty(g,"mods",{value:{}}),g}function SL(f){const g={},T=f.props||!1;if("component"in f)g.default=T;else for(const C in f.components)g[C]=typeof T=="object"?T[C]:T;return g}function n2(f){for(;f;){if(f.record.aliasOf)return!0;f=f.parent}return!1}function EL(f){return f.reduce((g,T)=>cn(g,T.meta),{})}function s2(f,g){const T={};for(const C in f)T[C]=C in g?g[C]:f[C];return T}function AL(f,g){let T=0,C=g.length;for(;T!==C;){const k=T+C>>1;eE(f,g[k])<0?C=k:T=k+1}const M=IL(f);return M&&(C=g.lastIndexOf(M,C-1)),C}function IL(f){let g=f;for(;g=g.parent;)if(tE(g)&&eE(f,g)===0)return g}function tE({record:f}){return!!(f.name||f.components&&Object.keys(f.components).length||f.redirect)}function CL(f){const g={};if(f===""||f==="?")return g;const C=(f[0]==="?"?f.slice(1):f).split("&");for(let M=0;M<C.length;++M){const k=C[M].replace($S," "),j=k.indexOf("="),o=im(j<0?k:k.slice(0,j)),Q=j<0?null:im(k.slice(j+1));if(o in g){let pe=g[o];Ca(pe)||(pe=g[o]=[pe]),pe.push(Q)}else g[o]=Q}return g}function o2(f){let g="";for(let T in f){const C=f[T];if(T=ZD(T),C==null){C!==void 0&&(g+=(g.length?"&":"")+T);continue}(Ca(C)?C.map(k=>k&&L0(k)):[C&&L0(C)]).forEach(k=>{k!==void 0&&(g+=(g.length?"&":"")+T,k!=null&&(g+="="+k))})}return g}function PL(f){const g={};for(const T in f){const C=f[T];C!==void 0&&(g[T]=Ca(C)?C.map(M=>M==null?null:""+M):C==null?C:""+C)}return g}const ML=Symbol(""),a2=Symbol(""),lv=Symbol(""),iE=Symbol(""),O0=Symbol("");function Bp(){let f=[];function g(C){return f.push(C),()=>{const M=f.indexOf(C);M>-1&&f.splice(M,1)}}function T(){f=[]}return{add:g,list:()=>f.slice(),reset:T}}function Ac(f,g,T,C,M,k=j=>j()){const j=C&&(C.enterCallbacks[M]=C.enterCallbacks[M]||[]);return()=>new Promise((o,Q)=>{const pe=Oe=>{Oe===!1?Q(Od(4,{from:T,to:g})):Oe instanceof Error?Q(Oe):pL(Oe)?Q(Od(2,{from:g,to:Oe})):(j&&C.enterCallbacks[M]===j&&typeof Oe=="function"&&j.push(Oe),o())},he=k(()=>f.call(C&&C.instances[M],g,T,pe));let ye=Promise.resolve(he);f.length<3&&(ye=ye.then(pe)),ye.catch(Oe=>Q(Oe))})}function f0(f,g,T,C,M=k=>k()){const k=[];for(const j of f)for(const o in j.components){let Q=j.components[o];if(!(g!=="beforeRouteEnter"&&!j.instances[o]))if(HS(Q)){const he=(Q.__vccOpts||Q)[g];he&&k.push(Ac(he,T,C,j,o,M))}else{let pe=Q();k.push(()=>pe.then(he=>{if(!he)throw new Error(`Couldn't resolve component "${o}" at "${j.path}"`);const ye=FD(he)?he.default:he;j.mods[o]=he,j.components[o]=ye;const je=(ye.__vccOpts||ye)[g];return je&&Ac(je,T,C,j,o,M)()}))}}return k}function l2(f){const g=rl(lv),T=rl(iE),C=Aa(()=>{const Q=Cc(f.to);return g.resolve(Q)}),M=Aa(()=>{const{matched:Q}=C.value,{length:pe}=Q,he=Q[pe-1],ye=T.matched;if(!he||!ye.length)return-1;const Oe=ye.findIndex(zd.bind(null,he));if(Oe>-1)return Oe;const je=c2(Q[pe-2]);return pe>1&&c2(he)===je&&ye[ye.length-1].path!==je?ye.findIndex(zd.bind(null,Q[pe-2])):Oe}),k=Aa(()=>M.value>-1&&OL(T.params,C.value.params)),j=Aa(()=>M.value>-1&&M.value===T.matched.length-1&&KS(T.params,C.value.params));function o(Q={}){if(zL(Q)){const pe=g[Cc(f.replace)?"replace":"push"](Cc(f.to)).catch(Xp);return f.viewTransition&&typeof document<"u"&&"startViewTransition"in document&&document.startViewTransition(()=>pe),pe}return Promise.resolve()}return{route:C,href:Aa(()=>C.value.href),isActive:k,isExactActive:j,navigate:o}}function RL(f){return f.length===1?f[0]:f}const DL=rS({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"},viewTransition:Boolean},useLink:l2,setup(f,{slots:g}){const T=Vg(l2(f)),{options:C}=rl(lv),M=Aa(()=>({[u2(f.activeClass,C.linkActiveClass,"router-link-active")]:T.isActive,[u2(f.exactActiveClass,C.linkExactActiveClass,"router-link-exact-active")]:T.isExactActive}));return()=>{const k=g.default&&RL(g.default(T));return f.custom?k:DS("a",{"aria-current":T.isExactActive?f.ariaCurrentValue:null,href:T.href,onClick:T.navigate,class:M.value},k)}}}),LL=DL;function zL(f){if(!(f.metaKey||f.altKey||f.ctrlKey||f.shiftKey)&&!f.defaultPrevented&&!(f.button!==void 0&&f.button!==0)){if(f.currentTarget&&f.currentTarget.getAttribute){const g=f.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(g))return}return f.preventDefault&&f.preventDefault(),!0}}function OL(f,g){for(const T in g){const C=g[T],M=f[T];if(typeof C=="string"){if(C!==M)return!1}else if(!Ca(M)||M.length!==C.length||C.some((k,j)=>k!==M[j]))return!1}return!0}function c2(f){return f?f.aliasOf?f.aliasOf.path:f.path:""}const u2=(f,g,T)=>f??g??T,kL=rS({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(f,{attrs:g,slots:T}){const C=rl(O0),M=Aa(()=>f.route||C.value),k=rl(a2,0),j=Aa(()=>{let pe=Cc(k);const{matched:he}=M.value;let ye;for(;(ye=he[pe])&&!ye.components;)pe++;return pe}),o=Aa(()=>M.value.matched[j.value]);dg(a2,Aa(()=>j.value+1)),dg(ML,o),dg(O0,M);const Q=T0();return Wp(()=>[Q.value,o.value,f.name],([pe,he,ye],[Oe,je,ft])=>{he&&(he.instances[ye]=pe,je&&je!==he&&pe&&pe===Oe&&(he.leaveGuards.size||(he.leaveGuards=je.leaveGuards),he.updateGuards.size||(he.updateGuards=je.updateGuards))),pe&&he&&(!je||!zd(he,je)||!Oe)&&(he.enterCallbacks[ye]||[]).forEach(rt=>rt(pe))},{flush:"post"}),()=>{const pe=M.value,he=f.name,ye=o.value,Oe=ye&&ye.components[he];if(!Oe)return h2(T.default,{Component:Oe,route:pe});const je=ye.props[he],ft=je?je===!0?pe.params:typeof je=="function"?je(pe):je:null,mt=DS(Oe,cn({},ft,g,{onVnodeUnmounted:Wt=>{Wt.component.isUnmounted&&(ye.instances[he]=null)},ref:Q}));return h2(T.default,{Component:mt,route:pe})||mt}}});function h2(f,g){if(!f)return null;const T=f(g);return T.length===1?T[0]:T}const FL=kL;function BL(f){const g=TL(f.routes,f),T=f.parseQuery||CL,C=f.stringifyQuery||o2,M=f.history,k=Bp(),j=Bp(),o=Bp(),Q=qP(wc);let pe=wc;Ad&&f.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const he=h0.bind(null,Rt=>""+Rt),ye=h0.bind(null,KD),Oe=h0.bind(null,im);function je(Rt,ci){let zt,Yt;return JS(Rt)?(zt=g.getRecordMatcher(Rt),Yt=ci):Yt=Rt,g.addRoute(Yt,zt)}function ft(Rt){const ci=g.getRecordMatcher(Rt);ci&&g.removeRoute(ci)}function rt(){return g.getRoutes().map(Rt=>Rt.record)}function mt(Rt){return!!g.getRecordMatcher(Rt)}function Wt(Rt,ci){if(ci=cn({},ci||Q.value),typeof Rt=="string"){const $e=d0(T,Rt,ci.path),It=g.resolve({path:$e.path},ci),Ct=M.createHref($e.fullPath);return cn($e,It,{params:Oe(It.params),hash:im($e.hash),redirectedFrom:void 0,href:Ct})}let zt;if(Rt.path!=null)zt=cn({},Rt,{path:d0(T,Rt.path,ci.path).path});else{const $e=cn({},Rt.params);for(const It in $e)$e[It]==null&&delete $e[It];zt=cn({},Rt,{params:ye($e)}),ci.params=ye(ci.params)}const Yt=g.resolve(zt,ci),sr=Rt.hash||"";Yt.params=he(Oe(Yt.params));const Ie=QD(C,cn({},Rt,{hash:WD(sr),path:Yt.path})),Ae=M.createHref(Ie);return cn({fullPath:Ie,hash:sr,query:C===o2?PL(Rt.query):Rt.query||{}},Yt,{redirectedFrom:void 0,href:Ae})}function wt(Rt){return typeof Rt=="string"?d0(T,Rt,Q.value.path):cn({},Rt)}function Xt(Rt,ci){if(pe!==Rt)return Od(8,{from:ci,to:Rt})}function Zt(Rt){return mr(Rt)}function Li(Rt){return Zt(cn(wt(Rt),{replace:!0}))}function Sr(Rt){const ci=Rt.matched[Rt.matched.length-1];if(ci&&ci.redirect){const{redirect:zt}=ci;let Yt=typeof zt=="function"?zt(Rt):zt;return typeof Yt=="string"&&(Yt=Yt.includes("?")||Yt.includes("#")?Yt=wt(Yt):{path:Yt},Yt.params={}),cn({query:Rt.query,hash:Rt.hash,params:Yt.path!=null?{}:Rt.params},Yt)}}function mr(Rt,ci){const zt=pe=Wt(Rt),Yt=Q.value,sr=Rt.state,Ie=Rt.force,Ae=Rt.replace===!0,$e=Sr(zt);if($e)return mr(cn(wt($e),{state:typeof $e=="object"?cn({},sr,$e.state):sr,force:Ie,replace:Ae}),ci||zt);const It=zt;It.redirectedFrom=ci;let Ct;return!Ie&&eL(C,Yt,zt)&&(Ct=Od(16,{to:It,from:Yt}),Nn(Yt,Yt,!0,!1)),(Ct?Promise.resolve(Ct):fs(It,Yt)).catch(bt=>Ol(bt)?Ol(bt,2)?bt:Hn(bt):Oi(bt,It,Yt)).then(bt=>{if(bt){if(Ol(bt,2))return mr(cn({replace:Ae},wt(bt.to),{state:typeof bt.to=="object"?cn({},sr,bt.to.state):sr,force:Ie}),ci||It)}else bt=Ns(It,Yt,!0,Ae,sr);return Rs(It,Yt,bt),bt})}function vn(Rt,ci){const zt=Xt(Rt,ci);return zt?Promise.reject(zt):Promise.resolve()}function Zn(Rt){const ci=qn.values().next().value;return ci&&typeof ci.runWithContext=="function"?ci.runWithContext(Rt):Rt()}function fs(Rt,ci){let zt;const[Yt,sr,Ie]=NL(Rt,ci);zt=f0(Yt.reverse(),"beforeRouteLeave",Rt,ci);for(const $e of Yt)$e.leaveGuards.forEach(It=>{zt.push(Ac(It,Rt,ci))});const Ae=vn.bind(null,Rt,ci);return zt.push(Ae),Qn(zt).then(()=>{zt=[];for(const $e of k.list())zt.push(Ac($e,Rt,ci));return zt.push(Ae),Qn(zt)}).then(()=>{zt=f0(sr,"beforeRouteUpdate",Rt,ci);for(const $e of sr)$e.updateGuards.forEach(It=>{zt.push(Ac(It,Rt,ci))});return zt.push(Ae),Qn(zt)}).then(()=>{zt=[];for(const $e of Ie)if($e.beforeEnter)if(Ca($e.beforeEnter))for(const It of $e.beforeEnter)zt.push(Ac(It,Rt,ci));else zt.push(Ac($e.beforeEnter,Rt,ci));return zt.push(Ae),Qn(zt)}).then(()=>(Rt.matched.forEach($e=>$e.enterCallbacks={}),zt=f0(Ie,"beforeRouteEnter",Rt,ci,Zn),zt.push(Ae),Qn(zt))).then(()=>{zt=[];for(const $e of j.list())zt.push(Ac($e,Rt,ci));return zt.push(Ae),Qn(zt)}).catch($e=>Ol($e,8)?$e:Promise.reject($e))}function Rs(Rt,ci,zt){o.list().forEach(Yt=>Zn(()=>Yt(Rt,ci,zt)))}function Ns(Rt,ci,zt,Yt,sr){const Ie=Xt(Rt,ci);if(Ie)return Ie;const Ae=ci===wc,$e=Ad?history.state:{};zt&&(Yt||Ae?M.replace(Rt.fullPath,cn({scroll:Ae&&$e&&$e.scroll},sr)):M.push(Rt.fullPath,sr)),Q.value=Rt,Nn(Rt,ci,zt,Ae),Hn()}let Fi;function Ro(){Fi||(Fi=M.listen((Rt,ci,zt)=>{if(!Jo.listening)return;const Yt=Wt(Rt),sr=Sr(Yt);if(sr){mr(cn(sr,{replace:!0,force:!0}),Yt).catch(Xp);return}pe=Yt;const Ie=Q.value;Ad&&lL(YT(Ie.fullPath,zt.delta),Wg()),fs(Yt,Ie).catch(Ae=>Ol(Ae,12)?Ae:Ol(Ae,2)?(mr(cn(wt(Ae.to),{force:!0}),Yt).then($e=>{Ol($e,20)&&!zt.delta&&zt.type===rm.pop&&M.go(-1,!1)}).catch(Xp),Promise.reject()):(zt.delta&&M.go(-zt.delta,!1),Oi(Ae,Yt,Ie))).then(Ae=>{Ae=Ae||Ns(Yt,Ie,!1),Ae&&(zt.delta&&!Ol(Ae,8)?M.go(-zt.delta,!1):zt.type===rm.pop&&Ol(Ae,20)&&M.go(-1,!1)),Rs(Yt,Ie,Ae)}).catch(Xp)}))}let ln=Bp(),Qi=Bp(),Ei;function Oi(Rt,ci,zt){Hn(Rt);const Yt=Qi.list();return Yt.length?Yt.forEach(sr=>sr(Rt,ci,zt)):console.error(Rt),Promise.reject(Rt)}function Gn(){return Ei&&Q.value!==wc?Promise.resolve():new Promise((Rt,ci)=>{ln.add([Rt,ci])})}function Hn(Rt){return Ei||(Ei=!Rt,Ro(),ln.list().forEach(([ci,zt])=>Rt?zt(Rt):ci()),ln.reset()),Rt}function Nn(Rt,ci,zt,Yt){const{scrollBehavior:sr}=f;if(!Ad||!sr)return Promise.resolve();const Ie=!zt&&cL(YT(Rt.fullPath,0))||(Yt||!zt)&&history.state&&history.state.scroll||null;return Q0().then(()=>sr(Rt,ci,Ie)).then(Ae=>Ae&&aL(Ae)).catch(Ae=>Oi(Ae,Rt,ci))}const fn=Rt=>M.go(Rt);let Cr;const qn=new Set,Jo={currentRoute:Q,listening:!0,addRoute:je,removeRoute:ft,clearRoutes:g.clearRoutes,hasRoute:mt,getRoutes:rt,resolve:Wt,options:f,push:Zt,replace:Li,go:fn,back:()=>fn(-1),forward:()=>fn(1),beforeEach:k.add,beforeResolve:j.add,afterEach:o.add,onError:Qi.add,isReady:Gn,install(Rt){const ci=this;Rt.component("RouterLink",LL),Rt.component("RouterView",FL),Rt.config.globalProperties.$router=ci,Object.defineProperty(Rt.config.globalProperties,"$route",{enumerable:!0,get:()=>Cc(Q)}),Ad&&!Cr&&Q.value===wc&&(Cr=!0,Zt(M.location).catch(sr=>{}));const zt={};for(const sr in wc)Object.defineProperty(zt,sr,{get:()=>Q.value[sr],enumerable:!0});Rt.provide(lv,ci),Rt.provide(iE,Z2(zt)),Rt.provide(O0,Q);const Yt=Rt.unmount;qn.add(Rt),Rt.unmount=function(){qn.delete(Rt),qn.size<1&&(pe=wc,Fi&&Fi(),Fi=null,Q.value=wc,Cr=!1,Ei=!1),Yt()}}};function Qn(Rt){return Rt.reduce((ci,zt)=>ci.then(()=>Zn(zt)),Promise.resolve())}return Jo}function NL(f,g){const T=[],C=[],M=[],k=Math.max(g.matched.length,f.matched.length);for(let j=0;j<k;j++){const o=g.matched[j];o&&(f.matched.find(pe=>zd(pe,o))?C.push(o):T.push(o));const Q=f.matched[j];Q&&(g.matched.find(pe=>zd(pe,Q))||M.push(Q))}return[T,C,M]}const VL="/static/assets/malaga-CHPZ_1rO.jpg",UL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKj0lEQVR4nO2dC7BVVRnHdyFmaIgYFpRhWGQYKIM9cMpAk0pTUroRlYxGWCmmVM4Vw0KnpGwmUyNFp0ztnWWJUVpJT4yiotIUGB5CYIligV24XuDXfN7/sc1m7dfZ55y99z37P3NHZtxn7bXWt9f3/r7leTkBGAHMBx4CdgBrgS8AR+c1p7YD8GzgNGAxsJtw/BKYCvTLe859EsBA4FzgQdJhLXAh8Ny819AnALwcuAbYTjb8C5gHHJz3msrKlk4F7gb2RGzyHrGm6ZIn04FfxRDmcRHm0LzXWXjYJgEfA1bHbOq/JbyPChlnFHAT0B0xhp24TwGHtH6lBQcwDlgI/DeGEEaoTmBQwnFfoNNgBAzDNuAzScfsswCGStj+OYYIxpZ+Ks3qWRkUgk7gsQSsbKDXLgCGiM+byrorhhD/Aa41od7A9x8EzAYeiXjvP4ELgP5eX4J9zcBwYBIwF7gvxm6owU7MB2zzmji3AZJVj0bMYxVwpldGAKdI368XTwK3AONbPO+DgDkxrOx7pZMvwD/qIEJNZT0HeF7O8x8IXAY8ETLXH9Urv4pOEGNZSyVgX+oVDMBgYEGIfDvXKwuAt4awLFM3/wbcCrzf1FCvBADGOLS/rWWZf64wdgdcBPwE2OzbwA3AjbL4n1PHuCMk2/y4rTmr6CMAJktNJYEK/Q1gimlYKcb/iEPuTWzuqkoKU0mBp0iPbcDNtrHmM4t5Rz/gj4Hfm7d5/9attAQADm+A99fwMHAF8JKId73GYT99vLUrLjiAzzrcHqa5HSujb4AM0gUxVnkNO4GOiPddH3i+y2RMa1ddYAD3BzZoUgzbmSDiRFnm5hk+PmSMQxRP8WNxUxdZJji8wokMS6A/8DbgW/rKg9gIHBbyW/PBBTGl4YsrIxzq6PPrGGMQcLEjAPYLl2NRvjnzLARl0IFeuwP4fWBjzN7Yr86xLnd8+QtCnj3aodld6bU7FEcJYqVpP8CrFAI2vj9MBt44399R/hOlZ3/oGG9myLs/55A9I712hlnewAqyoUtEvFEG5krHRr8+xEMc9N3d7bU7gBfWkRIUBZddY16Awx3vfqfj2UrASzDfkCD6mAV/cOV0AfcEnqsEfA3AERLOS32G4FY5G9cAy/W3Wl7puGSKIG51vPMVjqyWSsBnPF0nKp3IPMNxuMgxxqcDz3Q3MgegbQHsB0xzOBL96AFOCvzOXDTrk6jMLQVwggI6j4pFLAG+pEWmNtryAr3G35SIRL3HgpFOeZ39WJ/fCv4/qXURX5YZUj8I8xMVEcD+cla63Csr/MJb9o4fO/Kdfe+kknhUEWFGeSUBMDKEjVnSwzBfxo0fD+c9b5tUR0wqTfDEfKJeV0dOIeLlITLlAYf9YrGT9+U975oL4lCVD7xJaZmW4BCG5WU5LcBJCT82P1GmeUUEcIxSR10wHv3huFBqQbwCabHJKzKAN0fo+3/KkjxglrSihVOBTwLfBH4t/9R2GYJrZTh+V6e3Q97b2Bxeh6ukKxDWXaeior3glcQY+1rEV3W/NvR4CxQpoGS6/ouVKzVBm3OJ6j+WiMhRRT1JZNpfRcRL5Wg8UtqTZejPcGQ0XivZMlYW+9NZjcGBvbIAeAewhfLiqpB17QWvTFAxzUJpK2XDIyFr2gteGQG8UuyiO+smiYUtBD6qAp8xYj0DxFrMd/Uh4DoVAdULp8AOPuSVGeZiUSLBV6USbxGRTIBuks7/W+Auudwvltvi2Hqz59kXloP8O2WY1LzFwcCVYX6S8TJvSruBBBsoN8rVyv3apHpEZ+ZiRZCMoMEbWBEkI9gXgzKq9BVBGkyQbWJJiWvXZY90SuZUBGmyl3qjFSM5fneK/l8UNuezqhIDeHtEXWENGxy/iyOGjTk5n1WVHESwnBocvwlDapZXIVooz3N9/Y5ng9io35arfLosICVB8pllG4GKIMUCFUGKBSqCFAtUBCkWqAhSLFARpFigIkixQEWQYoGKIMUCFUGKBSqCFAtUBCkW2BfPZLPbvyuCtBjs3Zmu3EnVfQH0luLtLnXZQYsT6iao8eaoevopJoFYUxRREhfmWIM0tcO1BL+f60agNfqz2sw7FWmcHNaNqIjFmFPVHdvVfMyutZhVKzNr8Elxsa/NcSdDNSUXKNsyTXb+bnUkOr+QxFHM+64Ui1mim3gG5/ThnKxu2I1IIu9Wb6+JhWjkrAX+OEPdxyLg3c2+7kjFoXMT3HtSQ4+SKlxVvmFYqSTy/MrMgfeGTO5B8eKoe0H82KqM92MaNK9+SvKek+C6jRpbvV3J5Ef6C16BF+lU2eUyyxKwt50qejqhEWuJW+hwfdEz1cTSMtH9+Dvw6sDGHKdMeJd8cWGZxo/MmNfYh6n/1sn6zdVqOmN9gJPASqrPS8M+rTGBKrmSnLYHJGsa2ztfk7gzwdfx2phxRqiJWVT1bw3b1Vz5Dj2/Vicpa/tZq2f8sv/DySiPbk/Qn3ibmnxmv79RfXFDk9Qc2o0VV46PE3LAaLWTTdL5Oit26oM6qxk39KjWca5aQEXBPujrsian1XPVBWr6Yhs+NuYd/VXYE3d7W1psEC+f3qqr+MRGT5WyEtojLMsLjOquStybxX97Umggl0c1IqC3HUZalXOL5nOP5tSpDdmny1yrIWPzChURNabXiqNv4lX+JgKyQU5XqVlSQfoXCcVnOk87+pGgk/l54F3SmEaoHvHAEraWOlOnxrq1npFlsKAAHRLx7AF68bdTdIRbpkvAgl1HbYwD6p54GzVETqQeqjPoNG20CdS0GNP81fWNHu6z6lQMztaFLj0JCdJyH5HYYbGve5WhFVTbboq6PiKBJ/iD8mdFeWqdTZIbCc3lDPV0XKH52N9sr6iQG6ErRMP5OvC6DGMPUwfspSEG528kX96ollJD0l4maQqAlIHx2vzL5FhcE2HkPlkIR2GMv2pXTN/cs7MIYXo3LUnn0VZgnVd0qOGZfVVRsAabV2ZgZ+NSeASagR61jMrkUmkZZFGfo2haFHbJ/zQp7dGn12eWNLaSFbultFwjW6qclx77nGp3JGghvkoxgsF1dMKeraY3y3U6H68jqPSUTp15Cn6mxjfnqd9X0+7yzQ1yqnUmKEM2W+Q7xvq8Cs2HGsB0qKVSnIt+uUK4pXKBlBbqgXVDgrjFVvmqRpZEfo4WqzMF5w0K1pWila7/hudZiiJGYQ9wL/CeIvmv9GHNl+bVFcGK71WoeLhXIiVgorqN9iSMrY/N0WV+ScKIpktrW1Qatdlnnc9LmApai3cPaoEPa6ZueEuSDRmHmnupPNe/0suTO3Tc45QAYxe3KRuyIS4NhQrsloXvp/BGr5fSskj/XRVDwEu9MoJeP9X8hKdmtfj1sDoDRW8BvpKgwxBir4sVhx8a4aA8S+6jIK73ygx6N+x0JSPEyZpdMvRmRHX2UYz7RBmESfsQ36cU01QhAMlJi4YiI7YhOWZFkjVzEuY+dSsQNkOnbai+2ltSZLQ8pBshXtaACw9G90kvgE9DmyAZsoPGYrPiPcc9/bIKdUUezw/h10mxRUarsZd+KadQIQyyki+MuSSshieUFXNa2gBXBS89ZFEb/7cIo50AY22WU/tFeaULR4T/AVpyfU8HEgfbAAAAAElFTkSuQmCC",jL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAADT0lEQVR4nO2ZTW4UMRCFvUW5CErEPQhwhiQrtjkPKyLukIsgRSyJJogThMzyIY9aESHd7f/yc8/7pNm161XXs2tst3NCCCGEEEIIIYQQQgghRBAAlwB+T79LNxgALgD8GjX/ZwC8AfAFr/kG4MSRg8HzfwGAtwC+Y5kfAN45UjB4/nNL/BFh9gCuHRkYPP9n/DIGcLOQ/N30m+OGoQVg8PxTlvih56705O4tAIPnH7vEnwB8Tnh+36MFjJ7/v4llz5iYGemUf9LLnK301K8xCU1twD87x53XaHVOYMrffIkXxNuvtYDccwJL/sW0/FNLbQHIOCcw5V+MhWBswRB/Tnie8Uz5FwPgCsCfGRFflKsqIq/1Hmf0fA63GeeEW6L88/V67rsRbkmp5wSm/NNXJMO2DuECP839aUa0NIb84ydE7V3IsZ8TkLsLi7jLOTV8idPSu6Oh32cTMypvxV/TrXgAnxZ2IQcMEz5pdfKtcTKvxVKdJw8+uunaYZFRWtQoLWyt1gB2/oFdT0Oa7dtJzlUz+mvc+wc+TKb8nPqtiSERM/Zs5BW5ov0/F1PtvQfnwQGNkuq+iUCng29yfVsbwvaBB8a7MBpDmD+BwnDFUhjC0KJYJkx3Q1gOZiz5djOEuUX1XNFdDBmhRfWaUOaGjNairN/HzJCRW5TlijcxZAstymrCNTeE5bbYiuBtbeL4ZMGI57vfFlsSvK1NHJ8sGPF819tiMkPuU8cnC0Y83+W2uBfJt7WB8cmCpQm7jQHr+siQdWQIGTKEjM0a4vfsoS3zAg9rf54FcWPjm9THXHB68Vx2jeLGxDepj7lgacVco7ip8VvVx1zQqmC59K6PuWCqDhoXTIbIkAP1B2SOT9VBo7hW8bPHy5A28bPHozK1EkOjuKXxS0lOrJVgamJoFLc0fikxiT1YCKYmhkZxS+MXEvyg5QXPa5pSq3BoFLc0fgH++8l71xqrF3OF+rXyduzIEDIILhdf0CDvrPjdSHix3P+q3VrvzS3Y0RvCpg8ZwqUPGcKlDxnCpQ8ZwqUPGcKlDxnCpQ8ZwqUPGcKlDxnCpY9jMWTrOHZwZDh2an9xJCf8xa83tb84EmPzxU8IIYQQQgghhBBCCCGEEMJti79bG/73TSOnDgAAAABJRU5ErkJggg==",GL="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABkCAYAAABw4pVUAAAACXBIWXMAAAsTAAALEwEAmpwYAAAIUElEQVR4nO2dCaxdQxiAp7SoFi1SVEpra+1FK5ZnCxEaa2upEqGW2KuKkKCKWENDYgvSSBpd7JFQpBWltFKxdbO11hS1dtGVT8b9Iye/Ofe9d86ce2fOvV9yk5d73/3nnzn3zMy/zTGmSZMmJQDoAZwCjAYmAO8DC4FfgTXy+lXes589BdwEDLHfrbf+pQAYCNwHzAH+Jjv2u5+IrAH17ldUAJsC1wDzKA4r+2pgk3r3N1iAzYFbZNqpFbatMUD3evc/GID1gPOBn1sZvLXADOBu4DygBehjBxPoJK/u8l6L/M89wDvy3WosAYYDHUwjA+wsA5bGSmAycALQNUc7XYETRZaVmYa94DuZRgQ4A1iaMjCLgWuBbgW0201k/5DS9h/A6abBpqj7qwzGSGCjGujRGbhK2nRhd2TrmTIDbABMTBmACcA2ddCpJzApRSdry2xgSnwxXnF0ejlwdgD6nSO6aF4u3UWRacp1Z1irelcTCMBuwKKUO6U801fKmvFRPaaoNk5hHzv0vdeUaDfluhjed1C+EHvGdVFONTFj9/SOXczCEO+MlDtFT1/LgL4m4nVDG33LQ1ozWgPYA1ih+vB2lBY9cIHjlq/7bqq9iEtFc66J0FGofVMTTKQAT6u+/BSVQ1K8tknsOtLTRAqwNfC76tNoE1E8Q7vQR5rIoRKjSfJLFPEUh+KLa+GbKhpgY+BH1bdRJnQckb5rC2hjXwksvQHMl93bcvl7mny2bwHtXqf6NsdEEANPstKXAQh0kCSHBbSd+ZLk0MGjwbhKteH9wnsDGKuUnexJbp9WAlmtYQNPvT3p8qySfY8JFcnsSHKCB5mHSog1L3areogHfQYruR+agPOmkqk6a/KEXRMXY7VjcFdJ/GSodWUAXeTVV96bmPK91XkviuwikzH6v4AtTWjI/J7kHQ/T1BLHoE5qy/Qj35+ccqfkmr6AmUrmYBMaklHoZW6lsoDrNWMdMCKDrCvlu0nezqqbyLxXybvRhIZMIUmG55B1quOXPSKHPBs7x9ev2uGnG29CA5itlGzJcXcsULImFeCPmpdzbUvyngkN4Cul5PY5jD69gOfesgI7OBb6/hll2fUpyUITGg7v7hYZ5YwpykvsyC7J5CC0uyolZ4kJDcevL1OmBhV3SJKhHnUcpmRPzShnQyVnlQkNx06mY0Y5nyk53lI7xU5JsiCjHJtHnGStCQ1HTlMmo5BK3Dq3nCo5vkmW5TAOkyw1oeEw4rbKKGepkuMt5mBl+RhISYBI8qMJDcdWdc+Mcj5VcnbxqGM/JXu+p51geG544E2l5NEZ5UxTcs7wqOOZnhb1QT7kFIqkWya5yNO2d2KA294RSs6TJjSAG5SSD2WUs4+SY7fTO3rQr48juLRXRlnjlJxrTGgAJ/lw4FFxndhIn9dAF/CMkjnXo5voGBMa4prQqT+ZQqdUwq6aK3PoNsoh78SMsjo6yuJ6hpo6qm2I3jnukhlK1ros6UTi6dVG6/QseiVKFpL8bELFEbg5LYes3hJM0liv7Q5tvGP1NIWk8mRyfIpcWzGc5A0TUR3IYznlHVIlFDtJfFP9xALvKn8Pk8/SQr8tnt34t5pQAY5Tyn7rQebBVSpm24P1JByeU5f1JWMxSa4LXCjyK9W/zNzlB1SmL1sGkJXpwHYe9DjIsXHpZELG4T4f4VH24HaegTLXbsc9tq+N1udN6ADXK6WnFNBGf0mqmCo2yzJ5zZf3RmeNBrbS7geqbxeb0AH2U0qvzer5DQlgd9Wvv31lQxaOw2N7uYkc4A6fqUQ1BbhZKT/TRAwVQ3VRdNOVqr7VJ8DFWb1q/u3PYaova4JMH60GMEt1YoyJFOAJ1ZcXTWzYdUN14vvg9+wObDoT8Gf0BwhI7tLKoqJ/tcJRNbU42sNoHLd6roz4WiOu9m9UH24ysSInIWgGmkgATnM4J7c2MeNIfggv/pyCw38Wje7tKeRZE4OFCxzhuLvjP4RZ5mFtVD1sAoeKTyzJNFMWbEqQ6tzqPFG7ogEOdNwduWIpQSHJybp+5AETKMCrStcZpmwAl6hOrgzxIDPgAMfdcZQpG1JT8a2PZLoarx1R2U7tArjUESsJxukIHN8Qd4c6u1cX5DxnAoBKAoN9Tkmh0c7gSCl5rnvmBnCh0sme0LCPKTsS7HlXz9P1PFiSSraM9UYnGWcaBdnJ6ADWWXXU506li3W39zKNhOOYo8XAZnXQo68jl+w202jYxDVHoejYOuhhD9tPYt3tXUwjIo+109vgvWvY/sn8nyGmUbGHYwKfqwF5qxZPIpCK3K9V26+ZRscWhzp+pZfXoN0HVZt2HelXdLtRYI1DNTjLioyZSJmDtTOS3F5Ue9FhnYyOw5enFmGbiE9NJ2xb70Fn321FTcrh/ecX0M5dqg1rDx3pu52yWPCvO+ovennOmrch5CSP+JJfOqikoOrndbzkMUj2oZL9XT2M0agArijieR3W+nZMVcf60br8U9cUNXjL88RNpE5Rl0Y/6lfzEgNs69h1zc6SwmmnJEfWy6IoHjURElQe9Ki5K4Oc8UrGX6XKIKkluAfzqBxJepamAZgVKkfpfaEG1AaSerTx9J/f1HffjbEkIsQi0tVqYKdVO2RTrHF9Yo99hlSf2mpfUqg80ltzR5X/f8Tx/8Nqq3X5t8IvOOyIIW181GuuM1eapJeWfeOYhv6zT+zBm44o5LyGjQAWDdDi8EV9Ks+GshfsS/XZiqzH+DVpI8BljinpVYdj0nJmvfVtCIDHaZ2aJ0w0eix+VpWLMSPaStlYAXqlHGz2XfSFmbECDFDxE1tzsn+99WpoqBz7vUheg+qtT5MmTUyB/AMwWGbajMlRRAAAAABJRU5ErkJggg==",HL="/static/assets/pelu-D6okUQNI.jpg",qL={name:"CaseCard",props:{caseData:{type:Object,required:!0},large:{type:Boolean,default:!1}},methods:{formatAmount(f){return new Intl.NumberFormat("es-ES").format(f)},getImageUrl(f){return f?f.startsWith("http")||f.startsWith("/media/")?f:`/media/${f.replace(/^\\|^\//,"")}`:""}}},$L={class:"bg-white rounded-xl shadow hover:shadow-lg transition overflow-hidden flex flex-col h-full"},WL=["src","alt"],ZL={key:1,class:"w-full h-32 bg-gray-200 flex items-center justify-center text-gray-400"},XL={class:"p-3 md:p-4 flex-1 flex flex-col"},KL={class:"flex items-center text-sm md:text-base text-gray-500 mb-1 md:mb-0 space-x-2"},YL={key:0},JL={class:"font-medium text-primary-600"},QL={class:"flex items-start justify-between mb-1"},ez={class:"text-lg md:text-xl lg:text-2xl font-bold text-gray-900 flex-1 mr-2"},tz={key:0,class:"text-lg md:text-xl text-primary-600 font-semibold whitespace-nowrap"},iz={class:"text-sm md:text-lg text-gray-700 mb-2 line-clamp-2"},rz={class:"text-sm md:text-base text-gray-500 mb-1"},nz={class:"text-gray-600 text-sm md:text-base mb-2 line-clamp-3"};function sz(f,g,T,C,M,k){const j=Dd("router-link");return Rn(),Fn("div",$L,[ls(j,{to:`/apartments/${T.caseData.id}`,class:"block"},{default:jg(()=>[T.caseData.main_image?(Rn(),Fn("img",{key:0,src:k.getImageUrl(T.caseData.main_image),alt:T.caseData.title,loading:"lazy",width:"400",height:"250",class:"w-full h-32 md:h-36 object-cover"},null,8,WL)):(Rn(),Fn("div",ZL," Sin imagen ")),ot("div",XL,[ot("div",KL,[ot("span",null,an(T.caseData.habitaciones)+" hab.",1),g[1]||(g[1]=ot("span",null,"",-1)),ot("span",null,an(T.caseData.banos)+" baos",1),T.caseData.capacity?(Rn(),Fn("span",YL,[g[0]||(g[0]=ot("span",null,"",-1)),ot("span",JL,an(T.caseData.capacity)+" pers.",1)])):Ea("",!0)]),ot("div",QL,[ot("h3",ez,an(T.caseData.title),1),T.caseData.precio?(Rn(),Fn("span",tz,[uo(""+an(k.formatAmount(T.caseData.precio))+" ",1),g[2]||(g[2]=ot("span",{class:"text-sm md:text-base font-bold"},"p/n",-1))])):Ea("",!0)]),ot("div",iz,an(T.caseData.descripcion),1),ot("div",rz,an(T.caseData.location),1),ot("p",nz,an(T.caseData.discount),1)])]),_:1},8,["to"])])}const oz=kd(qL,[["render",sz],["__scopeId","data-v-c401aa28"]]),az={name:"PropertyCarousel",components:{CaseCard:oz},props:{properties:{type:Array,required:!0}},data(){return{currentIndex:0,autoPlayInterval:null}},computed:{visibleProperties(){if(!this.properties.length)return[];const f=this.properties.length,g=(this.currentIndex-1+f)%f,T=(this.currentIndex+1)%f;return[this.properties[g],this.properties[this.currentIndex],this.properties[T]]}},mounted(){this.startAutoPlay()},beforeUnmount(){this.stopAutoPlay()},methods:{getItemClass(f){return f===1?"scale-100 opacity-100 z-10 w-full md:w-[400px] shadow-2xl":"scale-85 opacity-60 blur-[1px] w-full md:w-[350px] pointer-events-none"},next(){this.currentIndex=(this.currentIndex+1)%this.properties.length,this.resetAutoPlay()},prev(){this.currentIndex=(this.currentIndex-1+this.properties.length)%this.properties.length,this.resetAutoPlay()},selectProperty(f){f===0&&this.prev(),f===2&&this.next()},startAutoPlay(){this.autoPlayInterval=setInterval(this.next,4e3)},stopAutoPlay(){clearInterval(this.autoPlayInterval)},resetAutoPlay(){this.stopAutoPlay(),this.startAutoPlay()}}},lz={class:"carousel-container relative w-full overflow-hidden py-10"},cz={class:"carousel-track flex items-center justify-center transition-transform duration-700 ease-out",style:{transform:"translateX(0)"}},uz=["onClick"];function hz(f,g,T,C,M,k){const j=Dd("CaseCard");return Rn(),Fn("div",lz,[ot("div",cz,[(Rn(!0),Fn(Xo,null,iv(k.visibleProperties,(o,Q)=>(Rn(),Fn("div",{key:o.id,class:sm(["carousel-item transition-all duration-700 transform",k.getItemClass(Q)]),onClick:pe=>k.selectProperty(Q)},[ls(j,{caseData:o},null,8,["caseData"])],10,uz))),128))]),ot("button",{onClick:g[0]||(g[0]=(...o)=>k.prev&&k.prev(...o)),class:"absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 p-3 rounded-full shadow hover:bg-white z-20"},"  "),ot("button",{onClick:g[1]||(g[1]=(...o)=>k.next&&k.next(...o)),class:"absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 p-3 rounded-full shadow hover:bg-white z-20"},"  ")])}const dz=kd(az,[["render",hz],["__scopeId","data-v-df4ad495"]]),fz="/api/",pz={name:"HomeView",components:{PropertyCarousel:dz},data(){return{featuredProperties:[],RentIcon:UL,ManagementIcon:jL,LocationIcon:GL,ProfileImage:HL}},computed:{backgroundStyle(){return{backgroundImage:`linear-gradient(to right, rgba(255,255,255,0.6), rgba(255,255,255,0.6)), url(${VL})`}}},async mounted(){await this.loadFeaturedProperties()},methods:{scrollToProperties(){const f=document.getElementById("propiedades");f&&f.scrollIntoView({behavior:"smooth"})},async loadFeaturedProperties(){try{const f=await fetch(`${fz}properties/featured/`);this.featuredProperties=await f.json()}catch(f){console.error("Error loading properties:",f)}}}},mz={class:"min-h-screen bg-gray-50"},_z={class:"w-full px-4 md:px-8 flex-1 flex flex-col justify-center"},gz={class:"text-center"},yz={class:"flex justify-center mt-6 md:mt-10"},xz={class:"py-12 md:py-20 bg-palette-light"},vz={class:"w-full px-4 md:px-8 lg:px-16"},bz={class:"flex flex-col space-y-4 md:space-y-0 md:grid md:grid-cols-3 md:gap-6 lg:gap-8"},wz={class:"bg-palette-taupe rounded-xl shadow flex flex-col items-center p-6 md:p-8 lg:p-12 h-auto md:h-80"},Tz={class:"mb-4 md:mb-6 lg:mb-10 flex items-center justify-center"},Sz=["src"],Ez={class:"bg-palette-taupe rounded-xl shadow flex flex-col items-center p-6 md:p-8 lg:p-12 h-auto md:h-80"},Az={class:"mb-4 md:mb-6 lg:mb-10 flex items-center justify-center"},Iz=["src"],Cz={class:"bg-palette-taupe rounded-xl shadow flex flex-col items-center p-6 md:p-8 lg:p-12 h-auto md:h-80"},Pz={class:"mb-4 md:mb-6 lg:mb-10 flex items-center justify-center"},Mz=["src"],Rz={class:"py-12 md:py-16 bg-white",id:"propiedades"},Dz={class:"w-full px-4 md:px-8"},Lz={class:"text-center mt-10"},zz={class:"py-12 md:py-16 bg-palette-light"},Oz={class:"w-full px-4 md:px-8"},kz={class:"flex flex-col md:flex-row items-center gap-8 max-w-6xl mx-auto"},Fz={class:"w-full md:w-1/3 flex justify-center"},Bz=["src"];function Nz(f,g,T,C,M,k){const j=Dd("PropertyCarousel"),o=Dd("router-link");return Rn(),Fn("div",mz,[ot("section",{class:"w-full bg-gradient-to-r from-primary-600 to-primary-800 min-h-[95vh] flex flex-col justify-center bg-cover bg-center pt-12 pb-8 md:pt-0 md:pb-0",style:Bg(k.backgroundStyle)},[ot("div",_z,[ot("div",gz,[g[1]||(g[1]=ot("h1",{class:"text-2xl md:text-4xl lg:text-6xl font-bold mb-4 md:mb-6 lg:mb-8 text-palette-taupe"},[ot("span",{class:"notranslate"},"Casa del Sol")],-1)),g[2]||(g[2]=ot("p",{class:"text-sm md:text-lg lg:text-2xl font-bold mb-4 md:mb-6 max-w-3xl mx-auto text-palette-taupe px-2"}," El mejor lugar para organizar tus vacaciones perfectas en la Costa del Sol. Alquila hoy mismo y disfruta de un descuento del 10% respecto a otros portales. ",-1)),ot("div",yz,[ot("button",{onClick:g[0]||(g[0]=(...Q)=>k.scrollToProperties&&k.scrollToProperties(...Q)),class:"btn-tertiary text-sm md:text-base px-6 py-3 md:px-8 md:py-4"}," Ver propiedades ")])])])],4),ot("section",xz,[ot("div",vz,[g[6]||(g[6]=ot("h2",{class:"text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-8 md:mb-12 lg:mb-20 text-center text-palette-taupe"},"Nuestros Servicios",-1)),ot("div",bz,[ot("div",wz,[ot("div",Tz,[ot("img",{src:M.RentIcon,alt:"Alquiler Vacacional",class:"w-16 h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 object-contain"},null,8,Sz)]),g[3]||(g[3]=ot("div",{class:"text-center"},[ot("h3",{class:"text-lg md:text-xl lg:text-2xl font-semibold text-palette-light"},"Alquiler vacacional")],-1))]),ot("div",Ez,[ot("div",Az,[ot("img",{src:M.ManagementIcon,alt:"Gestin de Propiedades",class:"w-16 h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 object-contain"},null,8,Iz)]),g[4]||(g[4]=ot("div",{class:"text-center"},[ot("h3",{class:"text-lg md:text-xl lg:text-2xl font-semibold text-palette-light"},"Gestin de propiedades")],-1))]),ot("div",Cz,[ot("div",Pz,[ot("img",{src:M.LocationIcon,alt:"Viajes a Medida",class:"w-16 h-16 md:w-20 md:h-20 lg:w-24 lg:h-24 object-contain"},null,8,Mz)]),g[5]||(g[5]=ot("div",{class:"text-center"},[ot("h3",{class:"text-lg md:text-xl lg:text-2xl font-semibold text-palette-light"},"Viajes a medida")],-1))])])])]),ot("section",Rz,[ot("div",Dz,[g[8]||(g[8]=ot("div",{class:"mb-8 md:mb-12 lg:mb-20 text-center"},[ot("h2",{class:"text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 text-palette-taupe mb-4"},"Propiedades Destacadas"),ot("p",{class:"text-gray-600 max-w-2xl mx-auto"},"Explora nuestra seleccin exclusiva de alojamientos vacacionales.")],-1)),ls(j,{properties:M.featuredProperties},null,8,["properties"]),ot("div",Lz,[ls(o,{to:"/properties",class:"btn-primary inline-block px-8 py-3 rounded-full shadow hover:shadow-lg transition"},{default:jg(()=>g[7]||(g[7]=[uo(" Ver todas las propiedades ")])),_:1,__:[7]})])])]),ot("section",zz,[ot("div",Oz,[g[10]||(g[10]=ot("h2",{class:"text-2xl md:text-3xl lg:text-4xl font-bold text-gray-900 mb-8 md:mb-12 lg:mb-20 text-center text-palette-taupe"},"Quin soy?",-1)),ot("div",kz,[ot("div",Fz,[ot("img",{src:M.ProfileImage,alt:"Foto del propietario",class:"w-64 h-64 object-cover rounded-full shadow-lg"},null,8,Bz)]),g[9]||(g[9]=PS('<div class="w-full md:w-2/3"><div class="text-gray-600 italic text-sm md:text-base space-y-4"><p>Bienvenidos a <span class="notranslate">Casa del Sol</span>! Soy la orgullosa propietaria y fundadora de esta empresa de alquileres vacacionales, dedicada a crear estancias inolvidables para cada husped. Con aos de experiencia en la industria de la hospitalidad y una profunda pasin por los viajes, he diseado cada propiedad para combinar comodidad, estilo y un toque del encanto local. Ya sea que ests buscando una escapada tranquila o unas vacaciones llenas de aventuras, <span class="notranslate">Casa del Sol</span> ofrece espacios cuidadosamente diseados que se sienten como un verdadero hogar lejos de casa.</p><p>Como Superanfitrin en Airbnb, me enorgullece brindar un servicio excepcional y experiencias personalizadas. Mi objetivo es que cada husped se sienta bienvenido, atendido e inspirado a volver. Desde el momento en que reservas con <span class="notranslate">Casa del Sol</span> hasta el da de tu salida, estoy aqu para asegurarme de que tu estancia sea perfecta y memorable.</p><p>Adems de ser anfitrin, tambin ofrezco servicios de gestin de propiedades vacacionales para propietarios que desean generar ingresos sin el estrs de las operaciones diarias. Si tienes una propiedad y ests buscando un socio de confianza que se encargue de todo, desde la comunicacin con los huspedes y la limpieza hasta el marketing y el mantenimiento, me encantara ayudarte. Convirtamos tu hogar en un destino de cinco estrellas.</p></div></div>',1))])])])])}const Vz=kd(pz,[["render",Nz]]);function rE(f,g){return function(){return f.apply(g,arguments)}}const{toString:Uz}=Object.prototype,{getPrototypeOf:cv}=Object,{iterator:Zg,toStringTag:nE}=Symbol,Xg=(f=>g=>{const T=Uz.call(g);return f[T]||(f[T]=T.slice(8,-1).toLowerCase())})(Object.create(null)),Pa=f=>(f=f.toLowerCase(),g=>Xg(g)===f),Kg=f=>g=>typeof g===f,{isArray:Fd}=Array,nm=Kg("undefined");function jz(f){return f!==null&&!nm(f)&&f.constructor!==null&&!nm(f.constructor)&&fo(f.constructor.isBuffer)&&f.constructor.isBuffer(f)}const sE=Pa("ArrayBuffer");function Gz(f){let g;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?g=ArrayBuffer.isView(f):g=f&&f.buffer&&sE(f.buffer),g}const Hz=Kg("string"),fo=Kg("function"),oE=Kg("number"),Yg=f=>f!==null&&typeof f=="object",qz=f=>f===!0||f===!1,gg=f=>{if(Xg(f)!=="object")return!1;const g=cv(f);return(g===null||g===Object.prototype||Object.getPrototypeOf(g)===null)&&!(nE in f)&&!(Zg in f)},$z=Pa("Date"),Wz=Pa("File"),Zz=Pa("Blob"),Xz=Pa("FileList"),Kz=f=>Yg(f)&&fo(f.pipe),Yz=f=>{let g;return f&&(typeof FormData=="function"&&f instanceof FormData||fo(f.append)&&((g=Xg(f))==="formdata"||g==="object"&&fo(f.toString)&&f.toString()==="[object FormData]"))},Jz=Pa("URLSearchParams"),[Qz,eO,tO,iO]=["ReadableStream","Request","Response","Headers"].map(Pa),rO=f=>f.trim?f.trim():f.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function lm(f,g,{allOwnKeys:T=!1}={}){if(f===null||typeof f>"u")return;let C,M;if(typeof f!="object"&&(f=[f]),Fd(f))for(C=0,M=f.length;C<M;C++)g.call(null,f[C],C,f);else{const k=T?Object.getOwnPropertyNames(f):Object.keys(f),j=k.length;let o;for(C=0;C<j;C++)o=k[C],g.call(null,f[o],o,f)}}function aE(f,g){g=g.toLowerCase();const T=Object.keys(f);let C=T.length,M;for(;C-- >0;)if(M=T[C],g===M.toLowerCase())return M;return null}const Ru=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,lE=f=>!nm(f)&&f!==Ru;function k0(){const{caseless:f}=lE(this)&&this||{},g={},T=(C,M)=>{const k=f&&aE(g,M)||M;gg(g[k])&&gg(C)?g[k]=k0(g[k],C):gg(C)?g[k]=k0({},C):Fd(C)?g[k]=C.slice():g[k]=C};for(let C=0,M=arguments.length;C<M;C++)arguments[C]&&lm(arguments[C],T);return g}const nO=(f,g,T,{allOwnKeys:C}={})=>(lm(g,(M,k)=>{T&&fo(M)?f[k]=rE(M,T):f[k]=M},{allOwnKeys:C}),f),sO=f=>(f.charCodeAt(0)===65279&&(f=f.slice(1)),f),oO=(f,g,T,C)=>{f.prototype=Object.create(g.prototype,C),f.prototype.constructor=f,Object.defineProperty(f,"super",{value:g.prototype}),T&&Object.assign(f.prototype,T)},aO=(f,g,T,C)=>{let M,k,j;const o={};if(g=g||{},f==null)return g;do{for(M=Object.getOwnPropertyNames(f),k=M.length;k-- >0;)j=M[k],(!C||C(j,f,g))&&!o[j]&&(g[j]=f[j],o[j]=!0);f=T!==!1&&cv(f)}while(f&&(!T||T(f,g))&&f!==Object.prototype);return g},lO=(f,g,T)=>{f=String(f),(T===void 0||T>f.length)&&(T=f.length),T-=g.length;const C=f.indexOf(g,T);return C!==-1&&C===T},cO=f=>{if(!f)return null;if(Fd(f))return f;let g=f.length;if(!oE(g))return null;const T=new Array(g);for(;g-- >0;)T[g]=f[g];return T},uO=(f=>g=>f&&g instanceof f)(typeof Uint8Array<"u"&&cv(Uint8Array)),hO=(f,g)=>{const C=(f&&f[Zg]).call(f);let M;for(;(M=C.next())&&!M.done;){const k=M.value;g.call(f,k[0],k[1])}},dO=(f,g)=>{let T;const C=[];for(;(T=f.exec(g))!==null;)C.push(T);return C},fO=Pa("HTMLFormElement"),pO=f=>f.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(T,C,M){return C.toUpperCase()+M}),d2=(({hasOwnProperty:f})=>(g,T)=>f.call(g,T))(Object.prototype),mO=Pa("RegExp"),cE=(f,g)=>{const T=Object.getOwnPropertyDescriptors(f),C={};lm(T,(M,k)=>{let j;(j=g(M,k,f))!==!1&&(C[k]=j||M)}),Object.defineProperties(f,C)},_O=f=>{cE(f,(g,T)=>{if(fo(f)&&["arguments","caller","callee"].indexOf(T)!==-1)return!1;const C=f[T];if(fo(C)){if(g.enumerable=!1,"writable"in g){g.writable=!1;return}g.set||(g.set=()=>{throw Error("Can not rewrite read-only method '"+T+"'")})}})},gO=(f,g)=>{const T={},C=M=>{M.forEach(k=>{T[k]=!0})};return Fd(f)?C(f):C(String(f).split(g)),T},yO=()=>{},xO=(f,g)=>f!=null&&Number.isFinite(f=+f)?f:g;function vO(f){return!!(f&&fo(f.append)&&f[nE]==="FormData"&&f[Zg])}const bO=f=>{const g=new Array(10),T=(C,M)=>{if(Yg(C)){if(g.indexOf(C)>=0)return;if(!("toJSON"in C)){g[M]=C;const k=Fd(C)?[]:{};return lm(C,(j,o)=>{const Q=T(j,M+1);!nm(Q)&&(k[o]=Q)}),g[M]=void 0,k}}return C};return T(f,0)},wO=Pa("AsyncFunction"),TO=f=>f&&(Yg(f)||fo(f))&&fo(f.then)&&fo(f.catch),uE=((f,g)=>f?setImmediate:g?((T,C)=>(Ru.addEventListener("message",({source:M,data:k})=>{M===Ru&&k===T&&C.length&&C.shift()()},!1),M=>{C.push(M),Ru.postMessage(T,"*")}))(`axios@${Math.random()}`,[]):T=>setTimeout(T))(typeof setImmediate=="function",fo(Ru.postMessage)),SO=typeof queueMicrotask<"u"?queueMicrotask.bind(Ru):typeof process<"u"&&process.nextTick||uE,EO=f=>f!=null&&fo(f[Zg]),yt={isArray:Fd,isArrayBuffer:sE,isBuffer:jz,isFormData:Yz,isArrayBufferView:Gz,isString:Hz,isNumber:oE,isBoolean:qz,isObject:Yg,isPlainObject:gg,isReadableStream:Qz,isRequest:eO,isResponse:tO,isHeaders:iO,isUndefined:nm,isDate:$z,isFile:Wz,isBlob:Zz,isRegExp:mO,isFunction:fo,isStream:Kz,isURLSearchParams:Jz,isTypedArray:uO,isFileList:Xz,forEach:lm,merge:k0,extend:nO,trim:rO,stripBOM:sO,inherits:oO,toFlatObject:aO,kindOf:Xg,kindOfTest:Pa,endsWith:lO,toArray:cO,forEachEntry:hO,matchAll:dO,isHTMLForm:fO,hasOwnProperty:d2,hasOwnProp:d2,reduceDescriptors:cE,freezeMethods:_O,toObjectSet:gO,toCamelCase:pO,noop:yO,toFiniteNumber:xO,findKey:aE,global:Ru,isContextDefined:lE,isSpecCompliantForm:vO,toJSONObject:bO,isAsyncFn:wO,isThenable:TO,setImmediate:uE,asap:SO,isIterable:EO};function Ir(f,g,T,C,M){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=f,this.name="AxiosError",g&&(this.code=g),T&&(this.config=T),C&&(this.request=C),M&&(this.response=M,this.status=M.status?M.status:null)}yt.inherits(Ir,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:yt.toJSONObject(this.config),code:this.code,status:this.status}}});const hE=Ir.prototype,dE={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(f=>{dE[f]={value:f}});Object.defineProperties(Ir,dE);Object.defineProperty(hE,"isAxiosError",{value:!0});Ir.from=(f,g,T,C,M,k)=>{const j=Object.create(hE);return yt.toFlatObject(f,j,function(Q){return Q!==Error.prototype},o=>o!=="isAxiosError"),Ir.call(j,f.message,g,T,C,M),j.cause=f,j.name=f.name,k&&Object.assign(j,k),j};const AO=null;function F0(f){return yt.isPlainObject(f)||yt.isArray(f)}function fE(f){return yt.endsWith(f,"[]")?f.slice(0,-2):f}function f2(f,g,T){return f?f.concat(g).map(function(M,k){return M=fE(M),!T&&k?"["+M+"]":M}).join(T?".":""):g}function IO(f){return yt.isArray(f)&&!f.some(F0)}const CO=yt.toFlatObject(yt,{},null,function(g){return/^is[A-Z]/.test(g)});function Jg(f,g,T){if(!yt.isObject(f))throw new TypeError("target must be an object");g=g||new FormData,T=yt.toFlatObject(T,{metaTokens:!0,dots:!1,indexes:!1},!1,function(rt,mt){return!yt.isUndefined(mt[rt])});const C=T.metaTokens,M=T.visitor||he,k=T.dots,j=T.indexes,Q=(T.Blob||typeof Blob<"u"&&Blob)&&yt.isSpecCompliantForm(g);if(!yt.isFunction(M))throw new TypeError("visitor must be a function");function pe(ft){if(ft===null)return"";if(yt.isDate(ft))return ft.toISOString();if(yt.isBoolean(ft))return ft.toString();if(!Q&&yt.isBlob(ft))throw new Ir("Blob is not supported. Use a Buffer instead.");return yt.isArrayBuffer(ft)||yt.isTypedArray(ft)?Q&&typeof Blob=="function"?new Blob([ft]):Buffer.from(ft):ft}function he(ft,rt,mt){let Wt=ft;if(ft&&!mt&&typeof ft=="object"){if(yt.endsWith(rt,"{}"))rt=C?rt:rt.slice(0,-2),ft=JSON.stringify(ft);else if(yt.isArray(ft)&&IO(ft)||(yt.isFileList(ft)||yt.endsWith(rt,"[]"))&&(Wt=yt.toArray(ft)))return rt=fE(rt),Wt.forEach(function(Xt,Zt){!(yt.isUndefined(Xt)||Xt===null)&&g.append(j===!0?f2([rt],Zt,k):j===null?rt:rt+"[]",pe(Xt))}),!1}return F0(ft)?!0:(g.append(f2(mt,rt,k),pe(ft)),!1)}const ye=[],Oe=Object.assign(CO,{defaultVisitor:he,convertValue:pe,isVisitable:F0});function je(ft,rt){if(!yt.isUndefined(ft)){if(ye.indexOf(ft)!==-1)throw Error("Circular reference detected in "+rt.join("."));ye.push(ft),yt.forEach(ft,function(Wt,wt){(!(yt.isUndefined(Wt)||Wt===null)&&M.call(g,Wt,yt.isString(wt)?wt.trim():wt,rt,Oe))===!0&&je(Wt,rt?rt.concat(wt):[wt])}),ye.pop()}}if(!yt.isObject(f))throw new TypeError("data must be an object");return je(f),g}function p2(f){const g={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(f).replace(/[!'()~]|%20|%00/g,function(C){return g[C]})}function uv(f,g){this._pairs=[],f&&Jg(f,this,g)}const pE=uv.prototype;pE.append=function(g,T){this._pairs.push([g,T])};pE.toString=function(g){const T=g?function(C){return g.call(this,C,p2)}:p2;return this._pairs.map(function(M){return T(M[0])+"="+T(M[1])},"").join("&")};function PO(f){return encodeURIComponent(f).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function mE(f,g,T){if(!g)return f;const C=T&&T.encode||PO;yt.isFunction(T)&&(T={serialize:T});const M=T&&T.serialize;let k;if(M?k=M(g,T):k=yt.isURLSearchParams(g)?g.toString():new uv(g,T).toString(C),k){const j=f.indexOf("#");j!==-1&&(f=f.slice(0,j)),f+=(f.indexOf("?")===-1?"?":"&")+k}return f}class m2{constructor(){this.handlers=[]}use(g,T,C){return this.handlers.push({fulfilled:g,rejected:T,synchronous:C?C.synchronous:!1,runWhen:C?C.runWhen:null}),this.handlers.length-1}eject(g){this.handlers[g]&&(this.handlers[g]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(g){yt.forEach(this.handlers,function(C){C!==null&&g(C)})}}const _E={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},MO=typeof URLSearchParams<"u"?URLSearchParams:uv,RO=typeof FormData<"u"?FormData:null,DO=typeof Blob<"u"?Blob:null,LO={isBrowser:!0,classes:{URLSearchParams:MO,FormData:RO,Blob:DO},protocols:["http","https","file","blob","url","data"]},hv=typeof window<"u"&&typeof document<"u",B0=typeof navigator=="object"&&navigator||void 0,zO=hv&&(!B0||["ReactNative","NativeScript","NS"].indexOf(B0.product)<0),OO=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",kO=hv&&window.location.href||"http://localhost",FO=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:hv,hasStandardBrowserEnv:zO,hasStandardBrowserWebWorkerEnv:OO,navigator:B0,origin:kO},Symbol.toStringTag,{value:"Module"})),ks={...FO,...LO};function BO(f,g){return Jg(f,new ks.classes.URLSearchParams,Object.assign({visitor:function(T,C,M,k){return ks.isNode&&yt.isBuffer(T)?(this.append(C,T.toString("base64")),!1):k.defaultVisitor.apply(this,arguments)}},g))}function NO(f){return yt.matchAll(/\w+|\[(\w*)]/g,f).map(g=>g[0]==="[]"?"":g[1]||g[0])}function VO(f){const g={},T=Object.keys(f);let C;const M=T.length;let k;for(C=0;C<M;C++)k=T[C],g[k]=f[k];return g}function gE(f){function g(T,C,M,k){let j=T[k++];if(j==="__proto__")return!0;const o=Number.isFinite(+j),Q=k>=T.length;return j=!j&&yt.isArray(M)?M.length:j,Q?(yt.hasOwnProp(M,j)?M[j]=[M[j],C]:M[j]=C,!o):((!M[j]||!yt.isObject(M[j]))&&(M[j]=[]),g(T,C,M[j],k)&&yt.isArray(M[j])&&(M[j]=VO(M[j])),!o)}if(yt.isFormData(f)&&yt.isFunction(f.entries)){const T={};return yt.forEachEntry(f,(C,M)=>{g(NO(C),M,T,0)}),T}return null}function UO(f,g,T){if(yt.isString(f))try{return(g||JSON.parse)(f),yt.trim(f)}catch(C){if(C.name!=="SyntaxError")throw C}return(T||JSON.stringify)(f)}const cm={transitional:_E,adapter:["xhr","http","fetch"],transformRequest:[function(g,T){const C=T.getContentType()||"",M=C.indexOf("application/json")>-1,k=yt.isObject(g);if(k&&yt.isHTMLForm(g)&&(g=new FormData(g)),yt.isFormData(g))return M?JSON.stringify(gE(g)):g;if(yt.isArrayBuffer(g)||yt.isBuffer(g)||yt.isStream(g)||yt.isFile(g)||yt.isBlob(g)||yt.isReadableStream(g))return g;if(yt.isArrayBufferView(g))return g.buffer;if(yt.isURLSearchParams(g))return T.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),g.toString();let o;if(k){if(C.indexOf("application/x-www-form-urlencoded")>-1)return BO(g,this.formSerializer).toString();if((o=yt.isFileList(g))||C.indexOf("multipart/form-data")>-1){const Q=this.env&&this.env.FormData;return Jg(o?{"files[]":g}:g,Q&&new Q,this.formSerializer)}}return k||M?(T.setContentType("application/json",!1),UO(g)):g}],transformResponse:[function(g){const T=this.transitional||cm.transitional,C=T&&T.forcedJSONParsing,M=this.responseType==="json";if(yt.isResponse(g)||yt.isReadableStream(g))return g;if(g&&yt.isString(g)&&(C&&!this.responseType||M)){const j=!(T&&T.silentJSONParsing)&&M;try{return JSON.parse(g)}catch(o){if(j)throw o.name==="SyntaxError"?Ir.from(o,Ir.ERR_BAD_RESPONSE,this,null,this.response):o}}return g}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ks.classes.FormData,Blob:ks.classes.Blob},validateStatus:function(g){return g>=200&&g<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};yt.forEach(["delete","get","head","post","put","patch"],f=>{cm.headers[f]={}});const jO=yt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),GO=f=>{const g={};let T,C,M;return f&&f.split(`
`).forEach(function(j){M=j.indexOf(":"),T=j.substring(0,M).trim().toLowerCase(),C=j.substring(M+1).trim(),!(!T||g[T]&&jO[T])&&(T==="set-cookie"?g[T]?g[T].push(C):g[T]=[C]:g[T]=g[T]?g[T]+", "+C:C)}),g},_2=Symbol("internals");function Np(f){return f&&String(f).trim().toLowerCase()}function yg(f){return f===!1||f==null?f:yt.isArray(f)?f.map(yg):String(f)}function HO(f){const g=Object.create(null),T=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let C;for(;C=T.exec(f);)g[C[1]]=C[2];return g}const qO=f=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(f.trim());function p0(f,g,T,C,M){if(yt.isFunction(C))return C.call(this,g,T);if(M&&(g=T),!!yt.isString(g)){if(yt.isString(C))return g.indexOf(C)!==-1;if(yt.isRegExp(C))return C.test(g)}}function $O(f){return f.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(g,T,C)=>T.toUpperCase()+C)}function WO(f,g){const T=yt.toCamelCase(" "+g);["get","set","has"].forEach(C=>{Object.defineProperty(f,C+T,{value:function(M,k,j){return this[C].call(this,g,M,k,j)},configurable:!0})})}let po=class{constructor(g){g&&this.set(g)}set(g,T,C){const M=this;function k(o,Q,pe){const he=Np(Q);if(!he)throw new Error("header name must be a non-empty string");const ye=yt.findKey(M,he);(!ye||M[ye]===void 0||pe===!0||pe===void 0&&M[ye]!==!1)&&(M[ye||Q]=yg(o))}const j=(o,Q)=>yt.forEach(o,(pe,he)=>k(pe,he,Q));if(yt.isPlainObject(g)||g instanceof this.constructor)j(g,T);else if(yt.isString(g)&&(g=g.trim())&&!qO(g))j(GO(g),T);else if(yt.isObject(g)&&yt.isIterable(g)){let o={},Q,pe;for(const he of g){if(!yt.isArray(he))throw TypeError("Object iterator must return a key-value pair");o[pe=he[0]]=(Q=o[pe])?yt.isArray(Q)?[...Q,he[1]]:[Q,he[1]]:he[1]}j(o,T)}else g!=null&&k(T,g,C);return this}get(g,T){if(g=Np(g),g){const C=yt.findKey(this,g);if(C){const M=this[C];if(!T)return M;if(T===!0)return HO(M);if(yt.isFunction(T))return T.call(this,M,C);if(yt.isRegExp(T))return T.exec(M);throw new TypeError("parser must be boolean|regexp|function")}}}has(g,T){if(g=Np(g),g){const C=yt.findKey(this,g);return!!(C&&this[C]!==void 0&&(!T||p0(this,this[C],C,T)))}return!1}delete(g,T){const C=this;let M=!1;function k(j){if(j=Np(j),j){const o=yt.findKey(C,j);o&&(!T||p0(C,C[o],o,T))&&(delete C[o],M=!0)}}return yt.isArray(g)?g.forEach(k):k(g),M}clear(g){const T=Object.keys(this);let C=T.length,M=!1;for(;C--;){const k=T[C];(!g||p0(this,this[k],k,g,!0))&&(delete this[k],M=!0)}return M}normalize(g){const T=this,C={};return yt.forEach(this,(M,k)=>{const j=yt.findKey(C,k);if(j){T[j]=yg(M),delete T[k];return}const o=g?$O(k):String(k).trim();o!==k&&delete T[k],T[o]=yg(M),C[o]=!0}),this}concat(...g){return this.constructor.concat(this,...g)}toJSON(g){const T=Object.create(null);return yt.forEach(this,(C,M)=>{C!=null&&C!==!1&&(T[M]=g&&yt.isArray(C)?C.join(", "):C)}),T}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([g,T])=>g+": "+T).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(g){return g instanceof this?g:new this(g)}static concat(g,...T){const C=new this(g);return T.forEach(M=>C.set(M)),C}static accessor(g){const C=(this[_2]=this[_2]={accessors:{}}).accessors,M=this.prototype;function k(j){const o=Np(j);C[o]||(WO(M,j),C[o]=!0)}return yt.isArray(g)?g.forEach(k):k(g),this}};po.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);yt.reduceDescriptors(po.prototype,({value:f},g)=>{let T=g[0].toUpperCase()+g.slice(1);return{get:()=>f,set(C){this[T]=C}}});yt.freezeMethods(po);function m0(f,g){const T=this||cm,C=g||T,M=po.from(C.headers);let k=C.data;return yt.forEach(f,function(o){k=o.call(T,k,M.normalize(),g?g.status:void 0)}),M.normalize(),k}function yE(f){return!!(f&&f.__CANCEL__)}function Bd(f,g,T){Ir.call(this,f??"canceled",Ir.ERR_CANCELED,g,T),this.name="CanceledError"}yt.inherits(Bd,Ir,{__CANCEL__:!0});function xE(f,g,T){const C=T.config.validateStatus;!T.status||!C||C(T.status)?f(T):g(new Ir("Request failed with status code "+T.status,[Ir.ERR_BAD_REQUEST,Ir.ERR_BAD_RESPONSE][Math.floor(T.status/100)-4],T.config,T.request,T))}function ZO(f){const g=/^([-+\w]{1,25})(:?\/\/|:)/.exec(f);return g&&g[1]||""}function XO(f,g){f=f||10;const T=new Array(f),C=new Array(f);let M=0,k=0,j;return g=g!==void 0?g:1e3,function(Q){const pe=Date.now(),he=C[k];j||(j=pe),T[M]=Q,C[M]=pe;let ye=k,Oe=0;for(;ye!==M;)Oe+=T[ye++],ye=ye%f;if(M=(M+1)%f,M===k&&(k=(k+1)%f),pe-j<g)return;const je=he&&pe-he;return je?Math.round(Oe*1e3/je):void 0}}function KO(f,g){let T=0,C=1e3/g,M,k;const j=(pe,he=Date.now())=>{T=he,M=null,k&&(clearTimeout(k),k=null),f.apply(null,pe)};return[(...pe)=>{const he=Date.now(),ye=he-T;ye>=C?j(pe,he):(M=pe,k||(k=setTimeout(()=>{k=null,j(M)},C-ye)))},()=>M&&j(M)]}const Rg=(f,g,T=3)=>{let C=0;const M=XO(50,250);return KO(k=>{const j=k.loaded,o=k.lengthComputable?k.total:void 0,Q=j-C,pe=M(Q),he=j<=o;C=j;const ye={loaded:j,total:o,progress:o?j/o:void 0,bytes:Q,rate:pe||void 0,estimated:pe&&o&&he?(o-j)/pe:void 0,event:k,lengthComputable:o!=null,[g?"download":"upload"]:!0};f(ye)},T)},g2=(f,g)=>{const T=f!=null;return[C=>g[0]({lengthComputable:T,total:f,loaded:C}),g[1]]},y2=f=>(...g)=>yt.asap(()=>f(...g)),YO=ks.hasStandardBrowserEnv?((f,g)=>T=>(T=new URL(T,ks.origin),f.protocol===T.protocol&&f.host===T.host&&(g||f.port===T.port)))(new URL(ks.origin),ks.navigator&&/(msie|trident)/i.test(ks.navigator.userAgent)):()=>!0,JO=ks.hasStandardBrowserEnv?{write(f,g,T,C,M,k){const j=[f+"="+encodeURIComponent(g)];yt.isNumber(T)&&j.push("expires="+new Date(T).toGMTString()),yt.isString(C)&&j.push("path="+C),yt.isString(M)&&j.push("domain="+M),k===!0&&j.push("secure"),document.cookie=j.join("; ")},read(f){const g=document.cookie.match(new RegExp("(^|;\\s*)("+f+")=([^;]*)"));return g?decodeURIComponent(g[3]):null},remove(f){this.write(f,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function QO(f){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(f)}function ek(f,g){return g?f.replace(/\/?\/$/,"")+"/"+g.replace(/^\/+/,""):f}function vE(f,g,T){let C=!QO(g);return f&&(C||T==!1)?ek(f,g):g}const x2=f=>f instanceof po?{...f}:f;function zu(f,g){g=g||{};const T={};function C(pe,he,ye,Oe){return yt.isPlainObject(pe)&&yt.isPlainObject(he)?yt.merge.call({caseless:Oe},pe,he):yt.isPlainObject(he)?yt.merge({},he):yt.isArray(he)?he.slice():he}function M(pe,he,ye,Oe){if(yt.isUndefined(he)){if(!yt.isUndefined(pe))return C(void 0,pe,ye,Oe)}else return C(pe,he,ye,Oe)}function k(pe,he){if(!yt.isUndefined(he))return C(void 0,he)}function j(pe,he){if(yt.isUndefined(he)){if(!yt.isUndefined(pe))return C(void 0,pe)}else return C(void 0,he)}function o(pe,he,ye){if(ye in g)return C(pe,he);if(ye in f)return C(void 0,pe)}const Q={url:k,method:k,data:k,baseURL:j,transformRequest:j,transformResponse:j,paramsSerializer:j,timeout:j,timeoutMessage:j,withCredentials:j,withXSRFToken:j,adapter:j,responseType:j,xsrfCookieName:j,xsrfHeaderName:j,onUploadProgress:j,onDownloadProgress:j,decompress:j,maxContentLength:j,maxBodyLength:j,beforeRedirect:j,transport:j,httpAgent:j,httpsAgent:j,cancelToken:j,socketPath:j,responseEncoding:j,validateStatus:o,headers:(pe,he,ye)=>M(x2(pe),x2(he),ye,!0)};return yt.forEach(Object.keys(Object.assign({},f,g)),function(he){const ye=Q[he]||M,Oe=ye(f[he],g[he],he);yt.isUndefined(Oe)&&ye!==o||(T[he]=Oe)}),T}const bE=f=>{const g=zu({},f);let{data:T,withXSRFToken:C,xsrfHeaderName:M,xsrfCookieName:k,headers:j,auth:o}=g;g.headers=j=po.from(j),g.url=mE(vE(g.baseURL,g.url,g.allowAbsoluteUrls),f.params,f.paramsSerializer),o&&j.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let Q;if(yt.isFormData(T)){if(ks.hasStandardBrowserEnv||ks.hasStandardBrowserWebWorkerEnv)j.setContentType(void 0);else if((Q=j.getContentType())!==!1){const[pe,...he]=Q?Q.split(";").map(ye=>ye.trim()).filter(Boolean):[];j.setContentType([pe||"multipart/form-data",...he].join("; "))}}if(ks.hasStandardBrowserEnv&&(C&&yt.isFunction(C)&&(C=C(g)),C||C!==!1&&YO(g.url))){const pe=M&&k&&JO.read(k);pe&&j.set(M,pe)}return g},tk=typeof XMLHttpRequest<"u",ik=tk&&function(f){return new Promise(function(T,C){const M=bE(f);let k=M.data;const j=po.from(M.headers).normalize();let{responseType:o,onUploadProgress:Q,onDownloadProgress:pe}=M,he,ye,Oe,je,ft;function rt(){je&&je(),ft&&ft(),M.cancelToken&&M.cancelToken.unsubscribe(he),M.signal&&M.signal.removeEventListener("abort",he)}let mt=new XMLHttpRequest;mt.open(M.method.toUpperCase(),M.url,!0),mt.timeout=M.timeout;function Wt(){if(!mt)return;const Xt=po.from("getAllResponseHeaders"in mt&&mt.getAllResponseHeaders()),Li={data:!o||o==="text"||o==="json"?mt.responseText:mt.response,status:mt.status,statusText:mt.statusText,headers:Xt,config:f,request:mt};xE(function(mr){T(mr),rt()},function(mr){C(mr),rt()},Li),mt=null}"onloadend"in mt?mt.onloadend=Wt:mt.onreadystatechange=function(){!mt||mt.readyState!==4||mt.status===0&&!(mt.responseURL&&mt.responseURL.indexOf("file:")===0)||setTimeout(Wt)},mt.onabort=function(){mt&&(C(new Ir("Request aborted",Ir.ECONNABORTED,f,mt)),mt=null)},mt.onerror=function(){C(new Ir("Network Error",Ir.ERR_NETWORK,f,mt)),mt=null},mt.ontimeout=function(){let Zt=M.timeout?"timeout of "+M.timeout+"ms exceeded":"timeout exceeded";const Li=M.transitional||_E;M.timeoutErrorMessage&&(Zt=M.timeoutErrorMessage),C(new Ir(Zt,Li.clarifyTimeoutError?Ir.ETIMEDOUT:Ir.ECONNABORTED,f,mt)),mt=null},k===void 0&&j.setContentType(null),"setRequestHeader"in mt&&yt.forEach(j.toJSON(),function(Zt,Li){mt.setRequestHeader(Li,Zt)}),yt.isUndefined(M.withCredentials)||(mt.withCredentials=!!M.withCredentials),o&&o!=="json"&&(mt.responseType=M.responseType),pe&&([Oe,ft]=Rg(pe,!0),mt.addEventListener("progress",Oe)),Q&&mt.upload&&([ye,je]=Rg(Q),mt.upload.addEventListener("progress",ye),mt.upload.addEventListener("loadend",je)),(M.cancelToken||M.signal)&&(he=Xt=>{mt&&(C(!Xt||Xt.type?new Bd(null,f,mt):Xt),mt.abort(),mt=null)},M.cancelToken&&M.cancelToken.subscribe(he),M.signal&&(M.signal.aborted?he():M.signal.addEventListener("abort",he)));const wt=ZO(M.url);if(wt&&ks.protocols.indexOf(wt)===-1){C(new Ir("Unsupported protocol "+wt+":",Ir.ERR_BAD_REQUEST,f));return}mt.send(k||null)})},rk=(f,g)=>{const{length:T}=f=f?f.filter(Boolean):[];if(g||T){let C=new AbortController,M;const k=function(pe){if(!M){M=!0,o();const he=pe instanceof Error?pe:this.reason;C.abort(he instanceof Ir?he:new Bd(he instanceof Error?he.message:he))}};let j=g&&setTimeout(()=>{j=null,k(new Ir(`timeout ${g} of ms exceeded`,Ir.ETIMEDOUT))},g);const o=()=>{f&&(j&&clearTimeout(j),j=null,f.forEach(pe=>{pe.unsubscribe?pe.unsubscribe(k):pe.removeEventListener("abort",k)}),f=null)};f.forEach(pe=>pe.addEventListener("abort",k));const{signal:Q}=C;return Q.unsubscribe=()=>yt.asap(o),Q}},nk=function*(f,g){let T=f.byteLength;if(T<g){yield f;return}let C=0,M;for(;C<T;)M=C+g,yield f.slice(C,M),C=M},sk=async function*(f,g){for await(const T of ok(f))yield*nk(T,g)},ok=async function*(f){if(f[Symbol.asyncIterator]){yield*f;return}const g=f.getReader();try{for(;;){const{done:T,value:C}=await g.read();if(T)break;yield C}}finally{await g.cancel()}},v2=(f,g,T,C)=>{const M=sk(f,g);let k=0,j,o=Q=>{j||(j=!0,C&&C(Q))};return new ReadableStream({async pull(Q){try{const{done:pe,value:he}=await M.next();if(pe){o(),Q.close();return}let ye=he.byteLength;if(T){let Oe=k+=ye;T(Oe)}Q.enqueue(new Uint8Array(he))}catch(pe){throw o(pe),pe}},cancel(Q){return o(Q),M.return()}},{highWaterMark:2})},Qg=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",wE=Qg&&typeof ReadableStream=="function",ak=Qg&&(typeof TextEncoder=="function"?(f=>g=>f.encode(g))(new TextEncoder):async f=>new Uint8Array(await new Response(f).arrayBuffer())),TE=(f,...g)=>{try{return!!f(...g)}catch{return!1}},lk=wE&&TE(()=>{let f=!1;const g=new Request(ks.origin,{body:new ReadableStream,method:"POST",get duplex(){return f=!0,"half"}}).headers.has("Content-Type");return f&&!g}),b2=64*1024,N0=wE&&TE(()=>yt.isReadableStream(new Response("").body)),Dg={stream:N0&&(f=>f.body)};Qg&&(f=>{["text","arrayBuffer","blob","formData","stream"].forEach(g=>{!Dg[g]&&(Dg[g]=yt.isFunction(f[g])?T=>T[g]():(T,C)=>{throw new Ir(`Response type '${g}' is not supported`,Ir.ERR_NOT_SUPPORT,C)})})})(new Response);const ck=async f=>{if(f==null)return 0;if(yt.isBlob(f))return f.size;if(yt.isSpecCompliantForm(f))return(await new Request(ks.origin,{method:"POST",body:f}).arrayBuffer()).byteLength;if(yt.isArrayBufferView(f)||yt.isArrayBuffer(f))return f.byteLength;if(yt.isURLSearchParams(f)&&(f=f+""),yt.isString(f))return(await ak(f)).byteLength},uk=async(f,g)=>{const T=yt.toFiniteNumber(f.getContentLength());return T??ck(g)},hk=Qg&&(async f=>{let{url:g,method:T,data:C,signal:M,cancelToken:k,timeout:j,onDownloadProgress:o,onUploadProgress:Q,responseType:pe,headers:he,withCredentials:ye="same-origin",fetchOptions:Oe}=bE(f);pe=pe?(pe+"").toLowerCase():"text";let je=rk([M,k&&k.toAbortSignal()],j),ft;const rt=je&&je.unsubscribe&&(()=>{je.unsubscribe()});let mt;try{if(Q&&lk&&T!=="get"&&T!=="head"&&(mt=await uk(he,C))!==0){let Li=new Request(g,{method:"POST",body:C,duplex:"half"}),Sr;if(yt.isFormData(C)&&(Sr=Li.headers.get("content-type"))&&he.setContentType(Sr),Li.body){const[mr,vn]=g2(mt,Rg(y2(Q)));C=v2(Li.body,b2,mr,vn)}}yt.isString(ye)||(ye=ye?"include":"omit");const Wt="credentials"in Request.prototype;ft=new Request(g,{...Oe,signal:je,method:T.toUpperCase(),headers:he.normalize().toJSON(),body:C,duplex:"half",credentials:Wt?ye:void 0});let wt=await fetch(ft,Oe);const Xt=N0&&(pe==="stream"||pe==="response");if(N0&&(o||Xt&&rt)){const Li={};["status","statusText","headers"].forEach(Zn=>{Li[Zn]=wt[Zn]});const Sr=yt.toFiniteNumber(wt.headers.get("content-length")),[mr,vn]=o&&g2(Sr,Rg(y2(o),!0))||[];wt=new Response(v2(wt.body,b2,mr,()=>{vn&&vn(),rt&&rt()}),Li)}pe=pe||"text";let Zt=await Dg[yt.findKey(Dg,pe)||"text"](wt,f);return!Xt&&rt&&rt(),await new Promise((Li,Sr)=>{xE(Li,Sr,{data:Zt,headers:po.from(wt.headers),status:wt.status,statusText:wt.statusText,config:f,request:ft})})}catch(Wt){throw rt&&rt(),Wt&&Wt.name==="TypeError"&&/Load failed|fetch/i.test(Wt.message)?Object.assign(new Ir("Network Error",Ir.ERR_NETWORK,f,ft),{cause:Wt.cause||Wt}):Ir.from(Wt,Wt&&Wt.code,f,ft)}}),V0={http:AO,xhr:ik,fetch:hk};yt.forEach(V0,(f,g)=>{if(f){try{Object.defineProperty(f,"name",{value:g})}catch{}Object.defineProperty(f,"adapterName",{value:g})}});const w2=f=>`- ${f}`,dk=f=>yt.isFunction(f)||f===null||f===!1,SE={getAdapter:f=>{f=yt.isArray(f)?f:[f];const{length:g}=f;let T,C;const M={};for(let k=0;k<g;k++){T=f[k];let j;if(C=T,!dk(T)&&(C=V0[(j=String(T)).toLowerCase()],C===void 0))throw new Ir(`Unknown adapter '${j}'`);if(C)break;M[j||"#"+k]=C}if(!C){const k=Object.entries(M).map(([o,Q])=>`adapter ${o} `+(Q===!1?"is not supported by the environment":"is not available in the build"));let j=g?k.length>1?`since :
`+k.map(w2).join(`
`):" "+w2(k[0]):"as no adapter specified";throw new Ir("There is no suitable adapter to dispatch the request "+j,"ERR_NOT_SUPPORT")}return C},adapters:V0};function _0(f){if(f.cancelToken&&f.cancelToken.throwIfRequested(),f.signal&&f.signal.aborted)throw new Bd(null,f)}function T2(f){return _0(f),f.headers=po.from(f.headers),f.data=m0.call(f,f.transformRequest),["post","put","patch"].indexOf(f.method)!==-1&&f.headers.setContentType("application/x-www-form-urlencoded",!1),SE.getAdapter(f.adapter||cm.adapter)(f).then(function(C){return _0(f),C.data=m0.call(f,f.transformResponse,C),C.headers=po.from(C.headers),C},function(C){return yE(C)||(_0(f),C&&C.response&&(C.response.data=m0.call(f,f.transformResponse,C.response),C.response.headers=po.from(C.response.headers))),Promise.reject(C)})}const EE="1.10.0",ey={};["object","boolean","number","function","string","symbol"].forEach((f,g)=>{ey[f]=function(C){return typeof C===f||"a"+(g<1?"n ":" ")+f}});const S2={};ey.transitional=function(g,T,C){function M(k,j){return"[Axios v"+EE+"] Transitional option '"+k+"'"+j+(C?". "+C:"")}return(k,j,o)=>{if(g===!1)throw new Ir(M(j," has been removed"+(T?" in "+T:"")),Ir.ERR_DEPRECATED);return T&&!S2[j]&&(S2[j]=!0,console.warn(M(j," has been deprecated since v"+T+" and will be removed in the near future"))),g?g(k,j,o):!0}};ey.spelling=function(g){return(T,C)=>(console.warn(`${C} is likely a misspelling of ${g}`),!0)};function fk(f,g,T){if(typeof f!="object")throw new Ir("options must be an object",Ir.ERR_BAD_OPTION_VALUE);const C=Object.keys(f);let M=C.length;for(;M-- >0;){const k=C[M],j=g[k];if(j){const o=f[k],Q=o===void 0||j(o,k,f);if(Q!==!0)throw new Ir("option "+k+" must be "+Q,Ir.ERR_BAD_OPTION_VALUE);continue}if(T!==!0)throw new Ir("Unknown option "+k,Ir.ERR_BAD_OPTION)}}const xg={assertOptions:fk,validators:ey},Qa=xg.validators;let Lu=class{constructor(g){this.defaults=g||{},this.interceptors={request:new m2,response:new m2}}async request(g,T){try{return await this._request(g,T)}catch(C){if(C instanceof Error){let M={};Error.captureStackTrace?Error.captureStackTrace(M):M=new Error;const k=M.stack?M.stack.replace(/^.+\n/,""):"";try{C.stack?k&&!String(C.stack).endsWith(k.replace(/^.+\n.+\n/,""))&&(C.stack+=`
`+k):C.stack=k}catch{}}throw C}}_request(g,T){typeof g=="string"?(T=T||{},T.url=g):T=g||{},T=zu(this.defaults,T);const{transitional:C,paramsSerializer:M,headers:k}=T;C!==void 0&&xg.assertOptions(C,{silentJSONParsing:Qa.transitional(Qa.boolean),forcedJSONParsing:Qa.transitional(Qa.boolean),clarifyTimeoutError:Qa.transitional(Qa.boolean)},!1),M!=null&&(yt.isFunction(M)?T.paramsSerializer={serialize:M}:xg.assertOptions(M,{encode:Qa.function,serialize:Qa.function},!0)),T.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?T.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:T.allowAbsoluteUrls=!0),xg.assertOptions(T,{baseUrl:Qa.spelling("baseURL"),withXsrfToken:Qa.spelling("withXSRFToken")},!0),T.method=(T.method||this.defaults.method||"get").toLowerCase();let j=k&&yt.merge(k.common,k[T.method]);k&&yt.forEach(["delete","get","head","post","put","patch","common"],ft=>{delete k[ft]}),T.headers=po.concat(j,k);const o=[];let Q=!0;this.interceptors.request.forEach(function(rt){typeof rt.runWhen=="function"&&rt.runWhen(T)===!1||(Q=Q&&rt.synchronous,o.unshift(rt.fulfilled,rt.rejected))});const pe=[];this.interceptors.response.forEach(function(rt){pe.push(rt.fulfilled,rt.rejected)});let he,ye=0,Oe;if(!Q){const ft=[T2.bind(this),void 0];for(ft.unshift.apply(ft,o),ft.push.apply(ft,pe),Oe=ft.length,he=Promise.resolve(T);ye<Oe;)he=he.then(ft[ye++],ft[ye++]);return he}Oe=o.length;let je=T;for(ye=0;ye<Oe;){const ft=o[ye++],rt=o[ye++];try{je=ft(je)}catch(mt){rt.call(this,mt);break}}try{he=T2.call(this,je)}catch(ft){return Promise.reject(ft)}for(ye=0,Oe=pe.length;ye<Oe;)he=he.then(pe[ye++],pe[ye++]);return he}getUri(g){g=zu(this.defaults,g);const T=vE(g.baseURL,g.url,g.allowAbsoluteUrls);return mE(T,g.params,g.paramsSerializer)}};yt.forEach(["delete","get","head","options"],function(g){Lu.prototype[g]=function(T,C){return this.request(zu(C||{},{method:g,url:T,data:(C||{}).data}))}});yt.forEach(["post","put","patch"],function(g){function T(C){return function(k,j,o){return this.request(zu(o||{},{method:g,headers:C?{"Content-Type":"multipart/form-data"}:{},url:k,data:j}))}}Lu.prototype[g]=T(),Lu.prototype[g+"Form"]=T(!0)});let pk=class AE{constructor(g){if(typeof g!="function")throw new TypeError("executor must be a function.");let T;this.promise=new Promise(function(k){T=k});const C=this;this.promise.then(M=>{if(!C._listeners)return;let k=C._listeners.length;for(;k-- >0;)C._listeners[k](M);C._listeners=null}),this.promise.then=M=>{let k;const j=new Promise(o=>{C.subscribe(o),k=o}).then(M);return j.cancel=function(){C.unsubscribe(k)},j},g(function(k,j,o){C.reason||(C.reason=new Bd(k,j,o),T(C.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(g){if(this.reason){g(this.reason);return}this._listeners?this._listeners.push(g):this._listeners=[g]}unsubscribe(g){if(!this._listeners)return;const T=this._listeners.indexOf(g);T!==-1&&this._listeners.splice(T,1)}toAbortSignal(){const g=new AbortController,T=C=>{g.abort(C)};return this.subscribe(T),g.signal.unsubscribe=()=>this.unsubscribe(T),g.signal}static source(){let g;return{token:new AE(function(M){g=M}),cancel:g}}};function mk(f){return function(T){return f.apply(null,T)}}function _k(f){return yt.isObject(f)&&f.isAxiosError===!0}const U0={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(U0).forEach(([f,g])=>{U0[g]=f});function IE(f){const g=new Lu(f),T=rE(Lu.prototype.request,g);return yt.extend(T,Lu.prototype,g,{allOwnKeys:!0}),yt.extend(T,g,null,{allOwnKeys:!0}),T.create=function(M){return IE(zu(f,M))},T}const Jn=IE(cm);Jn.Axios=Lu;Jn.CanceledError=Bd;Jn.CancelToken=pk;Jn.isCancel=yE;Jn.VERSION=EE;Jn.toFormData=Jg;Jn.AxiosError=Ir;Jn.Cancel=Jn.CanceledError;Jn.all=function(g){return Promise.all(g)};Jn.spread=mk;Jn.isAxiosError=_k;Jn.mergeConfig=zu;Jn.AxiosHeaders=po;Jn.formToJSON=f=>gE(yt.isHTMLForm(f)?new FormData(f):f);Jn.getAdapter=SE.getAdapter;Jn.HttpStatusCode=U0;Jn.default=Jn;const{Axios:BF,AxiosError:NF,CanceledError:VF,isCancel:UF,CancelToken:jF,VERSION:GF,all:HF,Cancel:qF,isAxiosError:$F,spread:WF,toFormData:ZF,AxiosHeaders:XF,HttpStatusCode:KF,formToJSON:YF,getAdapter:JF,mergeConfig:QF}=Jn;function gk(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var vg={exports:{}},yk=vg.exports,E2;function xk(){return E2||(E2=1,function(f,g){(function(T,C){f.exports=C()})(yk,function(){var T,C,M;function k(o,Q){if(!T)T=Q;else if(!C)C=Q;else{var pe="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+T+")(sharedChunk); ("+C+")(sharedChunk); self.onerror = null;",he={};T(he),M=Q(he),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(M.workerUrl=window.URL.createObjectURL(new Blob([pe],{type:"text/javascript"})))}}k(["exports"],function(o){var Q=1e-6,pe=typeof Float32Array<"u"?Float32Array:Array;function he(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=i*u-a*s;return h?(r[0]=u*(h=1/h),r[1]=-s*h,r[2]=-a*h,r[3]=i*h,r):null}function ye(){var r=new pe(9);return pe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function Oe(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=e[4],p=e[5],y=e[6],v=e[7],w=e[8];return r[0]=h*w-p*v,r[1]=a*v-s*w,r[2]=s*p-a*h,r[3]=p*y-u*w,r[4]=i*w-a*y,r[5]=a*u-i*p,r[6]=u*v-h*y,r[7]=s*y-i*v,r[8]=i*h-s*u,r}function je(r,e,i){var s=e[0],a=e[1],u=e[2],h=e[3],p=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=i[0],P=i[1],R=i[2],O=i[3],V=i[4],N=i[5],q=i[6],W=i[7],K=i[8];return r[0]=A*s+P*h+R*v,r[1]=A*a+P*p+R*w,r[2]=A*u+P*y+R*S,r[3]=O*s+V*h+N*v,r[4]=O*a+V*p+N*w,r[5]=O*u+V*y+N*S,r[6]=q*s+W*h+K*v,r[7]=q*a+W*p+K*w,r[8]=q*u+W*y+K*S,r}function ft(){var r=new pe(16);return pe!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r}function rt(r){var e=new pe(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function mt(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Wt(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=e[4],p=e[5],y=e[6],v=e[7],w=e[8],S=e[9],A=e[10],P=e[11],R=e[12],O=e[13],V=e[14],N=e[15],q=i*p-s*h,W=i*y-a*h,K=i*v-u*h,se=s*y-a*p,te=s*v-u*p,le=a*v-u*y,fe=w*O-S*R,ge=w*V-A*R,ze=w*N-P*R,we=S*V-A*O,Ne=S*N-P*O,He=A*N-P*V,qe=q*He-W*Ne+K*we+se*ze-te*ge+le*fe;return qe?(r[0]=(p*He-y*Ne+v*we)*(qe=1/qe),r[1]=(a*Ne-s*He-u*we)*qe,r[2]=(O*le-V*te+N*se)*qe,r[3]=(A*te-S*le-P*se)*qe,r[4]=(y*ze-h*He-v*ge)*qe,r[5]=(i*He-a*ze+u*ge)*qe,r[6]=(V*K-R*le-N*W)*qe,r[7]=(w*le-A*K+P*W)*qe,r[8]=(h*Ne-p*ze+v*fe)*qe,r[9]=(s*ze-i*Ne-u*fe)*qe,r[10]=(R*te-O*K+N*q)*qe,r[11]=(S*K-w*te-P*q)*qe,r[12]=(p*ge-h*we-y*fe)*qe,r[13]=(i*we-s*ge+a*fe)*qe,r[14]=(O*W-R*se-V*q)*qe,r[15]=(w*se-S*W+A*q)*qe,r):null}function wt(r,e,i){var s=e[0],a=e[1],u=e[2],h=e[3],p=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=e[9],P=e[10],R=e[11],O=e[12],V=e[13],N=e[14],q=e[15],W=i[0],K=i[1],se=i[2],te=i[3];return r[0]=W*s+K*p+se*S+te*O,r[1]=W*a+K*y+se*A+te*V,r[2]=W*u+K*v+se*P+te*N,r[3]=W*h+K*w+se*R+te*q,r[4]=(W=i[4])*s+(K=i[5])*p+(se=i[6])*S+(te=i[7])*O,r[5]=W*a+K*y+se*A+te*V,r[6]=W*u+K*v+se*P+te*N,r[7]=W*h+K*w+se*R+te*q,r[8]=(W=i[8])*s+(K=i[9])*p+(se=i[10])*S+(te=i[11])*O,r[9]=W*a+K*y+se*A+te*V,r[10]=W*u+K*v+se*P+te*N,r[11]=W*h+K*w+se*R+te*q,r[12]=(W=i[12])*s+(K=i[13])*p+(se=i[14])*S+(te=i[15])*O,r[13]=W*a+K*y+se*A+te*V,r[14]=W*u+K*v+se*P+te*N,r[15]=W*h+K*w+se*R+te*q,r}function Xt(r,e,i){var s,a,u,h,p,y,v,w,S,A,P,R,O=i[0],V=i[1],N=i[2];return e===r?(r[12]=e[0]*O+e[4]*V+e[8]*N+e[12],r[13]=e[1]*O+e[5]*V+e[9]*N+e[13],r[14]=e[2]*O+e[6]*V+e[10]*N+e[14],r[15]=e[3]*O+e[7]*V+e[11]*N+e[15]):(a=e[1],u=e[2],h=e[3],p=e[4],y=e[5],v=e[6],w=e[7],S=e[8],A=e[9],P=e[10],R=e[11],r[0]=s=e[0],r[1]=a,r[2]=u,r[3]=h,r[4]=p,r[5]=y,r[6]=v,r[7]=w,r[8]=S,r[9]=A,r[10]=P,r[11]=R,r[12]=s*O+p*V+S*N+e[12],r[13]=a*O+y*V+A*N+e[13],r[14]=u*O+v*V+P*N+e[14],r[15]=h*O+w*V+R*N+e[15]),r}function Zt(r,e,i){var s=i[0],a=i[1],u=i[2];return r[0]=e[0]*s,r[1]=e[1]*s,r[2]=e[2]*s,r[3]=e[3]*s,r[4]=e[4]*a,r[5]=e[5]*a,r[6]=e[6]*a,r[7]=e[7]*a,r[8]=e[8]*u,r[9]=e[9]*u,r[10]=e[10]*u,r[11]=e[11]*u,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Li(r,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[4],h=e[5],p=e[6],y=e[7],v=e[8],w=e[9],S=e[10],A=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=u*a+v*s,r[5]=h*a+w*s,r[6]=p*a+S*s,r[7]=y*a+A*s,r[8]=v*a-u*s,r[9]=w*a-h*s,r[10]=S*a-p*s,r[11]=A*a-y*s,r}function Sr(r,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[0],h=e[1],p=e[2],y=e[3],v=e[8],w=e[9],S=e[10],A=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=u*a-v*s,r[1]=h*a-w*s,r[2]=p*a-S*s,r[3]=y*a-A*s,r[8]=u*s+v*a,r[9]=h*s+w*a,r[10]=p*s+S*a,r[11]=y*s+A*a,r}function mr(r,e,i){var s=Math.sin(i),a=Math.cos(i),u=e[0],h=e[1],p=e[2],y=e[3],v=e[4],w=e[5],S=e[6],A=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=u*a+v*s,r[1]=h*a+w*s,r[2]=p*a+S*s,r[3]=y*a+A*s,r[4]=v*a-u*s,r[5]=w*a-h*s,r[6]=S*a-p*s,r[7]=A*a-y*s,r}function vn(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Zn(r,e,i){var s,a,u,h=i[0],p=i[1],y=i[2],v=Math.sqrt(h*h+p*p+y*y);return v<Q?null:(h*=v=1/v,p*=v,y*=v,s=Math.sin(e),a=Math.cos(e),r[0]=h*h*(u=1-a)+a,r[1]=p*h*u+y*s,r[2]=y*h*u-p*s,r[3]=0,r[4]=h*p*u-y*s,r[5]=p*p*u+a,r[6]=y*p*u+h*s,r[7]=0,r[8]=h*y*u+p*s,r[9]=p*y*u-h*s,r[10]=y*y*u+a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)}function fs(r,e){var i=e[0],s=e[1],a=e[2],u=e[4],h=e[5],p=e[6],y=e[8],v=e[9],w=e[10];return r[0]=Math.sqrt(i*i+s*s+a*a),r[1]=Math.sqrt(u*u+h*h+p*p),r[2]=Math.sqrt(y*y+v*v+w*w),r}function Rs(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=i+i,p=s+s,y=a+a,v=i*h,w=s*h,S=s*p,A=a*h,P=a*p,R=a*y,O=u*h,V=u*p,N=u*y;return r[0]=1-S-R,r[1]=w+N,r[2]=A-V,r[3]=0,r[4]=w-N,r[5]=1-v-R,r[6]=P+O,r[7]=0,r[8]=A+V,r[9]=P-O,r[10]=1-v-S,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}var Ns=wt;function Fi(){var r=new pe(3);return pe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ro(r){var e=new pe(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function ln(r){var e=r[0],i=r[1],s=r[2];return Math.sqrt(e*e+i*i+s*s)}function Qi(r,e,i){var s=new pe(3);return s[0]=r,s[1]=e,s[2]=i,s}function Ei(r,e,i,s){return r[0]=e,r[1]=i,r[2]=s,r}function Oi(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r}function Gn(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function Hn(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function Nn(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r}function fn(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r}function Cr(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r}function qn(r,e,i,s){return r[0]=e[0]+i[0]*s,r[1]=e[1]+i[1]*s,r[2]=e[2]+i[2]*s,r}function Jo(r,e){var i=e[0]-r[0],s=e[1]-r[1],a=e[2]-r[2];return Math.sqrt(i*i+s*s+a*a)}function Qn(r,e){var i=e[0]-r[0],s=e[1]-r[1],a=e[2]-r[2];return i*i+s*s+a*a}function Rt(r){var e=r[0],i=r[1],s=r[2];return e*e+i*i+s*s}function ci(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r}function zt(r,e){var i=e[0],s=e[1],a=e[2],u=i*i+s*s+a*a;return u>0&&(u=1/Math.sqrt(u)),r[0]=e[0]*u,r[1]=e[1]*u,r[2]=e[2]*u,r}function Yt(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}function sr(r,e,i){var s=e[0],a=e[1],u=e[2],h=i[0],p=i[1],y=i[2];return r[0]=a*y-u*p,r[1]=u*h-s*y,r[2]=s*p-a*h,r}function Ie(r,e,i,s){var a=e[0],u=e[1],h=e[2];return r[0]=a+s*(i[0]-a),r[1]=u+s*(i[1]-u),r[2]=h+s*(i[2]-h),r}function Ae(r,e,i){var s=e[0],a=e[1],u=e[2],h=i[3]*s+i[7]*a+i[11]*u+i[15];return r[0]=(i[0]*s+i[4]*a+i[8]*u+i[12])/(h=h||1),r[1]=(i[1]*s+i[5]*a+i[9]*u+i[13])/h,r[2]=(i[2]*s+i[6]*a+i[10]*u+i[14])/h,r}function $e(r,e,i){var s=e[0],a=e[1],u=e[2];return r[0]=s*i[0]+a*i[3]+u*i[6],r[1]=s*i[1]+a*i[4]+u*i[7],r[2]=s*i[2]+a*i[5]+u*i[8],r}function It(r,e,i){var s=i[0],a=i[1],u=i[2],h=i[3],p=e[0],y=e[1],v=e[2],w=a*v-u*y,S=u*p-s*v,A=s*y-a*p;return r[0]=p+h*(w+=w)+a*(A+=A)-u*(S+=S),r[1]=y+h*S+u*w-s*A,r[2]=v+h*A+s*S-a*w,r}function Ct(r){return r[0]=0,r[1]=0,r[2]=0,r}function bt(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]}var jt=Gn,ri=Hn,Jt=ln;function Gt(){var r=new pe(4);return pe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function Ai(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r}function ni(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=i*i+s*s+a*a+u*u;return h>0&&(h=1/Math.sqrt(h)),r[0]=i*h,r[1]=s*h,r[2]=a*h,r[3]=u*h,r}function hi(r,e,i){var s=e[0],a=e[1],u=e[2],h=e[3];return r[0]=i[0]*s+i[4]*a+i[8]*u+i[12]*h,r[1]=i[1]*s+i[5]*a+i[9]*u+i[13]*h,r[2]=i[2]*s+i[6]*a+i[10]*u+i[14]*h,r[3]=i[3]*s+i[7]*a+i[11]*u+i[15]*h,r}function Bi(){var r=new pe(4);return pe!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function vr(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r}function Dr(r,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(i),y=Math.cos(i);return r[0]=s*y+h*p,r[1]=a*y+u*p,r[2]=u*y-a*p,r[3]=h*y-s*p,r}function Pr(r,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(i),y=Math.cos(i);return r[0]=s*y-u*p,r[1]=a*y+h*p,r[2]=u*y+s*p,r[3]=h*y-a*p,r}Fi(),Gt();var Yr,Dn,es,ts=ni,Ys=(Yr=Fi(),Dn=Qi(1,0,0),es=Qi(0,1,0),function(r,e,i){var s=Yt(e,i);return s<-.999999?(sr(Yr,Dn,e),Jt(Yr)<1e-6&&sr(Yr,es,e),zt(Yr,Yr),function(a,u,h){h*=.5;var p=Math.sin(h);a[0]=p*u[0],a[1]=p*u[1],a[2]=p*u[2],a[3]=Math.cos(h)}(r,Yr,Math.PI),r):s>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(sr(Yr,e,i),r[0]=Yr[0],r[1]=Yr[1],r[2]=Yr[2],r[3]=1+s,ts(r,r))});function bn(){var r=new pe(2);return pe!=Float32Array&&(r[0]=0,r[1]=0),r}function rn(r,e){var i=new pe(2);return i[0]=r,i[1]=e,i}function ps(r,e,i){return r[0]=e,r[1]=i,r}function mo(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r}function Do(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function Qo(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r}function _o(r){var e=r[0],i=r[1];return Math.sqrt(e*e+i*i)}function Dc(r,e){var i=e[0],s=e[1],a=i*i+s*s;return a>0&&(a=1/Math.sqrt(a)),r[0]=e[0]*a,r[1]=e[1]*a,r}function sl(r,e){return r[0]*e[0]+r[1]*e[1]}Bi(),Bi(),ye();var Gr,$n,ku=Do;function ol(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}bn();var go=function(){if($n)return Gr;function r(e,i,s,a){this.cx=3*e,this.bx=3*(s-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(a-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=s,this.p2y=a}return $n=1,Gr=r,r.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var s=e,a=0;a<8;a++){var u=this.sampleCurveX(s)-e;if(Math.abs(u)<i)return s;var h=this.sampleCurveDerivativeX(s);if(Math.abs(h)<1e-6)break;s-=u/h}var p=0,y=1;for(s=e,a=0;a<20&&(u=this.sampleCurveX(s),!(Math.abs(u-e)<i));a++)e>u?p=s:y=s,s=.5*(y-p)+p;return s},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},Gr}(),Fu=ol(go);function Ye(r,e){this.x=r,this.y=e}function ea(r,e){if(Array.isArray(r)){if(!Array.isArray(e)||r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(!ea(r[i],e[i]))return!1;return!0}if(typeof r=="object"&&r!==null&&e!==null){if(typeof e!="object"||Object.keys(r).length!==Object.keys(e).length)return!1;for(const i in r)if(!ea(r[i],e[i]))return!1;return!0}return r===e}Ye.prototype={clone(){return new Ye(this.x,this.y)},add(r){return this.clone()._add(r)},sub(r){return this.clone()._sub(r)},multByPoint(r){return this.clone()._multByPoint(r)},divByPoint(r){return this.clone()._divByPoint(r)},mult(r){return this.clone()._mult(r)},div(r){return this.clone()._div(r)},rotate(r){return this.clone()._rotate(r)},rotateAround(r,e){return this.clone()._rotateAround(r,e)},matMult(r){return this.clone()._matMult(r)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(r){return this.x===r.x&&this.y===r.y},dist(r){return Math.sqrt(this.distSqr(r))},distSqr(r){const e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith(r){return this.angleWithSep(r.x,r.y)},angleWithSep(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult(r){const e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add(r){return this.x+=r.x,this.y+=r.y,this},_sub(r){return this.x-=r.x,this.y-=r.y,this},_mult(r){return this.x*=r,this.y*=r,this},_div(r){return this.x/=r,this.y/=r,this},_multByPoint(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint(r){return this.x/=r.x,this.y/=r.y,this},_unit(){return this._div(this.mag()),this},_perp(){const r=this.y;return this.y=this.x,this.x=-r,this},_rotate(r){const e=Math.cos(r),i=Math.sin(r),s=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=s,this},_rotateAround(r,e){const i=Math.cos(r),s=Math.sin(r),a=e.y+s*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-s*(this.y-e.y),this.y=a,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Ye},Ye.convert=function(r){if(r instanceof Ye)return r;if(Array.isArray(r))return new Ye(+r[0],+r[1]);if(r.x!==void 0&&r.y!==void 0)return new Ye(+r.x,+r.y);throw new Error("Expected [x, y] or {x, y} point format")};const Nd=Math.PI/180,al=180/Math.PI;function Wi(r){return r*Nd}function us(r){return r*al}const Vd=[[0,0],[1,0],[1,1],[0,1]];function ll(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Lc(r,e,i,s){const a=new Fu(r,e,i,s);return function(u){return a.solve(u)}}const Ee=Lc(.25,.1,.25,1);function U(r,e,i){return Math.min(i,Math.max(e,r))}function $(r,e,i){return(i=U((i-r)/(e-r),0,1))*i*(3-2*i)}function J(r,e,i){const s=i-e,a=((r-e)%s+s)%s+e;return a===e?i:a}function me(r,e,i){if(!r.length)return i(null,[]);let s=r.length;const a=new Array(r.length);let u=null;r.forEach((h,p)=>{e(h,(y,v)=>{y&&(u=y),a[p]=v,--s==0&&i(u,a)})})}let de=1;function ve(){return de++}function Re(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log2(r)))}function Te(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Me(r,e,i){const s={};for(const a in r)s[a]=e.call(this,r[a],a,r);return s}function tt(r,e,i){const s={};for(const a in r)e.call(this,r[a],a,r)&&(s[a]=r[a]);return s}function Ge(r){return Array.isArray(r)?r.map(Ge):typeof r=="object"&&r?Me(r,Ge):r}function Pt(r,e){for(let i=0;i<r.length;i++)if(e.indexOf(r[i])>=0)return!0;return!1}const qt={};function St(r){qt[r]||(typeof console<"u"&&console.warn(r),qt[r]=!0)}function yi(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function _i(r){let e=0;for(let i,s,a=0,u=r.length,h=u-1;a<u;h=a++)i=r[a],s=r[h],e+=(s.x-i.x)*(i.y+s.y);return e}function pi([r,e,i]){const s=Wi(e+90),a=Wi(i);return{x:r*Math.cos(s)*Math.sin(a),y:r*Math.sin(s)*Math.sin(a),z:r*Math.cos(a),azimuthal:e,polar:i}}function Vi(r){return(typeof self<"u"||r!==void 0)&&typeof WorkerGlobalScope<"u"&&(r!==void 0?r:self)instanceof WorkerGlobalScope}function Zr(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,s,a,u)=>{const h=a||u;return e[s]=!h||h.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let pn=null;function Jr(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function yn(r,e,i,s){for(;e<i;){const a=e+i>>1;r[a]<s?e=a+1:i=a}return e}function Hr(r,e,i,s){for(;e<i;){const a=e+i>>1;r[a]<=s?e=a+1:i=a}return e}function Hi(r){return r>0?1/(1.001-r):1+r}function qr(r){return r>0?1-1/(1.001-r):-r}function br(r,e,i){return(r-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Mi={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Mi.API_URL)return null;try{const r=new URL(Mi.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Qr(r){return Mi.API_URL_REGEX.test(r)}function Xn(r){return Mi.API_SPRITE_REGEX.test(r)}let is,ws,cl,Vn,Vs,hs;function Lo(){return is==null&&(is=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),is}const Ln={now:()=>Vn!==void 0?Vn:performance.now(),setNow(r){Vn=r},restoreNow(){Vn=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:s}=r;Vs||(Vs=document.createElement("canvas"));const a=Vs.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return(i>Vs.width||s>Vs.height)&&(Vs.width=i,Vs.height=s),a.clearRect(-e,-e,i+2*e,s+2*e),a.drawImage(r,0,0,i,s),a.getImageData(-e,-e,i+2*e,s+2*e)},resolveURL:r=>(ws||(ws=document.createElement("a")),ws.href=r,ws.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(cl==null&&(cl=window.matchMedia("(prefers-reduced-motion: reduce)")),cl.matches)},hasCanvasFingerprintNoise(){if(hs!==void 0)return hs;if(!Lo())return hs=!1,!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let a=0;a<r.width;++a)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(a,0,1,1);const s=e.getImageData(0,0,r.width,r.height);i=0;for(let a=0;a<s.data.length;++a)if(a%4!=3&&i++!==s.data[a])return hs=!0,!0;return hs=!1,!1}};function ul(r,e){const i=r.indexOf("?");if(i<0)return`${r}?${new URLSearchParams(e).toString()}`;const s=new URLSearchParams(r.slice(i));for(const a in e)s.set(a,e[a]);return`${r.slice(0,i)}?${s.toString()}`}function jl(r,e={persistentParams:[]}){const i=r.indexOf("?");if(i<0)return r;const s=new URLSearchParams,a=new URLSearchParams(r.slice(i));for(const h of e.persistentParams){const p=a.get(h);p&&s.set(h,p)}const u=s.toString();return`${r.slice(0,i)}${u.length>0?`?${u}`:""}`}const Bu="mapbox-tiles";let Nu=500,Vu=50;const zc=["language","worldview","jobid"];let zo,Ts;function yo(){try{return caches}catch{}}function xo(){const r=yo();r&&zo==null&&(zo=r.open(Bu))}let Js=1/0;const Oo={supported:!1,testSupport:function(r){!Uu&&hl&&(dl?um(r):Ma=r)}};let Ma,hl,Uu=!1,dl=!1;const ju=typeof self<"u"?self:{};function um(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,hl),r.isContextLost())return;Oo.supported=!0}catch{}r.deleteTexture(e),Uu=!0}ju.document&&(hl=ju.document.createElement("img"),hl.onload=function(){Ma&&um(Ma),Ma=null,dl=!0},hl.onerror=function(){Uu=!0,Ma=null},hl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Oc={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Oc);class Ds extends Error{constructor(e,i,s){i===401&&Qr(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Gu=Vi()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,fl=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(Gu())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(s,a){const u=new AbortController,h=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Gu(),referrerPolicy:s.referrerPolicy,signal:u.signal});let p=!1,y=!1;const v=(w=h.url).indexOf("sku=")>0&&Qr(w);var w;s.type==="json"&&h.headers.set("Accept","application/json");const S=(P,R,O)=>{if(y)return;if(P&&P.message!=="SecurityError"&&St(P.toString()),R&&O)return A(R);const V=Date.now();fetch(h).then(N=>{if(N.ok){const q=v?N.clone():null;return A(N,q,V)}return a(new Ds(N.statusText,N.status,s.url))}).catch(N=>{N.name!=="AbortError"&&a(new Error(`${N.message} ${s.url}`))})},A=(P,R,O)=>{(s.type==="arrayBuffer"?P.arrayBuffer():s.type==="json"?P.json():P.text()).then(V=>{y||(R&&O&&function(N,q,W){if(xo(),zo==null)return;const K=Zr(q.headers.get("Cache-Control")||"");if(K["no-store"])return;const se={status:q.status,statusText:q.statusText,headers:new Headers};q.headers.forEach((fe,ge)=>se.headers.set(ge,fe)),K["max-age"]&&se.headers.set("Expires",new Date(W+1e3*K["max-age"]).toUTCString());const te=se.headers.get("Expires");if(!te||new Date(te).getTime()-W<42e4)return;let le=jl(N.url,{persistentParams:zc});if(q.status===206){const fe=N.headers.get("Range");if(!fe)return;se.status=200,le=ul(le,{range:fe})}(function(fe,ge){if(Ts===void 0)try{new Response(new ReadableStream),Ts=!0}catch{Ts=!1}Ts?ge(fe.body):fe.blob().then(ge).catch(ze=>St(ze.message))})(q,fe=>{const ge=new Response((ze=q.status)!==200&&ze!==404&&[101,103,204,205,304].includes(ze)?null:fe,se);var ze;xo(),zo?.then(we=>we.put(le,ge)).catch(we=>St(we.message))})}(h,R,O),p=!0,a(null,V,P.headers))}).catch(V=>{y||a(new Error(V.message))})};return v?function(P,R){if(xo(),zo==null)return R(null);zo.then(O=>{let V=jl(P.url,{persistentParams:zc});const N=P.headers.get("Range");N&&(V=ul(V,{range:N})),O.match(V).then(q=>{const W=function(K){if(!K)return!1;const se=new Date(K.headers.get("Expires")||0),te=Zr(K.headers.get("Cache-Control")||"");return Number(se)>Date.now()&&!te["no-cache"]}(q);O.delete(V).catch(R),W&&O.put(V,q.clone()).catch(R),R(null,q,W)}).catch(R)}).catch(R)}(h,S):S(null,null),{cancel:()=>{y=!0,p||u.abort()}}}(r,e);if(Vi(self)&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(s,a){const u=new XMLHttpRequest;u.open(s.method||"GET",s.url,!0),s.type==="arrayBuffer"&&(u.responseType="arraybuffer");for(const h in s.headers)u.setRequestHeader(h,s.headers[h]);return s.type==="json"&&(u.responseType="text",u.setRequestHeader("Accept","application/json")),u.withCredentials=s.credentials==="include",u.onerror=()=>{a(new Error(u.statusText))},u.onload=()=>{if((u.status>=200&&u.status<300||u.status===0)&&u.response!==null){let h=u.response;if(s.type==="json")try{h=JSON.parse(u.response)}catch(y){return a(y)}const p=new Headers;u.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(y=>{const v=y.split(": "),w=v.shift(),S=v.join(": ");p.append(w,S)}),a(null,h,p)}else a(new Ds(u.statusText,u.status,s.url))},u.send(s.body),{cancel:()=>u.abort()}}(r,e)},ta=function(r,e){return fl(Object.assign(r,{type:"arrayBuffer"}),e)};function ty(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const hm="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let kc,qi;kc=[],qi=0;const Hu=function(r,e){if(Oo.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),qi>=Mi.MAX_PARALLEL_IMAGE_REQUESTS){const u={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return kc.push(u),u}qi++;let i=!1;const s=()=>{if(!i)for(i=!0,qi--;kc.length&&qi<Mi.MAX_PARALLEL_IMAGE_REQUESTS;){const u=kc.shift(),{requestParameters:h,callback:p,cancelled:y}=u;y||(u.cancel=Hu(h,p).cancel)}},a=ta(r,(u,h,p)=>{s(),u?e(u):h&&(self.createImageBitmap?function(y,v){const w=new Blob([new Uint8Array(y)],{type:"image/png"});createImageBitmap(w).then(S=>{v(null,S)}).catch(S=>{v(new Error(`Could not load image because of ${S.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(h,(y,v)=>e(y,v,p)):function(y,v){const w=new Image;w.onload=()=>{v(null,w),URL.revokeObjectURL(w.src),w.onload=null,requestAnimationFrame(()=>{w.src=hm})},w.onerror=()=>v(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const S=new Blob([new Uint8Array(y)],{type:"image/png"});w.src=y.byteLength?URL.createObjectURL(S):hm}(h,(y,v)=>e(y,v,p)))});return{cancel:()=>{a.cancel(),s()}}};var Ud,dm,fm,Ra={exports:{}},Fc={exports:{}},Bc={exports:{}},jd=function(){if(fm)return Ra.exports;fm=1;var r=(Ud||(Ud=1,Fc.exports=function(i,s){var a,u,h,p,y,v,w,S;for(u=i.length-(a=3&i.length),h=s,y=3432918353,v=461845907,S=0;S<u;)w=255&i.charCodeAt(S)|(255&i.charCodeAt(++S))<<8|(255&i.charCodeAt(++S))<<16|(255&i.charCodeAt(++S))<<24,++S,h=27492+(65535&(p=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(p>>>16)&65535)<<16);switch(w=0,a){case 3:w^=(255&i.charCodeAt(S+2))<<16;case 2:w^=(255&i.charCodeAt(S+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(S)))*y+(((w>>>16)*y&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0}),Fc.exports),e=(dm||(dm=1,Bc.exports=function(i,s){for(var a,u=i.length,h=s^u,p=0;u>=4;)a=1540483477*(65535&(a=255&i.charCodeAt(p)|(255&i.charCodeAt(++p))<<8|(255&i.charCodeAt(++p))<<16|(255&i.charCodeAt(++p))<<24))+((1540483477*(a>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),u-=4,++p;switch(u){case 3:h^=(255&i.charCodeAt(p+2))<<16;case 2:h^=(255&i.charCodeAt(p+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(p)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0}),Bc.exports);return Ra.exports=r,Ra.exports.murmur3=r,Ra.exports.murmur2=e,Ra.exports}(),qu=ol(jd);class ko{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Nc extends ko{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function Gd(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function Da(r,e,i){if(i&&i[r]){const s=i[r].indexOf(e);s!==-1&&i[r].splice(s,1)}}class pl{on(e,i){return this._listeners=this._listeners||{},Gd(e,i,this._listeners),this}off(e,i){return Da(e,i,this._listeners),Da(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},Gd(e,i,this._oneTimeListeners),this):new Promise(s=>{this.once(e,s)})}fire(e,i){const s=typeof e=="string"?new ko(e,i):e,a=s.type;if(this.listens(a)){s.target=this;const u=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of u)y.call(this,s);const h=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of h)Da(a,y,this._oneTimeListeners),y.call(this,s);const p=this._eventedParent;if(p){const y=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(s,y),p.fire(s)}}else s instanceof Nc&&console.error(s.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class ds{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ds(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,s]=e.split("");return new ds({name:i,iconsetId:s})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return ds.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var $u,Vc={},Qs=function(){if($u)return Vc;$u=1;var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(u){return(u=Math.round(u))<0?0:u>255?255:u}function i(u){return e(u[u.length-1]==="%"?parseFloat(u)/100*255:parseInt(u))}function s(u){return(h=u[u.length-1]==="%"?parseFloat(u)/100:parseFloat(u))<0?0:h>1?1:h;var h}function a(u,h,p){return p<0?p+=1:p>1&&(p-=1),6*p<1?u+(h-u)*p*6:2*p<1?h:3*p<2?u+(h-u)*(2/3-p)*6:u}try{Vc.parseCSSColor=function(u){var h,p=u.replace(/ /g,"").toLowerCase();if(p in r)return r[p].slice();if(p[0]==="#")return p.length===4?(h=parseInt(p.substr(1),16))>=0&&h<=4095?[(3840&h)>>4|(3840&h)>>8,240&h|(240&h)>>4,15&h|(15&h)<<4,1]:null:p.length===7&&(h=parseInt(p.substr(1),16))>=0&&h<=16777215?[(16711680&h)>>16,(65280&h)>>8,255&h,1]:null;var y=p.indexOf("("),v=p.indexOf(")");if(y!==-1&&v+1===p.length){var w=p.substr(0,y),S=p.substr(y+1,v-(y+1)).split(","),A=1;switch(w){case"rgba":if(S.length!==4)return null;A=s(S.pop());case"rgb":return S.length!==3?null:[i(S[0]),i(S[1]),i(S[2]),A];case"hsla":if(S.length!==4)return null;A=s(S.pop());case"hsl":if(S.length!==3)return null;var P=(parseFloat(S[0])%360+360)%360/360,R=s(S[1]),O=s(S[2]),V=O<=.5?O*(R+1):O+R-O*R,N=2*O-V;return[e(255*a(N,V,P+1/3)),e(255*a(N,V,P)),e(255*a(N,V,P-1/3)),A];default:return null}}return null}}catch{}return Vc}();class or{constructor(e,i,s,a=1){this.r=e,this.g=i,this.b=s,this.a=a}static parse(e){if(!e)return;if(e instanceof or)return e;if(typeof e!="string")return;const i=Qs.parseCSSColor(e);return i?new or(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,s,a]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*s)},${a})`}toNonPremultipliedRenderColor(e){const{r:i,g:s,b:a,a:u}=this;return new mm(e,i,s,a,u)}toPremultipliedRenderColor(e){const{r:i,g:s,b:a,a:u}=this;return new _m(e,i*u,s*u,a*u,u)}clone(){return new or(this.r,this.g,this.b,this.a)}}class pm{constructor(e,i,s,a,u,h=!1){if(this.premultiplied=!1,this.premultiplied=h,e){const p=e.image.height,y=p*p;this.premultiplied?(i=u===0?0:i/u*(p-1),s=u===0?0:s/u*(p-1),a=u===0?0:a/u*(p-1)):(i*=p-1,s*=p-1,a*=p-1);const v=Math.floor(i),w=Math.floor(s),S=Math.floor(a),A=Math.ceil(i),P=Math.ceil(s),R=Math.ceil(a),O=i-v,V=s-w,N=a-S,q=e.image.data,W=4*(v+w*y+S*p),K=4*(v+w*y+R*p),se=4*(v+P*y+S*p),te=4*(v+P*y+R*p),le=4*(A+w*y+S*p),fe=4*(A+w*y+R*p),ge=4*(A+P*y+S*p),ze=4*(A+P*y+R*p);if(W<0||ze>=q.length)throw new Error("out of range");this.r=ii(ii(ii(q[W],q[K],N),ii(q[se],q[te],N),V),ii(ii(q[le],q[fe],N),ii(q[ge],q[ze],N),V),O)/255*(this.premultiplied?u:1),this.g=ii(ii(ii(q[W+1],q[K+1],N),ii(q[se+1],q[te+1],N),V),ii(ii(q[le+1],q[fe+1],N),ii(q[ge+1],q[ze+1],N),V),O)/255*(this.premultiplied?u:1),this.b=ii(ii(ii(q[W+2],q[K+2],N),ii(q[se+2],q[te+2],N),V),ii(ii(q[le+2],q[fe+2],N),ii(q[ge+2],q[ze+2],N),V),O)/255*(this.premultiplied?u:1),this.a=u}else this.r=i,this.g=s,this.b=a,this.a=u}toArray(){const{r:e,g:i,b:s,a}=this;return[255*e,255*i,255*s,a]}toHslaArray(){let{r:e,g:i,b:s,a}=this;if(this.premultiplied){if(a===0)return[0,0,0,0];const R=1/a;e*=R,i*=R,s*=R}const u=Math.min(Math.max(e,0),1),h=Math.min(Math.max(i,0),1),p=Math.min(Math.max(s,0),1),y=Math.min(u,h,p),v=Math.max(u,h,p),w=v-y,S=.5*(y+v);if(w===0)return[0,0,100*S,a];const A=S>.5?w/(2-v-y):w/(v+y);let P;switch(v){case u:P=60*((h-p)/w+(h<p?6:0));break;case h:P=60*((p-u)/w+2);break;default:P=60*((u-h)/w+4)}return[P,100*A,100*S,a]}toArray01(){const{r:e,g:i,b:s,a}=this;return[e,i,s,a]}toArray01Scaled(e){const{r:i,g:s,b:a}=this;return[i*e,s*e,a*e]}toArray01Linear(){const{r:e,g:i,b:s,a}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(s,2.2),a]}}class mm extends pm{constructor(e,i,s,a,u){super(e,i,s,a,u,!1)}}class _m extends pm{constructor(e,i,s,a,u){super(e,i,s,a,u,!0)}}function ii(r,e,i){return r*(1-i)+e*i}function Hd(r,e,i){return r.map((s,a)=>ii(s,e[a],i))}or.black=new or(0,0,0,1),or.white=new or(1,1,1,1),or.transparent=new or(0,0,0,0),or.red=new or(1,0,0,1),or.blue=new or(0,0,1,1);var Uc=Object.freeze({__proto__:null,array:Hd,color:function(r,e,i){return new or(ii(r.r,e.r,i),ii(r.g,e.g,i),ii(r.b,e.b,i),ii(r.a,e.a,i))},number:ii});class eo extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class Gl{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[s,a]of i)this.bindings[s]=a}concat(e){return new Gl(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const vo={kind:"null"},Ut={kind:"number"},Ni={kind:"string"},ur={kind:"boolean"},Ss={kind:"color"},Fo={kind:"object"},nr={kind:"value"},Wu={kind:"collator"},jc={kind:"formatted"},Gc={kind:"resolvedImage"};function rs(r,e){return{kind:"array",itemType:r,N:e}}function mn(r){if(r.kind==="array"){const e=mn(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const iy=[vo,Ut,Ni,ur,Ss,jc,Fo,rs(nr),Gc];function La(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!La(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of iy)if(!La(i,e))return null}}return`Expected ${mn(r)} but found ${mn(e)} instead.`}function qd(r,e){return e.some(i=>i.kind===r.kind)}function Hc(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}function Zu(r,e){return r.kind==="array"&&e.kind==="array"?r.N===e.N&&Zu(r.itemType,e.itemType):r.kind===e.kind}class $d{constructor(e,i,s){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Xu{constructor(e,i,s,a,u){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=s,this.fontStack=a,this.textColor=u}}class ms{constructor(e){this.sections=e}static fromString(e){return new ms([new Xu(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof ms?e:ms.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const a=i.image.getPrimary().id.toString();e.push(["image",a]);continue}e.push(i.text);const s={};i.fontStack&&(s["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(s["font-scale"]=i.scale),i.textColor&&(s["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(s)}return e}}class ia{constructor(e,i={}){this.id=ds.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,s,a,u;try{({id:i,params:s,sx:a,sy:u}=JSON.parse(e)||{})}catch{return null}return i?new ia(i,{params:s,sx:a,sy:u}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class _s{constructor(e,i,s,a,u=!1){this.primaryId=ds.from(e),this.primaryOptions=i,s&&(this.secondaryId=ds.from(s)),this.secondaryOptions=a,this.available=u}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new ia(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new ia(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?_s.build({name:e}):e}static build(e,i,s,a){return!e||typeof e=="object"&&!("name"in e)?null:new _s(e,s,i,a)}}function ml(r,e,i,s){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?s===void 0||typeof s=="number"&&s>=0&&s<=1?null:`Invalid rgba value [${[r,e,i,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof s=="number"?[r,e,i,s]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Hl(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof or||r instanceof $d||r instanceof ms||r instanceof _s)return!0;if(Array.isArray(r)){for(const e of r)if(!Hl(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Hl(r[e]))return!1;return!0}return!1}function zn(r){if(r===null)return vo;if(typeof r=="string")return Ni;if(typeof r=="boolean")return ur;if(typeof r=="number")return Ut;if(r instanceof or)return Ss;if(r instanceof $d)return Wu;if(r instanceof ms)return jc;if(r instanceof _s)return Gc;if(Array.isArray(r)){const e=r.length;let i;for(const s of r){const a=zn(s);if(i){if(i===a)continue;i=nr;break}i=a}return rs(i||nr,e)}return Fo}function to(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof ms||r instanceof _s||r instanceof or?r.toString():JSON.stringify(r)}class ra{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Hl(e[1]))return i.error("invalid value");const s=e[1];let a=zn(s);const u=i.expectedType;return a.kind!=="array"||a.N!==0||!u||u.kind!=="array"||typeof u.N=="number"&&u.N!==0||(a=u),new ra(a,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof or?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ms?this.value.serialize():this.value}}class Cn{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Wd={string:Ni,number:Ut,boolean:ur,object:Fo};class bo{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let s,a=1;const u=e[0];if(u==="array"){let p,y;if(e.length>2){const v=e[1];if(typeof v!="string"||!(v in Wd)||v==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);p=Wd[v],a++}else p=nr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);y=e[2],a++}s=rs(p,y)}else s=Wd[u];const h=[];for(;a<e.length;a++){const p=i.parse(e[a],a,nr);if(!p)return null;h.push(p)}return new bo(s,h)}evaluate(e){for(let i=0;i<this.args.length;i++){const s=this.args[i].evaluate(e);if(!La(this.type,zn(s)))return s;if(i===this.args.length-1)throw new Cn(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${mn(zn(s))} but was expected to be of type ${mn(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const s=e.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){i.push(s.kind);const a=e.N;(typeof a=="number"||this.args.length>1)&&i.push(a)}}return i.concat(this.args.map(s=>s.serialize()))}}class Bo{constructor(e){this.type=jc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&typeof s=="object")return i.error("First argument must be an image or text section.");const a=[];let u=!1;for(let h=1;h<=e.length-1;++h){const p=e[h];if(u&&typeof p=="object"&&!Array.isArray(p)){u=!1;let y=null;if(p["font-scale"]&&(y=i.parseObjectValue(p["font-scale"],h,"font-scale",Ut),!y))return null;let v=null;if(p["text-font"]&&(v=i.parseObjectValue(p["text-font"],h,"text-font",rs(Ni)),!v))return null;let w=null;if(p["text-color"]&&(w=i.parseObjectValue(p["text-color"],h,"text-color",Ss),!w))return null;const S=a[a.length-1];S.scale=y,S.font=v,S.textColor=w}else{const y=i.parse(e[h],h,nr);if(!y)return null;const v=y.type.kind;if(v!=="string"&&v!=="value"&&v!=="null"&&v!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");u=!0,a.push({content:y,scale:null,font:null,textColor:null})}}return new Bo(a)}evaluate(e){return new ms(this.sections.map(i=>{const s=i.content.evaluate(e);return Zu(zn(s),Gc)?new Xu("",s,null,null,null):new Xu(to(s),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const s={};i.scale&&(s["font-scale"]=i.scale.serialize()),i.font&&(s["text-font"]=i.font.serialize()),i.textColor&&(s["text-color"]=i.textColor.serialize()),e.push(s)}return e}}class gi{constructor(e,i,s,a){this._imageWarnHistory={},this.type=Gc,this.namePrimary=e,this.nameSecondary=i,s&&(this.paramsPrimary=s.params,this.iconsetIdPrimary=s.iconset?s.iconset.id:void 0),a&&(this.paramsSecondary=a.params,this.iconsetIdSecondary=a.iconset?a.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let s=1;const a=[];function u(){if(s<e.length){const p=i.parse(e[s],s++,Ni);return p?(a.push({image:p,options:{}}),!0):(i.error(a.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function h(){if(s<e.length){const y=e[s];if((p=y)===null||typeof p!="object"||Array.isArray(p))return!0;const v=y.params,w=y.iconset,S=i.concat(s);if(!v&&!w)return s++,!0;if(v){if(typeof v!="object"||v.constructor!==Object)return S.error('Image options "params" should be an object'),!1;const A={},P=S.concat(void 0,"params");for(const R in v){if(!R)return P.error("Image parameter name should be non-empty"),!1;const O=P.concat(void 0,R).parse(v[R],void 0,Ss,void 0,{typeAnnotation:"coerce"});if(!O)return!1;A[R]=O}a[a.length-1].options.params=A}if(w){if(typeof w!="object"||w.constructor!==Object)return S.error('Image options "iconset" should be an object'),!1;if(!w.id)return S.error('Image options "iconset" should have an "id" property'),!1;a[a.length-1].options.iconset=w}return s++,!0}var p;return!0}for(let p=0;p<2;p++)if(!u()||!h())return;return new gi(a[0].image,a[1]?a[1].image:void 0,a[0].options,a[1]?a[1].options:void 0)}evaluateParams(e,i){const s={};if(i){for(const a in i)if(i[a])try{s[a]=i[a].evaluate(e)}catch{continue}if(Object.keys(s).length!==0)return{params:s}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},s=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,a=_s.build(i,s,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(a&&e.availableImages){const u=a.getPrimary().id;if(a.available=e.availableImages.some(h=>ds.isEqual(h,u)),a.available){const h=a.getSecondary()?a.getSecondary().id:null;h&&(a.available=e.availableImages.some(p=>ds.isEqual(p,h)))}}return a}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const s={};if(i&&(s.iconset={id:i}),e){s.params={};for(const a in e)e[a]&&(s.params[a]=e[a].serialize())}return Object.keys(s).length>0?s:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Bt(r){return oi(r)?"string":ql(r)?"number":Yu(r)?"boolean":Array.isArray(r)?"array":r===null?"null":Ku(r)?"object":typeof r}function Ku(r){return r!=null&&!Array.isArray(r)&&typeof r!="function"&&!(r instanceof String||r instanceof Number||r instanceof Boolean)&&typeof r=="object"}function oi(r){return typeof r=="string"||r instanceof String}function ql(r){return typeof r=="number"||r instanceof Number}function Yu(r){return typeof r=="boolean"||r instanceof Boolean}const si={"to-boolean":ur,"to-color":Ss,"to-number":Ut,"to-string":Ni};class No{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const s=e[0],a=[];let u=vo;if(s==="to-array"){if(!Array.isArray(e[1]))return null;const h=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);u=rs(i.expectedType.itemType,h)}else{if(!(h>0&&Hl(e[1][0])))return null;u=rs(zn(e[1][0]),h)}for(let p=0;p<h;p++){const y=e[1][p];let v;if(Array.isArray(y))v=i.parse(y,void 0,u.itemType);else{const w=Bt(y);if(w!==u.itemType.kind)return i.error(`Expected ${u.itemType.kind} but found ${w}.`);v=i.registry.literal.parse(["literal",y===void 0?null:y],i)}if(!v)return null;a.push(v)}}else{if((s==="to-boolean"||s==="to-string")&&e.length!==2)return i.error("Expected one argument.");u=si[s];for(let h=1;h<e.length;h++){const p=i.parse(e[h],h,nr);if(!p)return null;a.push(p)}}return new No(u,a)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,s;for(const a of this.args){if(i=a.evaluate(e),s=null,i instanceof or)return i;if(typeof i=="string"){const u=e.parseColor(i);if(u)return u}else if(Array.isArray(i)&&(s=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ml(i[0],i[1],i[2],i[3]),!s))return new or(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Cn(s||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const s of this.args){if(i=s.evaluate(e),i===null)return 0;const a=Number(i);if(!isNaN(a))return a}throw new Cn(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ms.fromString(to(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?_s.build(to(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):to(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gi(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Zd=["Unknown","Point","LineString","Polygon"];class Ju{constructor(e,i,s){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=s}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Zd[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:s,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(s*i-e[0])+this.featureDistanceData.bearing[1]*(a*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=or.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class gs{constructor(e,i,s,a,u){this.name=e,this.type=i,this._evaluate=s,this.args=a,this._overloadIndex=u}evaluate(e){if(!this._evaluate){const i=gs.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const s=e[0],a=gs.definitions[s];if(!a)return i.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const u=Array.isArray(a)?a[0]:a.type,h=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,p=[];let y=null,v=-1;for(const[w,S]of h){if(Array.isArray(w)&&w.length!==e.length-1)continue;p.push(w),v++,y=new uh(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const A=[];let P=!1;for(let R=1;R<e.length;R++){const O=e[R],V=Array.isArray(w)?w[R-1]:w.type,N=y.parse(O,1+A.length,V);if(!N){P=!0;break}A.push(N)}if(!P)if(Array.isArray(w)&&w.length!==A.length)y.error(`Expected ${w.length} arguments, but found ${A.length} instead.`);else{for(let R=0;R<A.length;R++){const O=Array.isArray(w)?w[R]:w.type,V=A[R];y.concat(R+1).checkSubtype(O,V.type)}if(y.errors.length===0)return new gs(s,u,S,A,v)}}if(p.length===1)i.errors.push(...y.errors);else{const w=(p.length?p:h.map(([A])=>A)).map(Qu).join(" | "),S=[];for(let A=1;A<e.length;A++){const P=i.parse(e[A],1+S.length);if(!P)return null;S.push(mn(P.type))}i.error(`Expected arguments of type ${w}, but found (${S.join(", ")}) instead.`)}return null}static register(e,i){gs.definitions=i;for(const s in i)e[s]=gs}}function Qu(r){return Array.isArray(r)?`(${r.map(mn).join(", ")})`:`(${mn(r.type)}...)`}class Un{constructor(e,i,s){this.type=Wu,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const s=e[1];if(typeof s!="object"||Array.isArray(s))return i.error("Collator options argument must be an object.");const a=s["case-sensitive"]===void 0?i.parse(!1,1,ur):i.parseObjectValue(s["case-sensitive"],1,"case-sensitive",ur);if(!a)return null;const u=s["diacritic-sensitive"]===void 0?i.parse(!1,1,ur):i.parseObjectValue(s["diacritic-sensitive"],1,"diacritic-sensitive",ur);if(!u)return null;let h=null;return s.locale&&(h=i.parseObjectValue(s.locale,1,"locale",Ni),!h)?null:new Un(a,u,h)}evaluate(e){return new $d(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function eh(r,e,i=0,s=r.length-1,a=Xd){for(;s>i;){if(s-i>600){const y=s-i+1,v=e-i+1,w=Math.log(y),S=.5*Math.exp(2*w/3),A=.5*Math.sqrt(w*S*(y-S)/y)*(v-y/2<0?-1:1);eh(r,e,Math.max(i,Math.floor(e-v*S/y+A)),Math.min(s,Math.floor(e+(y-v)*S/y+A)),a)}const u=r[e];let h=i,p=s;for(wo(r,i,e),a(r[s],u)>0&&wo(r,i,s);h<p;){for(wo(r,h,p),h++,p--;a(r[h],u)<0;)h++;for(;a(r[p],u)>0;)p--}a(r[i],u)===0?wo(r,i,p):(p++,wo(r,p,s)),p<=e&&(i=p+1),e<=p&&(s=p-1)}}function wo(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function Xd(r,e){return r<e?-1:r>e?1:0}function za(r){let e=0;for(let i,s,a=0,u=r.length,h=u-1;a<u;h=a++)i=r[a],s=r[h],e+=(s.x-i.x)*(i.y+s.y);return e}function io(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function qc(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function ry(r,e,i){const s=r[0]-e[0],a=r[1]-e[1],u=r[0]-i[0],h=r[1]-i[1];return s*h-u*a==0&&s*u<=0&&a*h<=0}function $l(r,e,i=!1){let s=!1;for(let p=0,y=e.length;p<y;p++){const v=e[p];for(let w=0,S=v.length,A=S-1;w<S;A=w++){const P=v[A],R=v[w];if(ry(r,P,R))return i;(u=P)[1]>(a=r)[1]!=(h=R)[1]>a[1]&&a[0]<(h[0]-u[0])*(a[1]-u[1])/(h[1]-u[1])+u[0]&&(s=!s)}}var a,u,h;return s}function $c(r,e,i,s){const a=s[0]-i[0],u=s[1]-i[1],h=(r[0]-i[0])*u-a*(r[1]-i[1]),p=(e[0]-i[0])*u-a*(e[1]-i[1]);return h>0&&p<0||h<0&&p>0}function Wc(r,e,i,s){return(a=[s[0]-i[0],s[1]-i[1]])[0]*(u=[e[0]-r[0],e[1]-r[1]])[1]-a[1]*u[0]!=0&&!(!$c(r,e,i,s)||!$c(i,s,r,e));var a,u}function na(r){const e=new Ye(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new Ye(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const s of r[0])e.x>s.x&&(e.x=s.x),e.y>s.y&&(e.y=s.y),i.x<s.x&&(i.x=s.x),i.y<s.y&&(i.y=s.y);return{min:e,max:i}}const Oa=8192;function ny(r,e){const i=(180+r[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,a=Math.pow(2,e.z);return[Math.round(i*a*Oa),Math.round(s*a*Oa)]}function Kd(r,e){for(let i=0;i<e.length;i++)if($l(r,e[i]))return!0;return!1}function sy(r,e,i){for(const s of i)for(let a=0,u=s.length,h=u-1;a<u;h=a++)if(Wc(r,e,s[h],s[a]))return!0;return!1}function gm(r,e){for(let i=0;i<r.length;++i)if(!$l(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(sy(r[i],r[i+1],e))return!1;return!0}function ym(r,e){for(let i=0;i<e.length;i++)if(gm(r,e[i]))return!0;return!1}function Yd(r,e,i){const s=[];for(let a=0;a<r.length;a++){const u=[];for(let h=0;h<r[a].length;h++){const p=ny(r[a][h],i);io(e,p),u.push(p)}s.push(u)}return s}function ka(r,e,i){const s=[];for(let a=0;a<r.length;a++){const u=Yd(r[a],e,i);s.push(u)}return s}function xm(r,e,i,s){if(r[0]<i[0]||r[0]>i[2]){const a=.5*s;let u=r[0]-i[0]>a?-s:i[0]-r[0]>a?s:0;u===0&&(u=r[0]-i[2]>a?-s:i[2]-r[0]>a?s:0),r[0]+=u}io(e,r)}function vm(r,e,i,s){const a=Math.pow(2,s.z)*Oa,u=[s.x*Oa,s.y*Oa],h=[];if(!r)return h;for(const p of r)for(const y of p){const v=[y.x+u[0],y.y+u[1]];xm(v,e,i,a),h.push(v)}return h}function th(r,e,i,s){const a=Math.pow(2,s.z)*Oa,u=[s.x*Oa,s.y*Oa],h=[];if(!r)return h;for(const y of r){const v=[];for(const w of y){const S=[w.x+u[0],w.y+u[1]];io(e,S),v.push(S)}h.push(v)}if(e[2]-e[0]<=a/2){(p=e)[0]=p[1]=1/0,p[2]=p[3]=-1/0;for(const y of h)for(const v of y)xm(v,e,i,a)}var p;return h}class Fa{constructor(e,i){this.type=ur,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Hl(e[1])){const s=e[1];if(s.type==="FeatureCollection")for(let a=0;a<s.features.length;++a){const u=s.features[a].geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new Fa(s,s.features[a].geometry)}else if(s.type==="Feature"){const a=s.geometry.type;if(a==="Polygon"||a==="MultiPolygon")return new Fa(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new Fa(s,s)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,s){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(s.type==="Polygon"){const p=Yd(s.coordinates,u,h),y=vm(i.geometry(),a,u,h);if(!qc(a,u))return!1;for(const v of y)if(!$l(v,p))return!1}if(s.type==="MultiPolygon"){const p=ka(s.coordinates,u,h),y=vm(i.geometry(),a,u,h);if(!qc(a,u))return!1;for(const v of y)if(!Kd(v,p))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,s){const a=[1/0,1/0,-1/0,-1/0],u=[1/0,1/0,-1/0,-1/0],h=i.canonicalID();if(!h)return!1;if(s.type==="Polygon"){const p=Yd(s.coordinates,u,h),y=th(i.geometry(),a,u,h);if(!qc(a,u))return!1;for(const v of y)if(!gm(v,p))return!1}if(s.type==="MultiPolygon"){const p=ka(s.coordinates,u,h),y=th(i.geometry(),a,u,h);if(!qc(a,u))return!1;for(const v of y)if(!ym(v,p))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Zc={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},ro=1/298.257223563,bm=ro*(2-ro),Wl=Math.PI/180;class Zl{static fromTile(e,i,s){const a=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),u=Math.atan(.5*(Math.exp(a)-Math.exp(-a)))/Wl;return new Zl(u,s)}static get units(){return Zc}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!Zc[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(Zc).join(", ")}`);const s=6378.137*Wl*(i?Zc[i]:1),a=Math.cos(e*Wl),u=1/(1-bm*(1-a*a)),h=Math.sqrt(u);this.kx=s*h*a,this.ky=s*h*u*(1-bm)}distance(e,i){const s=Us(e[0]-i[0])*this.kx,a=(e[1]-i[1])*this.ky;return Math.sqrt(s*s+a*a)}bearing(e,i){const s=Us(i[0]-e[0])*this.kx;return Math.atan2(s,(i[1]-e[1])*this.ky)/Wl}destination(e,i,s){const a=s*Wl;return this.offset(e,Math.sin(a)*i,Math.cos(a)*i)}offset(e,i,s){return[e[0]+i/this.kx,e[1]+s/this.ky]}lineDistance(e){let i=0;for(let s=0;s<e.length-1;s++)i+=this.distance(e[s],e[s+1]);return i}area(e){let i=0;for(let s=0;s<e.length;s++){const a=e[s];for(let u=0,h=a.length,p=h-1;u<h;p=u++)i+=Us(a[u][0]-a[p][0])*(a[u][1]+a[p][1])*(s?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let s=0;if(i<=0)return e[0];for(let a=0;a<e.length-1;a++){const u=e[a],h=e[a+1],p=this.distance(u,h);if(s+=p,s>i)return ih(u,h,(i-(s-p))/p)}return e[e.length-1]}pointToSegmentDistance(e,i,s){let[a,u]=i,h=Us(s[0]-a)*this.kx,p=(s[1]-u)*this.ky;if(h!==0||p!==0){const y=(Us(e[0]-a)*this.kx*h+(e[1]-u)*this.ky*p)/(h*h+p*p);y>1?(a=s[0],u=s[1]):y>0&&(a+=h/this.kx*y,u+=p/this.ky*y)}return h=Us(e[0]-a)*this.kx,p=(e[1]-u)*this.ky,Math.sqrt(h*h+p*p)}pointOnLine(e,i){let s=1/0,a=e[0][0],u=e[0][1],h=0,p=0;for(let y=0;y<e.length-1;y++){let v=e[y][0],w=e[y][1],S=Us(e[y+1][0]-v)*this.kx,A=(e[y+1][1]-w)*this.ky,P=0;S===0&&A===0||(P=(Us(i[0]-v)*this.kx*S+(i[1]-w)*this.ky*A)/(S*S+A*A),P>1?(v=e[y+1][0],w=e[y+1][1]):P>0&&(v+=S/this.kx*P,w+=A/this.ky*P)),S=Us(i[0]-v)*this.kx,A=(i[1]-w)*this.ky;const R=S*S+A*A;R<s&&(s=R,a=v,u=w,h=y,p=P)}return{point:[a,u],index:h,t:Math.max(0,Math.min(1,p))}}lineSlice(e,i,s){let a=this.pointOnLine(s,e),u=this.pointOnLine(s,i);if(a.index>u.index||a.index===u.index&&a.t>u.t){const v=a;a=u,u=v}const h=[a.point],p=a.index+1,y=u.index;!Jd(s[p],h[0])&&p<=y&&h.push(s[p]);for(let v=p+1;v<=y;v++)h.push(s[v]);return Jd(s[y],u.point)||h.push(u.point),h}lineSliceAlong(e,i,s){let a=0;const u=[];for(let h=0;h<s.length-1;h++){const p=s[h],y=s[h+1],v=this.distance(p,y);if(a+=v,a>e&&u.length===0&&u.push(ih(p,y,(e-(a-v))/v)),a>=i)return u.push(ih(p,y,(i-(a-v))/v)),u;a>e&&u.push(y)}return u}bufferPoint(e,i){const s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[0]+a,e[1]+s]}bufferBBox(e,i){const s=i/this.ky,a=i/this.kx;return[e[0]-a,e[1]-s,e[2]+a,e[3]+s]}insideBBox(e,i){return Us(e[0]-i[0])>=0&&Us(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Jd(r,e){return r[0]===e[0]&&r[1]===e[1]}function ih(r,e,i){const s=Us(e[0]-r[0]);return[r[0]+s*i,r[1]+(e[1]-r[1])*i]}function Us(r){for(;r<-180;)r+=360;for(;r>180;)r-=360;return r}class rh{constructor(e=[],i=(s,a)=>s<a?-1:s>a?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:s}=this,a=i[e];for(;e>0;){const u=e-1>>1,h=i[u];if(s(a,h)>=0)break;i[e]=h,e=u}i[e]=a}_down(e){const{data:i,compare:s}=this,a=this.length>>1,u=i[e];for(;e<a;){let h=1+(e<<1);const p=h+1;if(p<this.length&&s(i[p],i[h])<0&&(h=p),s(i[h],u)>=0)break;i[e]=i[h],e=h}i[e]=u}}var ut=8192;function Qd(r,e){return e.dist-r.dist}const nh=100,sh=50;function ef(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function Xc(r){return r[1]-r[0]+1}function Vo(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function tf(r,e){if(r[0]>r[1])return[null,null];const i=Xc(r);if(e){if(i===2)return[r,null];const s=Math.floor(i/2);return[[r[0],r[0]+s],[r[0]+s,r[1]]]}{if(i===1)return[r,null];const s=Math.floor(i/2)-1;return[[r[0],r[0]+s],[r[0]+s+1,r[1]]]}}function _l(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!Vo(e,r.length))return i;for(let s=e[0];s<=e[1];++s)io(i,r[s]);return i}function gl(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let s=0;s<r[i].length;++s)io(e,r[i][s]);return e}function Ba(r,e,i){if(ef(r)||ef(e))return NaN;let s=0,a=0;return r[2]<e[0]&&(s=e[0]-r[2]),r[0]>e[2]&&(s=r[0]-e[2]),r[1]>e[3]&&(a=r[1]-e[3]),r[3]<e[1]&&(a=e[1]-r[3]),i.distance([0,0],[s,a])}function oh(r){return 360*r-180}function wm(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function ah(r,e){const i=Math.pow(2,e.z),s=(r.y/ut+e.y)/i;return[oh((r.x/ut+e.x)/i),wm(s)]}function oy(r,e){const i=[];for(let s=0;s<r.length;++s)i.push(ah(r[s],e));return i}function Tm(r,e,i){const s=i.pointOnLine(e,r).point;return i.distance(r,s)}function rf(r,e,i,s,a){const u=i.slice(s[0],s[1]+1);let h=1/0;for(let p=e[0];p<=e[1];++p)if((h=Math.min(h,Tm(r[p],u,a)))===0)return 0;return h}function Na(r,e,i,s,a){const u=Math.min(a.pointToSegmentDistance(r,i,s),a.pointToSegmentDistance(e,i,s)),h=Math.min(a.pointToSegmentDistance(i,r,e),a.pointToSegmentDistance(s,r,e));return Math.min(u,h)}function Ui(r,e,i,s,a){if(!Vo(e,r.length)||!Vo(s,i.length))return NaN;let u=1/0;for(let h=e[0];h<e[1];++h)for(let p=s[0];p<s[1];++p){if(Wc(r[h],r[h+1],i[p],i[p+1]))return 0;u=Math.min(u,Na(r[h],r[h+1],i[p],i[p+1],a))}return u}function ay(r,e,i,s,a){if(!Vo(e,r.length)||!Vo(s,i.length))return NaN;let u=1/0;for(let h=e[0];h<=e[1];++h)for(let p=s[0];p<=s[1];++p)if((u=Math.min(u,a.distance(r[h],i[p])))===0)return u;return u}function ly(r,e,i){if($l(r,e,!0))return 0;let s=1/0;for(const a of e){const u=a.length;if(u<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(a[0]!==a[u-1]&&(s=Math.min(s,i.pointToSegmentDistance(r,a[u-1],a[0])))===0||(s=Math.min(s,Tm(r,a,i)))===0)return s}return s}function cy(r,e,i,s){if(!Vo(e,r.length))return NaN;for(let u=e[0];u<=e[1];++u)if($l(r[u],i,!0))return 0;let a=1/0;for(let u=e[0];u<e[1];++u)for(const h of i)for(let p=0,y=h.length,v=y-1;p<y;v=p++){if(Wc(r[u],r[u+1],h[v],h[p]))return 0;a=Math.min(a,Na(r[u],r[u+1],h[v],h[p],s))}return a}function nf(r,e){for(const i of r)for(let s=0;s<=i.length-1;++s)if($l(i[s],e,!0))return!0;return!1}function uy(r,e,i,s=1/0){const a=gl(r),u=gl(e);if(s!==1/0&&Ba(a,u,i)>=s)return s;if(qc(a,u)){if(nf(r,e))return 0}else if(nf(e,r))return 0;let h=s;for(const p of r)for(let y=0,v=p.length,w=v-1;y<v;w=y++)for(const S of e)for(let A=0,P=S.length,R=P-1;A<P;R=A++){if(Wc(p[w],p[y],S[R],S[A]))return 0;h=Math.min(h,Na(p[w],p[y],S[R],S[A],i))}return h}function Fr(r,e,i,s,a,u,h){if(u===null||h===null)return;const p=Ba(_l(s,u),_l(a,h),i);p<e&&r.push({dist:p,range1:u,range2:h})}function hy(r,e,i,s,a=1/0){let u=Math.min(s.distance(r[0],i[0][0]),a);if(u===0)return u;const h=new rh([{dist:0,range1:[0,r.length-1],range2:[0,0]}],Qd),p=e?sh:nh,y=gl(i);for(;h.length;){const v=h.pop();if(v.dist>=u)continue;const w=v.range1;if(Xc(w)<=p){if(!Vo(w,r.length))return NaN;if(e){const S=cy(r,w,i,s);if((u=Math.min(u,S))===0)return u}else for(let S=w[0];S<=w[1];++S){const A=ly(r[S],i,s);if((u=Math.min(u,A))===0)return u}}else{const S=tf(w,e);if(S[0]!==null){const A=Ba(_l(r,S[0]),y,s);A<u&&h.push({dist:A,range1:S[0],range2:[0,0]})}if(S[1]!==null){const A=Ba(_l(r,S[1]),y,s);A<u&&h.push({dist:A,range1:S[1],range2:[0,0]})}}}return u}function Sm(r,e,i,s,a,u=1/0){let h=Math.min(u,a.distance(r[0],i[0]));if(h===0)return h;const p=new rh([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],Qd),y=e?sh:nh,v=s?sh:nh;for(;p.length;){const w=p.pop();if(w.dist>=h)continue;const S=w.range1,A=w.range2;if(Xc(S)<=y&&Xc(A)<=v){if(!Vo(S,r.length)||!Vo(A,i.length))return NaN;if(e&&s?h=Math.min(h,Ui(r,S,i,A,a)):e||s?e&&!s?h=Math.min(h,rf(i,A,r,S,a)):!e&&s&&(h=Math.min(h,rf(r,S,i,A,a))):h=Math.min(h,ay(r,S,i,A,a)),h===0)return h}else{const P=tf(S,e),R=tf(A,s);Fr(p,h,a,r,i,P[0],R[0]),Fr(p,h,a,r,i,P[0],R[1]),Fr(p,h,a,r,i,P[1],R[0]),Fr(p,h,a,r,i,P[1],R[1])}}return h}function sf(r,e,i,s,a=1/0){let u=a;const h=_l(r,[0,r.length-1]);for(const p of i)if(!(u!==1/0&&Ba(h,_l(p,[0,p.length-1]),s)>=u)&&(u=Math.min(u,Sm(r,e,p,!0,s,u)),u===0))return u;return u}function lh(r,e,i,s,a=1/0){let u=a;const h=_l(r,[0,r.length-1]);for(const p of i){if(u!==1/0&&Ba(h,gl(p),s)>=u)continue;const y=hy(r,e,p,s,u);if(isNaN(y))return y;if((u=Math.min(u,y))===0)return u}return u}function of(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class yl{constructor(e,i){this.type=Ut,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Hl(e[1])){const s=e[1];if(s.type==="FeatureCollection"){for(let a=0;a<s.features.length;++a)if(of(s.features[a].geometry.type))return new yl(s,s.features[a].geometry)}else if(s.type==="Feature"){if(of(s.geometry.type))return new yl(s,s.geometry)}else if(of(s.type))return new yl(s,s)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),s=e.canonicalID();if(i!=null&&s!=null){if(e.geometryType()==="Point")return function(a,u,h){const p=[];for(const v of a)for(const w of v)p.push(ah(w,u));const y=new Zl(p[0][1],"meters");return h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString"?Sm(p,!1,h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",y):h.type==="MultiLineString"?sf(p,!1,h.coordinates,y):h.type==="Polygon"||h.type==="MultiPolygon"?lh(p,!1,h.type==="Polygon"?[h.coordinates]:h.coordinates,y):null}(i,s,this.geometries);if(e.geometryType()==="LineString")return function(a,u,h){const p=[];for(const v of a){const w=[];for(const S of v)w.push(ah(S,u));p.push(w)}const y=new Zl(p[0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return sf(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,y);if(h.type==="MultiLineString"){let v=1/0;for(let w=0;w<h.coordinates.length;w++){const S=sf(h.coordinates[w],!0,p,y,v);if(isNaN(S))return S;if((v=Math.min(v,S))===0)return v}return v}if(h.type==="Polygon"||h.type==="MultiPolygon"){let v=1/0;for(let w=0;w<p.length;w++){const S=lh(p[w],!0,h.type==="Polygon"?[h.coordinates]:h.coordinates,y,v);if(isNaN(S))return S;if((v=Math.min(v,S))===0)return v}return v}return null}(i,s,this.geometries);if(e.geometryType()==="Polygon")return function(a,u,h){const p=[];for(const v of function(w,S){const A=w.length;if(A<=1)return[w];const P=[];let R,O;for(let V=0;V<A;V++){const N=za(w[V]);N!==0&&(w[V].area=Math.abs(N),O===void 0&&(O=N<0),O===N<0?(R&&P.push(R),R=[w[V]]):R.push(w[V]))}return R&&P.push(R),P}(a)){const w=[];for(let S=0;S<v.length;++S)w.push(oy(v[S],u));p.push(w)}const y=new Zl(p[0][0][0][1],"meters");if(h.type==="Point"||h.type==="MultiPoint"||h.type==="LineString")return lh(h.type==="Point"?[h.coordinates]:h.coordinates,h.type==="LineString",p,y);if(h.type==="MultiLineString"){let v=1/0;for(let w=0;w<h.coordinates.length;w++){const S=lh(h.coordinates[w],!0,p,y,v);if(isNaN(S))return S;if((v=Math.min(v,S))===0)return v}return v}return h.type==="Polygon"||h.type==="MultiPolygon"?function(v,w,S){let A=1/0;for(const P of v)for(const R of w){const O=uy(P,R,S,A);if(isNaN(O))return O;if((A=Math.min(A,O))===0)return A}return A}(h.type==="Polygon"?[h.coordinates]:h.coordinates,p,y):null}(i,s,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Xl(r){if(r instanceof gs&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof Fa||r instanceof yl)return!1;if(r instanceof Yl)return r.featureConstant;let e=!0;return r.eachChild(i=>{e&&!Xl(i)&&(e=!1)}),e}function Kc(r){if(r instanceof gs&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Kc(i)&&(e=!1)}),e}function Kl(r,e){if(r instanceof gs&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(s=>{i&&!Kl(s,e)&&(i=!1)}),i}function Em(r,e,i){return[r,e,i].filter(Boolean).join("")}function af(r,e){switch(r){case"string":return to(e);case"number":return+e;case"boolean":return!!e;case"color":return or.parse(e);case"formatted":return ms.fromString(to(e));case"resolvedImage":return _s.build(to(e))}return e}function Am(r,e,i,s){return s!==void 0&&(r=s*Math.round(r/s)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}class Yl{constructor(e,i,s,a=!1){this.type=e,this.key=i,this.scope=s,this.featureConstant=a}static parse(e,i){let s=i.expectedType;if(s==null&&(s=nr),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const a=i.parse(e[1],1);if(!(a instanceof ra))return i.error("Key name of 'config' expression must be a string literal.");let u,h=!0;const p=to(a.value);if(e.length>=3){const y=i.parse(e[2],2);if(!(y instanceof ra))return i.error("Scope of 'config' expression must be a string literal.");u=to(y.value)}if(i.options){const y=Em(p,u,i._scope),v=i.options.get(y);v&&(h=Xl(v.value||v.default))}return new Yl(s,p,u,h)}evaluate(e){const i=Em(this.key,this.scope,e.scope),s=e.getConfig(i);if(!s)return null;const{type:a,value:u,values:h,minValue:p,maxValue:y,stepValue:v}=s,w=s.default.evaluate(e);let S=w;if(u){const A=e.scope;e.scope=(A||"").split("").slice(1).join(""),S=u.evaluate(e),e.scope=A}return a&&(S=af(a,S)),S===void 0||p===void 0&&y===void 0&&v===void 0||(typeof S=="number"?S=Am(S,p,y,v):Array.isArray(S)&&(S=S.map(A=>typeof A=="number"?Am(A,p,y,v):A))),u!==void 0&&S!==void 0&&h&&!h.includes(S)&&(S=w,a&&(S=af(a,S))),(a&&a!==this.type||S!==void 0&&!Zu(zn(S),this.type))&&(S=af(this.type.kind,S)),S}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class ch{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const s=e[1];return i.scope.has(s)?new ch(s,i.scope.get(s)):i.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class uh{constructor(e,i=[],s,a=new Gl,u=[],h,p,y){this.registry=e,this.path=i,this.key=i.map(v=>typeof v=="string"?`['${v}']`:`[${v}]`).join(""),this.scope=a,this.errors=u,this.expectedType=s,this._scope=h,this.options=p,this.iconImageUseTheme=y}parse(e,i,s,a,u={}){return i||s?this.concat(i,null,s,a)._parse(e,u):this._parse(e,u)}parseObjectValue(e,i,s,a,u,h={}){return this.concat(i,s,a,u)._parse(e,h)}_parse(e,i){function s(a,u,h){return h==="assert"?new bo(u,[a]):h==="coerce"?new No(u,[a]):a}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const a=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(a){let u=a.parse(e,this);if(!u)return null;if(this.expectedType){const h=this.expectedType,p=u.type;if(h.kind!=="string"&&h.kind!=="number"&&h.kind!=="boolean"&&h.kind!=="object"&&h.kind!=="array"||p.kind!=="value")if(h.kind!=="color"&&h.kind!=="formatted"&&h.kind!=="resolvedImage"||p.kind!=="value"&&p.kind!=="string"){if(this.checkSubtype(h,p))return null}else u=s(u,h,i.typeAnnotation||"coerce");else u=s(u,h,i.typeAnnotation||"assert")}if(!(u instanceof ra)&&u.type.kind!=="resolvedImage"&&lf(u)){const h=new Ju(this._scope,this.options,this.iconImageUseTheme);try{u=new ra(u.type,u.evaluate(h))}catch(p){return this.error(p.message),null}}return u}return No.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,s,a){let u=typeof e=="number"?this.path.concat(e):this.path;u=typeof i=="string"?u.concat(i):u;const h=a?this.scope.concat(a):this.scope;return new uh(this.registry,u,s||null,h,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const s=`${this.key}${i.map(a=>`[${a}]`).join("")}`;this.errors.push(new eo(s,e))}checkSubtype(e,i){const s=La(e,i);return s&&this.error(s),s}}function lf(r){if(r instanceof ch)return lf(r.boundExpression);if(r instanceof gs&&r.name==="error"||r instanceof Un||r instanceof Fa||r instanceof yl||r instanceof Yl)return!1;const e=r instanceof No||r instanceof bo;let i=!0;return r.eachChild(s=>{i=e?i&&lf(s):i&&s instanceof ra}),!!i&&Xl(r)&&Kl(r,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function hh(r,e){const i=r.length-1;let s,a,u=0,h=i,p=0;for(;u<=h;)if(p=Math.floor((u+h)/2),s=r[p],a=r[p+1],s<=e){if(p===i||e<a)return p;u=p+1}else{if(!(s>e))throw new Cn("Input is not a number.");h=p-1}return 0}class Yc{constructor(e,i,s){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[a,u]of s)this.labels.push(a),this.outputs.push(u)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const s=i.parse(e[1],1,Ut);if(!s)return null;const a=[];let u=null;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);for(let h=1;h<e.length;h+=2){const p=h===1?-1/0:e[h],y=e[h+1],v=h,w=h+1;if(typeof p!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(a.length&&a[a.length-1][0]>=p)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',v);const S=i.parse(y,w,u);if(!S)return null;u=u||S.type,a.push([p,S])}return new Yc(u,s,a)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);const u=i.length;return a>=i[u-1]?s[u-1].evaluate(e):s[hh(i,a)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const Im=.95047,Cm=1.08883,Pm=4/29,Jl=6/29,Mm=3*Jl*Jl,dy=Jl*Jl*Jl,fy=Math.PI/180,py=180/Math.PI;function cf(r){return r>dy?Math.pow(r,1/3):r/Mm+Pm}function uf(r){return r>Jl?r*r*r:Mm*(r-Pm)}function hf(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function df(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Rm(r){const e=df(r.r),i=df(r.g),s=df(r.b),a=cf((.4124564*e+.3575761*i+.1804375*s)/Im),u=cf((.2126729*e+.7151522*i+.072175*s)/1);return{l:116*u-16,a:500*(a-u),b:200*(u-cf((.0193339*e+.119192*i+.9503041*s)/Cm)),alpha:r.a}}function dh(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,s=isNaN(r.b)?e:e-r.b/200;return e=1*uf(e),i=Im*uf(i),s=Cm*uf(s),new or(hf(3.2404542*i-1.5371385*e-.4985314*s),hf(-.969266*i+1.8760108*e+.041556*s),hf(.0556434*i-.2040259*e+1.0572252*s),r.alpha)}function fh(r,e,i){const s=e-r;return r+i*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ql={forward:Rm,reverse:dh,interpolate:function(r,e,i){return{l:ii(r.l,e.l,i),a:ii(r.a,e.a,i),b:ii(r.b,e.b,i),alpha:ii(r.alpha,e.alpha,i)}}},Jc={forward:function(r){const{l:e,a:i,b:s}=Rm(r),a=Math.atan2(s,i)*py;return{h:a<0?a+360:a,c:Math.sqrt(i*i+s*s),l:e,alpha:r.a}},reverse:function(r){const e=r.h*fy,i=r.c;return dh({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:fh(r.h,e.h,i),c:ii(r.c,e.c,i),l:ii(r.l,e.l,i),alpha:ii(r.alpha,e.alpha,i)}}};var Dm=Object.freeze({__proto__:null,hcl:Jc,lab:Ql});class js{constructor(e,i,s,a,u){this.type=e,this.operator=i,this.interpolation=s,this.input=a,this.labels=[],this.outputs=[];for(const[h,p]of u)this.labels.push(h),this.outputs.push(p)}static interpolationFactor(e,i,s,a){let u=0;if(e.name==="exponential")u=ph(i,e.base,s,a);else if(e.name==="linear")u=ph(i,1,s,a);else if(e.name==="cubic-bezier"){const h=e.controlPoints;u=new Fu(h[0],h[1],h[2],h[3]).solve(ph(i,1,s,a))}return u}static parse(e,i){let[s,a,u,...h]=e;if(!Array.isArray(a)||a.length===0)return i.error("Expected an interpolation type expression.",1);if(a[0]==="linear")a={name:"linear"};else if(a[0]==="exponential"){const v=a[1];if(typeof v!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:v}}else{if(a[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(a[0])}`,1,0);{const v=a.slice(1);if(v.length!==4||v.some(w=>typeof w!="number"||w<0||w>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:v}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(u=i.parse(u,2,Ut),!u)return null;const p=[];let y=null;s==="interpolate-hcl"||s==="interpolate-lab"?y=Ss:i.expectedType&&i.expectedType.kind!=="value"&&(y=i.expectedType);for(let v=0;v<h.length;v+=2){const w=h[v],S=h[v+1],A=v+3,P=v+4;if(typeof w!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(p.length&&p[p.length-1][0]>=w)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',A);const R=i.parse(S,P,y);if(!R)return null;y=y||R.type,p.push([w,R])}return y.kind==="number"||y.kind==="color"||y.kind==="array"&&y.itemType.kind==="number"&&typeof y.N=="number"?new js(y,s,a,u,p):i.error(`Type ${mn(y)} is not interpolatable.`)}evaluate(e){const i=this.labels,s=this.outputs;if(i.length===1)return s[0].evaluate(e);const a=this.input.evaluate(e);if(a<=i[0])return s[0].evaluate(e);const u=i.length;if(a>=i[u-1])return s[u-1].evaluate(e);const h=hh(i,a),p=js.interpolationFactor(this.interpolation,a,i[h],i[h+1]),y=s[h].evaluate(e),v=s[h+1].evaluate(e);return this.operator==="interpolate"?Uc[this.type.kind.toLowerCase()](y,v,p):this.operator==="interpolate-hcl"?Jc.reverse(Jc.interpolate(Jc.forward(y),Jc.forward(v),p)):Ql.reverse(Ql.interpolate(Ql.forward(y),Ql.forward(v),p))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)i.push(this.labels[s],this.outputs[s].serialize());return i}}function ph(r,e,i,s){const a=s-i,u=r-i;return a===0?0:e===1?u/a:(Math.pow(e,u)-1)/(Math.pow(e,a)-1)}class Qc{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let s=null;const a=i.expectedType;a&&a.kind!=="value"&&(s=a);const u=[];for(const p of e.slice(1)){const y=i.parse(p,1+u.length,s,void 0,{typeAnnotation:"omit"});if(!y)return null;s=s||y.type,u.push(y)}const h=a&&u.some(p=>La(a,p.type));return new Qc(h?nr:s,u)}evaluate(e){let i,s=null,a=0;for(const u of this.args){if(a++,s=u.evaluate(e),s&&s instanceof _s&&!s.available&&(i||(i=s),s=null,a===this.args.length))return i;if(s!==null)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class sa{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let u=1;u<e.length-1;u+=2){const h=e[u];if(typeof h!="string")return i.error(`Expected string, but found ${typeof h} instead.`,u);if(/[^a-zA-Z0-9_]/.test(h))return i.error("Variable names must contain only alphanumeric characters or '_'.",u);const p=i.parse(e[u+1],u+1);if(!p)return null;s.push([h,p])}const a=i.parse(e[e.length-1],e.length-1,i.expectedType,s);return a?new sa(s,a):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,s]of this.bindings)e.push(i,s.serialize());return e.push(this.result.serialize()),e}}class mh{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ut),a=i.parse(e[2],2,rs(i.expectedType||nr));return s&&a?new mh(a.type.itemType,s,a):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Cn("Array index out of bounds: negative index");if(i>=s.length)throw new Cn("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Cn("Array index must be an integer. Use at-interpolated for fractional indices");return s[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class _h{constructor(e,i,s){this.type=e,this.index=i,this.input=s}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ut),a=i.parse(e[2],2,rs(i.expectedType||nr));return s&&a?new _h(a.type.itemType,s,a):null}evaluate(e){const i=this.index.evaluate(e),s=this.input.evaluate(e);if(i<0)throw new Cn(`Array index out of bounds: ${i} < 0.`);if(i>s.length-1)throw new Cn(`Array index out of bounds: ${i} > ${s.length-1}.`);if(i===Math.floor(i))return s[i];const a=Math.floor(i),u=Math.ceil(i),h=s[a],p=s[u];if(typeof h!="number"||typeof p!="number")throw new Cn(`Cannot interpolate between non-number values at index ${i}.`);const y=i-a;return h*(1-y)+p*y}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ff{constructor(e,i){this.type=ur,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,nr),a=i.parse(e[2],2,nr);return s&&a?qd(s.type,[ur,Ni,Ut,vo,nr])?new ff(s,a):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${mn(s.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(s==null)return!1;if(!Hc(i,["boolean","string","number","null"]))throw new Cn(`Expected first argument to be of type boolean, string, number or null, but found ${mn(zn(i))} instead.`);if(!Hc(s,["string","array"]))throw new Cn(`Expected second argument to be of type array or string, but found ${mn(zn(s))} instead.`);return s.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class ec{constructor(e,i,s){this.type=Ut,this.needle=e,this.haystack=i,this.fromIndex=s}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,nr),a=i.parse(e[2],2,nr);if(!s||!a)return null;if(!qd(s.type,[ur,Ni,Ut,vo,nr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${mn(s.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Ut);return u?new ec(s,a,u):null}return new ec(s,a)}evaluate(e){const i=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Hc(i,["boolean","string","number","null"]))throw new Cn(`Expected first argument to be of type boolean, string, number or null, but found ${mn(zn(i))} instead.`);if(!Hc(s,["string","array"]))throw new Cn(`Expected second argument to be of type array or string, but found ${mn(zn(s))} instead.`);if(this.fromIndex){const a=this.fromIndex.evaluate(e);return s.indexOf(i,a)}return s.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class eu{constructor(e,i,s,a,u,h){this.inputType=e,this.type=i,this.input=s,this.cases=a,this.outputs=u,this.otherwise=h}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let s,a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const u={},h=[];for(let v=2;v<e.length-1;v+=2){let w=e[v];const S=e[v+1];Array.isArray(w)||(w=[w]);const A=i.concat(v);if(w.length===0)return A.error("Expected at least one branch label.");for(const R of w){if(typeof R!="number"&&typeof R!="string")return A.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return A.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return A.error("Numeric branch labels must be integer values.");if(s){if(A.checkSubtype(s,zn(R)))return null}else s=zn(R);if(u[String(R)]!==void 0)return A.error("Branch labels must be unique.");u[String(R)]=h.length}const P=i.parse(S,v,a);if(!P)return null;a=a||P.type,h.push(P)}const p=i.parse(e[1],1,nr);if(!p)return null;const y=i.parse(e[e.length-1],e.length-1,a);return y?p.type.kind!=="value"&&i.concat(1).checkSubtype(s,p.type)?null:new eu(s,a,p,u,h,y):null}evaluate(e){const i=this.input.evaluate(e);return(Zu(zn(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),s=[],a={};for(const h of i){const p=a[this.cases[h]];p===void 0?(a[this.cases[h]]=s.length,s.push([this.cases[h],[h]])):s[p][1].push(h)}const u=h=>this.inputType.kind==="number"?Number(h):h;for(const[h,p]of s)e.push(p.length===1?u(p[0]):p.map(u)),e.push(this.outputs[h].serialize());return e.push(this.otherwise.serialize()),e}}class tu{constructor(e,i,s){this.type=e,this.branches=i,this.otherwise=s}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let s;i.expectedType&&i.expectedType.kind!=="value"&&(s=i.expectedType);const a=[];for(let h=1;h<e.length-1;h+=2){const p=i.parse(e[h],h,ur);if(!p)return null;const y=i.parse(e[h+1],h+1,s);if(!y)return null;a.push([p,y]),s=s||y.type}const u=i.parse(e[e.length-1],e.length-1,s);return u?new tu(s,a,u):null}evaluate(e){for(const[i,s]of this.branches)if(i.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,s]of this.branches)e(i),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class gh{constructor(e,i,s,a){this.type=e,this.input=i,this.beginIndex=s,this.endIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,nr),a=i.parse(e[2],2,Ut);if(!s||!a)return null;if(!qd(s.type,[rs(nr),Ni,nr]))return i.error(`Expected first argument to be of type array or string, but found ${mn(s.type)} instead`);if(e.length===4){const u=i.parse(e[3],3,Ut);return u?new gh(s.type,s,a,u):null}return new gh(s.type,s,a)}evaluate(e){const i=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Hc(i,["string","array"]))throw new Cn(`Expected first argument to be of type array or string, but found ${mn(zn(i))} instead.`);if(this.endIndex){const a=this.endIndex.evaluate(e);return i.slice(s,a)}return i.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class pf{constructor(e,i){this.type=rs(Ni),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=i.parse(e[1],1,Ni),a=i.parse(e[2],2,Ni);return s&&a?new pf(s,a):void 0}evaluate(e){const i=this.str.evaluate(e),s=this.delimiter.evaluate(e);return i.split(s)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function mf(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function _f(r,e,i,s){return s.compare(e,i)===0}function tc(r,e,i){const s=r!=="=="&&r!=="!=";return class CE{constructor(u,h,p){this.type=ur,this.lhs=u,this.rhs=h,this.collator=p,this.hasUntypedArgument=u.type.kind==="value"||h.type.kind==="value"}static parse(u,h){if(u.length!==3&&u.length!==4)return h.error("Expected two or three arguments.");const p=u[0];let y=h.parse(u[1],1,nr);if(!y)return null;if(!mf(p,y.type))return h.concat(1).error(`"${p}" comparisons are not supported for type '${mn(y.type)}'.`);let v=h.parse(u[2],2,nr);if(!v)return null;if(!mf(p,v.type))return h.concat(2).error(`"${p}" comparisons are not supported for type '${mn(v.type)}'.`);if(y.type.kind!==v.type.kind&&y.type.kind!=="value"&&v.type.kind!=="value")return h.error(`Cannot compare types '${mn(y.type)}' and '${mn(v.type)}'.`);s&&(y.type.kind==="value"&&v.type.kind!=="value"?y=new bo(v.type,[y]):y.type.kind!=="value"&&v.type.kind==="value"&&(v=new bo(y.type,[v])));let w=null;if(u.length===4){if(y.type.kind!=="string"&&v.type.kind!=="string"&&y.type.kind!=="value"&&v.type.kind!=="value")return h.error("Cannot use collator to compare non-string types.");if(w=h.parse(u[3],3,Wu),!w)return null}return new CE(y,v,w)}evaluate(u){const h=this.lhs.evaluate(u),p=this.rhs.evaluate(u);if(s&&this.hasUntypedArgument){const y=zn(h),v=zn(p);if(y.kind!==v.kind||y.kind!=="string"&&y.kind!=="number")throw new Cn(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${y.kind}, ${v.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const y=zn(h),v=zn(p);if(y.kind!=="string"||v.kind!=="string")return e(u,h,p)}return this.collator?i(u,h,p,this.collator.evaluate(u)):e(u,h,p)}eachChild(u){u(this.lhs),u(this.rhs),this.collator&&u(this.collator)}outputDefined(){return!0}serialize(){const u=[r];return this.eachChild(h=>{u.push(h.serialize())}),u}}}const my=tc("==",function(r,e,i){return e===i},_f),_y=tc("!=",function(r,e,i){return e!==i},function(r,e,i,s){return!_f(0,e,i,s)}),Lm=tc("<",function(r,e,i){return e<i},function(r,e,i,s){return s.compare(e,i)<0}),zm=tc(">",function(r,e,i){return e>i},function(r,e,i,s){return s.compare(e,i)>0}),yh=tc("<=",function(r,e,i){return e<=i},function(r,e,i,s){return s.compare(e,i)<=0}),gy=tc(">=",function(r,e,i){return e>=i},function(r,e,i,s){return s.compare(e,i)>=0});class xh{constructor(e,i,s,a,u,h){this.type=Ni,this.number=e,this.locale=i,this.currency=s,this.unit=a,this.minFractionDigits=u,this.maxFractionDigits=h}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const s=i.parse(e[1],1,Ut);if(!s)return null;const a=e[2];if(typeof a!="object"||Array.isArray(a))return i.error("NumberFormat options argument must be an object.");let u=null;if(a.locale&&(u=i.parseObjectValue(a.locale,2,"locale",Ni),!u))return null;let h=null;if(a.currency&&(h=i.parseObjectValue(a.currency,2,"currency",Ni),!h))return null;let p=null;if(a.unit&&(p=i.parseObjectValue(a.unit,2,"unit",Ni),!p))return null;let y=null;if(a["min-fraction-digits"]&&(y=i.parseObjectValue(a["min-fraction-digits"],2,"min-fraction-digits",Ut),!y))return null;let v=null;return a["max-fraction-digits"]&&(v=i.parseObjectValue(a["max-fraction-digits"],2,"max-fraction-digits",Ut),!v)?null:new xh(s,u,h,p,y,v)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gf{constructor(e){this.type=Ut,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=i.parse(e[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${mn(s.type)} instead.`):new gf(s):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Cn(`Expected value to be of type string or array, but found ${mn(zn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function Om(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const ic={"==":my,"!=":_y,">":zm,"<":Lm,">=":gy,"<=":yh,array:bo,at:mh,"at-interpolated":_h,boolean:bo,case:tu,coalesce:Qc,collator:Un,format:Bo,image:gi,in:ff,"index-of":ec,interpolate:js,"interpolate-hcl":js,"interpolate-lab":js,length:gf,let:sa,literal:ra,match:eu,number:bo,"number-format":xh,object:bo,slice:gh,step:Yc,string:bo,"to-boolean":No,"to-color":No,"to-number":No,"to-string":No,var:ch,within:Fa,distance:yl,config:Yl,split:pf};function yf(r,[e,i,s,a]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const u=a?a.evaluate(r):1,h=ml(e,i,s,u);if(h)throw new Cn(h);return new or(e/255,i/255,s/255,u)}function xf(r,[e,i,s,a]){e=e.evaluate(r),i=i.evaluate(r),s=s.evaluate(r);const u=a?a.evaluate(r):1,h=function(v,w,S,A){return typeof v=="number"&&v>=0&&v<=360?typeof w=="number"&&w>=0&&w<=100&&typeof S=="number"&&S>=0&&S<=100?A===void 0||typeof A=="number"&&A>=0&&A<=1?null:`Invalid hsla value [${[v,w,S,A].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof A=="number"?[v,w,S,A]:[v,w,S]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof A=="number"?[v,w,S,A]:[v,w,S]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,s,u);if(h)throw new Cn(h);const p=`hsla(${e}, ${i}%, ${s}%, ${u})`,y=or.parse(p);if(!y)throw new Cn(`Failed to parse HSLA color: ${p}`);return y}function km(r,e){return r in e}function vf(r,e){const i=e[r];return i===void 0?null:i}function Va(r){return{type:r}}function xl(r){if(r instanceof Yl)return new Set([r.key]);let e=new Set;return r.eachChild(i=>{e=new Set([...e,...xl(i)])}),e}function vh(r){if(r instanceof gs&&r.name==="is-active-floor")return!0;let e=!1;return r.eachChild(i=>{!e&&vh(i)&&(e=!0)}),e}function Fm(r){return{result:"success",value:r}}function Ua(r){return{result:"error",value:r}}function bf(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function iu(r){return r["property-type"]==="data-driven"}function Bm(r){return bf(r.expression,"measure-light")}function Nm(r){return bf(r.expression,"zoom")}function bh(r){return!!r.expression&&r.expression.interpolated}function wh(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function Vm(r){return r}function Um(r,e){const i=e.type==="color",s=r.stops&&typeof r.stops[0][0]=="object",a=s||!(s||r.property!==void 0),u=r.type||(bh(e)?"exponential":"interval");if(i&&((r=Object.assign({},r)).stops&&(r.stops=r.stops.map(v=>[v[0],or.parse(v[1])])),r.default=or.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Dm[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let h,p,y;if(u==="exponential")h=jm;else if(u==="interval")h=xy;else if(u==="categorical"){h=yy,p=Object.create(null);for(const v of r.stops)p[v[0]]=v[1];y=typeof r.stops[0][0]}else{if(u!=="identity")throw new Error(`Unknown function type "${u}"`);h=Gm}if(s){const v={},w=[];for(let P=0;P<r.stops.length;P++){const R=r.stops[P],O=R[0].zoom;v[O]===void 0&&(v[O]={zoom:O,type:r.type,property:r.property,default:r.default,stops:[]},w.push(O)),v[O].stops.push([R[0].value,R[1]])}const S=[];for(const P of w)S.push([v[P].zoom,Um(v[P],e)]);const A={name:"linear"};return{kind:"composite",interpolationType:A,interpolationFactor:js.interpolationFactor.bind(void 0,A),zoomStops:S.map(P=>P[0]),evaluate:({zoom:P},R)=>jm({stops:S,base:r.base},e,P).evaluate(P,R)}}if(a){const v=u==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:v,interpolationFactor:js.interpolationFactor.bind(void 0,v),zoomStops:r.stops.map(w=>w[0]),evaluate:({zoom:w})=>h(r,e,w,p,y)}}return{kind:"source",evaluate(v,w){const S=w&&w.properties?w.properties[r.property]:void 0;return S===void 0?Uo(r.default,e.default):h(r,e,S,p,y)}}}function Uo(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function yy(r,e,i,s,a){return Uo(typeof i===a?s[i]:void 0,r.default,e.default)}function xy(r,e,i){if(!ql(i))return Uo(r.default,e.default);const s=r.stops.length;if(s===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[s-1][0])return r.stops[s-1][1];const a=hh(r.stops.map(u=>u[0]),i);return r.stops[a][1]}function jm(r,e,i){const s=r.base!==void 0?r.base:1;if(!ql(i))return Uo(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const u=hh(r.stops.map(w=>w[0]),i),h=function(w,S,A,P){const R=P-A,O=w-A;return R===0?0:S===1?O/R:(Math.pow(S,O)-1)/(Math.pow(S,R)-1)}(i,s,r.stops[u][0],r.stops[u+1][0]),p=r.stops[u][1],y=r.stops[u+1][1];let v=Uc[e.type]||Vm;if(r.colorSpace&&r.colorSpace!=="rgb"){const w=Dm[r.colorSpace];v=(S,A)=>w.reverse(w.interpolate(w.forward(S),w.forward(A),h))}return typeof p.evaluate=="function"?{evaluate(...w){const S=p.evaluate.apply(void 0,w),A=y.evaluate.apply(void 0,w);if(S!==void 0&&A!==void 0)return v(S,A,h)}}:v(p,y,h)}function Gm(r,e,i){return e.type==="color"?i=or.parse(i):e.type==="formatted"?i=ms.fromString(i.toString()):e.type==="resolvedImage"?i=_s.build(i.toString()):Bt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),Uo(i,r.default,e.default)}gs.register(ic,{error:[{kind:"error"},[Ni],(r,[e])=>{throw new Cn(e.evaluate(r))}],typeof:[Ni,[nr],(r,[e])=>mn(zn(e.evaluate(r)))],"to-rgba":[rs(Ut,4),[Ss],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[rs(Ut,4),[Ss],(r,[e])=>e.evaluate(r).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Ss,[Ut,Ut,Ut],yf],rgba:[Ss,[Ut,Ut,Ut,Ut],yf],hsl:[Ss,[Ut,Ut,Ut],xf],hsla:[Ss,[Ut,Ut,Ut,Ut],xf],has:{type:ur,overloads:[[[Ni],(r,[e])=>km(e.evaluate(r),r.properties())],[[Ni,Fo],(r,[e,i])=>km(e.evaluate(r),i.evaluate(r))]]},get:{type:nr,overloads:[[[Ni],(r,[e])=>vf(e.evaluate(r),r.properties())],[[Ni,Fo],(r,[e,i])=>vf(e.evaluate(r),i.evaluate(r))]]},"feature-state":[nr,[Ni],(r,[e])=>vf(e.evaluate(r),r.featureState||{})],properties:[Fo,[],r=>r.properties()],"geometry-type":[Ni,[],r=>r.geometryType()],worldview:[Ni,[],r=>r.globals.worldview||""],"is-active-floor":[ur,Va(Ni),(r,e)=>{if(!(r.globals.activeFloors&&r.globals.activeFloors.size>0))return!1;const i=r.globals.activeFloors;return e.some(s=>{const a=s.evaluate(r);return i.has(a)})}],id:[nr,[],r=>r.id()],zoom:[Ut,[],r=>r.globals.zoom],pitch:[Ut,[],r=>r.globals.pitch||0],"distance-from-center":[Ut,[],r=>r.distanceFromCenter()],"measure-light":[Ut,[Ni],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[Ut,[],r=>r.globals.heatmapDensity||0],"line-progress":[Ut,[],r=>r.globals.lineProgress||0],"raster-value":[Ut,[],r=>r.globals.rasterValue||0],"raster-particle-speed":[Ut,[],r=>r.globals.rasterParticleSpeed||0],"sky-radial-progress":[Ut,[],r=>r.globals.skyRadialProgress||0],accumulated:[nr,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Ut,Va(Ut),(r,e)=>{let i=0;for(const s of e)i+=s.evaluate(r);return i}],"*":[Ut,Va(Ut),(r,e)=>{let i=1;for(const s of e)i*=s.evaluate(r);return i}],"-":{type:Ut,overloads:[[[Ut,Ut],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Ut],(r,[e])=>-e.evaluate(r)]]},"/":[Ut,[Ut,Ut],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Ut,[Ut,Ut],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Ut,[],()=>Math.LN2],pi:[Ut,[],()=>Math.PI],e:[Ut,[],()=>Math.E],"^":[Ut,[Ut,Ut],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Ut,[Ut],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Ut,[Ut],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Ut,[Ut],(r,[e])=>Math.log(e.evaluate(r))],log2:[Ut,[Ut],(r,[e])=>Math.log2(e.evaluate(r))],sin:[Ut,[Ut],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Ut,[Ut],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Ut,[Ut],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Ut,[Ut],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Ut,[Ut],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Ut,[Ut],(r,[e])=>Math.atan(e.evaluate(r))],min:[Ut,Va(Ut),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Ut,Va(Ut),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Ut,[Ut],(r,[e])=>Math.abs(e.evaluate(r))],round:[Ut,[Ut],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Ut,[Ut],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Ut,[Ut],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ur,[Ni,nr],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[ur,[nr],(r,[e])=>r.id()===e.value],"filter-type-==":[ur,[Ni],(r,[e])=>r.geometryType()===e.value],"filter-<":[ur,[Ni,nr],(r,[e,i])=>{const s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s<a}],"filter-id-<":[ur,[nr],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<s}],"filter->":[ur,[Ni,nr],(r,[e,i])=>{const s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s>a}],"filter-id->":[ur,[nr],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>s}],"filter-<=":[ur,[Ni,nr],(r,[e,i])=>{const s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s<=a}],"filter-id-<=":[ur,[nr],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i<=s}],"filter->=":[ur,[Ni,nr],(r,[e,i])=>{const s=r.properties()[e.value],a=i.value;return typeof s==typeof a&&s>=a}],"filter-id->=":[ur,[nr],(r,[e])=>{const i=r.id(),s=e.value;return typeof i==typeof s&&i>=s}],"filter-has":[ur,[nr],(r,[e])=>e.value in r.properties()],"filter-has-id":[ur,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ur,[rs(Ni)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ur,[rs(nr)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ur,[Ni,rs(nr)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ur,[Ni,rs(nr)],(r,[e,i])=>function(s,a,u,h){for(;u<=h;){const p=u+h>>1;if(a[p]===s)return!0;a[p]>s?h=p-1:u=p+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ur,overloads:[[[ur,ur],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[Va(ur),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:ur,overloads:[[[ur,ur],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[Va(ur),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[ur,[ur],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ur,[Ni],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Ni,[Ni],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Ni,[Ni],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Ni,Va(nr),(r,e)=>e.map(i=>to(i.evaluate(r))).join("")],"resolved-locale":[Ni,[Wu],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[Ut,[Ut,Ut,nr],(r,e)=>{const[i,s,a]=e.map(h=>h.evaluate(r));if(i>s||i===s)return i;let u;if(typeof a=="string")u=function(h){let p=0;if(h.length===0)return p;for(let y=0;y<h.length;y++)p=(p<<5)-p+h.charCodeAt(y),p|=0;return p}(a);else{if(typeof a!="number")throw new Cn(`Invalid seed input: ${a}`);u=a}return i+Om(u)()*(s-i)}]});class Th{constructor(e,i,s,a,u){this.expression=e,this._warningHistory={},this._scope=s,this._options=a,this._iconImageUseTheme=u,this._evaluator=new Ju(s,a,u),this._defaultValue=i?function(h){return h.type==="color"&&(wh(h.default)||Array.isArray(h.default))?new or(0,0,0,0):h.type==="color"?or.parse(h.default)||null:h.default===void 0?null:h.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=xl(e),this.isIndoorDependent=vh(e)}evaluateWithoutErrorHandling(e,i,s,a,u,h,p,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=s,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=y||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,s,a,u,h,p,y,v){this._evaluator||(this._evaluator=new Ju(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=s||null,this._evaluator.canonical=a||null,this._evaluator.availableImages=u||null,this._evaluator.formattedSection=h||null,this._evaluator.featureTileCoord=p||null,this._evaluator.featureDistanceData=y||null,this._evaluator.iconImageUseTheme=v||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Cn(`Expected value to be one of ${Object.keys(this._enumValues).map(S=>JSON.stringify(S)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){const S=w;return this._warningHistory[S.message]||(this._warningHistory[S.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${S.message}`)),this._defaultValue}}}function ru(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in ic}function ja(r,e,i,s,a){const u=new uh(ic,[],e?function(p){const y={color:Ss,string:Ni,number:Ut,enum:Ni,boolean:ur,formatted:jc,resolvedImage:Gc};return p.type==="array"?rs(y[p.value]||nr,p.length):y[p.type]}(e):void 0,void 0,void 0,i,s,a),h=u.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return h?Fm(new Th(h,e,i,s,a)):Ua(u.errors)}class rc{constructor(e,i,s,a){this.kind=e,this._styleExpression=i,this.isLightConstant=s,this.isLineProgressConstant=a,this.isStateDependent=e!=="constant"&&!Kc(i.expression),this.configDependencies=xl(i.expression),this.isIndoorDependent=vh(i.expression)}evaluateWithoutErrorHandling(e,i,s,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,u,h)}evaluate(e,i,s,a,u,h,p){return this._styleExpression.evaluate(e,i,s,a,u,h,void 0,void 0,p)}}class vl{constructor(e,i,s,a,u,h){this.kind=e,this.zoomStops=s,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Kc(i.expression),this.isIndoorDependent=vh(i.expression),this.isLightConstant=u,this.isLineProgressConstant=h,this.configDependencies=xl(i.expression),this.interpolationType=a}evaluateWithoutErrorHandling(e,i,s,a,u,h){return this._styleExpression.evaluateWithoutErrorHandling(e,i,s,a,u,h)}evaluate(e,i,s,a,u,h){return this._styleExpression.evaluate(e,i,s,a,u,h)}interpolationFactor(e,i,s){return this.interpolationType?js.interpolationFactor(this.interpolationType,e,i,s):0}}function wf(r,e,i,s,a){if((r=ja(r,e,i,s,a)).result==="error")return r;const u=r.value.expression,h=Xl(u);if(!h&&!iu(e))return Ua([new eo("","data expressions not supported")]);const p=Kl(u,["zoom","pitch","distance-from-center"]);if(!p&&!Nm(e))return Ua([new eo("","zoom expressions not supported")]);const y=Kl(u,["measure-light"]);if(!y&&!Bm(e))return Ua([new eo("","measure-light expression not supported")]);const v=Kl(u,["line-progress"]);if(!v&&!function(A){return bf(A.expression,"line-progress")}(e))return Ua([new eo("","line-progress expression not supported")]);const w=e.expression&&e.expression.relaxZoomRestriction,S=To(u);return S||p||w?S instanceof eo?Ua([S]):S instanceof js&&!bh(e)?Ua([new eo("",'"interpolate" expressions cannot be used with this property')]):Fm(S?new vl(h&&v?"camera":"composite",r.value,S.labels,S instanceof js?S.interpolation:void 0,y,v):new rc(h&&v?"constant":"source",r.value,y,v)):Ua([new eo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Sh{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,Um(this._parameters,this._specification))}static deserialize(e){return new Sh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function To(r){let e=null;if(r instanceof sa)e=To(r.result);else if(r instanceof Qc){for(const i of r.args)if(e=To(i),e)break}else(r instanceof Yc||r instanceof js)&&r.input instanceof gs&&r.input.name==="zoom"&&(e=r);return e instanceof eo||r.eachChild(i=>{const s=To(i);s instanceof eo?e=s:e&&s&&e!==s&&(e=new eo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var Tf,Hm,qm=function(){if(Hm)return Tf;Hm=1,Tf=e;var r=3;function e(i,s,a){var u=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var h=new Int32Array(this.arrayBuffer);i=h[0],this.d=(s=h[1])+2*(a=h[2]);for(var p=0;p<this.d*this.d;p++){var y=h[r+p],v=h[r+p+1];u.push(y===v?null:h.subarray(y,v))}var w=h[r+u.length+1];this.keys=h.subarray(h[r+u.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=s+2*a;for(var S=0;S<this.d*this.d;S++)u.push([]);this.keys=[],this.bboxes=[]}this.n=s,this.extent=i,this.padding=a,this.scale=s/i,this.uid=0;var A=a/s*i;this.min=-A,this.max=i+A}return e.prototype.insert=function(i,s,a,u,h){this._forEachCell(s,a,u,h,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(s),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(h)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,s,a,u,h,p){this.cells[h].push(p)},e.prototype.query=function(i,s,a,u,h){var p=this.min,y=this.max;if(i<=p&&s<=p&&y<=a&&y<=u&&!h)return Array.prototype.slice.call(this.keys);var v=[];return this._forEachCell(i,s,a,u,this._queryCell,v,{},h),v},e.prototype._queryCell=function(i,s,a,u,h,p,y,v){var w=this.cells[h];if(w!==null)for(var S=this.keys,A=this.bboxes,P=0;P<w.length;P++){var R=w[P];if(y[R]===void 0){var O=4*R;(v?v(A[O+0],A[O+1],A[O+2],A[O+3]):i<=A[O+2]&&s<=A[O+3]&&a>=A[O+0]&&u>=A[O+1])?(y[R]=!0,p.push(S[R])):y[R]=!1}}},e.prototype._forEachCell=function(i,s,a,u,h,p,y,v){for(var w=this._convertToCellCoord(i),S=this._convertToCellCoord(s),A=this._convertToCellCoord(a),P=this._convertToCellCoord(u),R=w;R<=A;R++)for(var O=S;O<=P;O++){var V=this.d*O+R;if((!v||v(this._convertFromCellCoord(R),this._convertFromCellCoord(O),this._convertFromCellCoord(R+1),this._convertFromCellCoord(O+1)))&&h.call(this,i,s,a,u,V,p,y,v))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,s=r+this.cells.length+1+1,a=0,u=0;u<this.cells.length;u++)a+=this.cells[u].length;var h=new Int32Array(s+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=s,y=0;y<i.length;y++){var v=i[y];h[r+y]=p,h.set(v,p),p+=v.length}return h[r+i.length]=p,h.set(this.keys,p),h[r+i.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer},Tf}(),nc=ol(qm);const bl={};function Mt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writable:!1}),bl[e]={klass:r,omit:i.omit||[]}}Mt(Object,"Object"),nc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},nc.deserialize=function(r){return new nc(r.buffer)},Object.defineProperty(nc,"name",{value:"Grid"}),Mt(nc,"Grid"),delete Ye.prototype.constructor,Mt(or,"Color"),Mt(Error,"Error"),Mt(ms,"Formatted"),Mt(Xu,"FormattedSection"),Mt(Ds,"AJAXError"),Mt(_s,"ResolvedImage"),Mt(Sh,"StylePropertyFunction"),Mt(Th,"StyleExpression",{omit:["_evaluator"]}),Mt(ds,"ImageId"),Mt(ia,"ImageVariant"),Mt(vl,"ZoomDependentExpression"),Mt(rc,"ZoomConstantExpression"),Mt(gs,"CompoundExpression",{omit:["_evaluate"]});for(const r in ic)bl[ic[r]._classRegistryKey]||Mt(ic[r],`Expression${r}`);function nu(r){return r&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function oa(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(nu(r)||r instanceof ImageBitmap)return e&&e.add(r),r;if(ArrayBuffer.isView(r))return e&&e.add(r.buffer),r;if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const s of r)i.push(oa(s,e));return i}if(r instanceof Map){const i={$name:"Map",entries:[]};for(const[s,a]of r.entries())i.entries.push(oa(s),oa(a,e));return i}if(r instanceof Set){const i={$name:"Set"};let s=0;for(const a of r.values())i[++s]=oa(a);return i}if(typeof r=="bigint")return{$name:"BigInt",value:r.toString()};if(typeof r=="object"){const i=r.constructor,s=i._classRegistryKey;if(!s)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const a=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const u in r)r.hasOwnProperty(u)&&(bl[s].omit.indexOf(u)>=0||(a[u]=oa(r[u],e)));r instanceof Error&&(a.message=r.message)}if(a.$name)throw new Error("$name property is reserved for worker serialization logic.");return s!=="Object"&&(a.$name=s),a}throw new Error("can't serialize object of type "+typeof r)}function Ga(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||nu(r)||r instanceof ImageBitmap||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ga);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const a=r.entries||[],u=new Map;for(let h=0;h<a.length;h+=2)u.set(Ga(a[h]),Ga(a[h+1]));return u}if(e==="Set"){const a=new Set;for(const u of Object.keys(r))u!=="$name"&&a.add(Ga(r[u]));return a}if(e==="BigInt")return BigInt(r.value);const{klass:i}=bl[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(r);const s=Object.create(i.prototype);for(const a of Object.keys(r))a!=="$name"&&(s[a]=Ga(r[a]));return s}throw new Error("can't deserialize object of type "+typeof r)}const Kt={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,Osage:r=>r>=66736&&r<=66815,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function su(r){for(const e of r)if(Eh(e.charCodeAt(0)))return!0;return!1}function Sf(r){for(const e of r)if(!$m(e.charCodeAt(0)))return!1;return!0}function $m(r){return!(Kt.Arabic(r)||Kt["Arabic Supplement"](r)||Kt["Arabic Extended-A"](r)||Kt["Arabic Presentation Forms-A"](r)||Kt["Arabic Presentation Forms-B"](r))}function Eh(r){return!(r!==746&&r!==747&&(r<4352||!(Kt["Bopomofo Extended"](r)||Kt.Bopomofo(r)||Kt["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Kt["CJK Compatibility Ideographs"](r)||Kt["CJK Compatibility"](r)||Kt["CJK Radicals Supplement"](r)||Kt["CJK Strokes"](r)||!(!Kt["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Kt["CJK Unified Ideographs Extension A"](r)||Kt["CJK Unified Ideographs"](r)||Kt["Enclosed CJK Letters and Months"](r)||Kt["Hangul Compatibility Jamo"](r)||Kt["Hangul Jamo Extended-A"](r)||Kt["Hangul Jamo Extended-B"](r)||Kt["Hangul Jamo"](r)||Kt["Hangul Syllables"](r)||Kt.Hiragana(r)||Kt["Ideographic Description Characters"](r)||Kt.Kanbun(r)||Kt["Kangxi Radicals"](r)||Kt["Katakana Phonetic Extensions"](r)||Kt.Katakana(r)&&r!==12540||!(!Kt["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Kt["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Kt["Unified Canadian Aboriginal Syllabics"](r)||Kt["Unified Canadian Aboriginal Syllabics Extended"](r)||Kt["Vertical Forms"](r)||Kt["Yijing Hexagram Symbols"](r)||Kt["Yi Syllables"](r)||Kt["Yi Radicals"](r))))}function Ah(r){return!(Eh(r)||function(e){return!!(Kt["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Kt["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Kt["Letterlike Symbols"](e)||Kt["Number Forms"](e)||Kt["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Kt["Control Pictures"](e)&&e!==9251||Kt["Optical Character Recognition"](e)||Kt["Enclosed Alphanumerics"](e)||Kt["Geometric Shapes"](e)||Kt["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Kt["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Kt["CJK Symbols and Punctuation"](e)||Kt.Katakana(e)||Kt["Private Use Area"](e)||Kt["CJK Compatibility Forms"](e)||Kt["Small Form Variants"](e)||Kt["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Ih(r){return Kt.Arabic(r)||Kt["Arabic Supplement"](r)||Kt["Arabic Extended-A"](r)||Kt["Arabic Presentation Forms-A"](r)||Kt["Arabic Presentation Forms-B"](r)}function Ef(r){return r>=1424&&r<=2303||Kt["Arabic Presentation Forms-A"](r)||Kt["Arabic Presentation Forms-B"](r)}function aa(r,e){return!(!e&&Ef(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Kt.Khmer(r))}function vy(r){for(const e of r)if(Ef(e.charCodeAt(0)))return!0;return!1}const Ls={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let Af=null,ys=Ls.unavailable,la=null;const ou=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(ys=Ls.error),Af&&Af(r)};function Ch(){Ph.fire(new ko("pluginStateChange",{pluginStatus:ys,pluginURL:la}))}const Ph=new pl,au=function(){return ys},Wm=function(){if(ys!==Ls.deferred||!la)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ys=Ls.loading,Ch(),la&&ta({url:la},r=>{r?ou(r):(ys=Ls.loaded,Ch())})},ca={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ys===Ls.loaded||ca.applyArabicShaping!=null,isLoading:()=>ys===Ls.loading,setState(r){ys=r.pluginStatus,la=r.pluginURL},isParsing:()=>ys===Ls.parsing,isParsed:()=>ys===Ls.parsed,getPluginURL:()=>la};class Mr{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,s){for(const a of i)if(!aa(a.charCodeAt(0),s))return!1;return!0}(e,ca.isLoaded())}}class Mh{constructor(e,i,s,a,u){this.property=e,this.value=i,this.expression=function(h,p,y,v,w){if(wh(h))return new Sh(h,p);if(ru(h)||Array.isArray(h)&&h.length>0){const S=wf(h,p,y,v,w);if(S.result==="error")throw new Error(S.value.map(A=>`${A.key}: ${A.message}`).join(", "));return S.value}{let S=h;return typeof h=="string"&&p.type==="color"&&(S=or.parse(h)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>S}}}(i===void 0?e.specification.default:i,e.specification,s,a,u)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,s,a){return this.property.possiblyEvaluate(this,e,i,s,a)}}class If{constructor(e,i,s,a){this.property=e,this.value=new Mh(e,void 0,i,s,a)}transitioned(e,i){return new Xm(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Xm(this.property,this.value,null,{},0)}}class Zm{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Ge(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new If(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Mh(this._values[e].property,i===null?void 0:Ge(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const s=this._properties.properties;if(e)for(const a in e){const u=e[a];if(a.endsWith("-transition")){const h=a.slice(0,-11);s[h]&&this.setTransition(h,u)}else s.hasOwnProperty(a)&&this.setValue(a,u)}}getTransition(e){return Ge(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new If(this._values[e].property)),this._values[e].transition=Ge(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s);const a=this.getTransition(i);a!==void 0&&(e[`${i}-transition`]=a)}return e}transitioned(e,i){const s=new Km(this._properties);for(const a of Object.keys(this._values))s._values[a]=this._values[a].transitioned(e,i._values[a]);return s}untransitioned(){const e=new Km(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Xm{constructor(e,i,s,a,u){const h=a.delay||0,p=a.duration||0;u=u||0,this.property=e,this.value=i,this.begin=u+h,this.end=this.begin+p,e.specification.transition&&(a.delay||a.duration)&&(this.prior=s)}possiblyEvaluate(e,i,s){const a=e.now||0,u=this.value.possiblyEvaluate(e,i,s),h=this.prior;if(h){if(a>this.end)return this.prior=null,u;if(this.value.isDataDriven())return this.prior=null,u;if(a<this.begin)return h.possiblyEvaluate(e,i,s);{const p=(a-this.begin)/(this.end-this.begin);return this.property.interpolate(h.possiblyEvaluate(e,i,s),u,ll(p))}}return u}}class Km{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,s){const a=new Tl(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].possiblyEvaluate(e,i,s);return a}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Ym{constructor(e,i,s,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=s,this._iconImageUseTheme=a,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return Ge(this._values[e].value)}setValue(e,i){this._values[e]=new Mh(this._values[e].property,i===null?void 0:Ge(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const s=this.getValue(i);s!==void 0&&(e[i]=s)}return e}possiblyEvaluate(e,i,s,a){const u=new Tl(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].possiblyEvaluate(e,i,s,a);return u}isIndoorDependent(){return this._isIndoorDependent}}class wl{constructor(e,i,s,a){this.property=e,this.value=i,this.parameters=s,this.iconImageUseTheme=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,s,a){return this.property.evaluate(this.value,this.parameters,e,i,s,a,this.iconImageUseTheme)}}class Tl{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class lt{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,s){const a=Uc[this.specification.type];return a?a(e,i,s):e}}class pt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,s,a,u){return e.expression.kind==="constant"||e.expression.kind==="camera"?new wl(this,{kind:"constant",value:e.expression.evaluate(i,null,{},s,a,void 0,u)},i):new wl(this,e.expression,i,u)}interpolate(e,i,s){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new wl(this,{kind:"constant",value:void 0},e.parameters);const a=Uc[this.specification.type];return a?new wl(this,{kind:"constant",value:a(e.value.value,i.value.value,s)},e.parameters):e}evaluate(e,i,s,a,u,h,p){return e.kind==="constant"?e.value:e.evaluate(i,s,a,u,h,void 0,p)}}class Sl{constructor(e){this.specification=e}possiblyEvaluate(e,i,s,a){return!!e.expression.evaluate(i,null,{},s,a)}interpolate(){return!1}}class Xr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Mr(0,{});for(const s in e){const a=e[s];a.specification.overridable&&this.overridableProperties.push(s);const u=this.defaultPropertyValues[s]=new Mh(a,void 0),h=this.defaultTransitionablePropertyValues[s]=new If(a);this.defaultTransitioningPropertyValues[s]=h.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=u.possiblyEvaluate(i)}}}Mt(pt,"DataDrivenProperty"),Mt(lt,"DataConstantProperty"),Mt(Sl,"ColorRampProperty");var Se=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Jm(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Rh(r){if(Array.isArray(r))return r.map(Rh);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Rh(r[i]);return e}return Jm(r)}function jo(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!jo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Dh(r,e="",i=null,s="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};jo(r)||(r=Lh(r));const a=r;let u=!0;try{u=function(w){if(!sc(w))return w;let S=Rh(w);return Qm(S),S=El(S),S}(a)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(a,null,2)}
        `)}let h=null,p=null;if(s!=="background"&&s!=="sky"&&s!=="slot"){p=Se[`filter_${s}`];const w=ja(u,p,e,i);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));h=(S,A,P)=>w.value.evaluate(S,A,{},P)}let y=null,v=null;if(u!==a){const w=ja(a,p,e,i);if(w.result==="error")throw new Error(w.value.map(S=>`${S.key}: ${S.message}`).join(", "));y=(S,A,P,R,O)=>w.value.evaluate(S,A,{},P,void 0,void 0,R,O),v=!Xl(w.value.expression)}return{filter:h,dynamicFilter:y||void 0,needGeometry:e_(u),needFeature:!!v}}function El(r){if(!Array.isArray(r))return r;const e=function(i){if(by.has(i[0])){for(let s=1;s<i.length;s++)if(sc(i[s]))return!0}return i}(r);return e===!0?e:e.map(i=>El(i))}function Qm(r){let e=!1;const i=[];if(r[0]==="case"){for(let s=1;s<r.length-1;s+=2)e=e||sc(r[s]),i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||sc(r[1]);for(let s=2;s<r.length-1;s+=2)i.push(r[s+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||sc(r[1]);for(let s=1;s<r.length-1;s+=2)i.push(r[s+1])}e&&(r.length=0,r.push("any",...i));for(let s=1;s<r.length;s++)Qm(r[s])}function sc(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(sc(r[i]))return!0;return!1}const by=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function wy(r,e){return r<e?-1:r>e?1:0}function e_(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(e_(r[e]))return!0;return!1}function Lh(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?zh(r[1],r[2],"=="):e==="!="?lu(zh(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?zh(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Lh))):e==="all"?["all"].concat(r.slice(1).map(Lh)):e==="none"?["all"].concat(r.slice(1).map(Lh).map(lu)):e==="in"?Oh(r[1],r.slice(2)):e==="!in"?lu(Oh(r[1],r.slice(2))):e==="has"?kh(r[1]):e!=="!has"||lu(kh(r[1]));var i}function zh(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Oh(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(wy)]]:["filter-in-small",r,["literal",e]]}}function kh(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function lu(r){return["!",r]}const Al="";function So(r,e){return e?`${r}${Al}${e}`:r}let t_;const i_=()=>t_||(t_=new Xr({"icon-size":new pt(Se.layout_symbol["icon-size"]),"icon-image":new pt(Se.layout_symbol["icon-image"]),"icon-rotate":new pt(Se.layout_symbol["icon-rotate"]),"icon-offset":new pt(Se.layout_symbol["icon-offset"]),"text-size":new pt(Se.layout_symbol["text-size"]),"text-rotate":new pt(Se.layout_symbol["text-rotate"]),"text-offset":new pt(Se.layout_symbol["text-offset"])}));class r_{constructor(e,i,s,a,u,h){const p=ja(e,Se.appearance.condition);if(p.result==="success"&&(this.condition=p.value),this.name=i,s){this.properties=new Tl(i_()),this.unevaluatedLayout=new Ym(i_(),a,u,h);for(const y in s)this.unevaluatedLayout.setValue(y,s[y])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,s){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,s))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),s=this.hasProperty("icon-offset"),a=this.hasProperty("icon-rotate");return e||i||s||a}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),s=this.hasProperty("text-rotate");return e||i||s}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const n_="-transition",Go=new Set(["fill","line","background","hillshade","raster"]);class xs extends pl{constructor(e,i,s,a,u,h){if(super(),this.id=e.id,this.fqid=So(this.id,s),this.type=e.type,this.scope=s,this.lut=a,this.options=u,this.iconImageUseTheme=h,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const p=ja(this.filter,Se[`filter_${e.type}`]);p.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...p.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||p.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Ym(i.layout,this.scope,u,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Zm(i.paint,this.scope,u);for(const p in e.paint)this.setPaintProperty(p,e.paint[p]);for(const p in e.layout)this.setLayoutProperty(p,e.layout[p]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Tl(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&Go.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const s=this._unevaluatedLayout;s._properties.properties[e]&&(s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new r_(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(n_)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const s=this._transitionablePaint,a=s._properties.properties;if(e.endsWith(n_)){const S=e.slice(0,-11);return a[S]&&s.setTransition(S,i||void 0),!1}if(!a[e])return!1;const u=s._values[e],h=u.value.isDataDriven(),p=u.value;s.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...s.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||s.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const y=s._values[e].value,v=y.isDataDriven(),w=e.endsWith("pattern")||e==="line-dasharray";return v||h||w||this._handleOverridablePaintPropertyUpdate(e,p,y)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,s){return null}_handleOverridablePaintPropertyUpdate(e,i,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),tt(e,(i,s)=>!(i===void 0||s==="layout"&&!Object.keys(i).length||s==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof wl&&iu(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!Kc(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Dh(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,s){return{}}queryRadius(e){}queryIntersectsFeature(e,i,s,a,u,h,p,y,v){}}const s_={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class cu{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const Ty=new ArrayBuffer(0);class zr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=Ty),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Ii(r,e=1){let i=0,s=0;return{members:r.map(a=>{const u=s_[a.type].BYTES_PER_ELEMENT,h=i=o_(i,Math.max(e,u)),p=a.components||1;return s=Math.max(s,u),i+=u*p,{name:a.name,type:a.type,components:p,offset:h}}),size:o_(i,Math.max(s,e)),alignment:e}}function o_(r,e){return Math.ceil(r/e)*e}class Ha extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.int16[a+0]=i,this.int16[a+1]=s,e}}Ha.prototype.bytesPerElement=4,Mt(Ha,"StructArrayLayout2i4");class oc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=3*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=a,e}}oc.prototype.bytesPerElement=6,Mt(oc,"StructArrayLayout3i6");class ac extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=4*e;return this.int16[h+0]=i,this.int16[h+1]=s,this.int16[h+2]=a,this.int16[h+3]=u,e}}ac.prototype.bytesPerElement=8,Mt(ac,"StructArrayLayout4i8");class ua extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}ua.prototype.bytesPerElement=4,Mt(ua,"StructArrayLayout1f4");class Cf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=4*e,h=2*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.float32[h+1]=a,e}}Cf.prototype.bytesPerElement=8,Mt(Cf,"StructArrayLayout2i1f8");class Pf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=4*e;return this.int16[u+0]=i,this.int16[u+1]=s,this.int16[u+2]=a,e}}Pf.prototype.bytesPerElement=8,Mt(Pf,"StructArrayLayout3i8");class Mf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const p=5*e;return this.int16[p+0]=i,this.int16[p+1]=s,this.int16[p+2]=a,this.int16[p+3]=u,this.int16[p+4]=h,e}}Mf.prototype.bytesPerElement=10,Mt(Mf,"StructArrayLayout5i10");class Fh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,u,h,p)}emplace(e,i,s,a,u,h,p,y){const v=6*e,w=12*e,S=3*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.uint8[w+4]=a,this.uint8[w+5]=u,this.uint8[w+6]=h,this.uint8[w+7]=p,this.float32[S+2]=y,e}}Fh.prototype.bytesPerElement=12,Mt(Fh,"StructArrayLayout2i4ub1f12");class Gs extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=3*e;return this.float32[u+0]=i,this.float32[u+1]=s,this.float32[u+2]=a,e}}Gs.prototype.bytesPerElement=12,Mt(Gs,"StructArrayLayout3f12");class Es extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const p=6*e,y=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=s,this.uint16[p+2]=a,this.uint16[p+3]=u,this.float32[y+2]=h,e}}Es.prototype.bytesPerElement=12,Mt(Es,"StructArrayLayout4ui1f12");class Il extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=4*e;return this.uint16[h+0]=i,this.uint16[h+1]=s,this.uint16[h+2]=a,this.uint16[h+3]=u,e}}Il.prototype.bytesPerElement=8,Mt(Il,"StructArrayLayout4ui8");class Bh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,p){const y=6*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=a,this.int16[y+3]=u,this.int16[y+4]=h,this.int16[y+5]=p,e}}Bh.prototype.bytesPerElement=12,Mt(Bh,"StructArrayLayout6i12");class Rf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v,w,S,A){const P=this.length;return this.resize(P+1),this.emplace(P,e,i,s,a,u,h,p,y,v,w,S,A)}emplace(e,i,s,a,u,h,p,y,v,w,S,A,P){const R=12*e;return this.int16[R+0]=i,this.int16[R+1]=s,this.int16[R+2]=a,this.int16[R+3]=u,this.uint16[R+4]=h,this.uint16[R+5]=p,this.uint16[R+6]=y,this.uint16[R+7]=v,this.int16[R+8]=w,this.int16[R+9]=S,this.int16[R+10]=A,this.int16[R+11]=P,e}}Rf.prototype.bytesPerElement=24,Mt(Rf,"StructArrayLayout4i4ui4i24");class Df extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,p){const y=10*e,v=5*e;return this.int16[y+0]=i,this.int16[y+1]=s,this.int16[y+2]=a,this.float32[v+2]=u,this.float32[v+3]=h,this.float32[v+4]=p,e}}Df.prototype.bytesPerElement=20,Mt(Df,"StructArrayLayout3i3f20");class qa extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=4*e;return this.float32[h+0]=i,this.float32[h+1]=s,this.float32[h+2]=a,this.float32[h+3]=u,e}}qa.prototype.bytesPerElement=16,Mt(qa,"StructArrayLayout4f16");class Nh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}Nh.prototype.bytesPerElement=4,Mt(Nh,"StructArrayLayout1ul4");class Hs extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.uint16[a+0]=i,this.uint16[a+1]=s,e}}Hs.prototype.bytesPerElement=4,Mt(Hs,"StructArrayLayout2ui4");class Vh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v,w,S,A,P){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,s,a,u,h,p,y,v,w,S,A,P)}emplace(e,i,s,a,u,h,p,y,v,w,S,A,P,R){const O=20*e,V=10*e;return this.int16[O+0]=i,this.int16[O+1]=s,this.int16[O+2]=a,this.int16[O+3]=u,this.int16[O+4]=h,this.float32[V+3]=p,this.float32[V+4]=y,this.float32[V+5]=v,this.float32[V+6]=w,this.int16[O+14]=S,this.uint32[V+8]=A,this.uint16[O+18]=P,this.uint16[O+19]=R,e}}Vh.prototype.bytesPerElement=40,Mt(Vh,"StructArrayLayout5i4f1i1ul2ui40");class Uh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,u,h,p)}emplace(e,i,s,a,u,h,p,y){const v=8*e;return this.int16[v+0]=i,this.int16[v+1]=s,this.int16[v+2]=a,this.int16[v+4]=u,this.int16[v+5]=h,this.int16[v+6]=p,this.int16[v+7]=y,e}}Uh.prototype.bytesPerElement=16,Mt(Uh,"StructArrayLayout3i2i2i16");class jh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const p=4*e,y=8*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=a,this.int16[y+6]=u,this.int16[y+7]=h,e}}jh.prototype.bytesPerElement=16,Mt(jh,"StructArrayLayout2f1f2i16");class Lf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,p){const y=20*e,v=5*e;return this.uint8[y+0]=i,this.uint8[y+1]=s,this.float32[v+1]=a,this.float32[v+2]=u,this.float32[v+3]=h,this.float32[v+4]=p,e}}Lf.prototype.bytesPerElement=20,Mt(Lf,"StructArrayLayout2ub4f20");class wn extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s){const a=this.length;return this.resize(a+1),this.emplace(a,e,i,s)}emplace(e,i,s,a){const u=3*e;return this.uint16[u+0]=i,this.uint16[u+1]=s,this.uint16[u+2]=a,e}}wn.prototype.bytesPerElement=6,Mt(wn,"StructArrayLayout3ui6");class lc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se){const te=this.length;return this.resize(te+1),this.emplace(te,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se)}emplace(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se,te){const le=30*e,fe=15*e,ge=60*e;return this.int16[le+0]=i,this.int16[le+1]=s,this.int16[le+2]=a,this.float32[fe+2]=u,this.float32[fe+3]=h,this.uint16[le+8]=p,this.uint16[le+9]=y,this.uint32[fe+5]=v,this.uint32[fe+6]=w,this.uint32[fe+7]=S,this.uint16[le+16]=A,this.uint16[le+17]=P,this.uint16[le+18]=R,this.float32[fe+10]=O,this.float32[fe+11]=V,this.uint8[ge+48]=N,this.uint8[ge+49]=q,this.uint8[ge+50]=W,this.uint32[fe+13]=K,this.int16[le+28]=se,this.uint8[ge+58]=te,e}}lc.prototype.bytesPerElement=60,Mt(lc,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class zf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se,te,le,fe,ge,ze,we,Ne,He,qe,Je,et,Ze){const Xe=this.length;return this.resize(Xe+1),this.emplace(Xe,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se,te,le,fe,ge,ze,we,Ne,He,qe,Je,et,Ze)}emplace(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se,te,le,fe,ge,ze,we,Ne,He,qe,Je,et,Ze,Xe){const Be=20*e,ke=40*e,Ke=80*e;return this.float32[Be+0]=i,this.float32[Be+1]=s,this.int16[ke+4]=a,this.int16[ke+5]=u,this.int16[ke+6]=h,this.int16[ke+7]=p,this.int16[ke+8]=y,this.int16[ke+9]=v,this.int16[ke+10]=w,this.int16[ke+11]=S,this.int16[ke+12]=A,this.uint16[ke+13]=P,this.uint16[ke+14]=R,this.uint16[ke+15]=O,this.uint16[ke+16]=V,this.uint16[ke+17]=N,this.uint16[ke+18]=q,this.uint16[ke+19]=W,this.uint16[ke+20]=K,this.uint16[ke+21]=se,this.uint16[ke+22]=te,this.uint16[ke+23]=le,this.uint16[ke+24]=fe,this.uint16[ke+25]=ge,this.uint16[ke+26]=ze,this.uint16[ke+27]=we,this.uint32[Be+14]=Ne,this.float32[Be+15]=He,this.float32[Be+16]=qe,this.float32[Be+17]=Je,this.float32[Be+18]=et,this.uint8[Ke+76]=Ze,this.uint16[ke+39]=Xe,e}}zf.prototype.bytesPerElement=80,Mt(zf,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Of extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,s,a,u,h)}emplace(e,i,s,a,u,h,p){const y=6*e;return this.float32[y+0]=i,this.float32[y+1]=s,this.float32[y+2]=a,this.float32[y+3]=u,this.float32[y+4]=h,this.float32[y+5]=p,e}}Of.prototype.bytesPerElement=24,Mt(Of,"StructArrayLayout6f24");class Cl extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,s,a,u)}emplace(e,i,s,a,u,h){const p=5*e;return this.float32[p+0]=i,this.float32[p+1]=s,this.float32[p+2]=a,this.float32[p+3]=u,this.float32[p+4]=h,e}}Cl.prototype.bytesPerElement=20,Mt(Cl,"StructArrayLayout5f20");class kf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,u,h,p)}emplace(e,i,s,a,u,h,p,y){const v=7*e;return this.float32[v+0]=i,this.float32[v+1]=s,this.float32[v+2]=a,this.float32[v+3]=u,this.float32[v+4]=h,this.float32[v+5]=p,this.float32[v+6]=y,e}}kf.prototype.bytesPerElement=28,Mt(kf,"StructArrayLayout7f28");class Ff extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v,w,S){const A=this.length;return this.resize(A+1),this.emplace(A,e,i,s,a,u,h,p,y,v,w,S)}emplace(e,i,s,a,u,h,p,y,v,w,S,A){const P=11*e;return this.float32[P+0]=i,this.float32[P+1]=s,this.float32[P+2]=a,this.float32[P+3]=u,this.float32[P+4]=h,this.float32[P+5]=p,this.float32[P+6]=y,this.float32[P+7]=v,this.float32[P+8]=w,this.float32[P+9]=S,this.float32[P+10]=A,e}}Ff.prototype.bytesPerElement=44,Mt(Ff,"StructArrayLayout11f44");class cc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,s,a,u,h,p,y,v)}emplace(e,i,s,a,u,h,p,y,v,w){const S=9*e;return this.float32[S+0]=i,this.float32[S+1]=s,this.float32[S+2]=a,this.float32[S+3]=u,this.float32[S+4]=h,this.float32[S+5]=p,this.float32[S+6]=y,this.float32[S+7]=v,this.float32[S+8]=w,e}}cc.prototype.bytesPerElement=36,Mt(cc,"StructArrayLayout9f36");class Ho extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,i)}emplace(e,i,s){const a=2*e;return this.float32[a+0]=i,this.float32[a+1]=s,e}}Ho.prototype.bytesPerElement=8,Mt(Ho,"StructArrayLayout2f8");class As extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,s,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,s,a)}emplace(e,i,s,a,u){const h=6*e;return this.uint32[3*e+0]=i,this.uint16[h+2]=s,this.uint16[h+3]=a,this.uint16[h+4]=u,e}}As.prototype.bytesPerElement=12,Mt(As,"StructArrayLayout1ul3ui12");class $a extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}$a.prototype.bytesPerElement=2,Mt($a,"StructArrayLayout1ui2");class Bf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V){const N=this.length;return this.resize(N+1),this.emplace(N,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V)}emplace(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N){const q=16*e;return this.float32[q+0]=i,this.float32[q+1]=s,this.float32[q+2]=a,this.float32[q+3]=u,this.float32[q+4]=h,this.float32[q+5]=p,this.float32[q+6]=y,this.float32[q+7]=v,this.float32[q+8]=w,this.float32[q+9]=S,this.float32[q+10]=A,this.float32[q+11]=P,this.float32[q+12]=R,this.float32[q+13]=O,this.float32[q+14]=V,this.float32[q+15]=N,e}}Bf.prototype.bytesPerElement=64,Mt(Bf,"StructArrayLayout16f64");class Gh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,s,a,u,h,p){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,s,a,u,h,p)}emplace(e,i,s,a,u,h,p,y){const v=10*e,w=5*e;return this.uint16[v+0]=i,this.uint16[v+1]=s,this.uint16[v+2]=a,this.uint16[v+3]=u,this.float32[w+2]=h,this.float32[w+3]=p,this.float32[w+4]=y,e}}Gh.prototype.bytesPerElement=20,Mt(Gh,"StructArrayLayout4ui3f20");class Nf extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Nf.prototype.bytesPerElement=2,Mt(Nf,"StructArrayLayout1i2");class Hh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Hh.prototype.bytesPerElement=1,Mt(Hh,"StructArrayLayout1ub1");class qh extends cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}qh.prototype.size=40;class a_ extends Vh{get(e){return new qh(this,e)}}Mt(a_,"CollisionBoxArray");class $h extends cu{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}$h.prototype.size=60;class l_ extends lc{get(e){return new $h(this,e)}}Mt(l_,"PlacedSymbolArray");class c_ extends cu{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}c_.prototype.size=80;class Vf extends zf{get(e){return new c_(this,e)}}Mt(Vf,"SymbolInstanceArray");class Wh extends ua{getoffsetX(e){return this.float32[1*e+0]}}Mt(Wh,"GlyphOffsetArray");class u_ extends Ha{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Mt(u_,"SymbolLineVertexArray");class Uf extends cu{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Uf.prototype.size=12;class jf extends As{get(e){return new Uf(this,e)}}Mt(jf,"FeatureIndexArray");class h_ extends Hs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Mt(h_,"FillExtrusionCentroidArray");class Zh extends cu{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Zh.prototype.size=6;class uu extends oc{get(e){return new Zh(this,e)}}Mt(uu,"FillExtrusionWallArray");const d_=Ii([{name:"a_pos",components:2,type:"Int16"}],4),Sy=Ii([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),f_=Ii([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Nr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,s,a){let u=this.segments[this.segments.length-1];return e>Nr.MAX_VERTEX_ARRAY_LENGTH&&St(`Max vertices per segment is ${Nr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!u||u.vertexLength+e>Nr.MAX_VERTEX_ARRAY_LENGTH||u.sortKey!==a)&&(u={vertexOffset:i,primitiveOffset:s,vertexLength:0,primitiveLength:0},a!==void 0&&(u.sortKey=a),this.segments.push(u)),u}prepareSegment(e,i,s,a){return this._prepareSegment(e,i.length,s.length,a)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,s,a){return new Nr([{vertexOffset:e,primitiveOffset:i,vertexLength:s,primitiveLength:a,vaos:{},sortKey:0}])}}function Xh(r,e){return 256*(r=U(Math.floor(r),0,255))+U(Math.floor(e),0,255)}Nr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Mt(Nr,"SegmentVector");const Ey=Ii([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Ay=Ii([{name:"a_pattern_b",components:4,type:"Uint16"}]),Iy=Ii([{name:"a_dash",components:4,type:"Uint16"}]);class hu{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,s,a){this.ids.push(Gf(e)),this.positions.push(i,s,a)}eachPosition(e,i){const s=Gf(e);let a=0,u=this.ids.length-1;for(;a<u;){const h=a+u>>1;this.ids[h]>=s?u=h:a=h+1}for(;this.ids[a]===s;)i(this.positions[3*a],this.positions[3*a+1],this.positions[3*a+2]),a++}static serialize(e,i){const s=new Float64Array(e.ids),a=new Uint32Array(e.positions);return Hf(s,a,0,s.length-1),i&&(i.add(s.buffer),i.add(a.buffer)),{ids:s,positions:a}}static deserialize(e){const i=new hu;let s;i.ids=e.ids,i.positions=e.positions;for(const a of i.ids)a!==s&&i.uniqueIds.push(a),s=a;return i.indexed=!0,i}}function Gf(r){const e=+r;return Number.isSafeInteger(e)?e:qu(String(r))}function Hf(r,e,i,s){for(;i<s;){const a=r[i+s>>1];let u=i-1,h=s+1;for(;;){do u++;while(r[u]<a);do h--;while(r[h]>a);if(u>=h)break;Kh(r,u,h),Kh(e,3*u,3*h),Kh(e,3*u+1,3*h+1),Kh(e,3*u+2,3*h+2)}h-i<s-h?(Hf(r,e,i,h),i=h+1):(Hf(r,e,h+1,s),s=h)}}function Kh(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}Mt(hu,"FeaturePositionMap");class ha{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,s){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Yh extends ha{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}}class Tn extends ha{constructor(e){super(e),this.current=0}set(e,i,s){this.fetchUniformLocation(e,i)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class qo extends ha{constructor(e){super(e),this.current=[0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1])))}}class du extends ha{constructor(e){super(e),this.current=[0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2])))}}class Jh extends ha{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,s){this.fetchUniformLocation(e,i)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class fu extends ha{constructor(e){super(e),this.current=or.transparent.toPremultipliedRenderColor(null)}set(e,i,s){this.fetchUniformLocation(e,i)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Cy=new Float32Array(16);class pu extends ha{constructor(e){super(e),this.current=Cy}set(e,i,s){if(this.fetchUniformLocation(e,i)){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let a=1;a<16;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}}}const Qh=new Float32Array(9),Py=new Float32Array(4);class ed extends ha{constructor(e){super(e),this.current=Py}set(e,i,s){if(this.fetchUniformLocation(e,i)){for(let a=0;a<4;a++)if(s[a]!==this.current[a]){this.current=s,this.gl.uniformMatrix2fv(this.location,!1,s);break}}}}function qf(r){return[Xh(255*r.r,255*r.g),Xh(255*r.b,255*r.a)]}function mu(r,e,i,s,a,u,h,p){return!!r&&(r.kind==="composite"||r.kind==="source"?r.evaluate(new Mr(0,{brightness:u,worldview:p}),e,i,a,s,h)==="none":r.value==="none")}class _u{constructor(e,i,s,a){this.value=e,this.uniformNames=i.map(u=>`u_${u}`),this.type=s,this.context=a}setUniform(e,i,s,a,u){const h=a.constantOr(this.value);i.set(e,u,h instanceof or?h.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):h)}getBinding(e,i){return this.type==="color"?new fu(e):new Tn(e)}}class uc{constructor(e,i){this.uniformNames=i.map(s=>`u_${s}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,s,a,u){let h=null;u!=="u_pattern"&&u!=="u_dash"||(h=this.pattern),u==="u_pattern_b"&&(h=this.patternTransition),u==="u_pixel_ratio"&&(h=this.pixelRatio),h&&i.set(e,u,h)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Jh(e):new Tn(e)}}class da{constructor(e,i,s,a){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=i.map(u=>({name:`a_${u}`,type:"Float32",components:s==="color"?2:1,offset:0})),this.paintVertexArray=new a}populatePaintArray(e,i,s,a,u,h,p,y){const v=this.paintVertexArray.length,w=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Mr(0,{brightness:h,worldview:y}),i,{},u,a,p):this.expression.kind==="constant"&&this.expression.value,S=mu(this.lutExpression,i,{},a,u,h,p,y);this.paintVertexArray.resize(e),this._setPaintValue(v,e,w,S?null:this.context.lut)}updatePaintArray(e,i,s,a,u,h,p,y){const v=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:p,worldview:y},s,a,void 0,u):this.expression.kind==="constant"&&this.expression.value,w=mu(this.lutExpression,s,a,u,void 0,p,void 0,y);this._setPaintValue(e,i,v,w?null:this.context.lut)}_setPaintValue(e,i,s,a){if(this.type==="color"){const u=qf(s.toPremultipliedRenderColor(a));for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,u[0],u[1])}else{for(let u=e;u<i;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class fa{constructor(e,i,s,a,u,h){this.expression=e,this.uniformNames=i.map(p=>`u_${p}_t`),this.type=s,this.useIntegerZoom=a,this.context=u,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:s==="color"?4:2,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,s,a,u,h,p,y){const v=this.expression.evaluate(new Mr(this.context.zoom,{brightness:h,worldview:y}),i,{},u,a,p),w=this.expression.evaluate(new Mr(this.context.zoom+1,{brightness:h,worldview:y}),i,{},u,a,p),S=mu(this.lutExpression,i,{},a,u,h,p,y),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,v,w,S?null:this.context.lut)}updatePaintArray(e,i,s,a,u,h,p,y){const v=this.expression.evaluate({zoom:this.context.zoom,brightness:p,worldview:y},s,a,void 0,u),w=this.expression.evaluate({zoom:this.context.zoom+1,brightness:p,worldview:y},s,a,void 0,u),S=mu(this.lutExpression,s,a,u,void 0,p,void 0,y);this._setPaintValue(e,i,v,w,S?null:this.context.lut)}_setPaintValue(e,i,s,a,u){if(this.type==="color"){const h=qf(s.toPremultipliedRenderColor(u)),p=qf(s.toPremultipliedRenderColor(u));for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,h[0],h[1],p[0],p[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,s,a);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,s,a,u){const h=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,p=U(this.expression.interpolationFactor(h,this.context.zoom,this.context.zoom+1),0,1);i.set(e,u,p)}getBinding(e,i){return new Tn(e)}}class pa{constructor(e,i,s,a,u){this.expression=e,this.layerId=u,this.paintVertexAttributes=(s==="array"?Iy:Ey).members;for(let h=0;h<i.length;++h);this.paintVertexArray=new a,this.paintTransitionVertexArray=new Il}populatePaintArray(e,i,s,a){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,i.patterns&&i.patterns[this.layerId],s)}updatePaintArray(e,i,s,a,u,h,p){this._setPaintValues(e,i,s.patterns&&s.patterns[this.layerId],h)}_setPaintValues(e,i,s,a){if(!a||!s)return;const u=a[s[0]],h=a[s[1]];if(u){if(u){const{tl:p,br:y,pixelRatio:v}=u;for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,p[0],p[1],y[0],y[1],v)}if(h){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:p,br:y}=h;for(let v=e;v<i;v++)this.paintTransitionVertexArray.emplace(v,p[0],p[1],y[0],y[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,Ay.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Wa{constructor(e,i,s=()=>!0){this.binders={},this._buffers=[],this.context=i;const a=[];for(const u in e.paint._values){const h=e.paint.get(u);if(u.endsWith("-use-theme")||!s(u)||!(h instanceof wl&&iu(h.property.specification)))continue;const p=Ry(u,e.type),y=h.value,v=h.property.specification.type,w=!!h.property.useIntegerZoom,S=u==="line-dasharray"||u.endsWith("pattern"),A=e.paint.get(`${u}-use-theme`),P=u==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||A&&A.value.kind!=="constant";if(y.kind!=="constant"||P)if(y.kind==="source"||P||S){const R=$f(u,v,"source");this.binders[u]=S?new pa(y,p,v,R,e.id):new da(y,p,v,R),a.push(`/a_${u}`)}else{const R=$f(u,v,"composite");this.binders[u]=new fa(y,p,v,w,i,R),a.push(`/z_${u}`)}else this.binders[u]=S?new uc(y.value,p):new _u(y.value,p,v,i),a.push(`/u_${u}`);A&&(this.binders[u].lutExpression=A.value)}this.cacheKey=a.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof da||i instanceof fa?i.maxValue:0}populatePaintArrays(e,i,s,a,u,h,p,y){for(const v in this.binders){const w=this.binders[v];w.context=this.context,(w instanceof da||w instanceof fa||w instanceof pa)&&w.populatePaintArray(e,i,s,a,u,h,p,y)}}setConstantPatternPositions(e,i){for(const s in this.binders){const a=this.binders[s];a instanceof uc&&a.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof pa?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,s,a,u,h,p,y,v,w){let S=!1;const A=Object.keys(e),P=A.length!==0&&!y,R=P?A:i.uniqueIds;this.context.lut=u.lut;for(const O in this.binders){const V=this.binders[O];if(V.context=this.context,(V instanceof da||V instanceof fa||V instanceof pa)&&V.expression&&V.expression.kind&&V.expression.kind!=="constant"&&(V.expression.isStateDependent===!0||V.expression.isLightConstant===!1)){const N=u.paint.get(O);V.expression=N.value;for(const q of R){const W=e[q.toString()];i.eachPosition(q,(K,se,te)=>{const le=a.feature(K);V.updatePaintArray(se,te,le,W,h,p,v,w)})}if(!P)for(const q of s.uniqueIds){const W=e[q.toString()];s.eachPosition(q,(K,se,te)=>{const le=a.feature(K);V.updatePaintArray(se,te,le,W,h,p,v,w)})}S=!0}}return S}defines(){const e=[];for(const i in this.binders){const s=this.binders[i];(s instanceof _u||s instanceof uc)&&e.push(...s.uniformNames.map(a=>`#define HAS_UNIFORM_${a}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const s in this.binders){const a=this.binders[s];if(a instanceof _u||a instanceof uc||a instanceof fa)for(const u of a.uniformNames)i.push({name:u,property:s,binding:a.getBinding(e,u)})}return i}setUniforms(e,i,s,a,u){for(const{name:h,property:p,binding:y}of s)this.binders[p].setUniform(e,y,u,a.get(p),h)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof da||i instanceof fa||i instanceof pa)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof pa&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const s=this.binders[i];(s instanceof da||s instanceof fa||s instanceof pa)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof da||i instanceof fa||i instanceof pa)&&i.destroy()}}}class Eo{constructor(e,i,s=()=>!0){this.programConfigurations={};for(const a of e)this.programConfigurations[a.id]=new Wa(a,i,s);this.needsUpload=!1,this._featureMap=new hu,this._featureMapWithoutIds=new hu,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,s,a,u,h,p,y,v){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,a,u,h,p,y,v);i.id!==void 0?this._featureMap.add(i.id,s,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,s,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,s,a,u,h,p,y){for(const v of s)this.needsUpload=this.programConfigurations[v.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,v,a,u,h,p||0,y)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const My={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Ry(r,e){return My[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const Dy={"line-pattern":{source:Es,composite:Es},"fill-pattern":{source:Es,composite:Es},"fill-extrusion-pattern":{source:Es,composite:Es},"line-dasharray":{source:Il,composite:Il}},Ly={color:{source:Ho,composite:qa},number:{source:ua,composite:Ho}};function $f(r,e,i){const s=Dy[r];return s&&s[i]||Ly[e][i]}Mt(_u,"ConstantBinder"),Mt(uc,"PatternConstantBinder"),Mt(da,"SourceExpressionBinder"),Mt(pa,"PatternCompositeBinder"),Mt(fa,"CompositeExpressionBinder"),Mt(Wa,"ProgramConfiguration",{omit:["_buffers"]}),Mt(Eo,"ProgramConfigurationSet");const ns=ut/Math.PI/2,no=5,td=6,zy=16383,hc=64,Wf=[hc,32,16],so=-ns,oo=ns;function Pl(r,e,i,s=ns){return i=Wi(i),[r*Math.sin(i)*s,-e*s,r*Math.cos(i)*s]}function dc(r,e,i){return Pl(Math.cos(Wi(r)),Math.sin(Wi(r)),e,i)}const l=63710088e-1,t=2*Math.PI*l;class n{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new n(J(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,s=this.lat*i,a=e.lat*i,u=Math.sin(s)*Math.sin(a)+Math.cos(s)*Math.cos(a)*Math.cos((e.lng-this.lng)*i);return l*Math.acos(Math.min(u,1))}toBounds(e=0){const i=360*e/40075017,s=i/Math.cos(Math.PI/180*this.lat);return new c({lng:this.lng-s,lat:this.lat-i},{lng:this.lng+s,lat:this.lat+i})}toEcef(e){return dc(this.lat,this.lng,ns+e*ns/l)}static convert(e){if(e instanceof n)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new n(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new n(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class c{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof n?new n(e.lng,e.lat):n.convert(e),this}setSouthWest(e){return this._sw=e instanceof n?new n(e.lng,e.lat):n.convert(e),this}extend(e){const i=this._sw,s=this._ne;let a,u;if(e instanceof n)a=e,u=e;else{if(!(e instanceof c))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(c.convert(e)):this.extend(n.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(n.convert(e)):this;if(a=e._sw,u=e._ne,!a||!u)return this}return i||s?(i.lng=Math.min(a.lng,i.lng),i.lat=Math.min(a.lat,i.lat),s.lng=Math.max(u.lng,s.lng),s.lat=Math.max(u.lat,s.lat)):(this._sw=new n(a.lng,a.lat),this._ne=new n(u.lng,u.lat)),this}getCenter(){return new n((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new n(this.getWest(),this.getNorth())}getSouthEast(){return new n(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:s}=n.convert(e);let a=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(a=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&a}static convert(e){if(e)return e instanceof c?e:new c(e)}}const d=0,m=25.5;function _(r){return t*Math.cos(r*Math.PI/180)}function x(r){return(180+r)/360}function b(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function E(r,e){return r/_(e)}function I(r){return 360*r-180}function L(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function D(r,e){return r*_(L(e))}const z=85.051129;function B(r){return Math.cos(Wi(U(r,-z,z)))}function F(r,e){const i=U(e,d,m),s=Math.pow(2,i);return B(r)*t/(512*s)}function H(r){return 1/Math.cos(r*Math.PI/180)}function G(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/ut)/(1<<r.z)*2));return 80150034*i/(i*i+1)/ut/(1<<r.z)}class Z{constructor(e,i,s=0){this.x=+e,this.y=+i,this.z=+s}static fromLngLat(e,i=0){const s=n.convert(e);return new Z(x(s.lng),b(s.lat),E(i,s.lat))}toLngLat(){return new n(I(this.x),L(this.y))}toAltitude(){return D(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/t*H(L(this.y))}}function Y(r,e,i,s,a,u,h,p,y){const v=(e+s)/2,w=(i+a)/2,S=new Ye(v,w);p(S),function(A,P,R,O,V,N){const q=R-V,W=O-N;return Math.abs((O-P)*q-(R-A)*W)/Math.hypot(q,W)}(S.x,S.y,u.x,u.y,h.x,h.y)>=y?(Y(r,e,i,v,w,u,S,p,y),Y(r,v,w,s,a,S,h,p,y)):r.push(h)}function X(r,e,i){let s=r[0],a=s.x,u=s.y;e(s);const h=[s];for(let p=1;p<r.length;p++){const y=r[p],{x:v,y:w}=y;e(y),Y(h,a,u,v,w,s,y,e,i),a=v,u=w,s=y}return h}function ce(r,e,i,s){if(s(e,i)){const a=e.add(i)._mult(.5);ce(r,e,a,s),ce(r,a,i,s)}else r.push(i)}function ne(r,e){let i=r[0];const s=[i];for(let a=1;a<r.length;a++){const u=r[a];ce(s,i,u,e),i=u}return s}const ae=Math.pow(2,14)-1,re=-ae-1;function ee(r,e){const i=Math.round(r.x*e),s=Math.round(r.y*e);return r.x=U(i,re,ae),r.y=U(s,re,ae),(i<r.x||i>r.x+1||s<r.y||s>r.y+1)&&St("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function ue(r,e,i){const s=r.loadGeometry(),a=r.extent,u=ut/a;if(e&&i&&i.projection.isReprojectedInTileSpace){const h=1<<e.z,{scale:p,x:y,y:v,projection:w}=i,S=A=>{const P=I((e.x+A.x/a)/h),R=L((e.y+A.y/a)/h),O=w.project(P,R);A.x=(O.x*p-y)*a,A.y=(O.y*p-v)*a};for(let A=0;A<s.length;A++)if(r.type!==1)s[A]=X(s[A],S,1);else{const P=[];for(const R of s[A])R.x<0||R.x>=a||R.y<0||R.y>=a||(S(R),P.push(R));s[A]=P}}for(const h of s)for(const p of h)ee(p,u);return s}function be(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?ue(r):[]}}class xe{constructor(e,i,s,a,u){this.properties={},this.extent=s,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=a,this._values=u,e.readFields(De,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,s=[];let a,u=1,h=0,p=0,y=0;for(;e.pos<i;){if(h<=0){const v=e.readVarint();u=7&v,h=v>>3}if(h--,u===1||u===2)p+=e.readSVarint(),y+=e.readSVarint(),u===1&&(a&&s.push(a),a=[]),a&&a.push(new Ye(p,y));else{if(u!==7)throw new Error(`unknown command ${u}`);a&&a.push(a[0].clone())}}return a&&s.push(a),s}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let s=1,a=0,u=0,h=0,p=1/0,y=-1/0,v=1/0,w=-1/0;for(;e.pos<i;){if(a<=0){const S=e.readVarint();s=7&S,a=S>>3}if(a--,s===1||s===2)u+=e.readSVarint(),h+=e.readSVarint(),u<p&&(p=u),u>y&&(y=u),h<v&&(v=h),h>w&&(w=h);else if(s!==7)throw new Error(`unknown command ${s}`)}return[p,v,y,w]}toGeoJSON(e,i,s){const a=this.extent*Math.pow(2,s),u=this.extent*e,h=this.extent*i,p=this.loadGeometry();function y(A){return[360*(A.x+u)/a-180,360/Math.PI*Math.atan(Math.exp((1-2*(A.y+h)/a)*Math.PI))-90]}function v(A){return A.map(y)}let w;if(this.type===1){const A=[];for(const R of p)A.push(R[0]);const P=v(A);w=A.length===1?{type:"Point",coordinates:P[0]}:{type:"MultiPoint",coordinates:P}}else if(this.type===2){const A=p.map(v);w=A.length===1?{type:"LineString",coordinates:A[0]}:{type:"MultiLineString",coordinates:A}}else{if(this.type!==3)throw new Error("unknown feature type");{const A=function(R){const O=R.length;if(O<=1)return[R];const V=[];let N,q;for(let W=0;W<O;W++){const K=Le(R[W]);K!==0&&(q===void 0&&(q=K<0),q===K<0?(N&&V.push(N),N=[R[W]]):N&&N.push(R[W]))}return N&&V.push(N),V}(p),P=[];for(const R of A)P.push(R.map(v));w=P.length===1?{type:"Polygon",coordinates:P[0]}:{type:"MultiPolygon",coordinates:P}}}const S={type:"Feature",geometry:w,properties:this.properties};return this.id!=null&&(S.id=this.id),S}}function De(r,e,i){r===1?e.id=i.readVarint():r===2?function(s,a){const u=s.readVarint()+s.pos;for(;s.pos<u;){const h=a._keys[s.readVarint()],p=a._values[s.readVarint()];a.properties[h]=p}}(i,e):r===3?e.type=i.readVarint():r===4&&(e._geometry=i.pos)}function Le(r){let e=0;for(let i,s,a=0,u=r.length,h=u-1;a<u;h=a++)i=r[a],s=r[h],e+=(s.x-i.x)*(i.y+s.y);return e}xe.types=["Unknown","Point","LineString","Polygon"];class Ue{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(it,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new xe(this._pbf,i,this.extent,this._keys,this._values)}}function it(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(s){let a=null;const u=s.readVarint()+s.pos;for(;s.pos<u;){const h=s.readVarint()>>3;a=h===1?s.readString():h===2?s.readFloat():h===3?s.readDouble():h===4?s.readVarint64():h===5?s.readVarint():h===6?s.readSVarint():h===7?s.readBoolean():null}if(a==null)throw new Error("unknown feature value");return a}(i))}class Ce{constructor(e,i){this.layers=e.readFields(_e,{},i)}}function _e(r,e,i){if(r===3){const s=new Ue(i,i.readVarint()+i.pos);s.length&&(e[s.name]=s)}}const Fe="3d_elevation_id",Pe="level";class We{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,s){return this.get(e,!0,i,s)}optional(e,i,s){return this.get(e,!1,i,s)}success(){return this._valid}get(e,i,s,a){const u=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&u!==void 0&&!Number.isNaN(u)?s(a?a(u):u):i&&(this._valid=!1),this}}class dt{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,s){return this.featureFunc(e,i,s)}parseVertex(e,i,s){return this.vertexFunc(e,i,s)}}const Tt=new dt((r,e,i)=>r.reset(e).require(Fe,s=>{i.id=s}).optional("fixed_height_relative",s=>{i.constantHeight=s},nt.decodeRelativeHeight).geometry(s=>{i.bounds=s},na).success(),(r,e,i)=>r.reset(e).require(Fe,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height_relative",s=>{i.height=s},nt.decodeRelativeHeight).geometry(s=>{i.position=s},nt.getPoint).success()),ct=new dt((r,e,i)=>r.reset(e).require(Fe,s=>{i.id=s}).optional("fixed_height",s=>{i.constantHeight=s},nt.decodeMetricHeight).geometry(s=>{i.bounds=s},na).success(),(r,e,i)=>r.reset(e).require(Fe,s=>{i.id=s}).require("elevation_idx",s=>{i.idx=s}).require("extent",s=>{i.extent=s}).require("height",s=>{i.height=s},nt.decodeMetricHeight).geometry(s=>{i.position=s},nt.getPoint).success());class nt{static getPoint(e){return rn(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?ct:void 0:Tt}static parse(e){const i=[],s=[],a=e.length,u=new We;for(let h=0;h<a;h++){const p=e.feature(h),y=p.properties.version,v=nt.getVersionSchema(y);if(v===void 0){St(`Unknown elevation feature version number ${y||"(unknown)"}`);continue}const w=p.properties.type;if(!w)continue;const S=xe.types[p.type];if(S==="Point"&&w==="curve_point"){const A={};v.parseVertex(u,p,A)&&i.push(A)}else if(S==="Polygon"&&w==="curve_meta"){const A={};v.parseFeature(u,p,A)&&s.push(A)}}return{vertices:i,features:s}}}class kt{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const a=sl(i,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,!0}}class Dt{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,s){const a=Yt(i,this.dir);if(Math.abs(a)<1e-6)return!1;const u=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/a;return s[0]=this.pos[0]+this.dir[0]*u,s[1]=this.pos[1]+this.dir[1]*u,s[2]=this.pos[2]+this.dir[2]*u,!0}closestPointOnSphere(e,i,s){if(function(P,R){var O=P[0],V=P[1],N=P[2],q=R[0],W=R[1],K=R[2];return Math.abs(O-q)<=Q*Math.max(1,Math.abs(O),Math.abs(q))&&Math.abs(V-W)<=Q*Math.max(1,Math.abs(V),Math.abs(W))&&Math.abs(N-K)<=Q*Math.max(1,Math.abs(N),Math.abs(K))}(this.pos,e)||i===0)return s[0]=s[1]=s[2]=0,!1;const[a,u,h]=this.dir,p=this.pos[0]-e[0],y=this.pos[1]-e[1],v=this.pos[2]-e[2],w=a*a+u*u+h*h,S=2*(p*a+y*u+v*h),A=S*S-4*w*(p*p+y*y+v*v-i*i);if(A<0){const P=Math.max(-S/2,0),R=p+a*P,O=y+u*P,V=v+h*P,N=Math.hypot(R,O,V);return s[0]=R*i/N,s[1]=O*i/N,s[2]=V*i/N,!1}{const P=(-S-Math.sqrt(A))/(2*w);if(P<0){const R=Math.hypot(p,y,v);return s[0]=p*i/R,s[1]=y*i/R,s[2]=v*i/R,!1}return s[0]=p+a*P,s[1]=y+u*P,s[2]=v+h*P,!0}}}class xt{constructor(e,i,s,a,u){this.TL=e,this.TR=i,this.BR=s,this.BL=a,this.horizon=u}static fromInvProjectionMatrix(e,i,s){const a=[-1,1,1],u=[1,1,1],h=[1,-1,1],p=[-1,-1,1],y=Ae(a,a,e),v=Ae(u,u,e),w=Ae(h,h,e),S=Ae(p,p,e);return new xt(y,v,w,S,i/s)}}function Et(r,e,i){let s=1/0,a=-1/0;const u=[];for(const h of r){jt(u,h,e);const p=Yt(u,i);s=Math.min(s,p),a=Math.max(a,p)}return[s,a]}function $t(r,e){let i=!0;for(let s=0;s<r.planes.length;s++){const a=r.planes[s];let u=0;for(let h=0;h<e.length;h++)u+=+(Yt(a,e[h])+a[3]>=0);if(u===0)return 0;u!==e.length&&(i=!1)}return i?2:1}function di(r,e){for(const i of r.projections){const s=Et(e,r.points[0],i.axis);if(i.projection[1]<s[0]||i.projection[0]>s[1])return 0}return 1}function Ri(r,e){let i=0;const s=[0,0,0,0];for(let h=0;h<r.length;h++)s[0]=r[h][0],s[1]=r[h][1],s[2]=r[h][2],s[3]=1,(a=s)[0]*(u=e)[0]+a[1]*u[1]+a[2]*u[2]+a[3]*u[3]>=0&&i++;var a,u;return i}class Yi{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ft.fromPoints(this.points),this.projections=[],this.frustumEdges=[jt([],this.points[2],this.points[3]),jt([],this.points[0],this.points[3]),jt([],this.points[4],this.points[0]),jt([],this.points[5],this.points[1]),jt([],this.points[6],this.points[2]),jt([],this.points[7],this.points[3])];for(const s of this.frustumEdges){const a=[0,-s[2],s[1]],u=[s[2],0,-s[0]];this.projections.push({axis:a,projection:Et(this.points,this.points[0],a)}),this.projections.push({axis:u,projection:Et(this.points,this.points[0],u)})}}static fromInvProjectionMatrix(e,i,s,a){const u=Math.pow(2,s),h=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(v=>{const w=hi([],v,e),S=1/w[3]/i*u;return(A=w)[0]=(P=w)[0]*(R=[S,S,a?1/w[3]:S,S])[0],A[1]=P[1]*R[1],A[2]=P[2]*R[2],A[3]=P[3]*R[3],A;var A,P,R}),p=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(v=>{const w=zt([],sr([],jt([],h[v[0]],h[v[1]]),jt([],h[v[2]],h[v[1]]))),S=-Yt(w,h[v[1]]);return w.concat(S)}),y=[];for(let v=0;v<h.length;v++)y.push([h[v][0],h[v][1],h[v][2]]);return new Yi(y,p)}intersectsPrecise(e,i,s){for(let a=0;a<i.length;a++)if(!Ri(e,i[a]))return 0;for(let a=0;a<this.planes.length;a++)if(!Ri(e,this.planes[a]))return 0;for(const a of s)for(const u of this.frustumEdges){const h=sr([],a,u),p=ln(h);if(p===0)continue;Cr(h,h,1/p);const y=Et(this.points,this.points[0],h),v=Et(e,this.points[0],h);if(y[0]>v[1]||v[0]>y[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const s=i[3];if(Yt([i[0],i[1],i[2]],e)+s<0)return!1}return!0}}class Ft{static fromPoints(e){const i=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const a of e)Nn(i,i,a),fn(s,s,a);return new Ft(i,s)}static fromTileIdAndHeight(e,i,s){const a=1<<e.canonical.z,u=e.canonical.x,h=e.canonical.y;return new Ft([u/a,h/a,i],[(u+1)/a,(h+1)/a,s])}static applyTransform(e,i){const s=e.getCorners();for(let a=0;a<s.length;++a)Ae(s[a],s[a],i);return Ft.fromPoints(s)}static applyTransformFast(e,i){const s=[i[12],i[13],i[14]],a=[...s];for(let u=0;u<3;u++)for(let h=0;h<3;h++){const p=i[4*h+u],y=p*e.min[h],v=p*e.max[h];s[u]+=Math.min(y,v),a[u]+=Math.max(y,v)}return new Ft(s,a)}static projectAabbCorners(e,i){const s=e.getCorners();for(let a=0;a<s.length;++a)Ae(s[a],s[a],i);return s}constructor(e,i){this.min=e,this.max=i,this.center=Cr([],Oi([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],s=Ro(this.min),a=Ro(this.max);for(let u=0;u<i.length;u++)s[u]=i[u]?this.min[u]:this.center[u],a[u]=i[u]?this.center[u]:this.max[u];return a[2]=this.max[2],new Ft(s,a)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?$t(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?$t(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?di(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?di(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Mt(Ft,"Aabb");class Zi{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,s=i[1],a=-i[0],u=(e.extent+1)*this.metersToTile;return[new Ye(Math.trunc(e.position[0]+s*u),Math.trunc(e.position[1]+a*u)),new Ye(Math.trunc(e.position[0]-s*u),Math.trunc(e.position[1]-a*u))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class ui{constructor(e,i,s,a,u,h){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[bn(),bn(),bn(),bn(),bn(),bn(),bn()],this.id=e,this.heightRange={min:s,max:s},this.safeArea=i,this.constantHeight=s,this.constantHeight==null&&(this.constantHeight!=null||a.length!==0)){this.vertices=a,this.edges=u,this.edges=this.edges.filter(p=>{return p.a<this.vertices.length&&p.b<this.vertices.length&&!((y=this.vertices[p.a].position)[0]===(v=this.vertices[p.b].position)[0]&&y[1]===v[1]);var y,v}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const p of this.vertices)this.vertexProps.push({dir:rn(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,p.height),this.heightRange.max=Math.max(this.heightRange.max,p.height);for(const p of this.edges){const y=this.vertices[p.a].position,v=this.vertices[p.b].position,w=Do(bn(),v,y),S=_o(w),A=Qo(bn(),w,1/S);this.edgeProps.push({vec:w,dir:A,len:S});const P=this.vertexProps[p.a].dir,R=this.vertexProps[p.b].dir;mo(P,P,A),mo(R,R,A)}for(const p of this.vertexProps)p.dir[0]===0&&p.dir[1]===0||Dc(p.dir,p.dir);this.tessellate(h)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[s,a]=i;return ii(this.vertices[this.edges[s].a].height,this.vertices[this.edges[s].b].height,a)}computeSlopeNormal(e,i){const s=this.getClosestEdge(e);if(!s)return Qi(0,0,1);const a=s[0],u=this.edges[a],h=this.edgeProps[a].vec,p=Qi(h[0],h[1],(this.vertices[u.b].height-this.vertices[u.a].height)*i),y=Qi(p[1],-p[0],0);sr(y,y,p);const v=ln(y);return v>0?Cr(y,y,1/v):Ei(y,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,s=Number.POSITIVE_INFINITY,a=0;const[u,h,p,y,v,w,S]=this._tmpVec2;ps(S,e.x,e.y);const A=new kt(S,null);for(let P=0;P<this.edges.length;P++){const R=this.edges[P],O=this.edgeProps[P].dir;A.dir=O;const V=this.vertices[R.a].position,N=this.vertices[R.b].position,q=A.intersectsPlane(V,this.vertexProps[R.a].dir,u),W=A.intersectsPlane(N,this.vertexProps[R.b].dir,h);if(!q||!W)continue;Do(p,h,u),Do(y,S,u);const K=sl(p,p),se=K>0?sl(y,p)/K:0,te=U(se,0,1),le=Math.abs((se-te)*this.edgeProps[P].len);Do(v,S,V),ps(w,O[1],-O[0]);const fe=le+Math.abs(sl(v,w));fe<s&&(i=P,s=fe,a=te)}return[i,a]}tessellate(e){const i=Fi(),s=Fi(),a=Fi(),u=Fi();for(let h=this.edges.length-1;h>=0;--h){const p=this.edges[h].a,y=this.edges[h].b,{position:v,height:w,extent:S}=this.vertices[p],{position:A,height:P,extent:R}=this.vertices[y],O=this.vertexProps[p].dir,V=this.vertexProps[y].dir;if(Ei(i,v[0]/e,v[1]/e,w),Ei(s,A[0]/e,A[1]/e,P),Ei(a,O[1],-O[0],0),Cr(a,a,S),Ei(u,V[1],-V[0],0),Cr(u,u,R),this.distSqLines(Qi(i[0]+.5*a[0],i[1]+.5*a[1],i[2]+.5*a[2]),Qi(s[0]-.5*u[0],s[1]-.5*u[1],s[2]-.5*u[2]),Qi(i[0]-.5*a[0],i[1]-.5*a[1],i[2]-.5*a[2]),Qi(s[0]+.5*u[0],s[1]+.5*u[1],s[2]+.5*u[2]))<=.0025000000000000005)continue;const N=this.vertices.length,q=mo(bn(),v,A);this.vertices.push({position:Qo(q,q,.5),height:.5*(w+P),extent:.5*(S+R)});const W=mo(bn(),O,V);this.vertexProps.push({dir:Dc(W,W)}),this.edges.splice(h,1),this.edgeProps.splice(h,1),this.edges.push({a:p,b:N}),this.edges.push({a:N,b:y});const K=Do(bn(),this.vertices[N].position,v),se=_o(K),te={vec:K,dir:Qo(bn(),K,1/se),len:se};this.edgeProps.push(te),this.edgeProps.push(te)}}distSqLines(e,i,s,a){const u=Gn(Fi(),i,e),h=Gn(Fi(),a,s),p=Gn(Fi(),e,s),y=Yt(u,u),v=Yt(u,h),w=Yt(u,p),S=Yt(h,h),A=Yt(h,p),P=y*S-v*v;if(P===0)return Qn(Ie(u,s,a,Yt(p,h)/Yt(h,h)),e);const R=(y*A-v*w)/P;return Qn(Ie(u,e,i,(v*A-w*S)/P),Ie(h,s,a,R))}}class tr{static parseFrom(e,i){const s=nt.parse(e);if(!s)return[];let{vertices:a,features:u}=s;const h=1/G(i);u.sort((w,S)=>w.id-S.id),a.sort((w,S)=>w.id-S.id||w.idx-S.idx),a=a.filter((w,S,A)=>S===A.findIndex(P=>P.id===w.id&&P.idx===w.idx));const p=new Array;let y=0;const v=a.length;for(const w of u){if(w.constantHeight){p.push(new ui(w.id,w.bounds,w.constantHeight));continue}for(;y!==v&&a[y].id<w.id;)y++;if(y===v||a[y].id!==w.id)continue;const S=new Array,A=new Array,P=y;for(;y!==v&&a[y].id===w.id;){const R=a[y];if(S.push({position:R.position,height:R.height,extent:R.extent}),y!==P&&a[y-1].idx===R.idx-1){const O=y-P;A.push({a:O-1,b:O})}y++}p.push(new ui(w.id,w.bounds,void 0,S,A,h))}return p}static getElevationFeature(e,i){if(!i)return;const s=+e.properties[Fe];return Number.isNaN(s)?void 0:i.find(a=>a.id===s)}}class hr{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*ut,this.yOffset=(e.y*this.zScale-i.y)*ut)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,s){const a=this.constantElevation(i,s);return a??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),s))}computeBiasedHeight(e,i){return i<=0?e:e+i*$(0,i,e>=0?e:Math.abs(.5*e))}}Mt(ui,"ElevationFeature");class ar{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Ha,this.indexArray=new wn,this.segments=new Nr,this.programConfigurations=new Eo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new ua),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){const u=this.layers[0],h=[];let p=null;u.type==="circle"&&(p=u.layout.get("circle-sort-key"));for(const{feature:v,id:w,index:S,sourceLayerIndex:A}of e){const P=this.layers[0]._featureFilter.needGeometry,R=be(v,P);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),R,s))continue;const O=p?p.evaluate(R,{},s):void 0,V={id:w,properties:v.properties,type:v.type,sourceLayerIndex:A,index:S,geometry:P?R.geometry:ue(v,s,a),patterns:{},sortKey:O};h.push(V)}p&&h.sort((v,w)=>v.sortKey-w.sortKey);let y=null;a.projection.name==="globe"&&(this.globeExtVertexArray=new Bh,y=a.projection);for(const v of h){const{geometry:w,index:S,sourceLayerIndex:A}=v,P=e[S].feature;this.addFeature(v,w,S,i.availableImages,s,y,i.brightness,i.elevationFeatures),i.featureIndex.insert(P,w,S,A,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,s,a,u,h,p){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,f_.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Sy.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,s,a,u,h,p,y){let v;this.elevationMode!=="none"&&(v=tr.getElevationFeature(e,y));for(const w of i)for(const S of w){const A=S.x,P=S.y;if(A<0||A>=ut||P<0||P>=ut)continue;if(h){const V=h.projectTilePoint(A,P,u),N=h.upVector(u,A,P);this.addGlobeExtVertex(V,N),this.addGlobeExtVertex(V,N),this.addGlobeExtVertex(V,N),this.addGlobeExtVertex(V,N)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),O=R.vertexLength;if(this.addCircleVertex(A,P,-1,-1),this.addCircleVertex(A,P,1,-1),this.addCircleVertex(A,P,1,1),this.addCircleVertex(A,P,-1,1),this.elevationMode!=="none"){const V=v?v.pointElevation(new Ye(A,P)):0;this.hasElevation=this.hasElevation||V!==0;for(let N=0;N<4;N++)this.elevatedLayoutVertexArray.emplaceBack(V)}this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+2,O+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},a,u,p,void 0,this.worldview)}addCircleVertex(e,i,s,a){this.layoutVertexArray.emplaceBack(2*e+(s+1)/2,2*i+(a+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function $i(r,e){for(let i=0;i<r.length;i++)if(gr(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(gr(r,e[i]))return!0;return!!Or(r,e)}function xi(r,e,i){return!!gr(r,e)||!!Lr(e,r,i)}function er(r,e){if(r.length===1)return Vr(e,r[0]);for(let i=0;i<e.length;i++){const s=e[i];for(let a=0;a<s.length;a++)if(gr(r,s[a]))return!0}for(let i=0;i<r.length;i++)if(Vr(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Or(r,e[i]))return!0;return!1}function $r(r,e,i){if(r.length>1){if(Or(r,e))return!0;for(let s=0;s<e.length;s++)if(Lr(e[s],r,i))return!0}for(let s=0;s<r.length;s++)if(Lr(r[s],e,i))return!0;return!1}function Or(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const s=r[i],a=r[i+1];for(let u=0;u<e.length-1;u++)if(ir(s,a,e[u],e[u+1]))return!0}return!1}function ir(r,e,i,s){return yi(r,i,s)!==yi(e,i,s)&&yi(r,e,i)!==yi(r,e,s)}function ji(r,e,i){return(r.x-i.x)*(e.y-i.y)-(r.y-i.y)*(e.x-i.x)}function vi(r,e,i,s){const a=ji(r,e,s),u=ji(r,e,i);if(Math.sign(a)===Math.sign(u))return;const h=ji(i,s,r),p=h+u-a;return Math.sign(h)!==Math.sign(p)?[h/(h-p),u/(u-a)]:void 0}function Lr(r,e,i){const s=i*i;if(e.length===1)return r.distSqr(e[0])<s;for(let a=1;a<e.length;a++)if(en(r,e[a-1],e[a])<s)return!0;return!1}function en(r,e,i){const s=e.distSqr(i);if(s===0)return r.distSqr(e);const a=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/s;return r.distSqr(a<0?e:a>1?i:i.sub(e)._mult(a)._add(e))}function Vr(r,e){let i,s,a,u=!1;for(let h=0;h<r.length;h++){i=r[h];for(let p=0,y=i.length-1;p<i.length;y=p++)s=i[p],a=i[y],s.y>e.y!=a.y>e.y&&e.x<(a.x-s.x)*(e.y-s.y)/(a.y-s.y)+s.x&&(u=!u)}return u}function gr(r,e){let i=!1;for(let s=0,a=r.length-1;s<r.length;a=s++){const u=r[s],h=r[a];u.y>e.y!=h.y>e.y&&e.x<(h.x-u.x)*(e.y-u.y)/(h.y-u.y)+u.x&&(i=!i)}return i}function vs(r,e,i,s,a){for(const h of r)if(e<=h.x&&i<=h.y&&s>=h.x&&a>=h.y)return!0;const u=[new Ye(e,i),new Ye(e,a),new Ye(s,a),new Ye(s,i)];if(r.length>2){for(const h of u)if(gr(r,h))return!0}for(let h=0;h<r.length-1;h++)if(Kn(r[h],r[h+1],u))return!0;return!1}function Kn(r,e,i){const s=i[0],a=i[2];if(r.x<s.x&&e.x<s.x||r.x>a.x&&e.x>a.x||r.y<s.y&&e.y<s.y||r.y>a.y&&e.y>a.y)return!1;const u=yi(r,e,i[0]);return u!==yi(r,e,i[1])||u!==yi(r,e,i[2])||u!==yi(r,e,i[3])}function Sn(r,e,i,s,a,u){let h=e.y-r.y,p=r.x-e.x;if(u=u||0){const y=h*h+p*p;if(y===0)return!0;const v=Math.sqrt(y);h/=v,p/=v}return!((i.x-r.x)*h+(i.y-r.y)*p-u<0||(s.x-r.x)*h+(s.y-r.y)*p-u<0||(a.x-r.x)*h+(a.y-r.y)*p-u<0)}function ss(r,e,i,s,a,u,h){return!(Sn(r,e,s,a,u,h)||Sn(e,i,s,a,u,h)||Sn(i,r,s,a,u,h)||Sn(s,a,r,e,i,h)||Sn(a,u,r,e,i,h)||Sn(u,s,r,e,i,h))}function os(r,e,i){const s=e.paint.get(r).value;return s.kind==="constant"?s.value:i.programConfigurations.get(e.id).getMaxValue(r)}function Wn(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function qs(r,e,i,s,a){if(!e[0]&&!e[1])return r;const u=Ye.convert(e)._mult(a);i==="viewport"&&u._rotate(-s);const h=[];for(let p=0;p<r.length;p++)h.push(r[p].sub(u));return h}function ao(r,e,i,s){const a=Ye.convert(r)._mult(s);return e==="viewport"&&a._rotate(-i),a}let Is,Kr;function nn(r,e,i){var s=2*Math.PI*6378137/256/Math.pow(2,i);return[r*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}Mt(ar,"CircleBucket",{omit:["layers"]});class yr{constructor(e,i,s){this.z=e,this.x=i,this.y=s,this.key=Ur(0,e,e,i,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const s=function(u,h,p){var y=nn(256*u,256*(h=Math.pow(2,p)-h-1),p),v=nn(256*(u+1),256*(h+1),p);return y[0]+","+y[1]+","+v[0]+","+v[1]}(this.x,this.y,this.z),a=function(u,h,p){let y,v="";for(let w=u;w>0;w--)y=1<<w-1,v+=(h&y?1:0)+(p&y?2:0);return v}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",a).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class dn{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Ur(e,i.z,i.z,i.x,i.y)}}class Wr{constructor(e,i,s,a,u){this.overscaledZ=e,this.wrap=i,this.canonical=new yr(s,+a,+u),this.key=i===0&&e===s?this.canonical.key:Ur(i,e,s,a,u)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new Wr(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wr(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Ur(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Ur(this.wrap*+i,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new Wr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,s=2*this.canonical.x,a=2*this.canonical.y;return[new Wr(i,this.wrap,i,s,a),new Wr(i,this.wrap,i,s+1,a),new Wr(i,this.wrap,i,s,a+1),new Wr(i,this.wrap,i,s+1,a+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Wr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Wr(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dn(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Ur(r,e,i,s,a){const u=1<<Math.min(i,22);let h=u*(a%u)+s%u;return r&&i<22&&(h+=u*u*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*h+i)+(e-i)}const lo=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new Wr(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new Wr(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new Wr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new Wr(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Mt(yr,"CanonicalTileID"),Mt(Wr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const gu=Ii([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Ao}=gu,yu=Ii([{name:"a_pos_3",components:3,type:"Int16"}]);var fc=Ii([{name:"a_pos",type:"Int16",components:2}]);function $o(r){return r*ns/l}const ma=[new Ft([so,so,so],[oo,oo,oo]),new Ft([so,so,so],[0,0,oo]),new Ft([0,so,so],[oo,0,oo]),new Ft([so,0,so],[0,oo,oo]),new Ft([0,0,so],[oo,oo,oo])];function pc(r,e,i,s=!0){const a=Cr([],r._camera.position,r.worldSize),u=[e,i,1,1];hi(u,u,r.pixelMatrixInverse),Ai(u,u,1/u[3]);const h=zt([],jt([],u,a)),p=r.globeMatrix,y=[p[12],p[13],p[14]],v=jt([],y,a),w=ln(v),S=zt([],v),A=r.worldSize/(2*Math.PI),P=Yt(S,h),R=Math.asin(A/w);if(R<Math.acos(P)){if(!s)return null;const ze=[],we=[];Cr(ze,h,w/P),zt(we,jt(we,ze,v)),zt(h,Oi(h,v,Cr(h,we,Math.tan(R)*w)))}const O=[];new Dt(a,h).closestPointOnSphere(y,A,O);const V=zt([],Jr(p,0)),N=zt([],Jr(p,1)),q=zt([],Jr(p,2)),W=Yt(V,O),K=Yt(N,O),se=Yt(q,O),te=us(Math.asin(-K/A));let le=us(Math.atan2(W,se));le=r.center.lng+function(ze,we){const Ne=(we-ze+180)%360-180;return Ne<-180?Ne+360:Ne}(r.center.lng,le);const fe=x(le),ge=U(b(te),0,1);return new Z(fe,ge)}class Za{constructor(e,i,s){this.a=jt([],e,s),this.b=jt([],i,s),this.center=s;const a=zt([],this.a),u=zt([],this.b);this.angle=Math.acos(Yt(a,u))}}function _a(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(s,a,u,h){const p=Math.sin(u);return s*(Math.sin((1-h)*u)/p)+a*(Math.sin(h*u)/p)}(r.a[e],r.b[e],r.angle,U(i,0,1))+r.center[e]}function Io(r){if(r.z<=1)return ma[r.z+2*r.y+r.x];const e=Oy(p_(r));return Ft.fromPoints(e)}function ga(r,e,i){return Cr(r,r,1-i),qn(r,r,e,i)}function fv(r,e,i){for(const s of r)Ae(s,s,e),Cr(s,s,i)}function pv(r,e,i,s){const a=e/r.worldSize,u=r.globeMatrix;if(i.z<=1){const ge=Io(i).getCorners();return fv(ge,u,a),Ft.fromPoints(ge)}const h=p_(i,s),p=Oy(h,ns+$o(r._tileCoverLift));fv(p,u,a);const y=Number.MAX_VALUE,v=[-y,-y,-y],w=[y,y,y];if(h.contains(r.center)){for(const we of p)Nn(w,w,we),fn(v,v,we);v[2]=0;const ge=r.point,ze=[ge.x*a,ge.y*a,0];return Nn(w,w,ze),fn(v,v,ze),new Ft(w,v)}if(r._tileCoverLift>0){for(const ge of p)Nn(w,w,ge),fn(v,v,ge);return new Ft(w,v)}const S=[u[12]*a,u[13]*a,u[14]*a],A=h.getCenter(),P=U(r.center.lat,-z,z),R=U(A.lat,-z,z),O=x(r.center.lng),V=b(P);let N=O-x(A.lng);const q=V-b(R);N>.5?N-=1:N<-.5&&(N+=1);let W=0;Math.abs(N)>Math.abs(q)?W=N>=0?1:3:(W=q>=0?0:2,qn(S,S,[u[4]*a,u[5]*a,u[6]*a],-Math.sin(Wi(q>=0?h.getSouth():h.getNorth()))*ns));const K=p[W],se=p[(W+1)%4],te=new Za(K,se,S),le=[_a(te,0)||K[0],_a(te,1)||K[1],_a(te,2)||K[2]],fe=mc(r.zoom);if(fe>0){const ge=function({x:we,y:Ne,z:He},qe,Je,et,Ze){const Xe=1/(1<<He);let Be=we*Xe,ke=Be+Xe,Ke=Ne*Xe,ht=Ke+Xe,st=0;const Nt=(Be+ke)/2-et;return Nt>.5?st=-1:Nt<-.5&&(st=1),Be=((Be+st)*qe-(et*=qe))*Je+et,ke=((ke+st)*qe-et)*Je+et,Ke=(Ke*qe-(Ze*=qe))*Je+Ze,ht=(ht*qe-Ze)*Je+Ze,[[Be,ht,0],[ke,ht,0],[ke,Ke,0],[Be,Ke,0]]}(i,e,r._pixelsPerMercatorPixel,O,V);for(let we=0;we<p.length;we++)ga(p[we],ge[we],fe);const ze=Oi([],ge[W],ge[(W+1)%4]);Cr(ze,ze,.5),ga(le,ze,fe)}for(const ge of p)Nn(w,w,ge),fn(v,v,ge);return w[2]=Math.min(K[2],se[2]),Nn(w,w,le),fn(v,v,le),new Ft(w,v)}function p_({x:r,y:e,z:i},s=!1){const a=1/(1<<i),u=new n(I(r*a),e===(1<<i)-1&&s?-90:L((e+1)*a)),h=new n(I((r+1)*a),e===0&&s?90:L(e*a));return new c(u,h)}function Oy(r,e=ns){const i=Wi(r.getNorth()),s=Wi(r.getSouth()),a=Math.cos(i),u=Math.cos(s),h=Math.sin(i),p=Math.sin(s),y=r.getWest(),v=r.getEast();return[Pl(u,p,y,e),Pl(u,p,v,e),Pl(a,h,v,e),Pl(a,h,y,e)]}function Zf(r,e,i,s){const a=1<<i.z,u=(r/ut+i.x)/a;return dc(L((e/ut+i.y)/a),I(u),s)}function m_({min:r,max:e}){return zy/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const mv=new Float64Array(16);function __(r){const e=m_(r),i=vn(mv,[e,e,e]);return Xt(i,i,ci([],r.min))}function ky(r){const e=(s=r.min,(i=mv)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=s[0],i[13]=s[1],i[14]=s[2],i[15]=1,i);var i,s;const a=1/m_(r);return Zt(e,e,[a,a,a])}function Fy(r){const e=ut/(2*Math.PI);return r/(2*Math.PI)/e}function _v(r,e){return ut/(512*Math.pow(2,r))*m_(Io(e))}function gv(r,e,i,s,a){const u=Fy(i),h=[r,e,-i/(2*Math.PI)],p=mt(new Float64Array(16));return Xt(p,p,h),Zt(p,p,[u,u,u]),Li(p,p,Wi(-a)),Sr(p,p,Wi(-s)),p}function mc(r){return $(no,td,r)}function yv(r,e){const i=dc(e.lat,e.lng),s=function(R){const O=dc(R._center.lat,R._center.lng);let V=sr([],Qi(0,1,0),O);const N=Zn([],-R.angle,O);V=Ae(V,V,N),Zn(N,-R._pitch,V);const q=zt([],O);return Cr(q,q,$o(R.cameraToCenterDistance/R.pixelsPerMeter)),Ae(q,q,N),Oi([],O,q)}(r);return h=(a=Gn([],s,i))[0],p=a[1],y=a[2],v=(u=i)[0],w=u[1],S=u[2],P=(A=Math.sqrt((h*h+p*p+y*y)*(v*v+w*w+S*S)))&&Yt(a,u)/A,Math.acos(Math.min(Math.max(P,-1),1));var a,u,h,p,y,v,w,S,A,P}function By(r,e){return yv(r,e)>Math.PI/2*1.01}const xv=Wi(85),PE=Math.cos(xv),ME=Math.sin(xv),RE=ft(),vv=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function bv(r,e,i,s,a,u,h,p,y){if(u&&r.queryGeometry.isAboveHorizon)return!1;u&&(y*=r.pixelToTileUnitsFactor);const v=r.tileID.canonical,w=i.projection.upVectorScale(v,i.center.lat,i.worldSize).metersToTile;for(const S of e)for(const A of S){const P=A.add(p),R=a&&i.elevation?i.elevation.exaggeration()*a.getElevationAt(P.x,P.y,!0):0,O=i.projection.projectTilePoint(P.x,P.y,v);if(R>0){const W=i.projection.upVector(v,P.x,P.y);O.x+=W[0]*w*R,O.y+=W[1]*w*R,O.z+=W[2]*w*R}const V=u?P:DE(O.x,O.y,O.z,s),N=u?r.tilespaceRays.map(W=>zE(W,R)):r.queryGeometry.screenGeometry,q=hi([],[O.x,O.y,O.z,1],s);if(!h&&u?y*=q[3]/i.cameraToCenterDistance:h&&!u&&(y*=i.cameraToCenterDistance/q[3]),u){const W=L((A.y/ut+v.y)/(1<<v.z));y/=i.projection.pixelsPerMeter(W,1)/E(1,W)}if(xi(N,V,y))return!0}return!1}function DE(r,e,i,s){const a=hi([],[r,e,i,1],s);return new Ye(a[0]/a[3],a[1]/a[3])}const wv=Qi(0,0,0),LE=Qi(0,0,1);function zE(r,e){const i=Fi();return wv[2]=e,r.intersectsPlane(wv,LE,i),new Ye(i[0],i[1])}class Tv extends ar{}let Sv,Ev,Av,Iv;function Cv(r,{width:e,height:i},s,a){if(a){if(a instanceof Uint8ClampedArray)a=new Uint8Array(a.buffer);else if(a.length!==e*i*s)throw new RangeError("mismatched image size")}else a=new Uint8Array(e*i*s);return r.width=e,r.height=i,r.data=a,r}function Pv(r,e,i){const{width:s,height:a}=e;s===r.width&&a===r.height||(Ny(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,s),height:Math.min(r.height,a)},i,null),r.width=s,r.height=a,r.data=e.data)}function Ny(r,e,i,s,a,u,h,p){if(a.width===0||a.height===0)return e;if(a.width>r.width||a.height>r.height||i.x>r.width-a.width||i.y>r.height-a.height)throw new RangeError("out of range source coordinates for image copy");if(a.width>e.width||a.height>e.height||s.x>e.width-a.width||s.y>e.height-a.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,v=e.data,w=u===4&&p;for(let S=0;S<a.height;S++){const A=((i.y+S)*r.width+i.x)*u,P=((s.y+S)*e.width+s.x)*u;if(w)for(let R=0;R<a.width;R++){const O=A+R*u+3,V=P+R*u;v[V+0]=255,v[V+1]=255,v[V+2]=255,v[V+3]=y[O]}else if(h)for(let R=0;R<a.width;R++){const O=A+R*u,V=P+R*u,N=new or(y[O+0]/255,y[O+1]/255,y[O+2]/255,y[O+3]).toNonPremultipliedRenderColor(h).toArray();v[V+0]=N[0],v[V+1]=N[1],v[V+2]=N[2],v[V+3]=N[3]}else for(let R=0;R<a.width*u;R++)v[P+R]=y[A+R]}return e}Mt(Tv,"HeatmapBucket",{omit:["layers"]});class _c{constructor(e,i){Cv(this,e,1,i)}resize(e){Pv(this,new _c(e),1)}clone(){return new _c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,u){Ny(e,i,s,a,u,1,null)}}class as{constructor(e,i){Cv(this,e,4,i)}resize(e){Pv(this,new as(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new as({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,s,a,u,h,p){Ny(e,i,s,a,u,4,h,p)}}class Mv{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Xf(r){const e={},i=r.resolution||256,s=r.clips?r.clips.length:1,a=r.image||new as({width:i,height:s}),u=(h,p,y)=>{e[r.evaluationKey]=y;const v=r.expression.evaluate(e),w=v?v.toNonPremultipliedRenderColor(null):null;w&&(a.data[h+p+0]=Math.floor(255*w.r),a.data[h+p+1]=Math.floor(255*w.g),a.data[h+p+2]=Math.floor(255*w.b),a.data[h+p+3]=Math.floor(255*w.a))};if(r.clips)for(let h=0,p=0;h<s;++h,p+=4*i)for(let y=0,v=0;y<i;y++,v+=4){const w=y/(i-1),{start:S,end:A}=r.clips[h];u(p,v,S*(1-w)+A*w)}else for(let h=0,p=0;h<i;h++,p+=4)u(0,p,h/(i-1));return a}Mt(_c,"AlphaImage"),Mt(as,"RGBAImage");const OE=Ii([{name:"a_pos",components:2,type:"Int16"}],4),kE=Ii([{name:"a_road_z_offset",components:1,type:"Float32"}],4),FE=Ii([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),BE=Ii([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function id(r,e,i=2){const s=e&&e.length,a=s?e[0]*i:r.length;let u=Rv(r,0,a,i,!0);const h=[];if(!u||u.next===u.prev)return h;let p,y,v;if(s&&(u=function(w,S,A,P){const R=[];for(let O=0,V=S.length;O<V;O++){const N=Rv(w,S[O]*P,O<V-1?S[O+1]*P:w.length,P,!1);N===N.next&&(N.steiner=!0),R.push($E(N))}R.sort(GE);for(let O=0;O<R.length;O++)A=HE(R[O],A);return A}(r,e,u,i)),r.length>80*i){p=r[0],y=r[1];let w=p,S=y;for(let A=i;A<a;A+=i){const P=r[A],R=r[A+1];P<p&&(p=P),R<y&&(y=R),P>w&&(w=P),R>S&&(S=R)}v=Math.max(w-p,S-y),v=v!==0?32767/v:0}return Kf(u,h,i,p,y,v,0),h}function Rv(r,e,i,s,a){let u;if(a===function(h,p,y,v){let w=0;for(let S=p,A=y-v;S<y;S+=v)w+=(h[A]-h[S])*(h[S+1]+h[A+1]),A=S;return w}(r,e,i,s)>0)for(let h=e;h<i;h+=s)u=Ov(h/s|0,r[h],r[h+1],u);else for(let h=i-s;h>=e;h-=s)u=Ov(h/s|0,r[h],r[h+1],u);return u&&rd(u,u.next)&&(Qf(u),u=u.next),u}function xu(r,e){if(!r)return r;e||(e=r);let i,s=r;do if(i=!1,s.steiner||!rd(s,s.next)&&jn(s.prev,s,s.next)!==0)s=s.next;else{if(Qf(s),s=e=s.prev,s===s.next)break;i=!0}while(i||s!==e);return e}function Kf(r,e,i,s,a,u,h){if(!r)return;!h&&u&&function(y,v,w,S){let A=y;do A.z===0&&(A.z=Vy(A.x,A.y,v,w,S)),A.prevZ=A.prev,A.nextZ=A.next,A=A.next;while(A!==y);A.prevZ.nextZ=null,A.prevZ=null,function(P){let R,O=1;do{let V,N=P;P=null;let q=null;for(R=0;N;){R++;let W=N,K=0;for(let te=0;te<O&&(K++,W=W.nextZ,W);te++);let se=O;for(;K>0||se>0&&W;)K!==0&&(se===0||!W||N.z<=W.z)?(V=N,N=N.nextZ,K--):(V=W,W=W.nextZ,se--),q?q.nextZ=V:P=V,V.prevZ=q,q=V;N=W}q.nextZ=null,O*=2}while(R>1)}(A)}(r,s,a,u);let p=r;for(;r.prev!==r.next;){const y=r.prev,v=r.next;if(u?VE(r,s,a,u):NE(r))e.push(y.i,r.i,v.i),Qf(r),r=v.next,p=v.next;else if((r=v)===p){h?h===1?Kf(r=UE(xu(r),e),e,i,s,a,u,2):h===2&&jE(r,e,i,s,a,u):Kf(xu(r),e,i,s,a,u,1);break}}}function NE(r){const e=r.prev,i=r,s=r.next;if(jn(e,i,s)>=0)return!1;const a=e.x,u=i.x,h=s.x,p=e.y,y=i.y,v=s.y,w=Math.min(a,u,h),S=Math.min(p,y,v),A=Math.max(a,u,h),P=Math.max(p,y,v);let R=s.next;for(;R!==e;){if(R.x>=w&&R.x<=A&&R.y>=S&&R.y<=P&&Yf(a,p,u,y,h,v,R.x,R.y)&&jn(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function VE(r,e,i,s){const a=r.prev,u=r,h=r.next;if(jn(a,u,h)>=0)return!1;const p=a.x,y=u.x,v=h.x,w=a.y,S=u.y,A=h.y,P=Math.min(p,y,v),R=Math.min(w,S,A),O=Math.max(p,y,v),V=Math.max(w,S,A),N=Vy(P,R,e,i,s),q=Vy(O,V,e,i,s);let W=r.prevZ,K=r.nextZ;for(;W&&W.z>=N&&K&&K.z<=q;){if(W.x>=P&&W.x<=O&&W.y>=R&&W.y<=V&&W!==a&&W!==h&&Yf(p,w,y,S,v,A,W.x,W.y)&&jn(W.prev,W,W.next)>=0||(W=W.prevZ,K.x>=P&&K.x<=O&&K.y>=R&&K.y<=V&&K!==a&&K!==h&&Yf(p,w,y,S,v,A,K.x,K.y)&&jn(K.prev,K,K.next)>=0))return!1;K=K.nextZ}for(;W&&W.z>=N;){if(W.x>=P&&W.x<=O&&W.y>=R&&W.y<=V&&W!==a&&W!==h&&Yf(p,w,y,S,v,A,W.x,W.y)&&jn(W.prev,W,W.next)>=0)return!1;W=W.prevZ}for(;K&&K.z<=q;){if(K.x>=P&&K.x<=O&&K.y>=R&&K.y<=V&&K!==a&&K!==h&&Yf(p,w,y,S,v,A,K.x,K.y)&&jn(K.prev,K,K.next)>=0)return!1;K=K.nextZ}return!0}function UE(r,e){let i=r;do{const s=i.prev,a=i.next.next;!rd(s,a)&&Lv(s,i,i.next,a)&&Jf(s,a)&&Jf(a,s)&&(e.push(s.i,i.i,a.i),Qf(i),Qf(i.next),i=r=a),i=i.next}while(i!==r);return xu(i)}function jE(r,e,i,s,a,u){let h=r;do{let p=h.next.next;for(;p!==h.prev;){if(h.i!==p.i&&WE(h,p)){let y=zv(h,p);return h=xu(h,h.next),y=xu(y,y.next),Kf(h,e,i,s,a,u,0),void Kf(y,e,i,s,a,u,0)}p=p.next}h=h.next}while(h!==r)}function GE(r,e){let i=r.x-e.x;return i===0&&(i=r.y-e.y,i===0)&&(i=(r.next.y-r.y)/(r.next.x-r.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function HE(r,e){const i=function(a,u){let h=u;const p=a.x,y=a.y;let v,w=-1/0;if(rd(a,h))return h;do{if(rd(a,h.next))return h.next;if(y<=h.y&&y>=h.next.y&&h.next.y!==h.y){const O=h.x+(y-h.y)*(h.next.x-h.x)/(h.next.y-h.y);if(O<=p&&O>w&&(w=O,v=h.x<h.next.x?h:h.next,O===p))return v}h=h.next}while(h!==u);if(!v)return null;const S=v,A=v.x,P=v.y;let R=1/0;h=v;do{if(p>=h.x&&h.x>=A&&p!==h.x&&Dv(y<P?p:w,y,A,P,y<P?w:p,y,h.x,h.y)){const O=Math.abs(y-h.y)/(p-h.x);Jf(h,a)&&(O<R||O===R&&(h.x>v.x||h.x===v.x&&qE(v,h)))&&(v=h,R=O)}h=h.next}while(h!==S);return v}(r,e);if(!i)return e;const s=zv(i,r);return xu(s,s.next),xu(i,i.next)}function qE(r,e){return jn(r.prev,r,e.prev)<0&&jn(e.next,r,r.next)<0}function Vy(r,e,i,s,a){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*a|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*a|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function $E(r){let e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Dv(r,e,i,s,a,u,h,p){return(a-h)*(e-p)>=(r-h)*(u-p)&&(r-h)*(s-p)>=(i-h)*(e-p)&&(i-h)*(u-p)>=(a-h)*(s-p)}function Yf(r,e,i,s,a,u,h,p){return!(r===h&&e===p)&&Dv(r,e,i,s,a,u,h,p)}function WE(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,s){let a=i;do{if(a.i!==i.i&&a.next.i!==i.i&&a.i!==s.i&&a.next.i!==s.i&&Lv(a,a.next,i,s))return!0;a=a.next}while(a!==i);return!1}(r,e)&&(Jf(r,e)&&Jf(e,r)&&function(i,s){let a=i,u=!1;const h=(i.x+s.x)/2,p=(i.y+s.y)/2;do a.y>p!=a.next.y>p&&a.next.y!==a.y&&h<(a.next.x-a.x)*(p-a.y)/(a.next.y-a.y)+a.x&&(u=!u),a=a.next;while(a!==i);return u}(r,e)&&(jn(r.prev,r,e.prev)||jn(r,e.prev,e))||rd(r,e)&&jn(r.prev,r,r.next)>0&&jn(e.prev,e,e.next)>0)}function jn(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function rd(r,e){return r.x===e.x&&r.y===e.y}function Lv(r,e,i,s){const a=y_(jn(r,e,i)),u=y_(jn(r,e,s)),h=y_(jn(i,s,r)),p=y_(jn(i,s,e));return a!==u&&h!==p||!(a!==0||!g_(r,i,e))||!(u!==0||!g_(r,s,e))||!(h!==0||!g_(i,r,s))||!(p!==0||!g_(i,e,s))}function g_(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function y_(r){return r>0?1:r<0?-1:0}function Jf(r,e){return jn(r.prev,r,r.next)<0?jn(r,e,r.next)>=0&&jn(r,r.prev,e)>=0:jn(r,e,r.prev)<0||jn(r,r.next,e)<0}function zv(r,e){const i=Uy(r.i,r.x,r.y),s=Uy(e.i,e.x,e.y),a=r.next,u=e.prev;return r.next=e,e.prev=r,i.next=a,a.prev=i,s.next=i,i.prev=s,u.next=s,s.prev=u,s}function Ov(r,e,i,s){const a=Uy(r,e,i);return s?(a.next=s.next,a.prev=s,s.next.prev=a,s.next=a):(a.prev=a,a.next=a),a}function Qf(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function Uy(r,e,i){return{i:r,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ep(r,e){const i=r.length;if(i<=1)return[r];const s=[];let a,u;for(let h=0;h<i;h++){const p=_i(r[h]);p!==0&&(r[h].area=Math.abs(p),u===void 0&&(u=p<0),u===p<0?(a&&s.push(a),a=[r[h]]):a.push(r[h]))}if(a&&s.push(a),e>1)for(let h=0;h<s.length;h++)s[h].length<=e||(eh(s[h],e,1,s[h].length-1,ZE),s[h]=s[h].slice(0,e));return s}function ZE(r,e){return e.area-r.area}function kv(r,e,i=1){if(!r)return null;const s=typeof r=="string"?_s.from(r).getPrimary():r.getPrimary(),a=typeof r=="string"?null:r.getSecondary();for(const u of[s,a]){if(!u)continue;const h=u.id.toString();e.has(h)||e.set(h,[]),u.scaleSelf(i),e.get(h).push(u)}return{primary:s.toString(),secondary:a?a.toString():null}}function jy(r,e,i,s){const a=s.patternDependencies;let u=!1;for(const h of e){const p=h.paint.get(`${r}-pattern`);p.isConstant()||(u=!0),kv(p.constantOr(null),a,i)&&(u=!0)}return u}function Gy(r,e,i,s,a,u){const h=u.patternDependencies;for(const p of e){const y=p.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let v=y.evaluate({zoom:s},i,{},u.availableImages);v=v&&v.name?v.name:v;const w=kv(v,h,a);if(!w)continue;const{primary:S,secondary:A}=w;S&&(i.patterns[p.id]=[S,A].filter(Boolean))}}return i}class Fv{constructor(){this.polygons=new Map}add(e,...i){const s=this.polygons.get(e);s?s.push(...i):this.polygons.set(e,i)}merge(e){for(const[i,s]of e.polygons)this.add(i,...s)}}class Ml{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=ut&&i>=ut}static evaluate(e){if(e.length===0)return new Ml;let i=[];for(const y of e)i.push(...y.portals);if(i.length===0)return new Ml;for(const y of i){const v=y.va,w=y.vb;(Ml.isOnBorder(v.x,w.x)||Ml.isOnBorder(v.y,w.y))&&(y.type="border")}const s=i.filter(y=>y.type!=="unevaluated"),a=i.filter(y=>y.type==="unevaluated");if(a.length===0)return new Ml;a.sort((y,v)=>y.hash===v.hash?y.isTunnel===v.isTunnel?0:y.isTunnel?-1:1:y.hash<v.hash?1:-1),i=s.concat(a);let u=s.length,h=u,p=u;do if(h++,h===i.length||i[u].hash!==i[h].hash){if(h-u==2){p<u&&(i[p]=i[u],i[u]=null);const y=i[p],v=i[h-1];y.type=y.isTunnel!==v.isTunnel?"tunnel":"polygon",y.connection={a:y.connection.a,b:v.connection.a},p++}u=h}while(u!==i.length);return i.splice(p),i.sort((y,v)=>y.hash<v.hash?1:-1),{portals:i}}}Mt(Ml,"ElevationPortalGraph"),Mt(Fv,"ElevationPolygons");class XE{constructor(e,i,s){this.outPositions=e,this.outNormals=i,this.outIndices=s,this.vertexLookup=new Map}addVertex(e,i,s){let a=e[2];s!=null&&(a*=s);const u=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,h=this.vertexLookup.get(u);if(h!=null)return h;const p=this.outPositions.length;this.vertexLookup.set(u,p);const y=Math.trunc(16384*i[0]),v=Math.trunc(16384*i[1]),w=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],a),this.outNormals.emplaceBack(y,v,w),p}addTriangle(e,i,s){this.outIndices.emplaceBack(e,i,s)}addTriangles(e,i,s){if(e.length===0)return;const a=s.length===1,u=Fi(),h=Fi();for(let p=0;p<e.length;p+=3){const y=i[e[p+0]],v=i[e[p+1]],w=i[e[p+2]],S=a?s[0]:s[e[p+1]],A=a?s[0]:s[e[p+2]];Ei(u,y.x,y.y,a?s[0]:s[e[p+0]]);const P=this.addVertex(u,h);Ei(u,v.x,v.y,S);const R=this.addVertex(u,h);Ei(u,w.x,w.y,A);const O=this.addVertex(u,h);this.outIndices.emplaceBack(P,R,O)}}addQuad(e,i,s,a,u,h){const p=this.addVertex(e,u,h),y=this.addVertex(i,u,h),v=this.addVertex(s,u,h),w=this.addVertex(a,u,h);this.addTriangle(p,y,v),this.addTriangle(v,w,p)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class $s{constructor(e,i,s,a){this.unevaluatedPortals=new Ml,this.portalPolygons=new Fv,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Cf,this.vertexNormals=new Pf,this.indexArray=new wn,this.tileToMeters=G(e),this.bridgeProgramConfigurations=new Eo(i,{zoom:s,lut:a},u=>u!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new Eo(i,{zoom:s,lut:a},u=>u!=="fill-bridge-guard-rail-color")}addVertices(e,i){const s=this.unevalVertices.length;for(let a=0;a<e.length;a++)this.unevalVertices.push(e[a]),this.unevalHeights.push(i[a]);return s}addTriangles(e,i,s){const a=s?this.unevalTunnelTriangles:this.unevalTriangles;for(const u of e)a.push(u+i)}addRenderableRing(e,i,s,a,u,h){const p=[new Ye(u.min.x,u.min.y),new Ye(u.max.x,u.min.y),new Ye(u.max.x,u.max.y),new Ye(u.min.x,u.max.y)];for(let y=0;y<s-1;y++){const v=i+y,w=v+1,S=this.unevalVertices[v],A=this.unevalVertices[w];if(!(S.x>=u.min.x&&S.x<=u.max.x&&S.y>=u.min.y&&S.y<=u.max.y||A.x>=u.min.x&&A.x<=u.max.x&&A.y>=u.min.y&&A.y<=u.max.y||Kn(S,A,p))||this.isOnBorder(S.x,A.x)||this.isOnBorder(S.y,A.y))continue;const P=$s.computeEdgeHash(this.unevalVertices[v],this.unevalVertices[w]);let R,O=this.vertexHashLookup.get($s.computePosHash(S));O!=null?R=O.next:(O=this.vertexHashLookup.get($s.computePosHash(A)),R=O!=null?O.prev:P),this.unevalEdges.push({polygonIdx:e,a:v,b:w,hash:P,portalHash:R,isTunnel:a,type:"unevaluated",featureInfo:h})}}addPortalCandidates(e,i,s,a,u){if(i.length===0)return;this.portalPolygons.add(e,{geometry:i,zLevel:u});const h=i[0];this.vertexHashLookup.clear();let p=$s.computeEdgeHash(h[h.length-2],h[h.length-1]);for(let y=0;y<h.length-1;y++){const v=h[y+0],w=h[y+1],S=rn(w.x-v.x,w.y-v.y),A=_o(S);if(A===0)continue;let P="unevaluated";const R=a.pointElevation(v),O=a.pointElevation(w);Math.abs(R)<.01&&Math.abs(O)<.01?P="entrance":(this.isOnBorder(v.x,w.x)||this.isOnBorder(v.y,w.y))&&(P="border");const V=$s.computeEdgeHash(v,w);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:v,vb:w,vab:S,length:A,hash:V,isTunnel:s,type:P});const N=$s.computePosHash(v);this.vertexHashLookup.set(N,{prev:p,next:V}),p=V}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),s=A=>{A.primitiveLength=this.indexArray.length-A.primitiveOffset},a=new XE(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const u=i(),h=i(),p=i(),y=(A,P)=>{A.sort((O,V)=>O.type===P&&V.type!==P?-1:O.type!==P&&V.type===P?1:0);const R=A.findIndex(O=>O.type!==P);return R>=0?R:A.length};let v=0;this.unevalEdges.length>0&&(v=y(this.unevalEdges,"none"),this.constructBridgeStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:v},this.tileToMeters)),s(p);const w=i(),S=i();if(this.unevalEdges.length>0){const A=this.unevalEdges.splice(v),P=y(A,"tunnel")+v;this.unevalEdges.push(...A),this.constructTunnelStructures(a,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:v},{min:v,max:P})}s(w),a.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),s(S),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),s(h),a.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),s(u),this.maskSegments=Nr.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.depthSegments=Nr.simpleSegment(0,h.primitiveOffset,0,h.primitiveLength),this.renderableBridgeSegments=Nr.simpleSegment(0,p.primitiveOffset,0,p.primitiveLength),this.renderableTunnelSegments=Nr.simpleSegment(0,w.primitiveOffset,0,w.primitiveLength),this.shadowCasterSegments=Nr.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength)}update(e,i,s,a,u,h,p,y){this.bridgeProgramConfigurations.updatePaintArrays(e,i,u,s,a,h,p,y),this.tunnelProgramConfigurations.updatePaintArrays(e,i,u,s,a,h,p,y)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,FE.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,BE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,s,a,u){const h=(p,y)=>{for(let v=0;v<y.length-1;v++){const w=y[v].featureIndex,S=y[v+1].vertexStart,A=e.feature(w);p.populatePaintArrays(S,A,w,{},s,i,a,void 0,u)}};h(this.bridgeProgramConfigurations,this.bridgeFeatureSections),h(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,s,a,u){const h=new Map;for(let p=a;p<u;p++){const y=s[p],v=y.a,w=y.b,S=$s.computePosHash(e[v]),A=$s.computePosHash(e[w]);let P=h.get(S);P||(P={},h.set(S,P));let R=h.get(A);R||(R={},h.set(A,R)),i[v]<=0&&i[w]<=0||(P.to=w,R.from=v)}return h}isTerminalVertex(e,i){const s=$s.computePosHash(this.unevalVertices[e]),a=i.get(s);return!a||!a.from||!a.to}constructBridgeStructures(e,i,s,a,u,h){e.clearVertexLookup();const p=this.computeVertexConnections(i,s,a,u.min,u.max),y=1/h,v=.5*y,w=(Je,et)=>Ei(Je,i[et].x,i[et].y,s[et]*y),S=Fi(),A=Fi(),P=Fi(),R=Fi(),O=Fi(),V=(Je,et)=>{const Ze=p.get($s.computePosHash(i[et])),Xe=Ze.from,Be=Ze.to;if(!Xe||!Be)return;w(S,Xe),w(A,et),w(P,Be),Ct(R),bt(S,A)||(jt(O,A,S),zt(R,O)),bt(P,A)||(jt(O,P,A),Oi(R,R,zt(O,O)));const ke=Jt(R);return ke>0?Cr(Je,R,1/ke):void 0};let N=Number.POSITIVE_INFINITY;this.sortSubarray(a,u.min,u.max,(Je,et)=>Je.featureInfo.featureIndex-et.featureInfo.featureIndex);const q=Fi(),W=Fi(),K=Fi(),se=Fi(),te=Fi(),le=Fi(),fe=Fi(),ge=Fi(),ze=Fi(),we=[Fi(),Fi(),Fi(),Fi()],Ne=[Fi(),Fi(),Fi(),Fi()],He=[{coord:new Ye(0,0),height:0},{coord:new Ye(0,0),height:0}],qe=(Je,et)=>Je>et;for(let Je=u.min;Je<u.max;Je++){const et=a[Je];if(!et.featureInfo.guardRailEnabled||!this.prepareEdgePoints(He,i,s,et,qe))continue;const[Ze,Xe]=He;if(Ei(q,Ze.coord.x,Ze.coord.y,y*Ze.height),Ei(W,Xe.coord.x,Xe.coord.y,y*Xe.height),bt(q,W))continue;jt(K,W,q),zt(K,K);const Be=V(ge,et.a)||K,ke=V(ze,et.b)||K;Ei(se,Be[1],-Be[0],0),zt(se,se),Ei(te,ke[1],-ke[0],0),zt(te,te),sr(ge,se,Be),zt(le,ge),sr(ge,te,ke),zt(fe,ge),Oi(we[0],q,Cr(ge,jt(ge,se,le),v)),Oi(we[1],q,Cr(ge,Oi(ge,se,le),v)),Oi(we[2],q,Cr(ge,le,v)),we[3]=q,Oi(Ne[0],W,Cr(ge,jt(ge,te,fe),v)),Oi(Ne[1],W,Cr(ge,Oi(ge,te,fe),v)),Oi(Ne[2],W,Cr(ge,fe,v)),Ne[3]=W,N=this.addFeatureSection(et.featureInfo.featureIndex,N,this.bridgeFeatureSections,e);const Ke=e.addVertex(we[0],se,h),ht=e.addVertex(we[1],se,h),st=e.addVertex(Ne[0],te,h),Nt=e.addVertex(Ne[1],te,h);e.addTriangle(Ke,ht,st),e.addTriangle(ht,Nt,st);const vt=e.addVertex(we[1],le,h),At=e.addVertex(we[2],le,h),Lt=e.addVertex(Ne[1],fe,h),Si=e.addVertex(Ne[2],fe,h);e.addTriangle(vt,At,Lt),e.addTriangle(At,Si,Lt),ci(se,se),ci(te,te);const at=e.addVertex(we[2],se,h),Ot=e.addVertex(we[3],se,h),li=e.addVertex(Ne[2],te,h),Di=e.addVertex(Ne[3],te,h);e.addTriangle(at,Ot,li),e.addTriangle(Ot,Di,li);const ki=this.isTerminalVertex(et.a,p),mi=this.isTerminalVertex(et.b,p);Ze.height<.01&&ki&&e.addQuad(we[3],we[2],we[1],we[0],ci(Be,Be),h),Xe.height<.01&&mi&&e.addQuad(Ne[0],Ne[1],Ne[2],Ne[3],ke,h)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,s,a,u,h){e.clearVertexLookup();let p=Number.POSITIVE_INFINITY;const y=(N,q)=>N.featureInfo.featureIndex-q.featureInfo.featureIndex;this.sortSubarray(a,u.min,u.max,y),this.sortSubarray(a,h.min,h.max,y);const v=N=>zt(N,N),w=[{coord:new Ye(0,0),height:0},{coord:new Ye(0,0),height:0}],S=(N,q)=>N<q,A=Fi(),P=Fi(),R=Fi(),O=Fi(),V=Fi();for(let N=u.min;N<u.max;N++){if(!this.prepareEdgePoints(w,i,s,a[N],S))continue;const[q,W]=w,K=v(Ei(V,-(W.coord.y-q.coord.y),W.coord.x-q.coord.x,0));p=this.addFeatureSection(a[N].featureInfo.featureIndex,p,this.tunnelFeatureSections,e),e.addQuad(Ei(A,q.coord.x,q.coord.y,q.height),Ei(P,W.coord.x,W.coord.y,W.height),Ei(R,W.coord.x,W.coord.y,a[N].isTunnel?-.1:0),Ei(O,q.coord.x,q.coord.y,a[N].isTunnel?-.1:0),K)}for(let N=h.min;N<h.max;N++){const q=a[N];q.isTunnel&&([q.a,q.b]=[q.b,q.a]);const W=i[q.a],K=i[q.b],se=v(Ei(V,-(K.y-W.y),K.x-W.x,0));p=this.addFeatureSection(q.featureInfo.featureIndex,p,this.tunnelFeatureSections,e),e.addQuad(Ei(A,K.x,K.y,0),Ei(P,W.x,W.y,0),Ei(R,W.x,W.y,s[q.a]+4),Ei(O,K.x,K.y,s[q.b]+4),se),e.addQuad(Ei(A,W.x,W.y,0),Ei(P,K.x,K.y,0),Ei(R,K.x,K.y,s[q.b]+4),Ei(O,W.x,W.y,s[q.a]+4),se)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,s,a){e.coord.x=i,e.coord.y=s,e.height=a}prepareEdgePoints(e,i,s,a,u){let h=i[a.a].x,p=i[a.a].y,y=i[a.b].x,v=i[a.b].y,w=s[a.a],S=s[a.b];const A=u(w,0),P=u(S,0);if(A&&P)return this.setElevatedPoint(e[0],h,p,w),this.setElevatedPoint(e[1],y,v,S),!0;if(!A&&!P)return!1;if(A){if(!P){const R=S/(S-w);y=ii(y,h,R),v=ii(v,p,R),S=ii(S,w,R)}}else{const R=w/(w-S);h=ii(h,y,R),p=ii(p,v,R),w=ii(w,S,R)}return this.setElevatedPoint(e[0],h,p,w),this.setElevatedPoint(e[1],y,v,S),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((p,y)=>p.hash===y.hash?y.polygonIdx-p.polygonIdx:y.hash>p.hash?1:-1);let s=0,a=0,u=0,h=i[s].polygonIdx;do a++,(a===i.length||i[s].hash!==i[a].hash)&&((a-s==1||i[a-1].polygonIdx!==h)&&(u<s&&(i[u]=i[s],i[s]=null),i[u].type="none",u++),s=a,s!==i.length&&(h=i[s].polygonIdx));while(s!==i.length);if(i.splice(u),i.length!==0&&e.length!==0){i.sort((v,w)=>v.portalHash<w.portalHash?1:-1);let p=0,y=0;for(;p!==i.length&&y!==e.length;){const v=i[p],w=e[y];v.portalHash>w.hash?p++:w.hash>v.portalHash?y++:(v.type=w.type,p++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=ut&&i>=ut}addFeatureSection(e,i,s,a){return e!==i&&(i=e,s.push({featureIndex:e,vertexStart:a.getVertexCount()}),a.clearVertexLookup()),i}sortSubarray(e,i,s,a){const u=e.slice(i,s);u.sort(a),e.splice(i,u.length,...u)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt($s.computePosHash(e))<<32n|BigInt($s.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var Bv,Nv={exports:{}},Vv=(Bv||(Bv=1,function(r){function e(ie,oe){return ie>oe?1:ie<oe?-1:0}var i=function(ie,oe){ie===void 0&&(ie=e),oe===void 0&&(oe=!1),this._compare=ie,this._root=null,this._size=0,this._noDuplicates=!!oe},s={size:{configurable:!0}};function a(ie,oe,Ve,Qe,_t){var gt=_t-Qe;if(gt>0){var Vt=Qe+Math.floor(gt/2),Ht={key:oe[Vt],data:Ve[Vt],parent:ie};return Ht.left=a(Ht,oe,Ve,Qe,Vt),Ht.right=a(Ht,oe,Ve,Vt+1,_t),Ht}return null}function u(ie,oe,Ve,Qe,_t){if(!(Ve>=Qe)){for(var gt=ie[Ve+Qe>>1],Vt=Ve-1,Ht=Qe+1;;){do Vt++;while(_t(ie[Vt],gt)<0);do Ht--;while(_t(ie[Ht],gt)>0);if(Vt>=Ht)break;var fi=ie[Vt];ie[Vt]=ie[Ht],ie[Ht]=fi,fi=oe[Vt],oe[Vt]=oe[Ht],oe[Ht]=fi}u(ie,oe,Ve,Ht,_t),u(ie,oe,Ht+1,Qe,_t)}}i.prototype.rotateLeft=function(ie){var oe=ie.right;oe&&(ie.right=oe.left,oe.left&&(oe.left.parent=ie),oe.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=oe:ie.parent.right=oe:this._root=oe,oe&&(oe.left=ie),ie.parent=oe},i.prototype.rotateRight=function(ie){var oe=ie.left;oe&&(ie.left=oe.right,oe.right&&(oe.right.parent=ie),oe.parent=ie.parent),ie.parent?ie===ie.parent.left?ie.parent.left=oe:ie.parent.right=oe:this._root=oe,oe&&(oe.right=ie),ie.parent=oe},i.prototype._splay=function(ie){for(;ie.parent;){var oe=ie.parent;oe.parent?oe.left===ie&&oe.parent.left===oe?(this.rotateRight(oe.parent),this.rotateRight(oe)):oe.right===ie&&oe.parent.right===oe?(this.rotateLeft(oe.parent),this.rotateLeft(oe)):oe.left===ie&&oe.parent.right===oe?(this.rotateRight(oe),this.rotateLeft(oe)):(this.rotateLeft(oe),this.rotateRight(oe)):oe.left===ie?this.rotateRight(oe):this.rotateLeft(oe)}},i.prototype.splay=function(ie){for(var oe,Ve,Qe,_t,gt;ie.parent;)(Ve=(oe=ie.parent).parent)&&Ve.parent?((Qe=Ve.parent).left===Ve?Qe.left=ie:Qe.right=ie,ie.parent=Qe):(ie.parent=null,this._root=ie),_t=ie.left,gt=ie.right,ie===oe.left?(Ve&&(Ve.left===oe?(oe.right?(Ve.left=oe.right,Ve.left.parent=Ve):Ve.left=null,oe.right=Ve,Ve.parent=oe):(_t?(Ve.right=_t,_t.parent=Ve):Ve.right=null,ie.left=Ve,Ve.parent=ie)),gt?(oe.left=gt,gt.parent=oe):oe.left=null,ie.right=oe,oe.parent=ie):(Ve&&(Ve.right===oe?(oe.left?(Ve.right=oe.left,Ve.right.parent=Ve):Ve.right=null,oe.left=Ve,Ve.parent=oe):(gt?(Ve.left=gt,gt.parent=Ve):Ve.left=null,ie.right=Ve,Ve.parent=ie)),_t?(oe.right=_t,_t.parent=oe):oe.right=null,ie.left=oe,oe.parent=ie)},i.prototype.replace=function(ie,oe){ie.parent?ie===ie.parent.left?ie.parent.left=oe:ie.parent.right=oe:this._root=oe,oe&&(oe.parent=ie.parent)},i.prototype.minNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.left;)ie=ie.left;return ie},i.prototype.maxNode=function(ie){if(ie===void 0&&(ie=this._root),ie)for(;ie.right;)ie=ie.right;return ie},i.prototype.insert=function(ie,oe){var Ve=this._root,Qe=null,_t=this._compare;if(this._noDuplicates)for(;Ve;){if(Qe=Ve,_t(Ve.key,ie)===0)return;Ve=_t(Ve.key,ie)<0?Ve.right:Ve.left}else for(;Ve;)Qe=Ve,Ve=_t(Ve.key,ie)<0?Ve.right:Ve.left;return Ve={key:ie,data:oe,left:null,right:null,parent:Qe},Qe?_t(Qe.key,Ve.key)<0?Qe.right=Ve:Qe.left=Ve:this._root=Ve,this.splay(Ve),this._size++,Ve},i.prototype.find=function(ie){for(var oe=this._root,Ve=this._compare;oe;){var Qe=Ve(oe.key,ie);if(Qe<0)oe=oe.right;else{if(!(Qe>0))return oe;oe=oe.left}}return null},i.prototype.contains=function(ie){for(var oe=this._root,Ve=this._compare;oe;){var Qe=Ve(ie,oe.key);if(Qe===0)return!0;oe=Qe<0?oe.left:oe.right}return!1},i.prototype.remove=function(ie){var oe=this.find(ie);if(!oe)return!1;if(this.splay(oe),oe.left)if(oe.right){var Ve=this.minNode(oe.right);Ve.parent!==oe&&(this.replace(Ve,Ve.right),Ve.right=oe.right,Ve.right.parent=Ve),this.replace(oe,Ve),Ve.left=oe.left,Ve.left.parent=Ve}else this.replace(oe,oe.left);else this.replace(oe,oe.right);return this._size--,!0},i.prototype.removeNode=function(ie){if(!ie)return!1;if(this.splay(ie),ie.left)if(ie.right){var oe=this.minNode(ie.right);oe.parent!==ie&&(this.replace(oe,oe.right),oe.right=ie.right,oe.right.parent=oe),this.replace(ie,oe),oe.left=ie.left,oe.left.parent=oe}else this.replace(ie,ie.left);else this.replace(ie,ie.right);return this._size--,!0},i.prototype.erase=function(ie){var oe=this.find(ie);if(oe){this.splay(oe);var Ve=oe.left,Qe=oe.right,_t=null;Ve&&(Ve.parent=null,_t=this.maxNode(Ve),this.splay(_t),this._root=_t),Qe&&(Ve?_t.right=Qe:this._root=Qe,Qe.parent=_t),this._size--}},i.prototype.pop=function(){var ie=this._root,oe=null;if(ie){for(;ie.left;)ie=ie.left;oe={key:ie.key,data:ie.data},this.remove(ie.key)}return oe},i.prototype.next=function(ie){var oe=ie;if(oe)if(oe.right)for(oe=oe.right;oe&&oe.left;)oe=oe.left;else for(oe=ie.parent;oe&&oe.right===ie;)ie=oe,oe=oe.parent;return oe},i.prototype.prev=function(ie){var oe=ie;if(oe)if(oe.left)for(oe=oe.left;oe&&oe.right;)oe=oe.right;else for(oe=ie.parent;oe&&oe.left===ie;)ie=oe,oe=oe.parent;return oe},i.prototype.forEach=function(ie){for(var oe=this._root,Ve=[],Qe=!1,_t=0;!Qe;)oe?(Ve.push(oe),oe=oe.left):Ve.length>0?(ie(oe=Ve.pop(),_t++),oe=oe.right):Qe=!0;return this},i.prototype.range=function(ie,oe,Ve,Qe){for(var _t=[],gt=this._compare,Vt=this._root;_t.length!==0||Vt;)if(Vt)_t.push(Vt),Vt=Vt.left;else{if(gt((Vt=_t.pop()).key,oe)>0)break;if(gt(Vt.key,ie)>=0&&Ve.call(Qe,Vt))return this;Vt=Vt.right}return this},i.prototype.keys=function(){for(var ie=this._root,oe=[],Ve=[],Qe=!1;!Qe;)ie?(oe.push(ie),ie=ie.left):oe.length>0?(ie=oe.pop(),Ve.push(ie.key),ie=ie.right):Qe=!0;return Ve},i.prototype.values=function(){for(var ie=this._root,oe=[],Ve=[],Qe=!1;!Qe;)ie?(oe.push(ie),ie=ie.left):oe.length>0?(ie=oe.pop(),Ve.push(ie.data),ie=ie.right):Qe=!0;return Ve},i.prototype.at=function(ie){for(var oe=this._root,Ve=[],Qe=!1,_t=0;!Qe;)if(oe)Ve.push(oe),oe=oe.left;else if(Ve.length>0){if(oe=Ve.pop(),_t===ie)return oe;_t++,oe=oe.right}else Qe=!0;return null},i.prototype.load=function(ie,oe,Ve){if(ie===void 0&&(ie=[]),oe===void 0&&(oe=[]),Ve===void 0&&(Ve=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var Qe=ie.length;return Ve&&u(ie,oe,0,Qe-1,this._compare),this._root=a(null,ie,oe,0,Qe),this._size=Qe,this},i.prototype.min=function(){var ie=this.minNode(this._root);return ie?ie.key:null},i.prototype.max=function(){var ie=this.maxNode(this._root);return ie?ie.key:null},i.prototype.isEmpty=function(){return this._root===null},s.size.get=function(){return this._size},i.createTree=function(ie,oe,Ve,Qe,_t){return new i(Ve,_t).load(ie,oe,Qe)},Object.defineProperties(i.prototype,s);var h=0,p=1,y=2,v=3,w=0,S=1,A=2,P=3;function R(ie,oe,Ve){oe===null?(ie.inOut=!1,ie.otherInOut=!0):(ie.isSubject===oe.isSubject?(ie.inOut=!oe.inOut,ie.otherInOut=oe.otherInOut):(ie.inOut=!oe.otherInOut,ie.otherInOut=oe.isVertical()?!oe.inOut:oe.inOut),oe&&(ie.prevInResult=!O(oe,Ve)||oe.isVertical()?oe.prevInResult:oe));var Qe=O(ie,Ve);ie.resultTransition=Qe?function(_t,gt){var Vt,Ht=!_t.inOut,fi=!_t.otherInOut;switch(gt){case w:Vt=Ht&&fi;break;case S:Vt=Ht||fi;break;case P:Vt=Ht^fi;break;case A:Vt=_t.isSubject?Ht&&!fi:fi&&!Ht}return Vt?1:-1}(ie,Ve):0}function O(ie,oe){switch(ie.type){case h:switch(oe){case w:return!ie.otherInOut;case S:return ie.otherInOut;case A:return ie.isSubject&&ie.otherInOut||!ie.isSubject&&!ie.otherInOut;case P:return!0}break;case y:return oe===w||oe===S;case v:return oe===A;case p:return!1}return!1}var V=function(ie,oe,Ve,Qe,_t){this.left=oe,this.point=ie,this.otherEvent=Ve,this.isSubject=Qe,this.type=_t||h,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},N={inResult:{configurable:!0}};function q(ie,oe){return ie[0]===oe[0]&&ie[1]===oe[1]}V.prototype.isBelow=function(ie){var oe=this.point,Ve=this.otherEvent.point;return this.left?(oe[0]-ie[0])*(Ve[1]-ie[1])-(Ve[0]-ie[0])*(oe[1]-ie[1])>0:(Ve[0]-ie[0])*(oe[1]-ie[1])-(oe[0]-ie[0])*(Ve[1]-ie[1])>0},V.prototype.isAbove=function(ie){return!this.isBelow(ie)},V.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},N.inResult.get=function(){return this.resultTransition!==0},V.prototype.clone=function(){var ie=new V(this.point,this.left,this.otherEvent,this.isSubject,this.type);return ie.contourId=this.contourId,ie.resultTransition=this.resultTransition,ie.prevInResult=this.prevInResult,ie.isExteriorRing=this.isExteriorRing,ie.inOut=this.inOut,ie.otherInOut=this.otherInOut,ie},Object.defineProperties(V.prototype,N);var W=11102230246251565e-32,K=134217729,se=(3+8*W)*W;function te(ie,oe,Ve,Qe,_t){var gt,Vt,Ht,fi,bi=oe[0],Ti=Qe[0],Ci=0,ti=0;Ti>bi==Ti>-bi?(gt=bi,bi=oe[++Ci]):(gt=Ti,Ti=Qe[++ti]);var ai=0;if(Ci<ie&&ti<Ve)for(Ti>bi==Ti>-bi?(Ht=gt-((Vt=bi+gt)-bi),bi=oe[++Ci]):(Ht=gt-((Vt=Ti+gt)-Ti),Ti=Qe[++ti]),gt=Vt,Ht!==0&&(_t[ai++]=Ht);Ci<ie&&ti<Ve;)Ti>bi==Ti>-bi?(Ht=gt-((Vt=gt+bi)-(fi=Vt-gt))+(bi-fi),bi=oe[++Ci]):(Ht=gt-((Vt=gt+Ti)-(fi=Vt-gt))+(Ti-fi),Ti=Qe[++ti]),gt=Vt,Ht!==0&&(_t[ai++]=Ht);for(;Ci<ie;)Ht=gt-((Vt=gt+bi)-(fi=Vt-gt))+(bi-fi),bi=oe[++Ci],gt=Vt,Ht!==0&&(_t[ai++]=Ht);for(;ti<Ve;)Ht=gt-((Vt=gt+Ti)-(fi=Vt-gt))+(Ti-fi),Ti=Qe[++ti],gt=Vt,Ht!==0&&(_t[ai++]=Ht);return gt===0&&ai!==0||(_t[ai++]=gt),ai}function le(ie){return new Float64Array(ie)}var fe=33306690738754716e-32,ge=22204460492503146e-32,ze=11093356479670487e-47,we=le(4),Ne=le(8),He=le(12),qe=le(16),Je=le(4);function et(ie,oe,Ve){var Qe=function(_t,gt,Vt,Ht,fi,bi){var Ti=(gt-bi)*(Vt-fi),Ci=(_t-fi)*(Ht-bi),ti=Ti-Ci;if(Ti===0||Ci===0||Ti>0!=Ci>0)return ti;var ai=Math.abs(Ti+Ci);return Math.abs(ti)>=fe*ai?ti:-function(Gi,Xi,Ki,lr,xr,fr,Ji){var rr,wi,zi,Br,Qt,Pi,_r,wr,Rr,sn,Er,ei,jr,cr,kr,En,kn,_n,gn=Gi-xr,Mn=Ki-xr,Cs=Xi-fr,Ar=lr-fr;we[0]=(kr=(wr=gn-(_r=(Pi=K*gn)-(Pi-gn)))*(sn=Ar-(Rr=(Pi=K*Ar)-(Pi-Ar)))-((cr=gn*Ar)-_r*Rr-wr*Rr-_r*sn))-((Er=kr-(kn=(wr=Cs-(_r=(Pi=K*Cs)-(Pi-Cs)))*(sn=Mn-(Rr=(Pi=K*Mn)-(Pi-Mn)))-((En=Cs*Mn)-_r*Rr-wr*Rr-_r*sn)))+(Qt=kr-Er))+(Qt-kn),we[1]=(jr=cr-((ei=cr+Er)-(Qt=ei-cr))+(Er-Qt))-((Er=jr-En)+(Qt=jr-Er))+(Qt-En),we[2]=ei-((_n=ei+Er)-(Qt=_n-ei))+(Er-Qt),we[3]=_n;var tn=function(Ya,Yn){for(var bs=Yn[0],Zs=1;Zs<4;Zs++)bs+=Yn[Zs];return bs}(0,we),on=ge*Ji;if(tn>=on||-tn>=on||(rr=Gi-(gn+(Qt=Gi-gn))+(Qt-xr),zi=Ki-(Mn+(Qt=Ki-Mn))+(Qt-xr),wi=Xi-(Cs+(Qt=Xi-Cs))+(Qt-fr),Br=lr-(Ar+(Qt=lr-Ar))+(Qt-fr),rr===0&&wi===0&&zi===0&&Br===0)||(on=ze*Ji+se*Math.abs(tn),(tn+=gn*Br+Ar*rr-(Cs*zi+Mn*wi))>=on||-tn>=on))return tn;Je[0]=(kr=(wr=rr-(_r=(Pi=K*rr)-(Pi-rr)))*(sn=Ar-(Rr=(Pi=K*Ar)-(Pi-Ar)))-((cr=rr*Ar)-_r*Rr-wr*Rr-_r*sn))-((Er=kr-(kn=(wr=wi-(_r=(Pi=K*wi)-(Pi-wi)))*(sn=Mn-(Rr=(Pi=K*Mn)-(Pi-Mn)))-((En=wi*Mn)-_r*Rr-wr*Rr-_r*sn)))+(Qt=kr-Er))+(Qt-kn),Je[1]=(jr=cr-((ei=cr+Er)-(Qt=ei-cr))+(Er-Qt))-((Er=jr-En)+(Qt=jr-Er))+(Qt-En),Je[2]=ei-((_n=ei+Er)-(Qt=_n-ei))+(Er-Qt),Je[3]=_n;var zs=te(4,we,4,Je,Ne);Je[0]=(kr=(wr=gn-(_r=(Pi=K*gn)-(Pi-gn)))*(sn=Br-(Rr=(Pi=K*Br)-(Pi-Br)))-((cr=gn*Br)-_r*Rr-wr*Rr-_r*sn))-((Er=kr-(kn=(wr=Cs-(_r=(Pi=K*Cs)-(Pi-Cs)))*(sn=zi-(Rr=(Pi=K*zi)-(Pi-zi)))-((En=Cs*zi)-_r*Rr-wr*Rr-_r*sn)))+(Qt=kr-Er))+(Qt-kn),Je[1]=(jr=cr-((ei=cr+Er)-(Qt=ei-cr))+(Er-Qt))-((Er=jr-En)+(Qt=jr-Er))+(Qt-En),Je[2]=ei-((_n=ei+Er)-(Qt=_n-ei))+(Er-Qt),Je[3]=_n;var An=te(zs,Ne,4,Je,He);Je[0]=(kr=(wr=rr-(_r=(Pi=K*rr)-(Pi-rr)))*(sn=Br-(Rr=(Pi=K*Br)-(Pi-Br)))-((cr=rr*Br)-_r*Rr-wr*Rr-_r*sn))-((Er=kr-(kn=(wr=wi-(_r=(Pi=K*wi)-(Pi-wi)))*(sn=zi-(Rr=(Pi=K*zi)-(Pi-zi)))-((En=wi*zi)-_r*Rr-wr*Rr-_r*sn)))+(Qt=kr-Er))+(Qt-kn),Je[1]=(jr=cr-((ei=cr+Er)-(Qt=ei-cr))+(Er-Qt))-((Er=jr-En)+(Qt=jr-Er))+(Qt-En),Je[2]=ei-((_n=ei+Er)-(Qt=_n-ei))+(Er-Qt),Je[3]=_n;var Zo=te(An,He,4,Je,qe);return qe[Zo-1]}(_t,gt,Vt,Ht,fi,bi,ai)}(ie[0],ie[1],oe[0],oe[1],Ve[0],Ve[1]);return Qe>0?-1:Qe<0?1:0}function Ze(ie,oe){var Ve=ie.point,Qe=oe.point;return Ve[0]>Qe[0]?1:Ve[0]<Qe[0]?-1:Ve[1]!==Qe[1]?Ve[1]>Qe[1]?1:-1:function(_t,gt,Vt,Ht){return _t.left!==gt.left?_t.left?1:-1:et(Vt,_t.otherEvent.point,gt.otherEvent.point)!==0?_t.isBelow(gt.otherEvent.point)?-1:1:!_t.isSubject&&gt.isSubject?1:-1}(ie,oe,Ve)}function Xe(ie,oe,Ve){var Qe=new V(oe,!1,ie,ie.isSubject),_t=new V(oe,!0,ie.otherEvent,ie.isSubject);return q(ie.point,ie.otherEvent.point)&&console.warn("what is that, a collapsed segment?",ie),Qe.contourId=_t.contourId=ie.contourId,Ze(_t,ie.otherEvent)>0&&(ie.otherEvent.left=!0,_t.left=!1),ie.otherEvent.otherEvent=_t,ie.otherEvent=Qe,Ve.push(_t),Ve.push(Qe),Ve}function Be(ie,oe){return ie[0]*oe[1]-ie[1]*oe[0]}function ke(ie,oe){return ie[0]*oe[0]+ie[1]*oe[1]}function Ke(ie,oe,Ve){var Qe=function(fi,bi,Ti,Ci,ti){var ai=[bi[0]-fi[0],bi[1]-fi[1]],Gi=[Ci[0]-Ti[0],Ci[1]-Ti[1]];function Xi(Pi,_r,wr){return[Pi[0]+_r*wr[0],Pi[1]+_r*wr[1]]}var Ki=[Ti[0]-fi[0],Ti[1]-fi[1]],lr=Be(ai,Gi),xr=lr*lr,fr=ke(ai,ai);if(xr>0){var Ji=Be(Ki,Gi)/lr;if(Ji<0||Ji>1)return null;var rr=Be(Ki,ai)/lr;return rr<0||rr>1?null:Ji===0||Ji===1?[Xi(fi,Ji,ai)]:rr===0||rr===1?[Xi(Ti,rr,Gi)]:[Xi(fi,Ji,ai)]}if((xr=(lr=Be(Ki,ai))*lr)>0)return null;var wi=ke(ai,Ki)/fr,zi=wi+ke(ai,Gi)/fr,Br=Math.min(wi,zi),Qt=Math.max(wi,zi);return Br<=1&&Qt>=0?Br===1?[Xi(fi,Br>0?Br:0,ai)]:Qt===0?[Xi(fi,Qt<1?Qt:1,ai)]:[Xi(fi,Br>0?Br:0,ai),Xi(fi,Qt<1?Qt:1,ai)]:null}(ie.point,ie.otherEvent.point,oe.point,oe.otherEvent.point),_t=Qe?Qe.length:0;if(_t===0||_t===1&&(q(ie.point,oe.point)||q(ie.otherEvent.point,oe.otherEvent.point))||_t===2&&ie.isSubject===oe.isSubject)return 0;if(_t===1)return q(ie.point,Qe[0])||q(ie.otherEvent.point,Qe[0])||Xe(ie,Qe[0],Ve),q(oe.point,Qe[0])||q(oe.otherEvent.point,Qe[0])||Xe(oe,Qe[0],Ve),1;var gt=[],Vt=!1,Ht=!1;return q(ie.point,oe.point)?Vt=!0:Ze(ie,oe)===1?gt.push(oe,ie):gt.push(ie,oe),q(ie.otherEvent.point,oe.otherEvent.point)?Ht=!0:Ze(ie.otherEvent,oe.otherEvent)===1?gt.push(oe.otherEvent,ie.otherEvent):gt.push(ie.otherEvent,oe.otherEvent),Vt&&Ht||Vt?(oe.type=p,ie.type=oe.inOut===ie.inOut?y:v,Vt&&!Ht&&Xe(gt[1].otherEvent,gt[0].point,Ve),2):Ht?(Xe(gt[0],gt[1].point,Ve),3):gt[0]!==gt[3].otherEvent?(Xe(gt[0],gt[1].point,Ve),Xe(gt[1],gt[2].point,Ve),3):(Xe(gt[0],gt[1].point,Ve),Xe(gt[3].otherEvent,gt[2].point,Ve),3)}function ht(ie,oe){if(ie===oe)return 0;if(et(ie.point,ie.otherEvent.point,oe.point)!==0||et(ie.point,ie.otherEvent.point,oe.otherEvent.point)!==0)return q(ie.point,oe.point)?ie.isBelow(oe.otherEvent.point)?-1:1:ie.point[0]===oe.point[0]?ie.point[1]<oe.point[1]?-1:1:Ze(ie,oe)===1?oe.isAbove(ie.point)?-1:1:ie.isBelow(oe.point)?-1:1;if(ie.isSubject!==oe.isSubject)return ie.isSubject?-1:1;var Ve=ie.point,Qe=oe.point;return Ve[0]===Qe[0]&&Ve[1]===Qe[1]?(Ve=ie.otherEvent.point)[0]===(Qe=oe.otherEvent.point)[0]&&Ve[1]===Qe[1]?0:ie.contourId>oe.contourId?1:-1:Ze(ie,oe)===1?1:-1}var st=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Nt(ie,oe,Ve,Qe){var _t,gt=ie+1,Vt=oe[ie].point,Ht=oe.length;for(gt<Ht&&(_t=oe[gt].point);gt<Ht&&_t[0]===Vt[0]&&_t[1]===Vt[1];){if(!Ve[gt])return gt;++gt<Ht&&(_t=oe[gt].point)}for(gt=ie-1;Ve[gt]&&gt>Qe;)gt--;return gt}st.prototype.isExterior=function(){return this.holeOf==null};var vt=Lt,At=Lt;function Lt(ie,oe){if(!(this instanceof Lt))return new Lt(ie,oe);if(this.data=ie||[],this.length=this.data.length,this.compare=oe||Si,this.length>0)for(var Ve=(this.length>>1)-1;Ve>=0;Ve--)this._down(Ve)}function Si(ie,oe){return ie<oe?-1:ie>oe?1:0}Lt.prototype={push:function(ie){this.data.push(ie),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var ie=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),ie}},peek:function(){return this.data[0]},_up:function(ie){for(var oe=this.data,Ve=this.compare,Qe=oe[ie];ie>0;){var _t=ie-1>>1,gt=oe[_t];if(Ve(Qe,gt)>=0)break;oe[ie]=gt,ie=_t}oe[ie]=Qe},_down:function(ie){for(var oe=this.data,Ve=this.compare,Qe=this.length>>1,_t=oe[ie];ie<Qe;){var gt=1+(ie<<1),Vt=gt+1,Ht=oe[gt];if(Vt<this.length&&Ve(oe[Vt],Ht)<0&&(gt=Vt,Ht=oe[Vt]),Ve(Ht,_t)>=0)break;oe[ie]=Ht,ie=gt}oe[ie]=_t}},vt.default=At;var at=Math.max,Ot=Math.min,li=0;function Di(ie,oe,Ve,Qe,_t,gt){var Vt,Ht,fi,bi,Ti,Ci;for(Vt=0,Ht=ie.length-1;Vt<Ht;Vt++)if(bi=ie[Vt+1],Ti=new V(fi=ie[Vt],!1,void 0,oe),Ci=new V(bi,!1,Ti,oe),Ti.otherEvent=Ci,fi[0]!==bi[0]||fi[1]!==bi[1]){Ti.contourId=Ci.contourId=Ve,gt||(Ti.isExteriorRing=!1,Ci.isExteriorRing=!1),Ze(Ti,Ci)>0?Ci.left=!0:Ti.left=!0;var ti=fi[0],ai=fi[1];_t[0]=Ot(_t[0],ti),_t[1]=Ot(_t[1],ai),_t[2]=at(_t[2],ti),_t[3]=at(_t[3],ai),Qe.push(Ti),Qe.push(Ci)}}var ki=[];function mi(ie,oe,Ve){typeof ie[0][0][0]=="number"&&(ie=[ie]),typeof oe[0][0][0]=="number"&&(oe=[oe]);var Qe=function(ai,Gi,Xi){var Ki=null;return ai.length*Gi.length==0&&(Xi===w?Ki=ki:Xi===A?Ki=ai:Xi!==S&&Xi!==P||(Ki=ai.length===0?Gi:ai)),Ki}(ie,oe,Ve);if(Qe)return Qe===ki?null:Qe;var _t=[1/0,1/0,-1/0,-1/0],gt=[1/0,1/0,-1/0,-1/0],Vt=function(ai,Gi,Xi,Ki,lr){var xr,fr,Ji,rr,wi,zi,Br=new vt(null,Ze);for(Ji=0,rr=ai.length;Ji<rr;Ji++)for(wi=0,zi=(xr=ai[Ji]).length;wi<zi;wi++)(fr=wi===0)&&li++,Di(xr[wi],!0,li,Br,Xi,fr);for(Ji=0,rr=Gi.length;Ji<rr;Ji++)for(wi=0,zi=(xr=Gi[Ji]).length;wi<zi;wi++)fr=wi===0,lr===A&&(fr=!1),fr&&li++,Di(xr[wi],!1,li,Br,Ki,fr);return Br}(ie,oe,_t,gt,Ve);if(Qe=function(ai,Gi,Xi,Ki,lr){var xr=null;return(Xi[0]>Ki[2]||Ki[0]>Xi[2]||Xi[1]>Ki[3]||Ki[1]>Xi[3])&&(lr===w?xr=ki:lr===A?xr=ai:lr!==S&&lr!==P||(xr=ai.concat(Gi))),xr}(ie,oe,_t,gt,Ve))return Qe===ki?null:Qe;for(var Ht=function(ai){var Gi,Xi,Ki=function(Ji){var rr,wi,zi,Br,Qt=[];for(wi=0,zi=Ji.length;wi<zi;wi++)((rr=Ji[wi]).left&&rr.inResult||!rr.left&&rr.otherEvent.inResult)&&Qt.push(rr);for(var Pi=!1;!Pi;)for(Pi=!0,wi=0,zi=Qt.length;wi<zi;wi++)wi+1<zi&&Ze(Qt[wi],Qt[wi+1])===1&&(Br=Qt[wi],Qt[wi]=Qt[wi+1],Qt[wi+1]=Br,Pi=!1);for(wi=0,zi=Qt.length;wi<zi;wi++)(rr=Qt[wi]).otherPos=wi;for(wi=0,zi=Qt.length;wi<zi;wi++)(rr=Qt[wi]).left||(Br=rr.otherPos,rr.otherPos=rr.otherEvent.otherPos,rr.otherEvent.otherPos=Br);return Qt}(ai),lr={},xr=[],fr=function(){if(!lr[Gi]){var Ji=xr.length,rr=function(Qt,Pi,_r){var wr=new st;if(Qt.prevInResult!=null){var Rr=Qt.prevInResult,sn=Rr.outputContourId;if(Rr.resultTransition>0){var Er=Pi[sn];if(Er.holeOf!=null){var ei=Er.holeOf;Pi[ei].holeIds.push(_r),wr.holeOf=ei,wr.depth=Pi[sn].depth}else Pi[sn].holeIds.push(_r),wr.holeOf=sn,wr.depth=Pi[sn].depth+1}else wr.holeOf=null,wr.depth=Pi[sn].depth}else wr.holeOf=null,wr.depth=0;return wr}(Ki[Gi],xr,Ji),wi=function(Qt){lr[Qt]=!0,Qt<Ki.length&&Ki[Qt]&&(Ki[Qt].outputContourId=Ji)},zi=Gi,Br=Gi;for(rr.points.push(Ki[Gi].point);wi(zi),wi(zi=Ki[zi].otherPos),rr.points.push(Ki[zi].point),!((zi=Nt(zi,Ki,lr,Br))==Br||zi>=Ki.length)&&Ki[zi];);xr.push(rr)}};for(Gi=0,Xi=Ki.length;Gi<Xi;Gi++)fr();return xr}(function(ai,Gi,Xi,Ki,lr,xr){for(var fr,Ji,rr,wi=new i(ht),zi=[],Br=Math.min(Ki[2],lr[2]);ai.length!==0;){var Qt=ai.pop();if(zi.push(Qt),xr===w&&Qt.point[0]>Br||xr===A&&Qt.point[0]>Ki[2])break;if(Qt.left){Ji=fr=wi.insert(Qt),fr=fr!==(rr=wi.minNode())?wi.prev(fr):null,Ji=wi.next(Ji);var Pi=fr?fr.key:null;if(R(Qt,Pi,xr),Ji&&Ke(Qt,Ji.key,ai)===2&&(R(Qt,Pi,xr),R(Ji.key,Qt,xr)),fr&&Ke(fr.key,Qt,ai)===2){var _r=fr;R(Pi,(_r=_r!==rr?wi.prev(_r):null)?_r.key:null,xr),R(Qt,Pi,xr)}}else Ji=fr=wi.find(Qt=Qt.otherEvent),fr&&Ji&&(fr=fr!==rr?wi.prev(fr):null,Ji=wi.next(Ji),wi.remove(Qt),Ji&&fr&&Ke(fr.key,Ji.key,ai))}return zi}(Vt,0,0,_t,gt,Ve)),fi=[],bi=0;bi<Ht.length;bi++){var Ti=Ht[bi];if(Ti.isExterior()){for(var Ci=[Ti.points],ti=0;ti<Ti.holeIds.length;ti++)Ci.push(Ht[Ti.holeIds[ti]].points);fi.push(Ci)}}return fi}var dr={UNION:S,DIFFERENCE:A,INTERSECTION:w,XOR:P};r.diff=function(ie,oe){return mi(ie,oe,A)},r.intersection=function(ie,oe){return mi(ie,oe,w)},r.operations=dr,r.union=function(ie,oe){return mi(ie,oe,S)},r.xor=function(ie,oe){return mi(ie,oe,P)},Object.defineProperty(r,"__esModule",{value:!0})}(Nv.exports)),Nv.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function x_(r,e,i,s){const a=[],u=s===0?(h,p,y,v,w,S)=>{h.push(new Ye(S,y+(S-p)/(v-p)*(w-y)))}:(h,p,y,v,w,S)=>{h.push(new Ye(p+(S-y)/(w-y)*(v-p),S))};for(const h of r){const p=[];for(const y of h){if(y.length<=2)continue;const v=[];for(let A=0;A<y.length-1;A++){const P=y[A].x,R=y[A].y,O=y[A+1].x,V=y[A+1].y,N=s===0?P:R,q=s===0?O:V;N<e?q>e&&u(v,P,R,O,V,e):N>i?q<i&&u(v,P,R,O,V,i):v.push(y[A]),q<e&&N>=e&&u(v,P,R,O,V,e),q>i&&N<=i&&u(v,P,R,O,V,i)}let w=y[y.length-1];const S=s===0?w.x:w.y;S>=e&&S<=i&&v.push(w),v.length&&(w=v[v.length-1],v[0].x===w.x&&v[0].y===w.y||v.push(v[0]),p.push(v))}p.length&&a.push(p)}return a}function KE(r,e){const i=Hy(r),s=Hy([e]),a=Vv.intersection(i,s);return a==null?[]:Uv(a)}function YE(r,e){let s=Hy(r,65536);const a=[];for(;e.valid();e.next()){const[u,h]=e.get(),p=u.x*65536,y=u.y*65536,v=h.x*65536,w=h.y*65536,S=v-p,A=w-y,P=Math.hypot(S,A);if(P===0)continue;const R=Math.trunc(A/P*3),O=-Math.trunc(S/P*3);a.push([[[p,y],[v,w],[v+R,w+O],[p+R,y+O],[p,y]]])}return a.length>0&&(s=Vv.diff(s,a)),Uv(s,1/65536)}function Hy(r,e=1){return[r.map(i=>i.map(s=>[s.x*e,s.y*e]))]}function Uv(r,e=1){return r.map(i=>i.map((s,a)=>{const u=s.map(h=>new Ye(h[0]*e,h[1]*e).round());return a>0&&u.reverse(),u}))}class qy{constructor(e,i){this.layoutVertexArray=new Ha,this.indexArray=new wn,this.lineIndexArray=new Hs,this.triangleSegments=new Nr,this.lineSegments=new Nr,this.programConfigurations=new Eo(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new ua)}update(e,i,s,a,u,h,p,y){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p,y)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,OE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,kE.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,s,a,u,h,p){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,s,a,u,h,void 0,p)}}class $y{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new qy(e,!1),this.elevationBufferData=new qy(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=jy("fill",this.layers,this.pixelRatio,i);const u=this.layers[0].layout.get("fill-sort-key"),h=[];for(const{feature:p,id:y,index:v,sourceLayerIndex:w}of e){const S=this.layers[0]._featureFilter.needGeometry,A=be(p,S);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),A,s))continue;const P=u?u.evaluate(A,{},s,i.availableImages):void 0,R={id:y,properties:p.properties,type:p.type,sourceLayerIndex:w,index:v,geometry:S?A.geometry:ue(p,s,a),patterns:{},sortKey:P};h.push(R)}u&&h.sort((p,y)=>p.sortKey-y.sortKey);for(const p of h){const{geometry:y,index:v,sourceLayerIndex:w}=p;if(this.hasPattern){const S=Gy("fill",this.layers,p,this.zoom,this.pixelRatio,i);this.patternFeatures.push(S)}else this.addFeature(p,y,v,s,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[v].feature,y,v,w,this.index)}}update(e,i,s,a,u,h,p){this.bufferData.update(e,i,s,a,u,h,p,this.worldview),this.elevationBufferData.update(e,i,s,a,u,h,p,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,s,a,u,h,p,this.worldview)}addFeatures(e,i,s,a,u,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,s,a,h,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,s,a,u,h=[],p,y){const v=ep(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,v,a,s,y):this.addGeometry(v,this.bufferData),this.bufferData.populatePaintArrays(e,s,u,h,a,p,this.worldview),this.elevationBufferData.populatePaintArrays(e,s,u,h,a,p,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,i,s,a,u){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,s,a,u,this.worldview))}addElevatedRoadFeature(e,i,s,a,u){const h=new Array,p=tr.getElevationFeature(e,u);if(!p)return void this.addGeometry(i,this.bufferData);{const v=this.clipPolygonsToTile(i,1);v.length>0&&h.push({polygons:v,elevationFeature:p,elevationTileID:s})}const y={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},s),featureIndex:a};for(const v of h)if(v.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new $s(v.elevationTileID,this.layers,this.zoom,this.lut));const S=v.elevationFeature.isTunnel();let A=0;e.properties.hasOwnProperty(Pe)&&(A=+e.properties[Pe]);for(const P of v.polygons)this.elevatedStructures.addPortalCandidates(v.elevationFeature.id,P,S,v.elevationFeature,A)}v.elevationFeature.constantHeight==null&&(v.polygons=this.prepareElevatedPolygons(v.polygons,v.elevationFeature,v.elevationTileID));const w=new hr(s,v.elevationTileID);this.addElevatedGeometry(v.polygons,w,v.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,a,y)}}addElevatedGeometry(e,i,s,a,u,h){const p={elevation:s,elevationSampler:i,bias:a,index:u,featureInfo:h},[y,v]=this.addGeometry(e,this.elevationBufferData,p);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:y,max:v}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,y),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,v))}addGeometry(e,i,s){let a=Number.POSITIVE_INFINITY,u=Number.NEGATIVE_INFINITY,h=null;s&&(h=s.elevationSampler.constantElevation(s.elevation,s.bias),h!=null&&(a=h,u=h));const p=(y,v,w)=>{if(s!=null)if(v.push(y),h!=null)i.elevatedLayoutVertexArray.emplaceBack(h),w.push(h);else{const S=s.elevationSampler.pointElevation(y,s.elevation,s.bias);i.elevatedLayoutVertexArray.emplaceBack(S),w.push(S),a=Math.min(a,S),u=Math.max(u,S)}};for(const y of e){let v=0;for(const W of y)v+=W.length;const w=i.triangleSegments.prepareSegment(v,i.layoutVertexArray,i.indexArray),S=w.vertexLength,A=[],P=[],R=[],O=[],V=[],N=i.layoutVertexArray.length;for(const W of y){if(W.length===0)continue;W!==y[0]&&P.push(A.length/2);const K=i.lineSegments.prepareSegment(W.length,i.layoutVertexArray,i.lineIndexArray),se=K.vertexLength;s&&V.push(i.layoutVertexArray.length-N),p(W[0],R,O),i.layoutVertexArray.emplaceBack(W[0].x,W[0].y),i.lineIndexArray.emplaceBack(se+W.length-1,se),A.push(W[0].x),A.push(W[0].y);for(let te=1;te<W.length;te++)p(W[te],R,O),i.layoutVertexArray.emplaceBack(W[te].x,W[te].y),i.lineIndexArray.emplaceBack(se+te-1,se+te),A.push(W[te].x),A.push(W[te].y);K.vertexLength+=W.length,K.primitiveLength+=W.length}const q=id(A,P);for(let W=0;W<q.length;W+=3)i.indexArray.emplaceBack(S+q[W],S+q[W+1],S+q[W+2]);if(q.length>0&&s&&this.elevationMode==="hd-road-base"){const W=s.elevation.isTunnel(),K=s.elevation.safeArea,se=this.elevatedStructures.addVertices(R,O);this.elevatedStructures.addTriangles(q,se,W);const te=V.length;if(te>0){for(let le=0;le<te-1;le++)this.elevatedStructures.addRenderableRing(s.index,V[le]+se,V[le+1]-V[le],W,K,s.featureInfo);this.elevatedStructures.addRenderableRing(s.index,V[te-1]+se,R.length-V[te-1],W,K,s.featureInfo)}}w.vertexLength+=v,w.primitiveLength+=q.length/3}return[a,u]}prepareElevatedPolygons(e,i,s){const a=1/G(s),u=[];for(const h of e){const p=YE(h,new Zi(i,a));u.push(...p)}return u}clipPolygonsToTile(e,i){const s=-i,a=-i,u=ut+i,h=ut+i;let p=0;const y=[],v=[];for(;p<e.length;p++){const A=e[p],P=na(A);(P.min.x>=s&&P.max.x<=u&&P.min.y>=a&&P.max.y<=h?y:v).push(A)}if(y.length===e.length)return e;const w=[new Ye(s,a),new Ye(u,a),new Ye(u,h),new Ye(s,h),new Ye(s,a)],S=y;for(const A of v)S.push(...KE(A,w));return S}}let jv,Gv,Hv,qv;Mt($y,"FillBucket",{omit:["layers","patternFeatures"]}),Mt(qy,"FillBufferData"),Mt($s,"ElevatedStructures");class v_{constructor(e,i,s,a){if(this.triangleCount=i.length/3,this.min=new Ye(0,0),this.max=new Ye(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[u,h]=[e[0].clone(),e[0].clone()];for(let S=1;S<e.length;++S){const A=e[S];u.x=Math.min(u.x,A.x),u.y=Math.min(u.y,A.y),h.x=Math.max(h.x,A.x),h.y=Math.max(h.y,A.y)}if(a){const S=Math.ceil(Math.max(h.x-u.x,h.y-u.y)/a);s=Math.max(s,S)}if(s===0)return;this.min=u,this.max=h;const p=this.max.sub(this.min);p.x=Math.max(p.x,1),p.y=Math.max(p.y,1);const y=Math.max(p.x,p.y)/s;this.cellsX=Math.max(1,Math.ceil(p.x/y)),this.cellsY=Math.max(1,Math.ceil(p.y/y)),this.xScale=1/y,this.yScale=1/y;const v=[];for(let S=0;S<this.triangleCount;S++){const A=e[i[3*S+0]].sub(this.min),P=e[i[3*S+1]].sub(this.min),R=e[i[3*S+2]].sub(this.min),O=Xa(Math.floor(Math.min(A.x,P.x,R.x)),this.xScale,this.cellsX),V=Xa(Math.floor(Math.max(A.x,P.x,R.x)),this.xScale,this.cellsX),N=Xa(Math.floor(Math.min(A.y,P.y,R.y)),this.yScale,this.cellsY),q=Xa(Math.floor(Math.max(A.y,P.y,R.y)),this.yScale,this.cellsY),W=new Ye(0,0),K=new Ye(0,0),se=new Ye(0,0),te=new Ye(0,0);for(let le=N;le<=q;++le){W.y=K.y=le*y,se.y=te.y=(le+1)*y;for(let fe=O;fe<=V;++fe)W.x=se.x=fe*y,K.x=te.x=(fe+1)*y,(ss(A,P,R,W,K,te)||ss(A,P,R,W,te,se))&&v.push({cellIdx:le*this.cellsX+fe,triIdx:S})}}if(v.length===0)return;v.sort((S,A)=>S.cellIdx-A.cellIdx||S.triIdx-A.triIdx);let w=0;for(;w<v.length;){const S=v[w].cellIdx,A={start:this.payload.length,len:0};for(;w<v.length&&v[w].cellIdx===S;)++A.len,this.payload.push(v[w++].triIdx);this.cells[S]=A}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const s=Xa(e.x-this.min.x,this.xScale,this.cellsX),a=Xa(e.y-this.min.y,this.yScale,this.cellsY),u=this.cells[a*this.cellsX+s];if(u){this._lazyInitLookup();for(let h=0;h<u.len;h++){const p=this.payload[u.start+h],y=Math.floor(p/8),v=1<<p%8;if(!(this.lookup[y]&v)&&(this.lookup[y]|=v,i.push(p),i.length===this.triangleCount))return}}}query(e,i,s){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const a=Xa(e.x-this.min.x,this.xScale,this.cellsX),u=Xa(i.x-this.min.x,this.xScale,this.cellsX),h=Xa(e.y-this.min.y,this.yScale,this.cellsY),p=Xa(i.y-this.min.y,this.yScale,this.cellsY);for(let y=h;y<=p;y++)for(let v=a;v<=u;v++){const w=this.cells[y*this.cellsX+v];if(w)for(let S=0;S<w.len;S++){const A=this.payload[w.start+S],P=Math.floor(A/8),R=1<<A%8;if(!(this.lookup[P]&R)&&(this.lookup[P]|=R,s.push(A),s.length===this.triangleCount))return}}}}function Xa(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}Mt(v_,"TriangleGridIndex");class $v{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const s of this.footprints)i.push({footprint:s,id:e})}updateAppearances(e,i,s,a){}populate(e,i,s,a){const u=[];for(const{feature:h,id:p,index:y,sourceLayerIndex:v}of e){const w=this.layers[0]._featureFilter.needGeometry,S=be(h,w);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),S,s))continue;const A={id:p,properties:h.properties,type:h.type,sourceLayerIndex:v,index:y,geometry:w?S.geometry:ue(h,s,a),patterns:{}};u.push(A)}for(const h of u){const{geometry:p,index:y,sourceLayerIndex:v}=h;this.addFeature(h,p,y,s,{},i.availableImages,i.brightness),i.featureIndex.insert(e[y].feature,p,y,v,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,s,a,u,h,p){}destroy(){}addFeature(e,i,s,a,u,h=[],p){for(const y of ep(i,2)){const v=[],w=[],S=[],A=new Ye(1/0,1/0),P=new Ye(-1/0,-1/0);for(const V of y)if(V.length!==0){V!==y[0]&&S.push(w.length/2);for(let N=0;N<V.length;N++)w.push(V[N].x),w.push(V[N].y),v.push(V[N]),A.x=Math.min(A.x,V[N].x),A.y=Math.min(A.y,V[N].y),P.x=Math.max(P.x,V[N].x),P.y=Math.max(P.y,V[N].y)}const R=id(w,S),O=new v_(v,R,8,256);this.footprints.push({vertices:v,indices:R,grid:O,min:A,max:P})}}}Mt($v,"ClipBucket",{omit:["layers"]});const JE=Ii([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),QE=Ii([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),eA=Ii([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),tA=Ii([{name:"a_centroid_pos",components:2,type:"Uint16"}]),iA=Ii([{name:"a_join_normal_inside",components:3,type:"Int16"}]),rA=Ii([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),nA=Ii([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:sA}=JE,tp=Number.MAX_SAFE_INTEGER,Wv=tp-1;function Zv(r,e,i,s){return r.order<e||r.order===tp||!(r.clipMask&i)||function(a,u){return u.length!==0&&u.find(h=>h===a)===void 0}(s,r.clipScope)}function b_(r,e){return r.x-e.x||r.y-e.y}function Xv(r,e){return b_(r.min,e.min)===0&&b_(r.max,e.max)===0}function Wy(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function w_(r,e){if(r.length!==e.length)return!1;for(let i=0;i<r.length;i++)if(r[i].sourceId!==e[i].sourceId||!Xv(r[i],e[i])||r[i].order!==e[i].order||r[i].clipMask!==e[i].clipMask||!ea(r[i].clipScope,e[i].clipScope))return!1;return!0}function Kv(r,e,i){const s=1/ut,a=1/(1<<i.canonical.z),u=(e.x*s+i.canonical.x)*a+i.wrap,h=(e.y*s+i.canonical.y)*a;return{min:new Ye((r.x*s+i.canonical.x)*a+i.wrap,(r.y*s+i.canonical.y)*a),max:new Ye(u,h)}}function oA(r,e,i){const s=1<<i.canonical.z,a=((e.x-i.wrap)*s-i.canonical.x)*ut,u=(e.y*s-i.canonical.y)*ut;return{min:new Ye(((r.x-i.wrap)*s-i.canonical.x)*ut,(r.y*s-i.canonical.y)*ut),max:new Ye(a,u)}}function Zy(r,e,i,s,a,u,h){const p=r.indices,y=r.vertices,v=[];for(let w=s;w<s+a;w+=3){const S=e[i[w+0]+u],A=e[i[w+1]+u],P=e[i[w+2]+u],R=Math.min(S.x,A.x,P.x),O=Math.max(S.x,A.x,P.x),V=Math.min(S.y,A.y,P.y),N=Math.max(S.y,A.y,P.y);v.length=0,r.grid.query(new Ye(R,V),new Ye(O,N),v);for(let q=0;q<v.length;q++){const W=v[q];if(ss(y[p[3*W+0]],y[p[3*W+1]],y[p[3*W+2]],S,A,P,h))return!0}}return!1}function Yv(r,e,i,s){if(!r||!i)return!1;let a=r.vertices;if(!e.canonical.equals(s.canonical)||e.wrap!==s.wrap){if(i.vertices.length<r.vertices.length)return Yv(i,s,r,e);const u=e.canonical,h=s.canonical,p=Math.pow(2,h.z-u.z);a=r.vertices.map(y=>new Ye((y.x+u.x*ut)*p-h.x*ut,(y.y+u.y*ut)*p-h.y*ut))}return Zy(i,a,r.indices,0,r.indices.length,0,0)}function Jv(r,e,i,s){const a=Math.pow(2,s.z-i.z);return new Ye((r+i.x*ut)*a-s.x*ut,(e+i.y*ut)*a-s.y*ut)}function Qv(r,e){const i=[];e.grid.queryPoint(r,i);const s=e.indices,a=e.vertices;for(let u=0;u<i.length;u++){const h=i[u];if(gr([a[s[3*h+0]],a[s[3*h+1]],a[s[3*h+2]]],r))return!0}return!1}const Xy=[new Ye(0,0),new Ye(ut,0),new Ye(ut,ut),new Ye(0,ut)];function eb(r,e){const i=[];let s=[];if(!e||r.length<2)return[r];if(r.length===2)return Kn(r[0],r[1],Xy)?[r]:[];for(let a=0;a<r.length+2;a++){const u=r[a%r.length],h=r[(a+1)%r.length],p=Kn(a===0?r[r.length-1]:r[(a-1)%r.length],u,Xy),y=Kn(u,h,Xy),v=p||y;v&&s.push(u),v&&y||s.length>0&&(s.length>1&&i.push(s),s=[])}return s.length>1&&i.push(s),i}const Ky=xe.types,aA=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],lA=["fill-extrusion-flood-light-ground-radius"],cA=Math.pow(2,13),uA=Math.pow(2,15)-1,tb=new Ye(0,1),Rl=2147483648,ib=7,rb=450;function ip(r,e,i,s,a,u,h,p){r.emplaceBack((e<<1)+h,(i<<1)+u,(Math.floor(s*cA)<<1)+a,Math.round(p))}function rp(r,e,i){r.emplaceBack(e.x*ut,e.y*ut,i?1:0)}function T_(r,e,i,s,a,u){r.emplaceBack(e.x,e.y,(i.x<<1)+s,(i.y<<1)+a,u)}function np(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class nb{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class sb{constructor(){this.centroidXY=new Ye(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Ye(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Ye(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Ye(this.max.x-this.min.x,this.max.y-this.min.y)}}class ob{constructor(){this.acc=new Ye(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,s){this.accCount++,this.acc._add(i);let a=!!this.borders;i.x<e.min.x?(e.min.x=i.x,a=!0):i.x>e.max.x&&(e.max.x=i.x,a=!0),i.y<e.min.y?(e.min.y=i.y,a=!0):i.y>e.max.y&&(e.max.y=i.y,a=!0),((i.x===0||i.x===ut)&&i.x===s.x)!=((i.y===0||i.y===ut)&&i.y===s.y)&&this.processBorderOverlap(i,s),a&&this.checkBorderIntersection(i,s)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,ii(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>ut!=e.x>ut&&this.addBorderIntersection(1,ii(i.y,e.y,(ut-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,ii(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>ut!=e.y>ut&&this.addBorderIntersection(3,ii(i.x,e.x,(ut-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];i<s[0]&&(s[0]=i),i>s[1]&&(s[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const s=e.x===0?0:1;this.addBorderIntersection(s,i.y),this.addBorderIntersection(s,e.y)}else{const s=e.y===0?2:3;this.addBorderIntersection(s,i.x),this.addBorderIntersection(s,e.x)}}centroid(){return this.accCount===0?new Ye(0,0):new Ye(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function ab(r,e){const i=r.add(e)._unit(),s=U(r.x*i.x+r.y*i.y,-1,1);var a,u,h;return a=Math.acos(s),Math.min(4,Math.max(-4,Math.tan(a)))/4*uA*((u=r).x*(h=e).y-u.y*h.x<0?-1:1)}const hA=[r=>r.x<0,r=>r.x>ut,r=>r.y<0,r=>r.y>ut];function dA(r,e,i,s){const a=[4];if(s===0)return a;i._mult(s);const u=r.sub(i),h=e.sub(i),p=[r,e,u,h];for(let y=0;y<4;y++)for(const v of p)if(hA[y](v)){a.push(y);break}return a}class Yy{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Mf,this.indexArray=new wn,this.programConfigurations=new Eo(e.layers,{zoom:e.zoom,lut:e.lut},i=>lA.includes(i)),this._segments=new Nr,this.hiddenByLandmarkVertexArray=new Hh,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Nr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,s,a=!1){const u=e.length;if(u>2){let h=Math.max(0,this._segments.get().length-1);const p=this._segments._prepareSegment(4*u,this.vertexArray.length,2*this._segmentToGroundQuads[h].length);let y;h!==this._segments.get().length-1&&(h++,this._segmentToGroundQuads[h]=[],this._segmentToRegionTriCounts[h]=[0,0,0,0,0]);{const v=e[0],w=e[1];y=ab(v.sub(e[u-1])._perp()._unit(),w.sub(v)._perp()._unit())}for(let v=0;v<u;v++){const w=v===u-1?0:v+1,S=e[v],A=e[w],P=e[w===u-1?0:w+1],R=A.sub(S)._perp()._unit(),O=ab(R,P.sub(A)._perp()._unit()),V=y,N=O;if(Jy(S,A,i)||a&&ub(S,i)&&ub(A,i)){y=O;continue}const q=p.vertexLength;T_(this.vertexArray,S,A,1,1,V),T_(this.vertexArray,S,A,1,0,V),T_(this.vertexArray,S,A,0,1,N),T_(this.vertexArray,S,A,0,0,N),p.vertexLength+=4;const W=dA(S,A,R,s);for(const K of W)this._segmentToGroundQuads[h].push({id:q,region:K}),this._segmentToRegionTriCounts[h][K]+=2,p.primitiveLength+=2;y=O}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let s=0;s<i;s++)this._segmentToGroundQuads[s].sort((a,u)=>a.region-u.region);for(let s=0;s<i;s++){const a=this._segmentToGroundQuads[s],u=e[s],h=this._segmentToRegionTriCounts[s];h.reduce((y,v)=>y+v,0);let p=0;for(let y=0;y<=4;y++){const v=h[y];if(v!==0){let w=this.regionSegments[y];w||(w=this.regionSegments[y]=new Nr);const S={vertexOffset:u.vertexOffset,primitiveOffset:u.primitiveOffset+p,vertexLength:u.vertexLength,primitiveLength:v};w.get().push(S)}p+=v}for(let y=0;y<a.length;y++){const v=a[y].id;this.indexArray.emplaceBack(v,v+1,v+3),this.indexArray.emplaceBack(v,v+3,v+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,s,a,u,h,p){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,s,a,u,h,void 0,p)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,QE.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,eA.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,s,a,u,h,p,y){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,s,a,u,h,p,y)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Rl))}updateHiddenByLandmarkRange(e,i,s){if(!this.hasData())return;const a=i+e;if(i!==0){for(let u=e;u<a;++u)this.hiddenByLandmarkVertexArray.emplace(u,s?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,rA.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class S_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new wn,this.footprintVertices=new Ha,this.footprintSegments=[],this.layoutVertexArray=new ac,this.centroidVertexArray=new h_,this.wallVertexArray=new uu,this.indexArray=new wn,this.programConfigurations=new Eo(e.layers,{zoom:e.zoom,lut:e.lut},i=>aA.includes(i)),this.segments=new Nr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new Yy(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.features=[],this.hasPattern=jy("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=G(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:u,id:h,index:p,sourceLayerIndex:y}of e){const v=this.layers[0]._featureFilter.needGeometry,w=be(u,v);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),w,s))continue;const S={id:h,sourceLayerIndex:y,index:p,geometry:v?w.geometry:ue(u,s,a),properties:u.properties,type:u.type,patterns:{}},A=this.layoutVertexArray.length,P=Ky[S.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:u.id,feature:Gy("fill-extrusion",this.layers,S,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const R of S.geometry)for(const O of eb(R,P))this.addFeature(u.id,S,[O],p,s,{},i.availableImages,a,i.brightness);else this.addFeature(u.id,S,S.geometry,p,s,{},i.availableImages,a,i.brightness);i.featureIndex.insert(u,S.geometry,p,y,this.index,A)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,s,a,u,h){for(const{featureId:p,feature:y}of this.features){const v=Ky[y.type]==="Polygon",{geometry:w}=y;if(this.wallMode)for(const S of w)for(const A of eb(S,v))this.addFeature(p,y,[A],y.index,i,s,a,u,h);else this.addFeature(p,y,w,y.index,i,s,a,u,h)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,s,a,u,h,p){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p,this.worldview),this.groundEffect.update(e,i,u,s,a,h,p,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,sA),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,iA.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,nA.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,tA.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,s,a,u,h,p,y,v){const w=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,S=[new Ye(0,0),new Ye(ut,ut)],A=y.projection,P=A.name==="globe",R=this.wallMode||Ky[i.type]==="Polygon",O=new ob;O.centroidDataIndex=this.centroidData.length;const V=new sb;V.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&(V.buildingId=i.properties.building_id);const N=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},u)<=0,q=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},u);let W;if(V.height=q,V.vertexArrayOffset=this.layoutVertexArray.length,V.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bh),this.wallMode){if(P)return void St("Non zero fill-extrusion-line-width is not yet supported on globe.");if(s.length!==1)return;W=function(we){const Ne=we[0].x===we[we.length-1].x&&we[0].y===we[we.length-1].y;(function(At){let Lt=0;const Si=At.length;for(let at=0;at<Si;at++)Lt+=(At[(at+1)%Si].x-At[at].x)*(At[(at+1)%Si].y+At[at].y);return Lt>=0})(we)||(we=we.reverse());const qe={geometry:[],joinNormals:[],indices:[]},Je=[],et=[],Ze=[];let Xe=we.length;for(;Xe>=2&&we[Xe-1].equals(we[Xe-2]);)Xe--;if(Xe<(Ne?3:2))return qe;let Be,ke,Ke,ht,st,Nt=0;for(;Nt<Xe-1&&we[Nt].equals(we[Nt+1]);)Nt++;Ne&&(Be=we[Xe-2],st=we[Nt].sub(Be)._unit()._perp());for(let At=Nt;At<Xe;At++){if(Ke=At===Xe-1?Ne?we[Nt+1]:void 0:we[At+1],Ke&&we[At].equals(Ke))continue;st&&(ht=st),Be&&(ke=Be),Be=we[At],st=Ke?Ke.sub(Be)._unit()._perp():ht,ht=ht||st;let Lt=ht.add(st);Lt.x===0&&Lt.y===0||Lt._unit();const Si=Lt.x*st.x+Lt.y*st.y,at=Si!==0?1/Si:1/0,Ot=ht.x*st.y-ht.y*st.x>0;let li="miter";const Di=2;li==="miter"&&at>Di&&(li="bevel"),li==="bevel"&&(at>100&&(li="flipbevel"),at<Di&&(li="miter"));const ki=(mi,dr,ie,oe)=>{const Ve=new Ye(mi.x,mi.y),Qe=new Ye(mi.x,mi.y);Ve.x+=dr.x*oe,Ve.y+=dr.y*oe,Qe.x-=dr.x*Math.max(ie,1),Qe.y-=dr.y*Math.max(ie,1),Ze.push(dr),Je.push(Ve),et.push(Qe)};if(li==="miter")Lt._mult(at),ki(Be,Lt,0,0);else if(li==="flipbevel")Lt=st.mult(-1),ki(Be,Lt,0,0),ki(Be,Lt.mult(-1),0,0);else{const mi=-Math.sqrt(at*at-1),dr=Ot?mi:0,ie=Ot?0:mi;ke&&ki(Be,ht,dr,ie),Ke&&ki(Be,st,dr,ie)}}qe.geometry=[...Je,...et.reverse(),Je[0]],qe.joinNormals=[...Ze,...Ze.reverse(),Ze[Ze.length-1]];const vt=qe.geometry.length-1;for(let At=0;At<vt/2;At++)if(At+1<vt/2){let Lt=At,Si=At+1,at=vt-1-At,Ot=vt-2-At;Lt=Lt===0?vt-1:Lt-1,Si=Si===0?vt-1:Si-1,at=at===0?vt-1:at-1,Ot=Ot===0?vt-1:Ot-1,qe.indices.push(at),qe.indices.push(Si),qe.indices.push(Lt),qe.indices.push(at),qe.indices.push(Ot),qe.indices.push(Si)}return qe}(s[0]),s=[W.geometry]}const K=(we,Ne)=>we<(Ne.length-1)/2||we===Ne.length-1,se=this.wallMode?[s]:ep(s,500);for(let we=se.length-1;we>=0;we--){const Ne=se[we];(Ne.length===0||(te=Ne[0]).every(He=>He.x<=0)||te.every(He=>He.x>=ut)||te.every(He=>He.y<=0)||te.every(He=>He.y>=ut))&&se.splice(we,1)}var te;let le;if(P)le=pb(se,S,u);else{le=[];for(const we of se)le.push({polygon:we,bounds:S})}const fe=R?this.edgeRadius:0,ge=fe>0&&this.zoom<17,ze=(we,Ne)=>{if(we.length===0)return!1;const He=we[we.length-1];return Ne.x===He.x&&Ne.y===He.y};for(const{polygon:we,bounds:Ne}of le){let He=0,qe=0;for(const Xe of we)R&&!Xe[0].equals(Xe[Xe.length-1])&&Xe.push(Xe[0]),qe+=R?Xe.length-1:Xe.length;const Je=this.segments.prepareSegment((R?5:4)*qe,this.layoutVertexArray,this.indexArray);V.footprintSegIdx<0&&(V.footprintSegIdx=this.footprintSegments.length),V.polygonSegIdx<0&&(V.polygonSegIdx=this.polygonSegments.length);const et={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ze=new nb;if(Ze.vertexOffset=this.footprintVertices.length,Ze.indexOffset=3*this.footprintIndices.length,Ze.ringIndices=[],R){const Xe=[],Be=[];He=Je.vertexLength;for(let Ke=0;Ke<we.length;Ke++){const ht=we[Ke];ht.length&&Ke!==0&&Be.push(Xe.length/2);const st=[];let Nt,vt;Nt=ht[1].sub(ht[0])._perp()._unit(),Ze.ringIndices.push(ht.length-1);for(let At=1;At<ht.length;At++){const Lt=ht[At],Si=ht[At===ht.length-1?1:At+1],at=Lt.clone();if(fe){vt=Si.sub(Lt)._perp()._unit();const Ot=Nt.add(vt)._unit(),li=fe*Math.min(4,1/(Nt.x*Ot.x+Nt.y*Ot.y));at.x+=li*Ot.x,at.y+=li*Ot.y,at.x=Math.round(at.x),at.y=Math.round(at.y),Nt=vt}if(!N||fe!==0&&!ge||ze(st,at)||st.push(at),ip(this.layoutVertexArray,at.x,at.y,0,0,1,1,0),this.wallMode){const Ot=K(At,ht);rp(this.wallVertexArray,W.joinNormals[At],!Ot)}Je.vertexLength++,this.footprintVertices.emplaceBack(Lt.x,Lt.y),Xe.push(Lt.x,Lt.y),P&&np(this.layoutVertexExtArray,A.projectTilePoint(at.x,at.y,u),A.upVector(u,at.x,at.y))}N&&(fe===0||ge)&&(st.length!==0&&ze(st,st[0])&&st.pop(),this.groundEffect.addData(st,Ne,w))}const ke=this.wallMode?W.indices:id(Xe,Be);for(let Ke=0;Ke<ke.length;Ke+=3)this.footprintIndices.emplaceBack(Ze.vertexOffset+ke[Ke+0],Ze.vertexOffset+ke[Ke+1],Ze.vertexOffset+ke[Ke+2]),this.indexArray.emplaceBack(He+ke[Ke],He+ke[Ke+2],He+ke[Ke+1]),Je.primitiveLength++;Ze.indexCount+=ke.length,Ze.vertexCount+=this.footprintVertices.length-Ze.vertexOffset}for(let Xe=0;Xe<we.length;Xe++){const Be=we[Xe];O.startRing(V,Be[0]);let ke=Be.length>4&&hb(Be[Be.length-2],Be[0],Be[1]),Ke=fe?fA(Be[Be.length-2],Be[0],Be[1],fe):0;const ht=[];let st,Nt,vt;Nt=Be[1].sub(Be[0])._perp()._unit();let At=!0;for(let Lt=1,Si=0;Lt<Be.length;Lt++){let at=Be[Lt-1],Ot=Be[Lt];const li=Be[Lt===Be.length-1?1:Lt+1];if(O.appendEdge(V,Ot,at),Jy(Ot,at,Ne)){fe&&(Nt=li.sub(Ot)._perp()._unit(),At=!At);continue}const Di=Ot.sub(at)._perp(),ki=Di.x/(Math.abs(Di.x)+Math.abs(Di.y)),mi=Di.y>0?1:0,dr=at.dist(Ot);if(Si+dr>32768&&(Si=0),fe){vt=li.sub(Ot)._perp()._unit();let Qe=cb(at,Ot,li,lb(Nt,vt),fe);isNaN(Qe)&&(Qe=0);const _t=Ot.sub(at)._unit();at=at.add(_t.mult(Ke))._round(),Ot=Ot.add(_t.mult(-Qe))._round(),Ke=Qe,Nt=vt,N&&this.zoom>=17&&(ze(ht,at)||ht.push(at),ze(ht,Ot)||ht.push(Ot))}const ie=Je.vertexLength,oe=Be.length>4&&hb(at,Ot,li);let Ve=db(Si,ke,At);if(ip(this.layoutVertexArray,at.x,at.y,ki,mi,0,0,Ve),ip(this.layoutVertexArray,at.x,at.y,ki,mi,0,1,Ve),this.wallMode){const Qe=K(Lt-1,Be),_t=W.joinNormals[Lt-1];rp(this.wallVertexArray,_t,Qe),rp(this.wallVertexArray,_t,Qe)}if(Si+=dr,Ve=db(Si,oe,!At),ke=oe,ip(this.layoutVertexArray,Ot.x,Ot.y,ki,mi,0,0,Ve),ip(this.layoutVertexArray,Ot.x,Ot.y,ki,mi,0,1,Ve),this.wallMode){const Qe=K(Lt,Be),_t=W.joinNormals[Lt];rp(this.wallVertexArray,_t,Qe),rp(this.wallVertexArray,_t,Qe)}if(Je.vertexLength+=4,this.indexArray.emplaceBack(ie+0,ie+1,ie+2),this.indexArray.emplaceBack(ie+1,ie+3,ie+2),Je.primitiveLength+=2,fe){const Qe=He+(Lt===1?Be.length-2:Lt-2),_t=Lt===1?He:Qe+1;if(this.indexArray.emplaceBack(ie+1,Qe,ie+3),this.indexArray.emplaceBack(Qe,_t,ie+3),Je.primitiveLength+=2,st===void 0&&(st=ie),!Jy(li,Be[Lt],Ne)){const gt=Lt===Be.length-1?st:Je.vertexLength;this.indexArray.emplaceBack(ie+2,ie+3,gt),this.indexArray.emplaceBack(ie+3,gt+1,gt),this.indexArray.emplaceBack(ie+3,_t,gt+1),Je.primitiveLength+=3}At=!At}if(P){const Qe=this.layoutVertexExtArray,_t=A.projectTilePoint(at.x,at.y,u),gt=A.projectTilePoint(Ot.x,Ot.y,u),Vt=A.upVector(u,at.x,at.y),Ht=A.upVector(u,Ot.x,Ot.y);np(Qe,_t,Vt),np(Qe,_t,Vt),np(Qe,gt,Ht),np(Qe,gt,Ht)}}R&&(He+=Be.length-1),N&&fe&&this.zoom>=17&&(ht.length!==0&&ze(ht,ht[0])&&ht.pop(),this.groundEffect.addData(ht,Ne,w,fe>0))}this.footprintSegments.push(Ze),et.triangleCount=this.indexArray.length-et.triangleArrayOffset,this.polygonSegments.push(et),++V.footprintSegLen,++V.polygonSegLen}if(V.vertexCount=this.layoutVertexArray.length-V.vertexArrayOffset,V.groundVertexCount=this.groundEffect.vertexArray.length-V.groundVertexArrayOffset,V.vertexCount!==0){if(V.centroidXY=O.borders?tb:this.encodeCentroid(O,V),this.centroidData.push(V),O.borders){this.featuresOnBorder.push(O);const we=this.featuresOnBorder.length-1;for(let Ne=0;Ne<O.borders.length;Ne++)O.borders[Ne][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ne].push(we)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,a,h,p,u,v,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,a,h,p,u,v,this.worldview),this.maxHeight=Math.max(this.maxHeight,q)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,s)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}splitToSubtiles(){const e=[];for(let p=0;p<this.centroidData.length;p++){const y=this.centroidData[p],v=+(y.min.y+y.max.y>ut),w=2*v+(+(y.min.x+y.max.x>ut)^v);for(let S=0;S<y.polygonSegLen;S++){const A=y.polygonSegIdx+S;e.push({centroidIdx:p,subtile:w,polygonSegmentIdx:A,triangleSegmentIdx:this.polygonSegments[A].triangleSegIdx})}}const i=new wn;e.sort((p,y)=>p.triangleSegmentIdx===y.triangleSegmentIdx?p.subtile-y.subtile:p.triangleSegmentIdx-y.triangleSegmentIdx);let s=0,a=0,u=0;for(const p of e){if(p.triangleSegmentIdx!==s)break;u++}const h=e.length;for(;a!==e.length;){s=e[a].triangleSegmentIdx;let p=0,y=a,v=a;for(let w=y;w<u&&e[w].subtile===p;w++)v++;for(;y!==u;){const w=e[y];p=w.subtile;const S=this.centroidData[w.centroidIdx].min.clone(),A=this.centroidData[w.centroidIdx].max.clone(),P={vertexOffset:this.segments.segments[s].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[s].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=y;R<v;R++){const O=e[R],V=this.polygonSegments[O.polygonSegmentIdx],N=this.centroidData[O.centroidIdx].min,q=this.centroidData[O.centroidIdx].max,W=this.indexArray.uint16;for(let K=V.triangleArrayOffset;K<V.triangleArrayOffset+V.triangleCount;K++)i.emplaceBack(W[3*K],W[3*K+1],W[3*K+2]);P.primitiveLength+=V.triangleCount,S.x=Math.min(S.x,N.x),S.y=Math.min(S.y,N.y),A.x=Math.max(A.x,q.x),A.y=Math.max(A.y,q.y)}P.primitiveLength>0&&this.triangleSubSegments.push({segment:P,min:S,max:A}),y=v;for(let R=y;R<u&&e[R].subtile===e[y].subtile;R++)v++}a=u;for(let w=a;w<h&&e[w].triangleSegmentIdx===e[a].triangleSegmentIdx;w++)u++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,s){const a=new Nr;if(this.wallMode){for(const O of this.triangleSubSegments)a.segments.push(O.segment);return a}let u=0,h=0;const p=1<<e.canonical.z;if(i){const O=i.getMinMaxForTile(e);O&&(u=O.min,h=O.max)}h+=this.maxHeight;const y=e.toUnwrapped();let v;const w=[y.canonical.x/p+y.wrap,y.canonical.y/p],S=[(y.canonical.x+1)/p+y.wrap,(y.canonical.y+1)/p],A=(O,V,N)=>[O[0]*(1-N[0])+V[0]*N[0],O[1]*(1-N[1])+V[1]*N[1]],P=[],R=[];for(const O of this.triangleSubSegments){P[0]=O.min.x/ut,P[1]=O.min.y/ut,R[0]=O.max.x/ut,R[1]=O.max.y/ut;const V=A(w,S,P),N=A(w,S,R);if(new Ft([V[0],V[1],u],[N[0],N[1],h]).intersectsPrecise(s)===0){v&&(a.segments.push(v),v=void 0);continue}const q=O.segment;v&&v.vertexOffset!==q.vertexOffset&&(a.segments.push(v),v=void 0),v?(v.vertexLength+=q.vertexLength,v.primitiveLength+=q.primitiveLength):v={vertexOffset:q.vertexOffset,primitiveLength:q.primitiveLength,vertexLength:q.vertexLength,primitiveOffset:q.primitiveOffset,sortKey:void 0,vaos:{}}}return v&&a.segments.push(v),a}encodeCentroid(e,i){const s=e.centroid(),a=i.span(),u=Math.min(7,Math.round(a.x*this.tileToMeter/10)),h=Math.min(7,Math.round(a.y*this.tileToMeter/10));return new Ye(U(s.x,1,ut-1)<<3|u,U(s.y,1,ut-1)<<3|h)}encodeBorderCentroid(e){if(!e.borders)return new Ye(0,0);const i=e.borders,s=Number.MAX_VALUE;if(i[0][0]!==s||i[1][0]!==s){const a=i[0][0]!==s?0:1;return new Ye(6|(i[0][0]!==s?0:65528),(i[a][0]+i[a][1])/2<<3|6)}{const a=i[2][0]!==s?2:3;return new Ye((i[a][0]+i[a][1])/2<<3|6,6|(i[2][0]!==s?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,s=e.vertexCount+e.vertexArrayOffset,a=e.flags&Rl?tb:e.centroidXY,u=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==a.y||u!==a.x){for(let h=i;h<s;++h)this.centroidVertexArray.emplace(h,a.x,a.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(w_(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const h of this.centroidData)h.flags&=2147483647;const u=[];for(const h of this.activeReplacements){if(h.order<s)continue;const p=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));if(h.footprint.buildingIds)for(const y of this.centroidData)y.flags&Rl||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y||h.footprint.buildingIds.has(y.buildingId)&&(y.flags|=Rl);else for(const y of this.centroidData)if(!(y.flags&Rl||h.min.x>y.max.x||y.min.x>h.max.x||h.min.y>y.max.y||y.min.y>h.max.y))for(let v=0;v<y.footprintSegLen;v++){const w=this.footprintSegments[y.footprintSegIdx+v];if(u.length=0,pA(this.footprintVertices,w.vertexOffset,w.vertexCount,h.footprintTileId.canonical,e.canonical,u),Zy(h.footprint,u,this.footprintIndices.uint16,w.indexOffset,w.indexCount,-w.vertexOffset,-p)){y.flags|=Rl;break}}}for(const h of this.centroidData)this.writeCentroidToBuffer(h);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,s){let a=!1;for(let u=0;u<s.footprintSegLen;u++){const h=this.footprintSegments[s.footprintSegIdx+u];let p=0;for(const y of h.ringIndices){for(let v=p,w=y+p-1;v<y+p;w=v++){const S=this.footprintVertices.int16[2*(v+h.vertexOffset)+0],A=this.footprintVertices.int16[2*(v+h.vertexOffset)+1],P=this.footprintVertices.int16[2*(w+h.vertexOffset)+1];A>i!=P>i&&e<(this.footprintVertices.int16[2*(w+h.vertexOffset)+0]-S)*(i-A)/(P-A)+S&&(a=!a)}p=y}}return a}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+ut)*ut+(i+ut);if(this.partLookup.hasOwnProperty(u)){const h=this.partLookup[u];return h?{height:h.height,hidden:!!(h.flags&Rl)}:void 0}for(const h of this.centroidData)e>h.max.x||h.min.x>e||i>h.max.y||h.min.y>i||h.height<=s||this.footprintContainsPoint(e,i,h)&&(s=h.height,this.partLookup[u]=h,a=!!(h.flags&Rl));if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.partLookup[u]=void 0}}function lb(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function fA(r,e,i,s){const a=e.sub(r)._perp()._unit(),u=i.sub(e)._perp()._unit();return cb(r,e,i,lb(a,u),s)}function cb(r,e,i,s,a){const u=Math.sqrt(1-s*s);return Math.min(r.dist(e)/3,e.dist(i)/3,a*u/s)}function Jy(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function ub(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function hb(r,e,i){if(r.x<0||r.x>=ut||e.x<0||e.x>=ut||i.x<0||i.x>=ut)return!1;const s=i.sub(e),a=s.perp(),u=r.sub(e);return(s.x*u.x+s.y*u.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(u.x*u.x+u.y*u.y))>-.866&&a.x*u.x+a.y*u.y<0}function db(r,e,i){const s=e?2|r:-3&r;return i?1|s:-2&s}function fb(){const r=Math.PI/32,e=Math.tan(r),i=l;return i*Math.sqrt(1+2*e*e)-i}function pb(r,e,i){const s=1<<i.z,a=I(i.x/s),u=I((i.x+1)/s),h=L(i.y/s),p=L((i.y+1)/s);return function(y,v,w,S,A=0,P){const R=[];if(!y.length||!w||!S)return R;const O=(te,le)=>{for(const fe of te)R.push({polygon:fe,bounds:le})},V=Math.ceil(Math.log2(w)),N=Math.ceil(Math.log2(S)),q=V-N,W=[];for(let te=0;te<Math.abs(q);te++)W.push(q>0?0:1);for(let te=0;te<Math.min(V,N);te++)W.push(0),W.push(1);let K=y;if(K=x_(K,v[0].y-A,v[1].y+A,1),K=x_(K,v[0].x-A,v[1].x+A,0),!K.length)return R;const se=[];for(W.length?se.push({polygons:K,bounds:v,depth:0}):O(K,v);se.length;){const te=se.pop(),le=te.depth,fe=W[le],ge=te.bounds[0],ze=te.bounds[1],we=fe===0?ge.x:ge.y,Ne=fe===0?ze.x:ze.y,He=P?P(fe,we,Ne):.5*(we+Ne),qe=x_(te.polygons,we-A,He+A,fe),Je=x_(te.polygons,He-A,Ne+A,fe);if(qe.length){const et=[ge,new Ye(fe===0?He:ze.x,fe===1?He:ze.y)];W.length>le+1?se.push({polygons:qe,bounds:et,depth:le+1}):O(qe,et)}if(Je.length){const et=[new Ye(fe===0?He:ge.x,fe===1?He:ge.y),ze];W.length>le+1?se.push({polygons:Je,bounds:et,depth:le+1}):O(Je,et)}}return R}(r,e,Math.ceil((u-a)/11.25),Math.ceil((h-p)/11.25),1,(y,v,w)=>{if(y===0)return .5*(v+w);{const S=L((i.y+v/ut)/s);return(b(.5*(L((i.y+w/ut)/s)+S))*s-i.y)*ut}})}function pA(r,e,i,s,a,u){const h=Math.pow(2,s.z-a.z);for(let p=0;p<i;p++){let y=r.int16[2*(p+e)+0],v=r.int16[2*(p+e)+1];y=(y+a.x*ut)*h-s.x*ut,v=(v+a.y*ut)*h-s.y*ut,u.push(new Ye(y,v))}}let mb,_b;Mt(S_,"FillExtrusionBucket",{omit:["layers","features"]}),Mt(sb,"PartData"),Mt(nb,"FootprintSegment"),Mt(ob,"BorderCentroidData"),Mt(Yy,"GroundEffect");class vu extends Ye{constructor(e,i,s){super(e,i),this.z=s}}class gb extends vu{constructor(e,i,s,a){super(e,i,s),this.w=a}}function yb(r,e,i,s){const a=i==="x"?"y":"x",u=(s-r[i])/(e[i]-r[i]);r[a]=Math.round(r[a]+(e[a]-r[a])*u),r[i]=s,r.hasOwnProperty("z")&&(r.z=ii(r.z,e.z,u)),r.hasOwnProperty("w")&&(r.w=ii(r.w,e.w,u))}function xb(r,e,i,s){const a=i,u=s;for(const h of["x","y"]){let p=r,y=e;p[h]>=y[h]&&(p=e,y=r),p[h]<a&&y[h]>a&&yb(p,y,h,a),p[h]<u&&y[h]>u&&yb(y,p,h,u)}}function E_(r,e,i,s,a,u){const h=[];for(let p=0;p<r.length;p++){const y=r[p];let v;const w=h.length;let S=0;for(let A=0;A<y.length-1;A++){let P=y[A],R=y[A+1],O=0;const V=S;let N,q;u&&(O=Math.hypot(R.x-P.x,R.y-P.y),S+=O,N=P,q=R),P.x<e&&R.x<e||(P.x<e?P=new Ye(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x<e&&(R=new Ye(e,P.y+(e-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y<i&&R.y<i||(P.y<i?P=new Ye(P.x+(i-P.y)/(R.y-P.y)*(R.x-P.x),i)._round():R.y<i&&(R=new Ye(P.x+(i-P.y)/(R.y-P.y)*(R.x-P.x),i)._round()),P.x>=s&&R.x>=s||(P.x>=s?P=new Ye(s,P.y+(s-P.x)/(R.x-P.x)*(R.y-P.y))._round():R.x>=s&&(R=new Ye(s,P.y+(s-P.x)/(R.x-P.x)*(R.y-P.y))._round()),P.y>=a&&R.y>=a||(P.y>=a?P=new Ye(P.x+(a-P.y)/(R.y-P.y)*(R.x-P.x),a)._round():R.y>=a&&(R=new Ye(P.x+(a-P.y)/(R.y-P.y)*(R.x-P.x),a)._round()),v&&P.equals(v[v.length-1])||(v=[P],h.push(v),u&&u.push({progress:{min:V+vb(N,q,P)*O,max:1},parentIndex:p,prevPoint:N,nextPoint:q})),v.push(R),u&&(u[u.length-1].progress.max=V+vb(N,q,R)*O,u[u.length-1].nextPoint=q)))))}if(u&&S>0)for(let A=w;A<h.length;A++)u[A].progress.min/=S,u[A].progress.max/=S}return h}function mA(r,e,i,s,a){if(r.length<2)return void s.push(r);const u=[];for(;e.valid();){const[v,w]=e.get();for(let S=0;S<r.length-1;S++){const A=r[S],P=r[S+1],R=vi(A,P,v,w);if(R){const[O]=R,V=new Ye(ii(A.x,P.x,O),ii(A.y,P.y,O));u.push({t:S+O,distance:0,point:V})}}e.next()}if(u.length===0)return void s.push(r);u.sort((v,w)=>v.t-w.t);let h=0,p=0,y=[];for(s.push(y);h!==r.length;){if(p===u.length){for(;h!==r.length;)y.length!==0&&y[y.length-1].equals(r[h])||y.push(r[h]),h++;break}u[p].t<=h?(y.length!==0&&y[y.length-1].equals(u[p].point)||y.push(u[p].point),Math.trunc(u[p].t),p++):(y.length!==0&&y[y.length-1].equals(r[h])||y.push(r[h]),h++)}}function vb(r,e,i){return r.x!==e.x?(i.x-r.x)/(e.x-r.x):r.y!==e.y?(i.y-r.y)/(e.y-r.y):0}function sp(r,e){return r.x*e.x+r.y*e.y}function bb(r,e){if(r.length===1){let i=0;const s=e[i++];let a;for(;!a||s.equals(a);)if(a=e[i++],!a)return 1/0;for(;i<e.length;i++){const u=e[i],h=r[0],p=a.sub(s),y=u.sub(s),v=h.sub(s),w=sp(p,p),S=sp(p,y),A=sp(y,y),P=sp(v,p),R=sp(v,y),O=w*A-S*S,V=(A*P-S*R)/O,N=(w*R-S*P)/O,q=s.z*(1-V-N)+a.z*V+u.z*N;if(isFinite(q))return q}return 1/0}{let i=1/0;for(const s of e)i=Math.min(i,s.z);return i}}function wb(r,e,i){let s=1/0;er(i,e)&&(s=bb(i,e[0]));for(let a=0;a<e.length;a++){const u=e[a],h=r[a];for(let p=0;p<u.length-1;p++){const y=u[p],v=[y,u[p+1],h[p+1],h[p],y];$i(i,v)&&(s=Math.min(s,bb(i,v)))}}return s!==1/0&&s}function Tb(r,e,i,s,a,u,h,p,y,v,w){return r.projection.name==="globe"?function(S,A,P,R,O,V,N,q,W,K,se){const te=[],le=[],fe=S.projection.upVectorScale(se,S.center.lat,S.worldSize).metersToTile,ge=[0,0,0,1],ze=[0,0,0,1],we=(He,qe,Je,et)=>{He[0]=qe,He[1]=Je,He[2]=et,He[3]=1},Ne=fb();P>0&&(P+=Ne),R+=Ne;for(const He of A){const qe=[],Je=[];for(const et of He){const Ze=et.x+O.x,Xe=et.y+O.y,Be=S.projection.projectTilePoint(Ze,Xe,se),ke=S.projection.upVector(se,et.x,et.y);let Ke=P,ht=R;if(N){const st=Sb(Ze,Xe,P,R,N,q,W,K);Ke+=st.base,ht+=st.top}P!==0?we(ge,Be.x+ke[0]*fe*Ke,Be.y+ke[1]*fe*Ke,Be.z+ke[2]*fe*Ke):we(ge,Be.x,Be.y,Be.z),we(ze,Be.x+ke[0]*fe*ht,Be.y+ke[1]*fe*ht,Be.z+ke[2]*fe*ht),Ae(ge,ge,V),Ae(ze,ze,V),qe.push(new vu(ge[0],ge[1],ge[2])),Je.push(new vu(ze[0],ze[1],ze[2]))}te.push(qe),le.push(Je)}return[te,le]}(r,e,i,s,a,u,h,p,y,v,w):h?function(S,A,P,R,O,V,N,q,W){const K=[],se=[],te=[0,0,0,1];for(const le of S){const fe=[],ge=[];for(const ze of le){const we=ze.x+R.x,Ne=ze.y+R.y,He=Sb(we,Ne,A,P,V,N,q,W);te[0]=we,te[1]=Ne,te[2]=He.base,te[3]=1,hi(te,te,O),te[3]=Math.max(te[3],1e-5);const qe=new vu(te[0]/te[3],te[1]/te[3],te[2]/te[3]);te[0]=we,te[1]=Ne,te[2]=He.top,te[3]=1,hi(te,te,O),te[3]=Math.max(te[3],1e-5);const Je=new vu(te[0]/te[3],te[1]/te[3],te[2]/te[3]);fe.push(qe),ge.push(Je)}K.push(fe),se.push(ge)}return[K,se]}(e,i,s,a,u,h,p,y,v):function(S,A,P,R,O){const V=[],N=[],q=O[8]*A,W=O[9]*A,K=O[10]*A,se=O[11]*A,te=O[8]*P,le=O[9]*P,fe=O[10]*P,ge=O[11]*P;for(const ze of S){const we=[],Ne=[];for(const He of ze){const qe=He.x+R.x,Je=He.y+R.y,et=O[0]*qe+O[4]*Je+O[12],Ze=O[1]*qe+O[5]*Je+O[13],Xe=O[2]*qe+O[6]*Je+O[14],Be=O[3]*qe+O[7]*Je+O[15],ke=et+q,Ke=Ze+W,ht=Xe+K,st=Math.max(Be+se,1e-5),Nt=et+te,vt=Ze+le,At=Xe+fe,Lt=Math.max(Be+ge,1e-5);we.push(new vu(ke/st,Ke/st,ht/st)),Ne.push(new vu(Nt/Lt,vt/Lt,At/Lt))}V.push(we),N.push(Ne)}return[V,N]}(e,i,s,a,u)}function Sb(r,e,i,s,a,u,h,p){const y=h*a.getElevationAt(r,e,!0,!0),v=u[0]!==0,w=v?u[1]===0?h*(u[0]/ib-rb):h*function(S,A,P){const R=Math.floor(A[0]/8),O=Math.floor(A[1]/8),V=10*(A[0]-8*R),N=10*(A[1]-8*O),q=S.getElevationAt(R,O,!0,!0),W=S.getMeterToDEM(P),K=Math.floor(.5*(V*W-1)),se=Math.floor(.5*(N*W-1)),te=S.tileCoordToPixel(R,O),le=2*K+1,fe=2*se+1,ge=function(Je,et,Ze,Xe,Be){return[Je.getElevationAtPixel(et,Ze,!0),Je.getElevationAtPixel(et+Be,Ze,!0),Je.getElevationAtPixel(et,Ze+Be,!0),Je.getElevationAtPixel(et+Xe,Ze+Be,!0)]}(S,te.x-K,te.y-se,le,fe),ze=Math.abs(ge[0]-ge[1]),we=Math.abs(ge[2]-ge[3]),Ne=Math.abs(ge[0]-ge[2])+Math.abs(ge[1]-ge[3]),He=Math.min(.25,.5*W*(ze+we)/le),qe=Math.min(.25,.5*W*Ne/fe);return q+Math.max(He*V,qe*N)}(a,u,p):y;return{base:y+(i===0?-1:i),top:v?Math.max(w+s,y+i+2):y+s}}class _A{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class gA{constructor(){this.tasks={},this.taskQueue=[],Te(["process"],this),this.invoker=new _A(this.process),this.nextId=0}add(e,i){const s=this.nextId++,a=function({type:u,isSymbolTile:h,zoom:p}){return p=p||0,u==="message"?0:u!=="maybePrepare"||h?u!=="parseTile"||h?u==="parseTile"&&h?300-p:u==="maybePrepare"&&h?400-p:500:200-p:100-p}(i);if(a===0){try{e()}finally{}return null}return this.tasks[s]={fn:e,metadata:i,priority:a,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let a=0;a<this.taskQueue.length;a++){const u=this.tasks[this.taskQueue[a]];u.priority<i&&(i=u.priority,e=a)}if(e===null)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Eb{constructor(e,i,s){this.target=e,this.parent=i,this.mapId=s,this.callbacks={},this.cancelCallbacks={},Te(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new gA}send(e,i,s,a,u=!1,h){const p=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(s.metadata=h,this.callbacks[p]=s);const y=new Set;return this.target.postMessage({id:p,type:e,hasCallback:!!s,targetMapId:a,mustQueue:u,sourceMapId:this.mapId,data:oa(i,y)},y),{cancel:()=>{s&&delete this.callbacks[p],this.target.postMessage({id:p,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const s=i.id;if(s&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const a=this.cancelCallbacks[s];delete this.cancelCallbacks[s],a&&a.cancel()}else if(i.mustQueue||Vi(self)){const a=this.callbacks[s],u=this.scheduler.add(()=>this.processTask(s,i),a&&a.metadata||{type:"message"});u&&(this.cancelCallbacks[s]=u)}else this.processTask(s,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const s=this.callbacks[e];delete this.callbacks[e],s&&(i.error?s(Ga(i.error)):s(null,Ga(i.data)))}else{const s=new Set,a=i.hasCallback?(h,p)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:h?oa(h):null,data:oa(p,s)},s)}:()=>{},u=Ga(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,u,a);else if(this.parent.getWorkerSource){const h=i.type.split("."),{source:p,scope:y}=u;this.parent.getWorkerSource(i.sourceMapId,h[0],p,y)[h[1]](u,a)}else a(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var op={workerUrl:"",workerClass:null,workerParams:void 0};const Qy="mapboxgl_preloaded_worker_pool";class bu{constructor(e){this.active={},this.name=e}acquire(e,i=bu.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const a=(s=`${this.name||""}WorkerPool: ${e}-${this.workers.length}`,op.workerClass!=null?new op.workerClass:new self.Worker(op.workerUrl,Object.assign({name:s},op.workerParams)));this.workers.push(a)}var s;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Qy]}numActive(){return Object.keys(this.active).length}}bu.workerCount=2;class nd{constructor(e,i,s="Worker",a=bu.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ve();const u=this.workerPool.acquire(this.id,a);for(let h=0;h<u.length;h++){const p=new nd.Actor(u[h],i,this.id);p.name=`${s} ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,s){me(this.actors,(a,u)=>{a.send(e,i,u)},s=s||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ap,ex;function A_(){return ap||(ap=new bu),ap}nd.Actor=Eb;const tx=4096;class yA{constructor(e){this.module=e,this.memoryStack=this.module.malloc(tx),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>tx?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>tx?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,s){this.module.setFauxFacadeOptions(e?1:0,i?1:0,s)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const p of e){const y=this.createIntArray(p.ringIndices),v=this.createFloatArray(p.coordinates);if(y===-1||v===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(p.id,p.sourceId,p.minHeight,p.height,p.roofType,v,y,p.ringIndices.length-1)}for(const p of i){let y;y=p.entrances?JSON.parse(p.entrances):[];const v=this.createFloatArray(y),w=this.createFloatArray(p.coordinates);if(v===-1||w===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(p.sourceId,p.crossPerc,p.distanceToRoad,v,y.length,w,p.coordinates.length)}if(!this.module.generateMesh()){const p=this.module.getLastError();return this.readStringBuffer(p)}const s=this.module.getMeshCount(),a=new Array(s);for(let p=0;p<s;p++){const y=this.module.getPositionsPtr(p),v=this.module.getPositionsLength(p),w=new Float32Array(this.module.heapF32.buffer,y,v),S=this.module.getNormalsPtr(p),A=this.module.getNormalsLength(p),P=new Float32Array(this.module.heapF32.buffer,S,A),R=this.module.getAOPtr(p),O=this.module.getAOLength(p),V=new Float32Array(this.module.heapF32.buffer,R,O),N=this.module.getUVPtr(p),q=this.module.getUVLength(p),W=new Float32Array(this.module.heapF32.buffer,N,q),K=this.module.getFauxFacadePtr(p),se=this.module.getFauxFacadeLength(p),te=new Uint8Array(this.module.heapU8.buffer,K,se),le=this.module.getIndicesPtr(p),fe=this.module.getIndicesLength(p),ge=new Int16Array(this.module.heap16.buffer,le,fe),ze=this.module.getBuildingPart(p);a[p]={positions:w,normals:P,ao:V,uv:W,isFauxFacade:te,indices:ge,buildingPart:ze}}const u=this.module.getRingCount(),h=[];for(let p=0;p<u;p++){const y=this.module.getRingPtr(p),v=this.module.getRingLength(p),w=new Float32Array(this.module.heapF32.buffer,y,v);h.push(w)}return{meshes:a,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:h}}}let lp,ix,ya,sd,rx,od=null,ad=null,Ab=null,I_=null;function Ib(){return Vi(self)&&self.worker.dracoUrl?self.worker.dracoUrl:ix||Mi.DRACO_URL}function Cb(){if(Vi(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(sd)return sd;const r=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return sd=WebAssembly.validate(r)?Mi.MESHOPT_SIMD_URL:Mi.MESHOPT_URL,sd}function xA(){return I_}const C_={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},vA={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},cp={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function Pb(r,e,i){const s=i.json.bufferViews.length,a=i.buffers.length;e.bufferView=s,i.json.bufferViews[s]={buffer:a,byteLength:r.byteLength},i.buffers[a]=r}const nx="KHR_draco_mesh_compression";function bA(r,e){const i=r.extensions&&r.extensions[nx];if(!i)return;const s=new ya.Decoder,a=Lb(e,i.bufferView),u=new ya.Mesh;if(!s.DecodeArrayToMesh(a,a.byteLength,u))throw new Error("Failed to decode Draco mesh");const h=e.json.accessors[r.indices],p=C_[h.componentType],y=h.count*p.BYTES_PER_ELEMENT,v=ya._malloc(y);p===Uint16Array?s.GetTrianglesUInt16Array(u,y,v):s.GetTrianglesUInt32Array(u,y,v),Pb(ya.memory.buffer.slice(v,v+y),h,e),ya._free(v);for(const w of Object.keys(i.attributes)){const S=s.GetAttributeByUniqueId(u,i.attributes[w]),A=e.json.accessors[r.attributes[w]],P=vA[A.componentType],R=A.count*cp[A.type]*C_[A.componentType].BYTES_PER_ELEMENT,O=ya._malloc(R);s.GetAttributeDataArrayForAllPoints(u,S,ya[P],R,O),Pb(ya.memory.buffer.slice(O,O+R),A,e),ya._free(O)}s.destroy(),u.destroy(),delete r.extensions[nx]}const P_="EXT_meshopt_compression";function wA(r,e){if(!r.extensions||!r.extensions[P_])return;const i=r.extensions[P_],s=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),a=new Uint8Array(i.count*i.byteStride);rx.decodeGltfBuffer(a,i.count,i.byteStride,s,i.mode,i.filter),r.buffer=e.buffers.length,r.byteOffset=0,e.buffers[r.buffer]=a.buffer,delete r.extensions[P_]}const Mb=1179937895,Rb=new TextDecoder("utf8");function Db(r,e){return new URL(r,e).href}function TA(r,e,i,s){return fetch(Db(r.uri,s)).then(a=>a.arrayBuffer()).then(a=>{e.buffers[i]=a})}function Lb(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function SA(r,e,i,s){if(r.uri){const a=Db(r.uri,s);return fetch(a).then(u=>u.blob()).then(u=>createImageBitmap(u)).then(u=>{e.images[i]=u})}if(r.bufferView!==void 0){const a=Lb(e,r.bufferView),u=new Blob([a],{type:r.mimeType});return createImageBitmap(u).then(h=>{e.images[i]=h})}}function zb(r,e=0,i){const s={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===Mb){const w=new Uint32Array(r,e);let S=2;const A=(w[S++]>>2)-3,P=w[S++]>>2;if(S++,s.json=JSON.parse(Rb.decode(w.subarray(S,S+P))),S+=P,S<A){const R=w[S++];S++;const O=e+(S<<2);s.buffers[0]=r.slice(O,O+R)}}else s.json=JSON.parse(Rb.decode(new Uint8Array(r,e)));const{buffers:a,images:u,meshes:h,extensionsUsed:p,bufferViews:y}=s.json;let v=Promise.resolve();if(a){const w=[];for(let S=0;S<a.length;S++){const A=a[S];A.uri?w.push(TA(A,s,S,i)):s.buffers[S]||(s.buffers[S]=null)}v=Promise.all(w)}return v.then(()=>{const w=[],S=p&&p.includes(nx),A=p&&p.includes(P_);if(S&&w.push(function(){if(!ya)return lp??(lp=function(P){let R,O=null;function V(){R=new Uint8Array(O.buffer)}function N(){throw new Error("Unexpected Draco error.")}const q={a:{a:N,d:function(W,K,se){return R.copyWithin(W,K,K+se)},c:function(W){const K=R.length,se=Math.max(W>>>0,Math.ceil(1.2*K)),te=Math.ceil((se-K)/65536);try{return O.grow(te),V(),!0}catch{return!1}},b:N}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(P,q):P.then(W=>W.arrayBuffer()).then(W=>WebAssembly.instantiate(W,q))).then(W=>{const{Rb:K,Qb:se,P:te,T:le,X:fe,Ja:ge,La:ze,Qa:we,Va:Ne,Wa:He,eb:qe,jb:Je,f:et,e:Ze,yb:Xe,zb:Be,Ab:ke,Bb:Ke,Db:ht,Gb:st}=W.instance.exports;O=Ze;const Nt=(()=>{let vt=0,At=0,Lt=0,Si=0;return at=>{Lt&&(K(Si),K(vt),At+=Lt,Lt=vt=0),vt||(At+=128,vt=se(At));const Ot=at.length+7&-8;let li=vt;Ot>=At&&(Lt=Ot,li=Si=se(Ot));for(let Di=0;Di<at.length;Di++)R[li+Di]=at[Di];return li}})();return V(),et(),{memory:Ze,_free:K,_malloc:se,Mesh:class{constructor(){this.ptr=te()}destroy(){le(this.ptr)}},Decoder:class{constructor(){this.ptr=ge()}destroy(){Je(this.ptr)}DecodeArrayToMesh(vt,At,Lt){const Si=Nt(vt),at=ze(this.ptr,Si,At,Lt.ptr);return!!fe(at)}GetAttributeByUniqueId(vt,At){return{ptr:we(this.ptr,vt.ptr,At)}}GetTrianglesUInt16Array(vt,At,Lt){Ne(this.ptr,vt.ptr,At,Lt)}GetTrianglesUInt32Array(vt,At,Lt){He(this.ptr,vt.ptr,At,Lt)}GetAttributeDataArrayForAllPoints(vt,At,Lt,Si,at){qe(this.ptr,vt.ptr,At.ptr,Lt,Si,at)}},DT_INT8:Xe(),DT_UINT8:Be(),DT_INT16:ke(),DT_UINT16:Ke(),DT_UINT32:ht(),DT_FLOAT32:st()}})}(fetch(Ib())),lp.then(P=>{ya=P,lp=void 0}))}()),A&&w.push(function(){if(rx)return;const P=function(R){let O;const V=WebAssembly.instantiateStreaming(R,{}).then(W=>{O=W.instance,O.exports.__wasm_call_ctors()}),N={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},q={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:V,supported:!0,decodeGltfBuffer(W,K,se,te,le,fe){(function(ge,ze,we,Ne,He,qe,Je){const et=ge.exports.sbrk,Ze=Ne+3&-4,Xe=et(Ze*He),Be=et(qe.length),ke=new Uint8Array(ge.exports.memory.buffer);ke.set(qe,Be);const Ke=ze(Xe,Ne,He,Be,qe.length);if(Ke===0&&Je&&Je(Xe,Ze,He),we.set(ke.subarray(Xe,Xe+Ne*He)),et(Xe-et(0)),Ke!==0)throw new Error(`Malformed buffer data: ${Ke}`)})(O,O.exports[q[le]],W,K,se,te,O.exports[N[fe]])}}}(fetch(Cb()));return P.ready.then(()=>{rx=P})}()),u)for(let P=0;P<u.length;P++)w.push(SA(u[P],s,P,i));return(w.length?Promise.all(w):Promise.resolve()).then(()=>{if(S&&h)for(const{primitives:P}of h)for(const R of P)bA(R,s);if(A&&h&&y)for(const P of y)wA(P,s);return s})})}function Ob(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>zb(e,0,r))}function sx(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function ox(r){switch(r){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ax{constructor(e,i,s,a){this.context=e,this.format=s,this.useMipmap=a&&a.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:a&&a.premultiply})}update(e,i){const s=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,a=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:u}=this,{gl:h}=u,{x:p,y}=i&&i.position?i.position:{x:0,y:0},v=p+s,w=y+a;!this.size||this.size[0]===v&&this.size[1]===w||(h.bindTexture(h.TEXTURE_2D,null),h.deleteTexture(this.texture),this.texture=h.createTexture(),this.size=null),h.bindTexture(h.TEXTURE_2D,this.texture),u.pixelStoreUnpackFlipY.set(!1),u.pixelStoreUnpack.set(1),u.pixelStoreUnpackPremultiplyAlpha.set(this.format===h.RGBA8&&(!i||i.premultiply!==!1));const S=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&v>0&&w>0){const A=this.useMipmap?Math.floor(Math.log2(Math.max(v,w)))+1:1;h.texStorage2D(h.TEXTURE_2D,A,this.format,v,w),this.size=[v,w]}this.size&&(S?h.texSubImage2D(h.TEXTURE_2D,0,p,y,sx(this.format),ox(this.format),e):"data"in e&&e.data&&h.texSubImage2D(h.TEXTURE_2D,0,p,y,s,a,sx(this.format),ox(this.format),e.data)),this.useMipmap&&h.generateMipmap(h.TEXTURE_2D)}bind(e,i,s=!1){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap&&!s?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,s,a,u){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),i!==this.magFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),s!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,s),this.wrapS=s),a!==this.wrapT&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrapT=a),u!==this.compareMode&&(u?(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_MODE,p.COMPARE_REF_TO_TEXTURE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_FUNC,u)):p.texParameteri(p.TEXTURE_2D,p.TEXTURE_COMPARE_MODE,p.NONE),this.compareMode=u)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class up{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:s}=this,{gl:a}=s;a.bindTexture(a.TEXTURE_2D,this.texture),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,i),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,i),this.wrapS=i)}}const EA=Ii([{name:"a_pos_3f",components:3,type:"Float32"}]),AA=Ii([{name:"a_color_3f",components:3,type:"Float32"}]),IA=Ii([{name:"a_color_4f",components:4,type:"Float32"}]),CA=Ii([{name:"a_uv_2f",components:2,type:"Float32"}]),PA=Ii([{name:"a_normal_3f",components:3,type:"Float32"}]),MA=Ii([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),RA=Ii([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function kb(r,e){const i=M_(r.projection,r.zoom,r.width,r.height),s=function(u,h,p,y,v){const w=new n(p.lng-180*gc,p.lat),S=new n(p.lng+180*gc,p.lat),A=u.project(w.lng,w.lat),P=u.project(S.lng,S.lat),R=-Math.atan2(P.y-A.y,P.x-A.x),O=Z.fromLngLat(p);O.y=U(O.y,-1+gc,1-gc);const V=O.toLngLat(),N=u.project(V.lng,V.lat),q=Z.fromLngLat(V);q.x+=gc;const W=q.toLngLat(),K=u.project(W.lng,W.lat),se=Bb(K.x-N.x,K.y-N.y,R),te=Z.fromLngLat(V);te.y+=gc;const le=te.toLngLat(),fe=u.project(le.lng,le.lat),ge=Bb(fe.x-N.x,fe.y-N.y,R),ze=Math.abs(se.x)/Math.abs(ge.y),we=mt([]);mr(we,we,-R*(1-(v?0:y)));const Ne=mt([]);return Zt(Ne,Ne,[1,1-(1-ze)*y,1]),Ne[4]=-ge.x/ge.y*y,mr(Ne,Ne,R),wt(Ne,we,Ne),Ne}(r.projection,0,r.center,i,e),a=Fb(r);return Zt(s,s,[a,a,1]),s}function Fb(r){const e=r.projection,i=M_(r.projection,r.zoom,r.width,r.height),s=lx(e,r.center),a=lx(e,n.convert(e.center));return Math.pow(2,s*i+(1-i)*a)}function M_(r,e,i,s,a=1/0){const u=r.range;if(!u)return 0;const h=Math.min(a,Math.max(i,s)),p=Math.log2(h/1024);return $(u[0]+p,u[1]+p,e)}const gc=1/4e4;function lx(r,e){const i=U(e.lat,-z,z),s=new n(e.lng-180*gc,i),a=new n(e.lng+180*gc,i),u=r.project(s.lng,i),h=r.project(a.lng,i),p=Z.fromLngLat(s),y=Z.fromLngLat(a),v=h.x-u.x,w=h.y-u.y,S=y.x-p.x,A=y.y-p.y,P=Math.sqrt((S*S+A*A)/(v*v+w*w));return Math.log2(P)}function Bb(r,e,i){const s=Math.cos(i),a=Math.sin(i);return{x:r*s-e*a,y:r*a+e*s}}function Nb(r,e,i){mt(r),mr(r,r,Wi(e[2])),Li(r,r,Wi(e[0])),Sr(r,r,Wi(e[1])),Zt(r,r,i),wt(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function R_(r,e,i,s,a,u,h,p){const y=[i[0]-e[0],i[1]-e[1],0],v=[s[0]-e[0],s[1]-e[1],0];if(ln(y)<1e-12||ln(v)<1e-12)return vr(r);const w=sr([],y,v);zt(w,w),Gn(v,s,e),y[2]=(u-a)*p,v[2]=(h-a)*p;const S=y;return sr(S,y,v),zt(S,S),Ys(r,w,S)}function D_(r,e,i=!1){const s=mc(e.zoom),a=function(u,h,p){const y=h.worldSize,v=[u[12],u[13],u[14]],w=L(v[1]/y),S=I(v[0]/y),A=mt([]),P=E(1,w)*y,R=E(1,0)*y*F(w,h.zoom),O=1/Fy(y);let V=R*O;if(p){const K=M_(h.projection,h.zoom,h.width,h.height,1024);V=O*h.projection.pixelSpaceConversion(h.center.lat,y,K)}const N=dc(w,S);Oi(N,N,Cr([],zt([],N),P*V*v[2]));const q=function(K){const se=[K[0],K[1],K[2]];let te=[0,1,0];const le=sr([],te,se);return sr(te,se,le),Rt(te)===0&&(te=[0,1,0],sr(le,se,te)),zt(le,le),zt(te,te),zt(se,se),[le[0],le[1],le[2],0,te[0],te[1],te[2],0,se[0],se[1],se[2],0,K[0],K[1],K[2],1]}(N);Zt(A,A,[V,V,V*P]),Xt(A,A,[-v[0],-v[1],-v[2]]);const W=wt([],h.globeMatrix,q);return wt(W,W,A),wt(W,W,u),W}(r,e,i);if(s>0){const u=function(h,p){const y=p.worldSize,v=E(1,0)*y*F(p.center.lat,p.zoom)/Fy(y),w=E(1,p.center.lat)*y,S=mt([]);Sr(S,S,Wi(p.center.lng)),Li(S,S,Wi(p.center.lat)),Xt(S,S,[0,0,ns]),Zt(S,S,[v,v,v*w]);const A=p.point;return Xt(S,S,[-A.x,-A.y,0]),wt(S,S,h),wt(S,p.globeMatrix,S)}(r,e);return function(h,p,y){const v=(R,O,V)=>{const N=ln(R),q=ln(O),W=ga(R,O,V);return Cr(W,W,1/ln(W)*ii(N,q,V))},w=v([h[0],h[1],h[2]],[p[0],p[1],p[2]],y),S=v([h[4],h[5],h[6]],[p[4],p[5],p[6]],y),A=v([h[8],h[9],h[10]],[p[8],p[9],p[10]],y),P=ga([h[12],h[13],h[14]],[p[12],p[13],p[14]],y);return[w[0],w[1],w[2],0,S[0],S[1],S[2],0,A[0],A[1],A[2],0,P[0],P[1],P[2],1]}(a,u,s)}return a}function cx(r,e,i,s){const a=Ft.projectAabbCorners(s,i);let u=Number.MAX_VALUE;for(let p=0;p<a.length;++p){const y=a[p];y[0]=(.5*y[0]+.5)*e.width,y[1]=(.5-.5*y[1])*e.height,y[2]<u&&(u=y[2])}const h=function(p){const y=[];let v=0;for(let P=1;P<p.length;P++)(p[P][0]<p[v][0]||p[P][0]===p[v][0]&&p[P][1]<p[v][1])&&(v=P);let w,S=v;const A=new Uint8Array(p.length);do{if(A[S])break;y.push(new Ye(p[S][0],p[S][1])),A[S]=1,w=(S+1)%p.length;for(let P=0;P<p.length;P++){if(p[P][0]===p[w][0]&&p[P][1]===p[w][1]||p[P][0]===p[S][0]&&p[P][1]===p[S][1])continue;const R=[p[P][0]-p[S][0],p[P][1]-p[S][1]],O=[p[w][0]-p[S][0],p[w][1]-p[S][1]],V=R[0]*O[1]-R[1]*O[0];(V>0||V===0&&R[0]*O[0]+R[1]*O[1]>=0&&R[0]*R[0]+R[1]*R[1]>O[0]*O[0]+O[1]*O[1])&&(w=P)}S=w}while(S!==v);return y.length>0&&y.push(y[0]),y}(a);if($i(r,h))return u}const wu=64,ld={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function L_(r,e,i,s,a,u,h,p,y,v=!1){const w=i.zoom,S=i.project(s),A=F(s.lat,w),P=1/A;mt(r),Xt(r,r,[S.x+h[0]*P,S.y+h[1]*P,h[2]]);let R=1,O=1;const V=i.worldSize;if(v){if(i.projection.name==="mercator"){let K=0;i.elevation&&(K=i.elevation.getAtPointOrZero(new Z(S.x/V,S.y/V),0));const se=hi([],[S.x,S.y,K,1],i.projMatrix)[3]/i.cameraToCenterDistance;R=se,O=se*F(i.center.lat,w)}else if(i.projection.name==="globe"){const K=D_(r,i),se=[0,0,0,1];hi(se,se,wt([],i.projMatrix,K));const te=se[3]/i.cameraToCenterDistance,le=mc(w),fe=i.projection.pixelsPerMeter(s.lat,V)*F(s.lat,w),ge=i.projection.pixelsPerMeter(i.center.lat,V)*F(i.center.lat,w);R=te/ii(fe,B(i.center.lat),le),O=te*A/fe,R*=ge,O*=ge}}else R=P;Zt(r,r,[R,R,O]);const N=[...r],q=e.orientation,W=[];if(Nb(W,[q[0]+(a?a[0]:0),q[1]+(a?a[1]:0),q[2]+(a?a[2]:0)],u),wt(r,N,W),p&&i.elevation){let K=0;const se=[];if(y&&i.elevation){K=function(le,fe,ge,ze,we){const Ne=fe.elevation;if(!Ne)return 0;const He=Ft.projectAabbCorners(ge,ze),qe=E(1,we.lat)*fe.worldSize,Je=function(At,Lt){const Si=[0,0,1],at=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Ot of at){const li=At[Ot.corners[0]],Di=At[Ot.corners[1]],ki=At[Ot.corners[2]],mi=[Di[0]-li[0],Di[1]-li[1],Lt*(Di[2]-li[2])],dr=sr(mi,mi,[ki[0]-li[0],ki[1]-li[1],Lt*(ki[2]-li[2])]);zt(dr,dr),Ot.dotProductWithUp=Yt(dr,Si)}return at.sort((Ot,li)=>Ot.dotProductWithUp-li.dotProductWithUp),at[0].corners}(He,qe),et=He[Je[0]],Ze=He[Je[1]],Xe=He[Je[2]],Be=He[Je[3]],ke=Ne.getAtPointOrZero(new Z(et[0]/fe.worldSize,et[1]/fe.worldSize),0),Ke=Ne.getAtPointOrZero(new Z(Ze[0]/fe.worldSize,Ze[1]/fe.worldSize),0),ht=Ne.getAtPointOrZero(new Z(Xe[0]/fe.worldSize,Xe[1]/fe.worldSize),0),st=Ne.getAtPointOrZero(new Z(Be[0]/fe.worldSize,Be[1]/fe.worldSize),0),Nt=(ke+st)/2,vt=(Ke+ht)/2;return Nt>vt?Ke<ht?R_(le,Ze,Be,et,Ke,st,ke,qe):R_(le,Xe,et,Be,ht,ke,st,qe):ke<st?R_(le,et,Ze,Xe,ke,Ke,ht,qe):R_(le,Be,Xe,Ze,st,ht,Ke,qe),Math.max(Nt,vt)}(se,i,e.aabb,r,s);const te=wt([],Rs([],se),W);wt(r,N,te)}else K=i.elevation.getAtPointOrZero(new Z(S.x/V,S.y/V),0);K!==0&&(r[14]+=K)}}class Vb{constructor(e,i,s,a,u){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=s!=null?new n(s[0],s[1]):new n(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new Ft([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){wt(e.globalMatrix,i,e.localMatrix);const s=this.nodeOverrides.get(e.name);if(s!==void 0){const h=[];u=s.orientation,mt(a=h),Sr(a,a,Wi(u[1])),mr(a,a,Wi(u[2])),Li(a,a,Wi(u[0])),wt(e.globalMatrix,e.globalMatrix,h)}var a,u;if(e.meshes)for(const h of e.meshes){const p=Ft.applyTransformFast(h.aabb,e.globalMatrix);this.aabb.encapsulate(p)}if(e.children)for(const h of e.children)this._applyTransformations(h,e.globalMatrix)}computeBoundsAndApplyParent(){const e=mt([]);this.aabb=new Ft([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,s,a,u,h,p=!1){L_(this.matrix,this,e.transform,this.position,i,s,a,u,h,p)}upload(e){if(!this.uploaded){for(const i of this.nodes)ux(i,e);for(const i of this.nodes)z_(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)hx(e)}}function hp(r,e,i=!1){r.uploaded||(r.gfxTexture=new ax(e,r.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function DA(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,EA.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,PA.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,CA.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?AA:IA).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,RA.members,!0)),r.segments=Nr.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const s=r.material;s.pbrMetallicRoughness.baseColorTexture&&hp(s.pbrMetallicRoughness.baseColorTexture,e),s.pbrMetallicRoughness.metallicRoughnessTexture&&hp(s.pbrMetallicRoughness.metallicRoughnessTexture,e),s.normalTexture&&hp(s.normalTexture,e),s.occlusionTexture&&hp(s.occlusionTexture,e,i),s.emissionTexture&&hp(s.emissionTexture,e)}function ux(r,e,i){if(r.meshes)for(const s of r.meshes)DA(s,e,i);if(r.children)for(const s of r.children)ux(s,e,i)}function z_(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)z_(e)}function hx(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)hx(i)}function Tu(r,e){const i=r.json.bufferViews[e.bufferView],s=C_[e.componentType];return new s(r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==cp[e.type]*s.BYTES_PER_ELEMENT?i.byteStride/s.BYTES_PER_ELEMENT:cp[e.type]))}function dx(r,e,i,s){const a=C_[e.componentType],u=function(w){switch(w){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(a),h=r.json.bufferViews[e.bufferView],p=h.byteStride?h.byteStride/a.BYTES_PER_ELEMENT:cp[e.type],y=i.float32,v=y.length/i.capacity;for(let w=0,S=0;w<e.count*p;w+=p,S+=v)for(let A=0;A<v;A++)y[S+A]=s[w+A]*u;i._trim()}function LA(r,e,i){const s=r.indices,a=r.attributes,u={};u.indexArray=new wn;const h=e.json.accessors[s],p=h.count/3;u.indexArray.reserve(p);const y=Tu(e,h);for(let A=0;A<p;A++)u.indexArray.emplaceBack(y[3*A],y[3*A+1],y[3*A+2]);u.indexArray._trim(),u.vertexArray=new Gs;const v=e.json.accessors[a.POSITION];u.vertexArray.reserve(v.count);const w=Tu(e,v);for(let A=0;A<v.count;A++)u.vertexArray.emplaceBack(w[3*A],w[3*A+1],w[3*A+2]);if(u.vertexArray._trim(),u.aabb=new Ft(v.min,v.max),u.centroid=function(A,P){const R=[0,0,0],O=A.length;if(O>0){for(let V=0;V<O;V++){const N=3*A[V];R[0]+=P[N],R[1]+=P[N+1],R[2]+=P[N+2]}R[0]/=O,R[1]/=O,R[2]/=O}return R}(y,w),a.COLOR_0!==void 0){const A=e.json.accessors[a.COLOR_0],P=cp[A.type],R=Tu(e,A);u.colorArray=P===3?new Gs:new qa,u.colorArray.resize(A.count),dx(e,A,u.colorArray,R)}if(a.NORMAL!==void 0){u.normalArray=new Gs;const A=e.json.accessors[a.NORMAL];u.normalArray.resize(A.count);const P=Tu(e,A);dx(e,A,u.normalArray,P)}if(a.TEXCOORD_0!==void 0&&i.length>0){u.texcoordArray=new Ho;const A=e.json.accessors[a.TEXCOORD_0];u.texcoordArray.resize(A.count);const P=Tu(e,A);dx(e,A,u.texcoordArray,P)}if(a._FEATURE_ID_RGBA4444!==void 0){const A=e.json.accessors[a._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(u.featureData=Tu(e,A))}a._FEATURE_RGBA4444!==void 0&&(u.featureData=new Uint32Array(Tu(e,e.json.accessors[a._FEATURE_RGBA4444]).buffer));const S=r.material;return u.material=function(A,P){const{emissiveFactor:R=[0,0,0],alphaMode:O="OPAQUE",alphaCutoff:V=.5,normalTexture:N,occlusionTexture:q,emissiveTexture:W,doubleSided:K,name:se}=A,{baseColorFactor:te=[1,1,1,1],metallicFactor:le=1,roughnessFactor:fe=1,baseColorTexture:ge,metallicRoughnessTexture:ze}=A.pbrMetallicRoughness||{},we=q?P[q.index]:void 0;if(q&&q.extensions&&q.extensions.KHR_texture_transform&&we){const Ne=q.extensions.KHR_texture_transform;we.offsetScale=[Ne.offset[0],Ne.offset[1],Ne.scale[0],Ne.scale[1]]}return{name:se,pbrMetallicRoughness:{baseColorFactor:new or(...te),metallicFactor:le,roughnessFactor:fe,baseColorTexture:ge?P[ge.index]:void 0,metallicRoughnessTexture:ze?P[ze.index]:void 0},doubleSided:K,emissiveFactor:new or(...R),alphaMode:O,alphaCutoff:V,normalTexture:N?P[N.index]:void 0,occlusionTexture:we,emissionTexture:W?P[W.index]:void 0,defined:A.defined===void 0}}(S!==void 0?e.json.materials[S]:{defined:!1},i),u}function Ub(r,e,i){const{matrix:s,rotation:a,translation:u,scale:h,mesh:p,extras:y,children:v,name:w}=r,S={};if(S.name=w,S.localMatrix=s||function(A,P,R,O){var V=P[0],N=P[1],q=P[2],W=P[3],K=V+V,se=N+N,te=q+q,le=V*K,fe=V*se,ge=V*te,ze=N*se,we=N*te,Ne=q*te,He=W*K,qe=W*se,Je=W*te,et=O[0],Ze=O[1],Xe=O[2];return A[0]=(1-(ze+Ne))*et,A[1]=(fe+Je)*et,A[2]=(ge-qe)*et,A[3]=0,A[4]=(fe-Je)*Ze,A[5]=(1-(le+Ne))*Ze,A[6]=(we+He)*Ze,A[7]=0,A[8]=(ge+qe)*Xe,A[9]=(we-He)*Xe,A[10]=(1-(le+ze))*Xe,A[11]=0,A[12]=R[0],A[13]=R[1],A[14]=R[2],A[15]=1,A}([],a||[0,0,0,1],u||[0,0,0],h||[1,1,1]),S.globalMatrix=rt(S.localMatrix),p!==void 0){S.meshes=i[p];const A=S.anchor=[0,0];for(const P of S.meshes){const{min:R,max:O}=P.aabb;A[0]+=R[0]+O[0],A[1]+=R[1]+O[1]}A[0]=Math.floor(A[0]/S.meshes.length/2),A[1]=Math.floor(A[1]/S.meshes.length/2)}if(y&&(y.id&&(S.id=y.id),y.lights&&(S.lights=function(A){if(!A.length)return[];const P=function(q){const W=atob(q),K=new Uint8Array(W.length);for(let se=0;se<W.length;se++)K[se]=W.codePointAt(se);return K}(A),R=[],O=P.length/24,V=new Uint16Array(P.buffer),N=new Float32Array(P.buffer);for(let q=0;q<O;q++){const W=V[2*q*6]/30,K=V[2*q*6+1]/30,se=V[2*q*6+10]/100,te=N[6*q+1],le=N[6*q+2],fe=N[6*q+3],ge=N[6*q+4],ze=fe-te,we=ge-le,Ne=Math.hypot(ze,we);R.push({pos:[te+.5*ze,le+.5*we,K],normal:[we/Ne,-ze/Ne,0],width:Ne,height:W,depth:se,points:[te,le,fe,ge]})}return R}(y.lights)),y.MAPBOX_geometry_bloom&&(S.isGeometryBloom=y.MAPBOX_geometry_bloom)),v){const A=[];for(const P of v)A.push(Ub(e.json.nodes[P],e,i));S.children=A}return S}function zA(r){if(r.vertices.length===0||r.indices.length===0)return null;const e=new v_(r.vertices,r.indices,8,256),[i,s]=[e.min.clone(),e.max.clone()];return{vertices:r.vertices,indices:r.indices,grid:e,min:i,max:s}}function OA(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const s=[];for(const h of i){if(!Array.isArray(h)||h.length!==2)continue;const p=h[0],y=h[1];typeof p=="number"&&typeof y=="number"&&s.push(new Ye(p,y))}if(s.length<3)return null;s.length>1&&s[s.length-1].equals(s[0])&&s.pop();let a=0;for(let h=0;h<s.length;h++){const p=s[h],y=s[(h+1)%s.length],v=s[(h+2)%s.length];a+=(p.x-y.x)*(v.y-y.y)-(v.x-y.x)*(p.y-y.y)}a>0&&s.reverse();const u=id(s.flatMap(h=>[h.x,h.y]),[]);return u.length===0?null:{vertices:s,indices:u}}function kA(r,e){const i=[],s=[];let a=0;const u=[];for(const h of r){a=i.length;const p=h.vertexArray.float32,y=h.indexArray.uint16;for(let v=0;v<h.vertexArray.length;v++)u[0]=p[3*v+0],u[1]=p[3*v+1],u[2]=p[3*v+2],Ae(u,u,e),i.push(new Ye(u[0],u[1]));for(let v=0;v<3*h.indexArray.length;v++)s.push(y[v]+a)}if(s.length%3!=0)return null;for(let h=0;h<s.length;h+=3){const p=i[s[h+0]],y=i[s[h+1]],v=i[s[h+2]];(p.x-y.x)*(v.y-y.y)-(v.x-y.x)*(p.y-y.y)>0&&([s[h+1],s[h+2]]=[s[h+2],s[h+1]])}return{vertices:i,indices:s}}function fx(r){const e=function(y,v){const w=[],S=WebGL2RenderingContext;if(y.json.textures)for(const A of y.json.textures){const P={magFilter:S.LINEAR,minFilter:S.NEAREST,wrapS:S.REPEAT,wrapT:S.REPEAT};A.sampler!==void 0&&Object.assign(P,y.json.samplers[A.sampler]),w.push({image:v[A.source],sampler:P,uploaded:!1})}return w}(r,r.images),i=function(y,v){const w=[];for(const S of y.json.meshes){const A=[];for(const P of S.primitives)A.push(LA(P,y,v));w.push(A)}return w}(r,e),{scenes:s,scene:a,nodes:u}=r.json,h=s?s[a||0].nodes:[...u.keys()],p=[];for(const y of h)p.push(Ub(u[y],r,i));return function(y,v,w){const S={},A=new Set;for(let P=0;P<y.length;P++){const R=w[v[P]];if(!R.extras)continue;const O=R.extras["mapbox:footprint:version"],V=R.extras["mapbox:footprint:id"];(O||V)&&A.add(P),O==="1.0.0"&&V&&(S[V]=P)}for(let P=0;P<y.length;P++){if(A.has(P))continue;const R=y[P],O=w[v[P]];if(!O.extras)continue;let V=null;R.id in S&&(V=kA(y[S[R.id]].meshes,R.localMatrix)),V||(V=OA(O)),V&&(R.footprint=zA(V))}if(A.size>0){const P=Array.from(A.values()).sort((R,O)=>R-O);for(let R=P.length-1;R>=0;R--)y.splice(P[R],1)}}(p,h,r.json.nodes),p}function FA(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,s=r.aabb.min[1]-1,a=wu/(r.aabb.max[0]-i+2),u=wu/(r.aabb.max[1]-s+2);for(let h=0;h<e.length;h+=3){const p=e[h+2],y=(e[h+0]-i)*a|0,v=(e[h+1]-s)*u|0;p>r.heightmap[v*wu+y]&&(r.heightmap[v*wu+y]=p)}}function jb(r,e,i,s,a){i.reserve(i.length+4*r.length),s.reserve(s.length+10*r.length),a.reserve(a.length+10*r.length);let u=s.length;for(const h of r){const p=Math.min(10,Math.max(4,1.3*h.height))*e,y=[-h.normal[1],h.normal[0],0],v=Math.min(.29,.1*h.width/h.depth),w=h.width-2*h.depth*e*(v+.01),S=qn([],h.pos,y,w/2),A=qn([],h.pos,y,-w/2),P=[S[0],S[1],S[2]+h.height],R=[A[0],A[1],A[2]+h.height],O=qn([],h.normal,y,v);Cr(O,O,p);const V=qn([],h.normal,y,-v);Cr(V,V,p),Oi(O,S,O),Oi(V,A,V),S[2]+=.1,A[2]+=.1,s.emplaceBack(O[0],O[1],O[2]),s.emplaceBack(V[0],V[1],V[2]),s.emplaceBack(S[0],S[1],S[2]),s.emplaceBack(A[0],A[1],A[2]),s.emplaceBack(P[0],P[1],P[2]),s.emplaceBack(R[0],R[1],R[2]),s.emplaceBack(S[0],S[1],S[2]),s.emplaceBack(A[0],A[1],A[2]),s.emplaceBack(O[0],O[1],O[2]),s.emplaceBack(V[0],V[1],V[2]);const N=w/p/2;a.emplaceBack(-N-v,-1,N,.8),a.emplaceBack(N+v,-1,N,.8),a.emplaceBack(-N,0,N,1.3),a.emplaceBack(N,0,N,1.3),a.emplaceBack(N+v,-.8,N,.7),a.emplaceBack(N+v,-.8,N,.7),a.emplaceBack(0,0,N,1.3),a.emplaceBack(0,0,N,1.3),a.emplaceBack(N+v,-1.2,N,.8),a.emplaceBack(N+v,-1.2,N,.8),i.emplaceBack(6+u,4+u,8+u),i.emplaceBack(7+u,9+u,5+u),i.emplaceBack(0+u,1+u,2+u),i.emplaceBack(1+u,3+u,2+u),u+=10}}function BA(r,e){const i={};i.indexArray=new wn,i.vertexArray=new Gs,i.colorArray=new qa,jb(r,e,i.indexArray,i.vertexArray,i.colorArray);const s={defined:!0};s.emissiveFactor=or.black;const a={};return a.baseColorFactor=or.white,s.pbrMetallicRoughness=a,i.material=s,i.aabb=new Ft([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const Gb=Ii([{name:"a_pos_3f",components:3,type:"Float32"}]),NA=Ii([{name:"a_normal_3",components:3,type:"Int16"}]),VA=Ii([{name:"a_centroid_3",components:3,type:"Int16"}]),Hb=Ii([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),UA=Ii([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),jA=Ii([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),GA=Ii([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),HA=Ii([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),qA=Ii([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),qb=xe.types,O_=32767;function $A(r,e){const i=ut+e;for(const s of r)for(const a of s)if(a.x<-e||a.x>i||a.y<-e||a.y>i)return!1;return!0}function WA(r){switch(r){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${r}`)}}class px{constructor(){this.layoutVertexArray=new Gs,this.layoutAttenuationArray=new qa,this.layoutColorArray=new Hs,this.indexArray=new wn,this.indexArrayForConflation=new wn,this.segmentsBucket=new Nr}}class mx{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new Nr,this.entranceBloom=new px;const i=66560;this.layoutVertexArray=new Gs,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new oc,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new oc,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new Hs,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new $a,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new Hh,this.layoutAOArray.reserve(i),this.indexArray=new wn,this.indexArray.reserve(66560),this.indexArrayForConflation=new wn,this.segmentsBucket=new Nr,this.entranceBloom=new px,e&&(this.layoutFacadePaintArray=new Hs,this.layoutFacadeDataArray=new Il,this.layoutFacadeVerticalRangeArray=new Hs)}reserve(e,i,s){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),s&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class $b{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Ho,this.footprintsIndices=new $a,this.footprintsMin=new Ye(1/0,1/0),this.footprintsMax=new Ye(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new mx(!1),this.buildingWithFacade=new mx(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new Eo(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new Yy(e),this.groundEffect.groundRadiusArray=new ua,this.hasAppearances=null}updateFootprints(e,i){const s=new v_([],[],1),a={vertices:[],indices:new Uint32Array(0),grid:s,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:a,id:e})}updateAppearances(e,i,s,a){}prepare(){return function(){if(I_!=null||Ab!=null)return null;if(ad!=null)return ad;const e=fetch(Mi.BUILDING_GEN_URL);return ad=function(i){let s,a,u,h,p;function y(){s=new Uint8Array(p.buffer),a=new Int16Array(p.buffer),u=new Int32Array(p.buffer),h=new Float32Array(p.buffer)}function v(){throw new Error("Unexpected BuildingGen error.")}const w=()=>{},S={a:{a:v,f:function(A){const P=s.length,R=Math.max(A>>>0,Math.ceil(1.2*P)),O=Math.ceil((R-P)/65536);try{return p.grow(O),y(),!0}catch{return!1}},g:v,b:w,c:w,d:w,e:w}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,S):i.then(A=>A.arrayBuffer()).then(A=>WebAssembly.instantiate(A,S))).then(A=>{const P=A.instance.exports;return(0,P.g)(),p=P.f,y(),new yA({setStyle:P.h,setAOOptions:P.i,setMetricOptions:P.j,setStructuralOptions:P.k,setFacadeOptions:P.l,setFauxFacadeOptions:P.m,setFacadeClassifierOptions:P.n,addFeature:P.o,addFacade:P.p,generateMesh:P.q,getLastError:P.r,getOuterRingLength:P.s,getMeshCount:P.t,getPositionsPtr:P.u,getPositionsLength:P.v,getNormalsPtr:P.w,getNormalsLength:P.x,getAOPtr:P.y,getAOLength:P.z,getUVPtr:P.A,getUVLength:P.B,getFauxFacadePtr:P.C,getFauxFacadeLength:P.D,getIndicesPtr:P.E,getIndicesLength:P.F,getBuildingPart:P.G,getRingCount:P.H,getRingPtr:P.I,getRingLength:P.J,malloc:P.K,free:P.L,heapU8:s,heap16:a,heap32:u,heapF32:h})})}(e).then(i=>(ad=null,I_=i,I_)).catch(i=>{St("Could not load building-gen"),ad=null,Ab=i}),ad}()}populate(e,i,s,a){const u=xA();if(!u)return;const h=G(s);this.tileToMeter=h,this.brightness=i.brightness,u.setStyle({normalScale:[1,-1,h],tileToMeters:h}),u.setAOOptions(!1,.3),u.setMetricOptions(!1,16),u.setStructuralOptions(!0),u.setFacadeClassifierOptions(3);const p=new Map,y=new Map;let v=0;for(const{feature:N}of e){if(qb[N.type]!=="LineString"){p.set(N.id,N.properties.source_id);continue}const q=this.layers[0]._featureFilter.needGeometry;if(q&&!this.layers[0]._featureFilter.filter(new Mr(this.zoom),N,s))continue;const W=be(N,q);if(!q&&!this.layers[0]._featureFilter.filter(new Mr(this.zoom),W,s))continue;const K=q?W.geometry:ue(N,s,a),se=[];for(const ge of K)for(const ze of ge)se.push(ze.x),se.push(ze.y);const te={coordinates:se,crossPerc:N.properties.cross_perc,distanceToRoad:N.properties.distance_to_road,entrances:N.properties.entrances,sourceId:0},le=N.properties.source_id;let fe=y.get(le);fe||(fe=[],y.set(le,fe)),fe.push(te),++v}this.maxHeight=0;const w=new Array,S=new Set,A=N=>{N!=null&&S.add(N)},P=(N,q)=>{N!=null&&w.push({buildingId:N,footprintIndex:q})},R=64*(e.length-v),O=R/2;this.buildingWithFacade.reserve(R,O,!0),this.buildingWithoutFacade.reserve(2*R,2*O,!1),this.footprintsIndices.reserve(16*(e.length-v)),this.footprintsVertices.reserve(8*(e.length-v));for(const{feature:N,id:q,index:W,sourceLayerIndex:K}of e){if(qb[N.type]==="LineString")continue;const se=this.layers[0]._featureFilter.needGeometry;if(se&&!this.layers[0]._featureFilter.filter(new Mr(this.zoom),N,s))continue;let te=null;if(N.properties&&N.properties.hasOwnProperty("building_id")&&(te=N.properties.building_id,S.has(te)))continue;const le=be(N,se);if(!se&&!this.layers[0]._featureFilter.filter(new Mr(this.zoom),le,s))continue;const fe=se?le.geometry:ue(N,s,a),ge=ep(fe,500);let ze=!1;for(const ei of ge)if(ei.length!==1){ze=!0;break}if(ze){A(te);continue}if(!$A(fe,163)){A(te);continue}const we=this.layers[0],Ne=WA(we.layout.get("building-roof-shape").evaluate(N,{},s)),He=we.layout.get("building-base").evaluate(N,{},s),qe=we.layout.get("building-height").evaluate(N,{},s),Je=we.layout.get("building-flood-light-ground-radius").evaluate(N,{},s),et=we.paint.get("building-ambient-occlusion-intensity"),Ze=Je/this.tileToMeter;N.properties["building-part"]="roof";const Xe=we.paint.get("building-color").evaluate(N,{},this.canonical).toPremultipliedRenderColor(this.lut),Be=we.paint.get("building-emissive-strength").evaluate(N,{},this.canonical);N.properties["building-part"]="wall";const ke=we.paint.get("building-color").evaluate(N,{},this.canonical).toPremultipliedRenderColor(this.lut),Ke=we.paint.get("building-emissive-strength").evaluate(N,{},this.canonical);N.properties["building-part"]="window";const ht=we.paint.get("building-color").evaluate(N,{},this.canonical).toPremultipliedRenderColor(this.lut),st=we.paint.get("building-emissive-strength").evaluate(N,{},this.canonical);N.properties["building-part"]="door";const Nt=we.paint.get("building-color").evaluate(N,{},this.canonical).toPremultipliedRenderColor(this.lut),vt=we.paint.get("building-emissive-strength").evaluate(N,{},this.canonical);let At=we.layout.get("building-flood-light-wall-radius").evaluate(N,{},s);At=U(At,0,2048);const Lt=At/2048*O_,Si=p.get(q),at=y.get(Si)||[],Ot=at.length!==0&&we.layout.get("building-facade").evaluate(N,{},s);u.setFacadeOptions(4,!0),u.setFauxFacadeOptions(Ot,!1,1);let li=0,Di=0,ki=0,mi=0,dr=0,ie=0,oe=0,Ve=0,Qe=0,_t=0,gt=0;if(Ot){let ei=Math.round(we.layout.get("building-facade-floors").evaluate(N,{},s));if(He===0){ei=Math.max(1,ei-(at.length>0?1:0));let cr=4;if(qe>100){const kr=[10,13,15];cr=kr[N.id?N.id%kr.length:0]}else qe<=10&&(cr=3);u.setFacadeOptions(cr,!0),dr=(qe<15?1.3:1.61803)*cr/h}else dr=He/h;ie=qe/h,dr=Math.min(dr,ie),ki=we.layout.get("building-facade-unit-width").evaluate(N,{},s)/h,mi=(ie-dr)/ei,u.setFauxFacadeOptions(!0,!0,ki);const jr=we.layout.get("building-facade-window").evaluate(N,{},s);li=jr[0],Di=jr[1],oe=Math.floor(65535*Math.min(1,dr/ut)),Ve=Math.floor(65535*Math.min(1,ie/ut)),Qe=Math.floor(255*li)<<8|Math.floor(255*Di),_t=Math.floor(65535*Math.min(1,ki/ut)),gt=Math.floor(65535*Math.min(1,mi/ut))}const Vt=Array(ge.length),Ht={x:1/0,y:1/0},fi={x:-1/0,y:-1/0},bi={x:0,y:0};let Ti=0;for(let ei=0;ei<ge.length;ei++){const jr=ge[ei];if(jr.length>0){const cr=[],kr=Array(jr.length+1);kr[0]=0;for(let En=0;En<jr.length;En++){const kn=jr[En];for(let _n=0;_n<kn.length;_n++){const gn=kn[kn.length-_n-1];Ht.x=Math.min(Ht.x,gn.x),Ht.y=Math.min(Ht.y,gn.y),fi.x=Math.max(fi.x,gn.x),fi.y=Math.max(fi.y,gn.y),bi.x+=gn.x,bi.y+=gn.y,Ti++,cr.push(gn.x),cr.push(gn.y)}kr[En+1]=cr.length}Vt[ei]={id:N.id?N.id:0,height:qe,minHeight:He,sourceId:0,roofType:Ne,coordinates:cr,ringIndices:kr}}}bi.x/=Ti||1,bi.y/=Ti||1;const Ci=u.generateMesh(Vt,at);if(typeof Ci=="string"){St(`Unable to generate building ${N.id}: ${Ci}`),A(te);continue}if(Ci.meshes.length===0||Ci.modifiedPolygonRings.length===0){A(te);continue}const ti=Ot?this.buildingWithFacade:this.buildingWithoutFacade;let ai=0;for(const ei of Ci.meshes)ai+=ei.positions.length/3;const Gi=ti.segmentsBucket.prepareSegment(ai,ti.layoutVertexArray,ti.indexArray),Xi=[];let Ki=null,lr=0,xr=-1;const fr=ti.layoutVertexArray.length,Ji=fr+ai;ti.layoutVertexArray.resize(Ji),ti.layoutCentroidArray.resize(Ji),ti.layoutNormalArray.resize(Ji),ti.layoutAOArray.resize(Ji),ti.layoutColorArray.resize(Ji),ti.layoutFloodLightDataArray.resize(Ji),Ot&&(ti.layoutFacadePaintArray.resize(Ji),ti.layoutFacadeDataArray.resize(Ji),ti.layoutFacadeVerticalRangeArray.resize(Ji));const rr=ti.indexArray.length;let wi=0,zi=fr;for(const ei of Ci.meshes){let jr,cr;if(ei.buildingPart===1)jr=Xe,cr=Be;else if(ei.buildingPart===0)jr=ke,cr=Ke;else if(ei.buildingPart===2)jr=ht,cr=st;else{if(ei.buildingPart!==3)continue;jr=Nt,cr=vt}if(cr=U(cr,0,1),ei.buildingPart===3){const Ar=new Array;for(let An=0;An<ei.positions.length;An+=12){const Zo=ei.positions[An+0],Ya=ei.positions[An+1],Yn=ei.positions[An+3],bs=ei.positions[An+4],Zs=ei.positions[An+2],bc=ei.positions[An+8]-Zs,bd=1,Ta=Yn-Zo,Sa=bs-Ya,Op=Math.hypot(Ta,Sa);Ar.push({pos:[Zo+.5*Ta,Ya+.5*Sa,Zs],normal:[Sa/Op,-Ta/Op,0],width:Op,height:bc,depth:bd,points:[Zo,Ya,Yn,bs]})}const tn=ti.entranceBloom.segmentsBucket.prepareSegment(10*Ar.length,ti.entranceBloom.layoutVertexArray,ti.entranceBloom.indexArray),on=ti.entranceBloom.layoutVertexArray.length;lr=ti.entranceBloom.indexArray.length,jb(Ar,.5/this.tileToMeter,ti.entranceBloom.indexArray,ti.entranceBloom.layoutVertexArray,ti.entranceBloom.layoutAttenuationArray);const zs=ti.entranceBloom.layoutVertexArray.length-on;xr=ti.entranceBloom.indexArray.length-lr;for(let An=0;An<zs;An++)ti.entranceBloom.layoutColorArray.emplaceBack(255*Nt.r<<8|255*Nt.g,255*Nt.b<<8|51*vt);tn.vertexLength+=zs,tn.primitiveLength+=xr,Ki={part:ei.buildingPart,vertexOffset:on,vertexLength:zs}}ti.layoutVertexArray.float32.set(ei.positions,3*zi);const kr=ei.positions.length/3;for(let Ar=0;Ar<kr;++Ar){const tn=3*Ar;wi=Math.max(wi,ei.positions[tn+2]);const on=ei.normals[tn+1]*O_,zs=ei.normals[tn+2]*O_,An=3*(zi+Ar);ti.layoutNormalArray.int16[An]=ei.normals[tn]*O_,ti.layoutNormalArray.int16[An+1]=on,ti.layoutNormalArray.int16[An+2]=zs;const Zo=ei.ao[Ar];ti.layoutAOArray.uint8[zi+Ar]=255*Zo;const Ya=1+(Zo-1)*et,Yn=255*jr.b*Ya<<8|255*cr;ti.layoutColorArray.uint16[2*(zi+Ar)]=255*jr.r*Ya<<8|255*jr.g*Ya,ti.layoutColorArray.uint16[2*(zi+Ar)+1]=Yn}const En=Math.floor(bi.x),kn=Math.floor(bi.y),_n=Math.floor(qe);for(let Ar=0;Ar<kr;++Ar){const tn=3*(zi+Ar);ti.layoutCentroidArray.int16[tn]=En,ti.layoutCentroidArray.int16[tn+1]=kn,ti.layoutCentroidArray.int16[tn+2]=_n}if(ti.layoutFloodLightDataArray.uint16.fill(ei.buildingPart===0?Lt:0,zi,zi+kr),Ot){const Ar=255*ht.r<<8|255*ht.g,tn=255*ht.b<<8|255*st;for(let on=0;on<kr;++on){const zs=2*(zi+on);ti.layoutFacadePaintArray.uint16[zs]=Ar,ti.layoutFacadePaintArray.uint16[zs+1]=tn}for(let on=0;on<kr;++on)if(ei.isFauxFacade[on]){const zs=Math.min(65535,Math.floor(ei.uv[2*on]*Ci.outerRingLength));ti.layoutFacadeDataArray.emplace(zi+on,1|zs,Qe,_t,gt),ti.layoutFacadeVerticalRangeArray.emplace(zi+on,oe,Ve)}else ti.layoutFacadeDataArray.emplace(zi+on,0,0,0,0),ti.layoutFacadeVerticalRangeArray.emplace(zi+on,0,0)}const gn=Gi.vertexLength,Mn=ei.indices.length/3,Cs=ti.indexArray.length;ti.indexArray.resize(Cs+Mn);for(let Ar=0;Ar<Mn;++Ar){const tn=3*Ar,on=3*Cs+tn;ti.indexArray.uint16[on]=gn+ei.indices[tn],ti.indexArray.uint16[on+1]=gn+ei.indices[tn+1],ti.indexArray.uint16[on+2]=gn+ei.indices[tn+2]}ei.buildingPart!==1&&ei.buildingPart!==0&&ei.buildingPart!==2&&ei.buildingPart!==3||Xi.push({part:ei.buildingPart,vertexOffset:zi,vertexLength:ei.positions.length/3}),zi+=kr,Gi.vertexLength+=kr,Gi.primitiveLength+=ei.indices.length/3}this.maxHeight=Math.max(this.maxHeight,wi);const Br=ti.indexArray.length-rr,Qt=this.footprintsIndices.length,Pi=this.footprintsVertices.length,_r=[],wr=new Ye(1/0,1/0),Rr=new Ye(-1/0,-1/0),sn=this.groundEffect.vertexArray.length;for(const ei of Ci.modifiedPolygonRings){const jr=[],cr=new Ye(1/0,1/0),kr=new Ye(-1/0,-1/0);for(let En=0;En<ei.length;En+=2){const kn=ei.length-En-2;cr.x=Math.min(cr.x,ei[kn]),cr.y=Math.min(cr.y,ei[kn+1]),kr.x=Math.max(kr.x,ei[kn]),kr.y=Math.max(kr.y,ei[kn+1]);const _n=new Ye(ei[kn],ei[kn+1]);jr.push(_n),_r.push(_n.x,_n.y),this.footprintsVertices.emplaceBack(_n.x,_n.y)}wr.x=Math.min(wr.x,cr.x),wr.y=Math.min(wr.y,cr.y),Rr.x=Math.max(Rr.x,kr.x),Rr.y=Math.max(Rr.y,kr.y),this.groundEffect.addData(jr,[cr,kr],Ze)}const Er=this.groundEffect.vertexArray.length-sn;this.groundEffect.groundRadiusArray.reserveForAdditional(Er);for(let ei=0;ei<Er;ei++)this.groundEffect.groundRadiusArray.emplaceBack(Je);(Ht.x<0||fi.x>ut||Ht.y<0||fi.y>ut)&&this.featuresOnBorder.push({featureId:N.id,footprintIndex:this.footprints.length});{const ei=id(_r,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+ei.length),this.footprintsIndices.uint16.set(ei,Qt),this.buildingIds.add(te??N.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,wr.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,wr.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,Rr.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,Rr.y);const jr={footprintVertexOffset:Pi,footprintVertexLength:this.footprintsVertices.length-Pi,footprintIndexOffset:Qt,footprintIndexLength:this.footprintsIndices.length-Qt,min:wr,max:Rr,hiddenFlags:0,indicesOffset:rr,indicesLength:Br,bloomIndicesOffset:lr,bloomIndicesLength:xr,groundEffectVertexOffset:sn,groundEffectVertexLength:Er,hasFauxFacade:Ot,height:wi,promoteId:q,feature:le,parts:Xi,buildingBloom:Ki},cr=this.footprints.length;N.id!==void 0&&this.featureFootprintLookup.set(N.id,cr),P(te,cr),this.footprints.push(jr)}this.programConfigurations.populatePaintArrays(ti.layoutVertexArray.length,N,W,{},i.availableImages,s,i.brightness),this.groundEffect.addPaintPropertiesData(N,W,{},i.availableImages,s,i.brightness),i.featureIndex.insert(N,fe,W,K,this.index,fr)}w.forEach(({buildingId:N,footprintIndex:q})=>{S.has(N)&&(this.footprints[q].hiddenFlags|=4)});const V=new Set;this.buildingIds.forEach((N,q,W)=>{S.has(N)||V.add(N)}),this.buildingIds=V,this.groundEffect.prepareBorderSegments()}update(e,i,s,a,u,h,p){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p),this.groundEffect.update(e,i,u,s,a,h,p),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=s=>{s.layoutVertexBuffer=e.createVertexBuffer(s.layoutVertexArray,Gb.members),s.layoutNormalBuffer=e.createVertexBuffer(s.layoutNormalArray,NA.members),s.layoutCentroidBuffer=e.createVertexBuffer(s.layoutCentroidArray,VA.members),s.layoutFloodLightDataBuffer=e.createVertexBuffer(s.layoutFloodLightDataArray,qA.members),s.layoutFacadeDataArray&&s.layoutFacadeDataArray.length&&(s.layoutFacadeDataBuffer=e.createVertexBuffer(s.layoutFacadeDataArray,jA.members)),s.layoutFacadeVerticalRangeArray&&s.layoutFacadeVerticalRangeArray.length&&(s.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(s.layoutFacadeVerticalRangeArray,GA.members)),s.entranceBloom.layoutVertexArray.length&&(s.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(s.entranceBloom.layoutVertexArray,Gb.members),s.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(s.entranceBloom.layoutAttenuationArray,HA.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,s=!0){let a=!1;const u=s?i:0,h=0|(s?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const p of e){const y=this.footprints[p],v=y.hiddenFlags&h|u;y.hiddenFlags!==v&&(y.hiddenFlags=v,a=!0,this.groundEffect.updateHiddenByLandmarkRange(y.groundEffectVertexOffset,y.groundEffectVertexLength,y.hiddenFlags!==0))}return a&&(this.indexArrayForConflationUploaded=!1),a}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=a=>{a.indexArray.length!==0&&(a.indexArrayForConflation.resize(a.indexArray.length),a.indexArrayForConflation.uint16.set(a.indexArray.uint16),a.entranceBloom.indexArrayForConflation.resize(a.entranceBloom.indexArray.length),a.entranceBloom.indexArrayForConflation.uint16.set(a.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const a of this.footprints){const u=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,h=a.indicesOffset+a.indicesLength;if(a.hiddenFlags!==0){for(let y=a.indicesOffset;y<h;y++)u.indexArrayForConflation.uint16[3*y+0]=0,u.indexArrayForConflation.uint16[3*y+1]=0,u.indexArrayForConflation.uint16[3*y+2]=0;const p=a.bloomIndicesOffset+a.bloomIndicesLength;for(let y=a.bloomIndicesOffset;y<p;y++)u.entranceBloom.indexArrayForConflation.uint16[3*y+0]=0,u.entranceBloom.indexArrayForConflation.uint16[3*y+1]=0,u.entranceBloom.indexArrayForConflation.uint16[3*y+2]=0}}const s=a=>{a.indexArray.length!==0&&(a.indexBuffer?a.indexBuffer.updateData(a.indexArrayForConflation):a.indexBuffer=e.createIndexBuffer(a.indexArrayForConflation,!0),a.entranceBloom.indexBuffer?a.entranceBloom.indexBuffer.updateData(a.entranceBloom.indexArrayForConflation):a.entranceBloom.indexBuffer=e.createIndexBuffer(a.entranceBloom.indexArrayForConflation,!0))};s(this.buildingWithoutFacade),s(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=s=>{s.layoutColorBuffer?s.layoutColorBuffer.updateData(s.layoutColorArray):s.layoutColorBuffer=e.createVertexBuffer(s.layoutColorArray,Hb.members,!0),s.layoutFacadePaintArray&&(s.layoutFacadePaintBuffer?s.layoutFacadePaintBuffer.updateData(s.layoutFacadePaintArray):s.layoutFacadePaintBuffer=e.createVertexBuffer(s.layoutFacadePaintArray,UA.members,!0)),s.entranceBloom.layoutColorBuffer?s.entranceBloom.layoutColorBuffer.updateData(s.entranceBloom.layoutColorArray):s.entranceBloom.layoutColorBuffer=e.createVertexBuffer(s.entranceBloom.layoutColorArray,Hb.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const s=e.paint.get("building-ambient-occlusion-intensity");for(const a of this.footprints){if(4&a.hiddenFlags)continue;const u=i[a.promoteId],h=a.feature;h.properties["building-part"]="roof";const p=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),y=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="wall";const v=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),w=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="window";const S=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical);h.properties["building-part"]="door";const P=e.paint.get("building-color").evaluate(h,u,this.canonical).toPremultipliedRenderColor(this.lut),R=e.paint.get("building-emissive-strength").evaluate(h,u,this.canonical),O=a.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const N of a.parts){let q,W=p;N.part===1?(W=p,q=y):N.part===0?(W=v,q=w):N.part===2?(W=S,q=A):N.part===3&&(W=P,q=R),q=U(q,0,1);for(let K=0;K<N.vertexLength;K++){const se=N.vertexOffset+K,te=1+(O.layoutAOArray.uint8[se]/255-1)*s;O.layoutColorArray.emplace(se,W.r*te*255<<8|W.g*te*255,W.b*te*255<<8|255*q),a.hasFauxFacade&&O.layoutFacadePaintArray.emplace(se,255*S.r<<8|255*S.g,255*S.b<<8|255*A)}}const V=a.buildingBloom;if(V)for(let N=0;N<V.vertexLength;N++)O.entranceBloom.layoutColorArray.emplace(V.vertexOffset+N,255*P.r<<8|255*P.g,255*P.b<<8|51*R)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,s){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(w_(this.activeReplacements,a))return;this.activeReplacements=a;for(const h of this.footprints)h.hiddenFlags&=-2;const u=[];for(const h of this.activeReplacements){if(h.order<=Wv)continue;const p=Math.max(1,Math.pow(2,h.footprintTileId.canonical.z-e.canonical.z));for(const y of this.footprints)y.min.x>h.max.x||y.max.x<h.min.x||y.min.y>h.max.y||y.max.y<h.min.y||(u.length=0,XA(this.footprintsVertices,y.footprintVertexOffset,y.footprintVertexLength,h.footprintTileId.canonical,e.canonical,u),Zy(h.footprint,u,this.footprintsIndices.uint16,y.footprintIndexOffset,y.footprintIndexLength,0,-p)&&(y.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const h of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(h.groundEffectVertexOffset,h.groundEffectVertexLength,h.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let s=Number.NEGATIVE_INFINITY,a=!0;const u=4*(e+ut)*ut+(i+ut);if(this.footprintLookup.hasOwnProperty(u)){const p=this.footprintLookup[u];return p?{height:p.height,hidden:p.hiddenFlags!==0}:void 0}const h=new Ye(e,i);for(const p of this.footprints)e>p.max.x||p.min.x>e||i>p.max.y||p.min.y>i||p.height<=s||ZA(h,this.footprintsVertices.float32.subarray(2*p.footprintVertexOffset,2*(p.footprintVertexOffset+p.footprintVertexLength)),this.footprintsIndices.uint16.subarray(p.footprintIndexOffset,p.footprintIndexOffset+p.footprintIndexLength))&&(s=p.height,this.footprintLookup[u]=p,a=p.hiddenFlags!==0);if(s!==Number.NEGATIVE_INFINITY)return{height:s,hidden:a};this.footprintLookup[u]=void 0}}function ZA(r,e,i){for(let s=0;s<i.length;s+=3){const a=i[s],u=i[s+1],h=i[s+2],p=e[2*a+0],y=e[2*a+1],v=e[2*u+0],w=e[2*u+1],S=e[2*h+0],A=e[2*h+1],P=(p-S)*(r.y-A)-(y-A)*(r.x-S),R=(v-p)*(r.y-y)-(w-y)*(r.x-p);if(P<0!=R<0&&P!==0&&R!==0)continue;const O=(S-v)*(r.y-w)-(A-w)*(r.x-v);if(O===0||O<0==P+R<=0)return!0}return!1}function XA(r,e,i,s,a,u){const h=Math.pow(2,s.z-a.z);for(let p=0;p<i;p++){let y=r.float32[2*(p+e)+0],v=r.float32[2*(p+e)+1];y=(y+a.x*ut)*h-s.x*ut,v=(v+a.y*ut)*h-s.y*ut,u.push(new Ye(y,v))}}let Wb,Zb;Mt($b,"BuildingBucket",{omit:["layers"]}),Mt(mx,"BuildingGeometry"),Mt(px,"BuildingBloomGeometry");const KA=Ii([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),YA=Ii([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:JA}=KA,QA=Ii([{name:"a_packed",components:3,type:"Float32"}]),{members:eI}=QA,tI=Ii([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:iI}=tI;class Xb{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new _c({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const s=this.getKey(e,i);return this.positions[s]}trim(){const e=this.width,i=this.height=Re(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,s){const a=[];let u=e.length%2==1?-e[e.length-1]*s:0,h=e[0]*s,p=!0;a.push({left:u,right:h,isDash:p,zeroLength:e[0]===0});let y=e[0];for(let v=1;v<e.length;v++){p=!p;const w=e[v];u=y*s,y+=w,h=y*s,a.push({left:u,right:h,isDash:p,zeroLength:w===0})}return a}addRoundDash(e,i,s){const a=i/2;for(let u=-s;u<=s;u++){const h=this.width*(this.nextRow+s+u);let p=0,y=e[p];for(let v=0;v<this.width;v++){v/y.right>1&&(y=e[++p]);const w=Math.abs(v-y.left),S=Math.abs(v-y.right),A=Math.min(w,S);let P;const R=u/s*(a+1);if(y.isDash){const O=a-Math.abs(R);P=Math.sqrt(A*A+O*O)}else P=a-Math.sqrt(A*A+R*R);this.image.data[h+v]=Math.max(0,Math.min(255,P+128))}}}addRegularDash(e,i){for(let y=e.length-1;y>=0;--y){const v=e[y],w=e[y+1];v.zeroLength?e.splice(y,1):w&&w.isDash===v.isDash&&(w.left=v.left,e.splice(y,1))}const s=e[0],a=e[e.length-1];s.isDash===a.isDash&&(s.left=a.left-this.width,a.right=s.right+this.width);const u=this.width*this.nextRow;let h=0,p=e[h];for(let y=0;y<this.width;y++){y/p.right>1&&(p=e[++h]);const v=Math.abs(y-p.left),w=Math.abs(y-p.right),S=Math.min(v,w);this.image.data[u+y]=Math.max(0,Math.min(255,(p.isDash?S:-S)+i+128))}}addDash(e,i){const s=this.getKey(e,i);if(this.positions[s])return this.positions[s];const a=i==="round",u=a?7:0,h=2*u+1;if(this.nextRow+h>this.height)return St("LineAtlas out of space"),null;e.length===0&&e.push(1);let p=0;for(let w=0;w<e.length;w++)e[w]<0&&(St("Negative value is found in line dasharray, replacing values with 0"),e[w]=0),p+=e[w];if(p!==0){const w=this.width/p,S=this.getDashRanges(e,this.width,w);a?this.addRoundDash(S,w,u):this.addRegularDash(S,i==="square"?.5*w:0)}const y=this.nextRow+u;this.nextRow+=h;const v={tl:[y,u],br:[p,0]};return this.positions[s]=v,v}}Mt(Xb,"LineAtlas");const rI=xe.types,nI=Math.cos(Math.PI/180*37.5),sI=Math.cos(Math.PI/180*5);class _x{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Fh,this.layoutVertexArray2=new Gs,this.patternVertexArray=new Gs,this.indexArray=new wn,this.programConfigurations=new Eo(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new Nr,this.maxLineLength=0,this.zOffsetVertexArray=new Gs,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:ut/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.hasPattern=jy("line",this.layers,this.pixelRatio,i);const u=this.layers[0].layout.get("line-sort-key");this.tileToMeter=G(s);const h=this.layers[0].layout.get("line-elevation-reference");if(h==="hd-road-markup")this.elevationType="road";else{const A=this.layers[0].layout.get("line-z-offset"),P=A.isConstant()&&!A.constantOr(0);this.elevationType=h!=="sea"&&h!=="ground"&&P?"none":"offset",this.elevationType==="offset"&&h==="none"&&St(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const p=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&p!==void 0;const y=[];for(const{feature:A,id:P,index:R,sourceLayerIndex:O}of e){const V=this.layers[0]._featureFilter.needGeometry,N=be(A,V);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),N,s))continue;const q=u?u.evaluate(N,{},s):void 0,W={id:P,properties:A.properties,type:A.type,sourceLayerIndex:O,index:R,geometry:V?N.geometry:ue(A,s,a),patterns:{},sortKey:q};y.push(W)}u&&y.sort((A,P)=>A.sortKey-P.sortKey);const{lineAtlas:v,featureIndex:w}=i,S=this.addConstantDashes(v);for(const A of y){const{geometry:P,index:R,sourceLayerIndex:O}=A;if(S&&this.addFeatureDashes(A,v),this.hasPattern){const V=Gy("line",this.layers,A,this.zoom,this.pixelRatio,i);this.patternFeatures.push(V)}else this.addFeature(A,P,R,s,v.positions,i.availableImages,i.brightness,i.elevationFeatures);w.insert(e[R].feature,P,R,O,this.index)}}addConstantDashes(e){let i=!1;for(const s of this.layers){const a=s.paint.get("line-dasharray").value,u=s.layout.get("line-cap").value;if(a.kind!=="constant"||u.kind!=="constant")i=!0;else{const h=u.value,p=a.value;if(!p)continue;e.addDash(p,h)}}return i}addFeatureDashes(e,i){const s=this.zoom;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,h=a.layout.get("line-cap").value;if(u.kind==="constant"&&h.kind==="constant")continue;let p,y;if(u.kind==="constant"){if(p=u.value,!p)continue}else p=u.evaluate({zoom:s},e);y=h.kind==="constant"?h.value:h.evaluate({zoom:s},e),i.addDash(p,y),e.patterns[a.id]=[i.getKey(p,y)]}}update(e,i,s,a,u,h,p,y){this.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p,y)}addFeatures(e,i,s,a,u,h){for(const p of this.patternFeatures)this.addFeature(p,p.geometry,p.index,i,s,a,h,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,eI)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,iI)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,YA.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,JA),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let s,a;if(i&&i>0?(s=`mapbox_clip_start_${i}`,a=`mapbox_clip_end_${i}`):(s="mapbox_clip_start",a="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(s)&&e.properties.hasOwnProperty(a))return{start:+e.properties[s],end:+e.properties[a]}}addFeature(e,i,s,a,u,h,p,y){const v=this.layers[0].layout,w=v.get("line-join").evaluate(e,{}),S=v.get("line-cap").evaluate(e,{}),A=v.get("line-miter-limit"),P=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const R=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=v.get("line-z-offset").value;const O=this.layers[0].paint.get("line-width").value;if(O.kind!=="constant"&&O.isLineProgressConstant===!1&&(this.variableWidthValue=O),this.elevationType==="road"){const V=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,a,y,w,S,A,P)){const[N,q]=this.clipRuntimeLinesToTile(i,1);for(let W=0;W<N.length;W++){const K=N[W],se=q[W],te={progress:{min:se.progress.min,max:se.progress.max},nextDir:this.computeSegNextDir(se,K),prevDir:this.computeSegPrevDir(se,K)};this.addLine(K,e,a,w,S,A,P,te,R&&se.parentIndex>0?se.parentIndex:null)}this.fillNonElevatedRoadSegment(V)}}else for(let V=0;V<i.length;V++)this.addLine(i[V],e,a,w,S,A,P,void 0,R&&V>0?V:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,u,h,a,p,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return E_(e,-i,-i,ut+i,ut+i)}clipRuntimeLinesToTile(e,i){const s=[];return[E_(e,-i,-i,ut+i,ut+i,s),s]}addElevatedRoadFeature(e,i,s,a,u,h,p,y){const v=[],w=tr.getElevationFeature(e,a);if(w){const S=this.clipLinesToTile(i,1),A=this.prepareElevatedLines(S,w,s);for(const P of A)v.push({geometry:P,elevation:w,elevationTileID:s,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(v.length===0)return!1;for(const S of v){const A=this.layoutVertexArray.length;this.addLine(S.geometry,e,s,u,h,p,y);const P=new hr(s,S.elevationTileID);if(S.elevation)for(let R=A;R<this.layoutVertexArray.length;R++){const O=new Ye(this.layoutVertexArray.int16[6*R]>>1,this.layoutVertexArray.int16[6*R+1]>>1),V=P.pointElevation(O,S.elevation,.05);this.updateHeightRange(V),this.zOffsetVertexArray.emplaceBack(V,0,0)}else this.fillNonElevatedRoadSegment(A)}return!0}prepareElevatedLines(e,i,s){if(i.constantHeight!=null)return e;const a=[],u=1/G(s);for(const h of e)mA(h,new Zi(i,u),0,a);return a}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,s,a,u,h,p,y,v){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=v?this.lineFeatureClips(i,v):this.lineClips;const w=a==="none";this.patternJoinNone=this.hasPattern&&w,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const S=y&&y.progress.min>0,A=y&&y.progress.max<1;if(this.lineClips){let ge={min:this.lineClips.start,max:this.lineClips.end},ze=1;if(y){const He=this.lineClips.end-this.lineClips.start;ge=function(qe,Je,et){return{min:br(qe.min,Je,et),max:br(qe.max,Je,et)}}(y.progress,{min:0,max:1},ge),He>0&&(ze=(ge.max-ge.min)/He)}const we=+i.properties.mapbox_clip_feature_len,Ne=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(we)||Number.isNaN(Ne)){for(let qe=0;qe<e.length-1;qe++)this.totalDistance+=e[qe].dist(e[qe+1]);const He=this.totalDistance/(ge.max-ge.min);this.totalFeatureLength=Number.isFinite(He)?He:0,this.lineClips.start=ge.min,this.lineClips.end=ge.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=we,this.distance=Ne*ze,this.lineClips.start=ge.min,this.lineClips.end=ge.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const P=rI[i.type]==="Polygon";let R=e.length;for(;R>=2&&e[R-1].equals(e[R-2]);)R--;let O=0;for(;O<R-1&&e[O].equals(e[O+1]);)O++;if(R<(P?3:2))return;a==="bevel"&&(h=1.05);const V=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let N,q,W,K,se,te,le,fe;y&&y.prevDir&&(te=y.prevDir.perp()),y&&y.nextDir&&(le=y.nextDir.perp()),this.e1=this.e2=-1,P&&(N=e[R-2],se=e[O].sub(N)._unit()._perp());for(let ge=O;ge<R;ge++){if(W=ge===R-1?P?e[O+1]:void 0:e[ge+1],W&&e[ge].equals(W))continue;se&&(K=se),N&&(q=N),N=e[ge],fe=this.evaluateLineProgressFeatures(q?q.dist(N):0),se=W?W.sub(N)._unit()._perp():K,K=K||se;const ze=q&&W;let we=ze?a:P||w?"butt":u;const Ne=K.x*se.x+K.y*se.y;if(w){const ke=function(Ke){if(Ke.patternJoinNone){const ht=Ke.segmentPoints.length/2,st=Ke.lineSoFar-Ke.segmentStart;for(let Nt=0;Nt<ht;++Nt){const vt=Ke.segmentPoints[2*Nt+1],At=Math.round(Ke.segmentPoints[2*Nt])+.5+.25*vt;Ke.patternVertexArray.emplaceBack(At,st,Ke.segmentStart),Ke.patternVertexArray.emplaceBack(At,st,Ke.segmentStart)}Ke.segmentPoints.length=0}Ke.e1=Ke.e2=-1};if(ze&&Ne<sI){this.updateDistance(q,N),this.addCurrentVertex(N,K,1,1,V,fe),ke(this),this.addCurrentVertex(N,se,-1,-1,V,fe);continue}if(q){if(!W){this.updateDistance(q,N),this.addCurrentVertex(N,K,1,1,V,fe),ke(this);continue}we="miter"}}let He=K.add(se);He.x===0&&He.y===0||He._unit();const qe=He.x*se.x+He.y*se.y,Je=qe!==0?1/qe:1/0,et=2*Math.sqrt(2-2*qe),Ze=qe<nI&&q&&W,Xe=K.x*se.y-K.y*se.x>0,Be=this.overscaling<=16?15*ut/(512*this.overscaling):0;if(ze&&we==="round"){if(Je<p)we="miter";else if(Je<=2){const ke=gx(N,-10,ut+10);we=this.elevationType==="offset"&&(ke||this.hasCrossSlope)?"miter":"fakeround"}}if(we==="miter"&&Je>h&&(we="bevel"),we==="bevel"&&(Je>2&&(we="flipbevel"),Je<h&&(we="miter")),q&&!(we==="miter"&&Ze)&&this.updateDistance(q,N),we==="miter")if(Ze){const ke=N.dist(q);if(ke>2*Be){const ht=N.sub(N.sub(q)._mult(Be/ke)._round());this.updateDistance(q,ht),this.addCurrentVertex(ht,K,0,0,V,fe),q=ht}this.updateDistance(q,N),He._mult(Je),this.addCurrentVertex(N,He,0,0,V,fe);const Ke=N.dist(W);if(Ke>2*Be){const ht=N.add(W.sub(N)._mult(Be/Ke)._round());this.updateDistance(N,ht),this.addCurrentVertex(ht,se,0,0,V,fe),N=ht}}else He._mult(Je),this.addCurrentVertex(N,He,0,0,V,fe);else if(we==="flipbevel"){if(Je>100)He=se.mult(-1);else{const ke=Je*K.add(se).mag()/K.sub(se).mag();He._perp()._mult(ke*(Xe?-1:1))}this.addCurrentVertex(N,He,0,0,V,fe),this.addCurrentVertex(N,He.mult(-1),0,0,V,fe)}else if(we==="bevel"||we==="fakeround"){fe!=null&&q&&this.addCurrentVertex(N,le||K,-1,-1,V,fe);const ke=N.dist(q)<=2*Be&&we!=="bevel",Ke=He.mult(Xe?1:-1);Ke._mult(Je);const ht=se.mult(Xe?-1:1),st=K.mult(Xe?-1:1),Nt=this.evaluateLineProgressFeatures(this.distance);if(fe==null&&(this.addHalfVertex(N,Ke.x,Ke.y,!1,!Xe,0,V,Nt),ke||this.addHalfVertex(N,Ke.x+2*st.x,Ke.y+2*st.y,!1,Xe,0,V,Nt)),we==="fakeround"){const vt=Math.round(180*et/Math.PI/20);this.addHalfVertex(N,st.x,st.y,!1,Xe,0,V,Nt);for(let At=0;At<vt;At++){let Lt=At/vt;if(Lt!==.5){const at=Lt-.5;Lt+=Lt*at*(Lt-1)*((1.0904+Ne*(Ne*(3.55645-1.43519*Ne)-3.2452))*at*at+(.848013+Ne*(.215638*Ne-1.06021)))}const Si=ht.sub(st)._mult(Lt)._add(st)._unit();this.addHalfVertex(N,Si.x,Si.y,!1,Xe,0,V,Nt)}this.addHalfVertex(N,ht.x,ht.y,!1,Xe,0,V,Nt)}ke||fe!=null||this.addHalfVertex(N,Ke.x+2*ht.x,Ke.y+2*ht.y,!1,Xe,0,V,Nt),fe!=null&&W&&this.addCurrentVertex(N,te||se,1,1,V,fe)}else if(we==="butt")this.addCurrentVertex(N,He,0,0,V,fe);else if(we==="square"){if(!q){const ke=S?0:-1;this.addCurrentVertex(N,He,ke,ke,V,fe)}if(this.addCurrentVertex(N,He,0,0,V,fe),q){const ke=A?0:1;this.addCurrentVertex(N,He,ke,ke,V,fe)}}else if(we==="round"){if(q){const ke=!ze&&le?le:K;this.addCurrentVertex(N,ke,0,0,V,fe),!ze&&A||this.addCurrentVertex(N,ke,1,1,V,fe,!0)}if(W){const ke=!ze&&te?te:se;!ze&&S||this.addCurrentVertex(N,ke,-1,-1,V,fe,!0),this.addCurrentVertex(N,ke,0,0,V,fe)}}}}addVerticesTo(e,i,s,a,u,h,p,y,v,w){const S=(i.w-e.w)/this.tessellationStep|0;let A=0;const P=this.scaledDistance;if(S>1){this.lineSoFar=e.w;const O=(i.x-e.x)/S,V=(i.y-e.y)/S,N=(i.z-e.z)/S,q=(i.w-e.w)/S;for(let W=1;W<S;++W){e.x+=O,e.y+=V,e.z+=N,this.lineSoFar+=q,A+=q;const K=this.evaluateLineProgressFeatures(this.prevDistance+A);this.scaledDistance=(this.prevDistance+A)/this.totalDistance,this.addHalfVertex(e,s,a,w,!1,p,v,K),this.addHalfVertex(e,u,h,w,!0,-y,v,K)}}this.lineSoFar=i.w,this.scaledDistance=P;const R=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,s,a,w,!1,p,v,R),this.addHalfVertex(i,u,h,w,!0,-y,v,R)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):St(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,s,a,u,h,p=!1){const y=i.x+i.y*s,v=i.y-i.x*s,w=i.y*a-i.x,S=-i.y-i.x*a;if(h!=null){const A=this.elevationType==="offset",P=-10,R=ut+10,O=h.zOffset,V=new gb(e.x,e.y,O,this.lineSoFar),N=!!A&&gx(e,P,R),q=this.lineSoFar,W=this.distance;if(this.currentVertex)if(N){const K=this.currentVertexIsOutside,se=this.currentVertex,te=new gb(e.x,e.y,O,this.lineSoFar);if(xb(se,te,P,R),!gx(te,P,R)){if(K){this.e1=this.e2=-1,this.distance-=se.dist(V),this.lineSoFar=se.w;const le=this.evaluateLineProgressFeatures(se.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(se,y,v,p,!1,s,u,le),this.addHalfVertex(se,w,S,p,!0,-a,u,le),this.prevDistance=this.distance}this.distance=this.prevDistance+se.dist(te),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(se,te,y,v,w,S,s,a,u,p),this.distance=W,this.scaledDistance=this.distance/this.totalDistance}}else{const K=this.currentVertex;if(this.currentVertexIsOutside){xb(K,V,P,R),this.e1=this.e2=-1,this.distance-=K.dist(V),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=K.w;const se=this.evaluateLineProgressFeatures(K.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(K,y,v,p,!1,s,u,se),this.addHalfVertex(K,w,S,p,!0,-a,u,se),this.prevDistance=this.distance,this.distance=W,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(K,V,y,v,w,S,s,a,u,p)}else N||(this.addHalfVertex(e,y,v,p,!1,s,u,h),this.addHalfVertex(e,w,S,p,!0,-a,u,h));this.currentVertex=V,this.currentVertexIsOutside=N,this.lineSoFar=q}else this.addHalfVertex(e,y,v,p,!1,s,u,h),this.addHalfVertex(e,w,S,p,!0,-a,u,h)}addHalfVertex({x:e,y:i},s,a,u,h,p,y,v){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),h||this.segmentPoints.push(this.lineSoFar-this.segmentStart,p)),this.layoutVertexArray.emplaceBack((e<<1)+(u?1:0),(i<<1)+(h?1:0),Math.round(63*s)+128,Math.round(63*a)+128,1+(p===0?0:p<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const S=ii(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,S)}const w=y.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,w),y.primitiveLength++),h?this.e2=w:this.e1=w,v!=null&&this.zOffsetVertexArray.emplaceBack(v.zOffset,v.variableWidth,v.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function gx(r,e,i){return r.x<e||r.x>i||r.y<e||r.y>i}let Kb,Yb;function Jb(r,e,i){return e*(ut/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}Mt(_x,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Qb=(r,e,i)=>(1-i)*r+i*e;function e1(r,e){return 1/Jb(r,1,e.tileZoom)}function t1(r,e,i,s){return r.translatePosMatrix(s||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const i1=r=>{const e=[];r1(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const s=r.layout.get("line-join").constantOr("miter")==="none",a=!!r.paint.get("line-pattern").constantOr(1);return s&&a&&e.push("LINE_JOIN_NONE"),e};function r1(r){const e=r.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let yx;const n1=()=>yx||(yx={layout:Kb||(Kb=new Xr({"line-cap":new pt(Se.layout_line["line-cap"]),"line-join":new pt(Se.layout_line["line-join"]),"line-miter-limit":new lt(Se.layout_line["line-miter-limit"]),"line-round-limit":new lt(Se.layout_line["line-round-limit"]),"line-sort-key":new pt(Se.layout_line["line-sort-key"]),"line-z-offset":new pt(Se.layout_line["line-z-offset"]),"line-elevation-reference":new lt(Se.layout_line["line-elevation-reference"]),"line-cross-slope":new lt(Se.layout_line["line-cross-slope"]),visibility:new lt(Se.layout_line.visibility),"line-width-unit":new lt(Se.layout_line["line-width-unit"])})),paint:Yb||(Yb=new Xr({"line-opacity":new pt(Se.paint_line["line-opacity"]),"line-color":new pt(Se.paint_line["line-color"]),"line-translate":new lt(Se.paint_line["line-translate"]),"line-translate-anchor":new lt(Se.paint_line["line-translate-anchor"]),"line-width":new pt(Se.paint_line["line-width"]),"line-gap-width":new pt(Se.paint_line["line-gap-width"]),"line-offset":new pt(Se.paint_line["line-offset"]),"line-blur":new pt(Se.paint_line["line-blur"]),"line-dasharray":new pt(Se.paint_line["line-dasharray"]),"line-pattern":new pt(Se.paint_line["line-pattern"]),"line-pattern-cross-fade":new lt(Se.paint_line["line-pattern-cross-fade"]),"line-gradient":new Sl(Se.paint_line["line-gradient"]),"line-trim-offset":new lt(Se.paint_line["line-trim-offset"]),"line-trim-fade-range":new lt(Se.paint_line["line-trim-fade-range"]),"line-trim-color":new lt(Se.paint_line["line-trim-color"]),"line-emissive-strength":new pt(Se.paint_line["line-emissive-strength"]),"line-border-width":new pt(Se.paint_line["line-border-width"]),"line-border-color":new pt(Se.paint_line["line-border-color"]),"line-occlusion-opacity":new lt(Se.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},yx);class oI extends pt{possiblyEvaluate(e,i){return i=new Mr(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,s,a){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,s,a)}}let dp;function s1(r,e){return e>0?e+2*r:r}const aI=Ii([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),lI=Ii([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),cI=Ii([{name:"a_projected_pos",components:4,type:"Float32"}],4);Ii([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const uI=Ii([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hI=Ii([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),dI=Ii([{name:"a_texb",components:2,type:"Uint16"}]),fI=Ii([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pI=Ii([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);Ii([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const o1=Ii([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),mI=Ii([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Ii([{name:"triangle",components:3,type:"Uint16"}]),Ii([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Ii([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),Ii([{type:"Float32",name:"offsetX"}]),Ii([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var On=24;function _I(r,e,i){return r.sections.forEach(s=>{s.text=function(a,u,h){const p=u.layout.get("text-transform").evaluate(h,{});return p==="uppercase"?a=a.toLocaleUpperCase():p==="lowercase"&&(a=a.toLocaleLowerCase()),ca.applyArabicShaping&&(a=ca.applyArabicShaping(a)),a}(s.text,e,i)}),r}const fp={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function gI(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}function yI(r){return r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""||r===""}const xx=4294967296,a1=1/xx,l1=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let k_=class{constructor(r=new Uint8Array(16)){this.buf=ArrayBuffer.isView(r)?r:new Uint8Array(r),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(r,e,i=this.length){for(;this.pos<i;){const s=this.readVarint(),a=s>>3,u=this.pos;this.type=7&s,r(a,e,this),this.pos===u&&this.skip(s)}return e}readMessage(r,e){return this.readFields(r,e,this.readVarint()+this.pos)}readFixed32(){const r=this.dataView.getUint32(this.pos,!0);return this.pos+=4,r}readSFixed32(){const r=this.dataView.getInt32(this.pos,!0);return this.pos+=4,r}readFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*xx;return this.pos+=8,r}readSFixed64(){const r=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*xx;return this.pos+=8,r}readFloat(){const r=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,r}readDouble(){const r=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,r}readVarint(r){const e=this.buf;let i,s;return s=e[this.pos++],i=127&s,s<128?i:(s=e[this.pos++],i|=(127&s)<<7,s<128?i:(s=e[this.pos++],i|=(127&s)<<14,s<128?i:(s=e[this.pos++],i|=(127&s)<<21,s<128?i:(s=e[this.pos],i|=(15&s)<<28,function(a,u,h){const p=h.buf;let y,v;if(v=p[h.pos++],y=(112&v)>>4,v<128||(v=p[h.pos++],y|=(127&v)<<3,v<128)||(v=p[h.pos++],y|=(127&v)<<10,v<128)||(v=p[h.pos++],y|=(127&v)<<17,v<128)||(v=p[h.pos++],y|=(127&v)<<24,v<128)||(v=p[h.pos++],y|=(1&v)<<31,v<128))return cd(a,y,u);throw new Error("Expected varint not more than 10 bytes")}(i,r,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const r=this.readVarint();return r%2==1?(r+1)/-2:r/2}readBoolean(){return!!this.readVarint()}readString(){const r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&l1?l1.decode(this.buf.subarray(e,r)):function(i,s,a){let u="",h=s;for(;h<a;){const p=i[h];let y,v,w,S=null,A=p>239?4:p>223?3:p>191?2:1;if(h+A>a)break;A===1?p<128&&(S=p):A===2?(y=i[h+1],(192&y)==128&&(S=(31&p)<<6|63&y,S<=127&&(S=null))):A===3?(y=i[h+1],v=i[h+2],(192&y)==128&&(192&v)==128&&(S=(15&p)<<12|(63&y)<<6|63&v,(S<=2047||S>=55296&&S<=57343)&&(S=null))):A===4&&(y=i[h+1],v=i[h+2],w=i[h+3],(192&y)==128&&(192&v)==128&&(192&w)==128&&(S=(15&p)<<18|(63&y)<<12|(63&v)<<6|63&w,(S<=65535||S>=1114112)&&(S=null))),S===null?(S=65533,A=1):S>65535&&(S-=65536,u+=String.fromCharCode(S>>>10&1023|55296),S=56320|1023&S),u+=String.fromCharCode(S),h+=A}return u}(this.buf,e,r)}readBytes(){const r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e}readPackedVarint(r=[],e){const i=this.readPackedEnd();for(;this.pos<i;)r.push(this.readVarint(e));return r}readPackedSVarint(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSVarint());return r}readPackedBoolean(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readBoolean());return r}readPackedFloat(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFloat());return r}readPackedDouble(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readDouble());return r}readPackedFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed32());return r}readPackedSFixed32(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed32());return r}readPackedFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readFixed64());return r}readPackedSFixed64(r=[]){const e=this.readPackedEnd();for(;this.pos<e;)r.push(this.readSFixed64());return r}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(r){const e=7&r;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(r,e){this.writeVarint(r<<3|e)}realloc(r){let e=this.length||16;for(;e<this.pos+r;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeSFixed32(r){this.realloc(4),this.dataView.setInt32(this.pos,r,!0),this.pos+=4}writeFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*a1),!0),this.pos+=8}writeSFixed64(r){this.realloc(8),this.dataView.setInt32(this.pos,-1&r,!0),this.dataView.setInt32(this.pos+4,Math.floor(r*a1),!0),this.pos+=8}writeVarint(r){(r=+r||0)>268435455||r<0?function(e,i){let s,a;if(e>=0?(s=e%4294967296|0,a=e/4294967296|0):(s=~(-e%4294967296),a=~(-e/4294967296),4294967295^s?s=s+1|0:(s=0,a=a+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(u,h,p){p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,u>>>=7,p.buf[p.pos++]=127&u|128,p.buf[p.pos]=127&(u>>>=7)}(s,0,i),function(u,h){const p=(7&u)<<4;h.buf[h.pos++]|=p|((u>>>=3)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u|((u>>>=7)?128:0),u&&(h.buf[h.pos++]=127&u)))))}(a,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))}writeSVarint(r){this.writeVarint(r<0?2*-r-1:2*r)}writeBoolean(r){this.writeVarint(+r)}writeString(r){r=String(r),this.realloc(4*r.length),this.pos++;const e=this.pos;this.pos=function(s,a,u){for(let h,p,y=0;y<a.length;y++){if(h=a.charCodeAt(y),h>55295&&h<57344){if(!p){h>56319||y+1===a.length?(s[u++]=239,s[u++]=191,s[u++]=189):p=h;continue}if(h<56320){s[u++]=239,s[u++]=191,s[u++]=189,p=h;continue}h=p-55296<<10|h-56320|65536,p=null}else p&&(s[u++]=239,s[u++]=191,s[u++]=189,p=null);h<128?s[u++]=h:(h<2048?s[u++]=h>>6|192:(h<65536?s[u++]=h>>12|224:(s[u++]=h>>18|240,s[u++]=h>>12&63|128),s[u++]=h>>6&63|128),s[u++]=63&h|128)}return u}(this.buf,r,this.pos);const i=this.pos-e;i>=128&&c1(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(r){this.realloc(4),this.dataView.setFloat32(this.pos,r,!0),this.pos+=4}writeDouble(r){this.realloc(8),this.dataView.setFloat64(this.pos,r,!0),this.pos+=8}writeBytes(r){const e=r.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=r[i]}writeRawMessage(r,e){this.pos++;const i=this.pos;r(e,this);const s=this.pos-i;s>=128&&c1(i,s,this),this.pos=i-1,this.writeVarint(s),this.pos+=s}writeMessage(r,e,i){this.writeTag(r,2),this.writeRawMessage(e,i)}writePackedVarint(r,e){e.length&&this.writeMessage(r,xI,e)}writePackedSVarint(r,e){e.length&&this.writeMessage(r,vI,e)}writePackedBoolean(r,e){e.length&&this.writeMessage(r,TI,e)}writePackedFloat(r,e){e.length&&this.writeMessage(r,bI,e)}writePackedDouble(r,e){e.length&&this.writeMessage(r,wI,e)}writePackedFixed32(r,e){e.length&&this.writeMessage(r,SI,e)}writePackedSFixed32(r,e){e.length&&this.writeMessage(r,EI,e)}writePackedFixed64(r,e){e.length&&this.writeMessage(r,AI,e)}writePackedSFixed64(r,e){e.length&&this.writeMessage(r,II,e)}writeBytesField(r,e){this.writeTag(r,2),this.writeBytes(e)}writeFixed32Field(r,e){this.writeTag(r,5),this.writeFixed32(e)}writeSFixed32Field(r,e){this.writeTag(r,5),this.writeSFixed32(e)}writeFixed64Field(r,e){this.writeTag(r,1),this.writeFixed64(e)}writeSFixed64Field(r,e){this.writeTag(r,1),this.writeSFixed64(e)}writeVarintField(r,e){this.writeTag(r,0),this.writeVarint(e)}writeSVarintField(r,e){this.writeTag(r,0),this.writeSVarint(e)}writeStringField(r,e){this.writeTag(r,2),this.writeString(e)}writeFloatField(r,e){this.writeTag(r,5),this.writeFloat(e)}writeDoubleField(r,e){this.writeTag(r,1),this.writeDouble(e)}writeBooleanField(r,e){this.writeVarintField(r,+e)}};function cd(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function c1(r,e,i){const s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(s);for(let a=i.pos-1;a>=r;a--)i.buf[a+s]=i.buf[a]}function xI(r,e){for(let i=0;i<r.length;i++)e.writeVarint(r[i])}function vI(r,e){for(let i=0;i<r.length;i++)e.writeSVarint(r[i])}function bI(r,e){for(let i=0;i<r.length;i++)e.writeFloat(r[i])}function wI(r,e){for(let i=0;i<r.length;i++)e.writeDouble(r[i])}function TI(r,e){for(let i=0;i<r.length;i++)e.writeBoolean(r[i])}function SI(r,e){for(let i=0;i<r.length;i++)e.writeFixed32(r[i])}function EI(r,e){for(let i=0;i<r.length;i++)e.writeSFixed32(r[i])}function AI(r,e){for(let i=0;i<r.length;i++)e.writeFixed64(r[i])}function II(r,e){for(let i=0;i<r.length;i++)e.writeSFixed64(r[i])}const vx=3;function CI(r,e,i){e.glyphs=[],r===1&&i.readMessage(PI,e)}function PI(r,e,i){if(r===3){const{id:s,bitmap:a,width:u,height:h,left:p,top:y,advance:v}=i.readMessage(MI,{});e.glyphs.push({id:s,bitmap:new _c({width:u+2*vx,height:h+2*vx},a),metrics:{width:u,height:h,left:p,top:y,advance:v}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function MI(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const u1=vx,Ws={horizontal:1,vertical:2,horizontalOnly:3};class pp{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const s=new pp;return s.scale=e||1,s.fontStack=i,s}static forImage(e){const i=new pp;return i.image=e,i}}class ud{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,s){const a=new ud;for(let u=0;u<e.sections.length;u++){const h=e.sections[u];h.image?a.addImageSection(h,s):a.addTextSection(h,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,s){let a="";for(let u=0;u<i.length;u++){const h=i.charCodeAt(u+1)||null,p=i.charCodeAt(u-1)||null;a+=!s&&(h&&Ah(h)&&!fp[i[u+1]]||p&&Ah(p)&&!fp[i[u-1]])||!fp[i[u]]?i[u]:fp[i[u]]}return a}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&F_[this.text.charCodeAt(s)];s++)e++;let i=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&F_[this.text.charCodeAt(s)];s--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const s=new ud;return s.text=this.text.substring(e,i),s.sectionIndex=this.sectionIndex.slice(e,i),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(pp.forText(e.scale,e.fontStack||i));const s=this.sections.length-1;for(let a=0;a<e.text.length;++a)this.sectionIndex.push(s)}addImageSection(e,i){const s=e.image?e.image.getPrimary():null;if(!s)return void St("Can't add FormattedSection with an empty image.");s.scaleSelf(i);const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(pp.forImage(s)),this.sectionIndex.push(this.sections.length-1)):St("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function bx(r,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O=1){const V=ud.fromFeature(r,a,O);S===Ws.vertical&&V.verticalizePunctuation(A);let N=[];const q=function(le,fe,ge,ze,we,Ne){if(!le)return[];const He=[],qe=function(Xe,Be,ke,Ke,ht,st){let Nt=0;for(let vt=0;vt<Xe.length();vt++){const At=Xe.getSection(vt);Nt+=h1(Xe.getCodePoint(vt),At,Ke,ht,Be,st)}return Nt/Math.max(1,Math.ceil(Nt/ke))}(le,fe,ge,ze,we,Ne),Je=le.text.indexOf("")>=0;let et=0;for(let Xe=0;Xe<le.length();Xe++){const Be=le.getSection(Xe),ke=le.getCodePoint(Xe);if(F_[ke]||(et+=h1(ke,Be,ze,we,fe,Ne)),Xe<le.length()-1){const Ke=!((Ze=ke)<11904||!(Kt["Bopomofo Extended"](Ze)||Kt.Bopomofo(Ze)||Kt["CJK Compatibility Forms"](Ze)||Kt["CJK Compatibility Ideographs"](Ze)||Kt["CJK Compatibility"](Ze)||Kt["CJK Radicals Supplement"](Ze)||Kt["CJK Strokes"](Ze)||Kt["CJK Symbols and Punctuation"](Ze)||Kt["CJK Unified Ideographs Extension A"](Ze)||Kt["CJK Unified Ideographs"](Ze)||Kt["Enclosed CJK Letters and Months"](Ze)||Kt["Halfwidth and Fullwidth Forms"](Ze)||Kt.Hiragana(Ze)||Kt["Ideographic Description Characters"](Ze)||Kt["Kangxi Radicals"](Ze)||Kt["Katakana Phonetic Extensions"](Ze)||Kt.Katakana(Ze)||Kt["Vertical Forms"](Ze)||Kt["Yi Radicals"](Ze)||Kt["Yi Syllables"](Ze)));(RI[ke]||Ke||Be.image)&&He.push(f1(Xe+1,et,qe,He,DI(ke,le.getCodePoint(Xe+1),Ke&&Je),!1))}}var Ze;return p1(f1(le.length(),et,qe,He,0,!0))}(V,v,u,e,s,P),{processBidirectionalText:W,processStyledBidirectionalText:K}=ca;if(W&&V.sections.length===1){const le=W(V.toString(),q);for(const fe of le){const ge=new ud;ge.text=fe,ge.sections=V.sections;for(let ze=0;ze<fe.length;ze++)ge.sectionIndex.push(0);N.push(ge)}}else if(K){const le=K(V.text,V.sectionIndex,q);for(const fe of le){const ge=new ud;ge.text=fe[0],ge.sectionIndex=fe[1],ge.sections=V.sections,N.push(ge)}}else N=function(le,fe){const ge=[],ze=le.text;let we=0;for(const Ne of fe)ge.push(le.substring(we,Ne)),we=Ne;return we<ze.length&&ge.push(le.substring(we,ze.length)),ge}(V,q);const se=[],te={positionedLines:se,text:V.toString(),top:w[1],bottom:w[1],left:w[0],right:w[0],writingMode:S,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(le,fe,ge,ze,we,Ne,He,qe,Je,et,Ze,Xe){let Be=0,ke=0,Ke=0;const ht=qe==="right"?1:qe==="left"?0:.5;let st=!1;for(const at of we){const Ot=at.getSections();for(const li of Ot){if(li.image)continue;const Di=fe[li.fontStack];if(Di&&(st=Di.ascender!==void 0&&Di.descender!==void 0,!st))break}if(!st)break}let Nt=0;for(const at of we){at.trim();const Ot=at.getMaxScale(),li=(Ot-1)*On,Di={positionedGlyphs:[],lineOffset:0};le.positionedLines[Nt]=Di;const ki=Di.positionedGlyphs;let mi=0;if(!at.length()){ke+=Ne,++Nt;continue}let dr=0,ie=0;for(let Ve=0;Ve<at.length();Ve++){const Qe=at.getSection(Ve),_t=at.getSectionIndex(Ve),gt=at.getCodePoint(Ve);let Vt=Qe.scale,Ht=null,fi=null,bi=null,Ti=On,Ci=0,ti=Je;ti===Ws.vertical&&((vt=gt)===12312||vt===12313||vt===12316||vt===12540||vt===12448)&&(ti=Ws.horizontal);const ai=!(ti===Ws.horizontal||!Ze&&!Eh(gt)||Ze&&(F_[gt]||Ih(gt)));if(Qe.image){const Gi=ze.get(Qe.image.toString());if(!Gi)continue;bi=Qe.image,le.iconsInText=le.iconsInText||!0,fi=Gi.paddedRect;const Xi=Gi.displaySize;Vt=Vt*On/Xe,Ht={width:Xi[0],height:Xi[1],left:0,top:-u1,advance:ai?Xi[1]:Xi[0],localGlyph:!1},Ci=st?-Ht.height*Vt:Ot*On-17-Xi[1]*Vt,Ti=Ht.advance;const Ki=(ai?Xi[0]:Xi[1])*Vt-On*Ot;Ki>0&&Ki>mi&&(mi=Ki)}else{const Gi=ge[Qe.fontStack];if(!Gi)continue;Gi[gt]&&(fi=Gi[gt]);const Xi=fe[Qe.fontStack];if(!Xi)continue;const Ki=Xi.glyphs[gt];if(!Ki)continue;if(Ht=Ki.metrics,Ti=gt!==8203?On:0,st){const lr=Xi.ascender!==void 0?Math.abs(Xi.ascender):0,xr=Xi.descender!==void 0?Math.abs(Xi.descender):0,fr=(lr+xr)*Vt;dr<fr&&(dr=fr,ie=(lr-xr)/2*Vt),Ci=-lr*Vt}else Ci=(Ot-Vt)*On-17}ai?(le.verticalizable=!0,ki.push({glyph:gt,image:bi,x:Be,y:ke+Ci,vertical:ai,scale:Vt,localGlyph:Ht.localGlyph,fontStack:Qe.fontStack,sectionIndex:_t,metrics:Ht,rect:fi}),Be+=Ti*Vt+et):(ki.push({glyph:gt,image:bi,x:Be,y:ke+Ci,vertical:ai,scale:Vt,localGlyph:Ht.localGlyph,fontStack:Qe.fontStack,sectionIndex:_t,metrics:Ht,rect:fi}),Be+=Ht.advance*Vt+et)}ki.length!==0&&(Ke=Math.max(Be-et,Ke),st?m1(ki,ht,mi,ie,Ne*Ot/2):m1(ki,ht,mi,0,Ne/2)),Be=0;const oe=Ne*Ot+mi;Di.lineOffset=Math.max(mi,li),ke+=oe,++Nt}var vt;const At=ke,{horizontalAlign:Lt,verticalAlign:Si}=wx(He);(function(at,Ot,li,Di,ki,mi){const dr=(Ot-li)*ki,ie=-mi*Di;for(const oe of at)for(const Ve of oe.positionedGlyphs)Ve.x+=dr,Ve.y+=ie})(le.positionedLines,ht,Lt,Si,Ke,At),le.top+=-Si*At,le.bottom=le.top+At,le.left+=-Lt*Ke,le.right=le.left+Ke,le.hasBaseline=st}(te,e,i,s,N,h,p,y,S,v,A,R),!function(le){for(const fe of le)if(fe.positionedGlyphs.length!==0)return!1;return!0}(se))return te}const F_={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},RI={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function h1(r,e,i,s,a,u){if(e.image){const h=s.get(e.image.toString());return h?h.displaySize[0]*e.scale*On/u+a:0}{const h=i[e.fontStack],p=h&&h.glyphs[r];return p?p.metrics.advance*e.scale+a:0}}function d1(r,e,i,s){const a=Math.pow(r-e,2);return s?r<e?a/2:2*a:a+Math.abs(i)*i}function DI(r,e,i){let s=0;return r===10&&(s-=1e4),i&&(s+=150),r!==40&&r!==65288||(s+=50),e!==41&&e!==65289||(s+=50),s}function f1(r,e,i,s,a,u){let h=null,p=d1(e,i,a,u);for(const y of s){const v=d1(e-y.x,i,a,u)+y.badness;v<=p&&(h=y,p=v)}return{index:r,x:e,priorBreak:h,badness:p}}function p1(r){return r?p1(r.priorBreak).concat(r.index):[]}function wx(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function m1(r,e,i,s,a){if(!(e||i||s||a))return;const u=r.length-1,h=r[u],p=(h.x+h.metrics.advance*h.scale)*e;for(let y=0;y<=u;y++)r[y].x-=p,r[y].y+=i+s+a}function Tx(r){return r.imagePrimary!==void 0&&r.top!==void 0&&r.bottom!==void 0&&r.left!==void 0&&r.right!==void 0}function B_(r,e,i,s){const{horizontalAlign:a,verticalAlign:u}=wx(s),h=i[0]-r.displaySize[0]*a,p=i[1]-r.displaySize[1]*u;return{imagePrimary:r,imageSecondary:e,top:p,bottom:p+r.displaySize[1],left:h,right:h+r.displaySize[0]}}function Sx(r,e,i,s,a,u){const h=r.imagePrimary;let p;if(h.content){const V=h.content,N=h.pixelRatio||1;p=[V[0]/N,V[1]/N,h.displaySize[0]-V[2]/N,h.displaySize[1]-V[3]/N]}const y=e.left*u,v=e.right*u;let w,S,A,P;i==="width"||i==="both"?(P=a[0]+y-s[3],S=a[0]+v+s[1]):(P=a[0]+(y+v-h.displaySize[0])/2,S=P+h.displaySize[0]);const R=e.top*u,O=e.bottom*u;return i==="height"||i==="both"?(w=a[1]+R-s[0],A=a[1]+O+s[2]):(w=a[1]+(R+O-h.displaySize[1])/2,A=w+h.displaySize[1]),{imagePrimary:h,imageSecondary:void 0,top:w,right:S,bottom:A,left:P,collisionPadding:p}}function _1(r){return!r.imagePrimary.stretchX}function g1(r){return!r.imagePrimary.stretchY}function y1(r){return{width:r.right-r.left,height:r.bottom-r.top}}const xa=128;function hd(r,e,i){const{expression:s}=e;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Mr(r+1,{worldview:i}))};if(s.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:u}=s;let h=0;for(;h<a.length&&a[h]<=r;)h++;h=Math.max(0,h-1);let p=h;for(;p<a.length&&a[p]<r+1;)p++;p=Math.min(a.length-1,p);const y=a[h],v=a[p];return s.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:v,interpolationType:u}:{kind:"camera",minZoom:y,maxZoom:v,minSize:s.evaluate(new Mr(y,{worldview:i})),maxSize:s.evaluate(new Mr(v,{worldview:i})),interpolationType:u}}}function Ex(r,{uSize:e,uSizeT:i},{lowerSize:s,upperSize:a}){return r.kind==="source"?s/xa:r.kind==="composite"?ii(s/xa,a/xa,i):e}function dd(r,e,i=1){let s=0,a=0;if(r.kind==="constant")a=r.layoutSize*i;else if(r.kind!=="source"){const{interpolationType:u,minZoom:h,maxZoom:p}=r,y=u?U(js.interpolationFactor(u,e,h,p),0,1):0;r.kind==="camera"?a=ii(r.minSize,r.maxSize,y)*i:s=y*i}return{uSizeT:s,uSize:a}}class Dl extends Ye{constructor(e,i,s,a,u){super(e,i),this.angle=a,this.z=s,u!==void 0&&(this.segment=u)}clone(){return new Dl(this.x,this.y,this.z,this.angle,this.segment)}}function x1(r,e,i,s,a){if(e.segment===void 0)return!0;let u=e,h=e.segment+1,p=0;for(;p>-i/2;){if(h--,h<0)return!1;p-=r[h].dist(u),u=r[h]}p+=r[h].dist(r[h+1]),h++;const y=[];let v=0;for(;p<i/2;){const w=r[h],S=r[h+1];if(!S)return!1;let A=r[h-1].angleTo(w)-w.angleTo(S);for(A=Math.abs((A+3*Math.PI)%(2*Math.PI)-Math.PI),y.push({distance:p,angleDelta:A}),v+=A;p-y[0].distance>s;)v-=y.shift().angleDelta;if(v>a)return!1;h++,p+=w.dist(S)}return!0}function v1(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function b1(r,e,i){return r?.6*e*i:0}function w1(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function LI(r,e,i,s,a,u){const h=b1(i,a,u),p=w1(i,s)*u;let y=0;const v=v1(r)/2;for(let w=0;w<r.length-1;w++){const S=r[w],A=r[w+1],P=S.dist(A);if(y+P>v){const R=(v-y)/P,O=ii(S.x,A.x,R),V=ii(S.y,A.y,R),N=new Dl(O,V,0,A.angleTo(S),w);return!h||x1(r,N,p,h,e)?N:void 0}y+=P}}function zI(r,e,i,s,a,u,h,p,y){const v=b1(s,u,h),w=w1(s,a),S=w*h,A=r[0].x===0||r[0].x===y||r[0].y===0||r[0].y===y;return e-S<e/4&&(e=S+e/4),T1(r,A?e/2*p%e:(w/2+2*u)*h*p%e,e,v,i,S,A,!1,y)}function T1(r,e,i,s,a,u,h,p,y){const v=u/2,w=v1(r);let S=0,A=e-i,P=[];for(let R=0;R<r.length-1;R++){const O=r[R],V=r[R+1],N=O.dist(V),q=V.angleTo(O);for(;A+i<S+N;){A+=i;const W=(A-S)/N,K=ii(O.x,V.x,W),se=ii(O.y,V.y,W);if(K>=0&&K<y&&se>=0&&se<y&&A-v>=0&&A+v<=w){const te=new Dl(K,se,0,q,R);s&&!x1(r,te,u,s,a)||P.push(te)}}S+=N}return p||P.length||h||(P=T1(r,S/2,i,s,a,u,h,!0,y)),P}function S1(r){let e=0,i=0;for(const h of r)e+=h.w*h.h,i=Math.max(i,h.w);r.sort((h,p)=>p.h-h.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let a=0,u=0;for(const h of r)for(let p=s.length-1;p>=0;p--){const y=s[p];if(!(h.w>y.w||h.h>y.h)){if(h.x=y.x,h.y=y.y,u=Math.max(u,h.y+h.h),a=Math.max(a,h.x+h.w),h.w===y.w&&h.h===y.h){const v=s.pop();v&&p<s.length&&(s[p]=v)}else h.h===y.h?(y.x+=h.w,y.w-=h.w):h.w===y.w?(y.y+=h.h,y.h-=h.h):(s.push({x:y.x+h.w,y:y.y,w:y.w-h.w,h:h.h}),y.y+=h.h,y.h-=h.h);break}}return{w:a,h:u,fill:e/(a*u)||0}}Mt(Dl,"Anchor");const Su=1;class mp{static getImagePositionScale(e,i,s){if(i&&e){const{sx:a,sy:u}=e;return{x:a,y:u}}return{x:s,y:s}}constructor(e,i,s,a){this.paddedRect=e;const{pixelRatio:u,version:h,stretchX:p,stretchY:y,content:v,sdf:w,usvg:S}=i;this.pixelRatio=u,this.stretchX=p,this.stretchY=y,this.content=v,this.version=h,this.padding=s,this.sdf=w,this.usvg=S,this.scale=mp.getImagePositionScale(a,S,u)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Ax(r,e,i){const s=ia.parse(r),a=function(u,h,p=[1,1]){return{x:0,y:0,w:(u.data?u.data.width:u.width*p[0])+2*h,h:(u.data?u.data.height:u.height*p[1])+2*h}}(e,i,[s.sx,s.sy]);return{bin:a,imagePosition:new mp(a,e,i,s),imageVariant:s}}class E1{constructor(e,i,s){const a=new Map,u=new Map;this.haveRenderCallbacks=[];const h=[];this.addImages(e,a,Su,h),this.addImages(i,u,2,h);const{w:p,h:y}=S1(h),v=new as({width:p||1,height:y||1});for(const[w,S]of e.entries()){const A=a.get(w).paddedRect;as.copy(S.data,v,{x:0,y:0},{x:A.x+Su,y:A.y+Su},S.data,null,S.sdf)}for(const[w,S]of i.entries()){const A=u.get(w),P=A.paddedRect;let R=A.padding;const O=P.x+R,V=P.y+R,N=S.data.width,q=S.data.height;R=R>1?R-1:R,as.copy(S.data,v,{x:0,y:0},{x:O,y:V},S.data,s),as.copy(S.data,v,{x:0,y:q-R},{x:O,y:V-R},{width:N,height:R},s),as.copy(S.data,v,{x:0,y:0},{x:O,y:V+q},{width:N,height:R},s),as.copy(S.data,v,{x:N-R,y:0},{x:O-R,y:V},{width:R,height:q},s),as.copy(S.data,v,{x:0,y:0},{x:O+N,y:V},{width:R,height:q},s),as.copy(S.data,v,{x:N-R,y:q-R},{x:O-R,y:V-R},{width:R,height:R},s),as.copy(S.data,v,{x:0,y:q-R},{x:O+N,y:V-R},{width:R,height:R},s),as.copy(S.data,v,{x:0,y:0},{x:O+N,y:V+q},{width:R,height:R},s),as.copy(S.data,v,{x:N-R,y:0},{x:O-R,y:V+q},{width:R,height:R},s)}this.lut=s,this.image=v,this.iconPositions=a,this.patternPositions=u}addImages(e,i,s,a){for(const[u,h]of e.entries()){const{bin:p,imagePosition:y,imageVariant:v}=Ax(u,h,s);i.set(u,y),a.push(p),h.hasRenderCallback&&this.haveRenderCallbacks.push(v.id)}}patchUpdatedImages(e,i,s){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(a=>e.hasImage(a,s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,s);for(const a of e.getUpdatedImages(s)){for(const u of this.iconPositions.keys()){const h=ia.parse(u);if(ds.isEqual(h.id,a)){const p=e.getImage(a,s);this.patchUpdatedImage(this.iconPositions.get(u),p,i,null)}}for(const u of this.patternPositions.keys()){const h=ia.parse(u);if(ds.isEqual(h.id,a)){const p=e.getImage(a,s);this.patchUpdatedImage(this.patternPositions.get(u),p,i,this.lut)}}}}patchUpdatedImage(e,i,s,a=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[u,h]=e.tl,p=e.sdf;if(this.lut||p){const y={width:i.data.width,height:i.data.height},v=new as(y);as.copy(i.data,v,{x:0,y:0},{x:0,y:0},y,a,p),s.update(v,{position:{x:u,y:h}})}else s.update(i.data,{position:{x:u,y:h}})}}Mt(mp,"ImagePosition"),Mt(E1,"ImageAtlas");const _p=1e20;function A1(r,e,i,s,a,u,h,p,y){for(let v=e;v<e+s;v++)I1(r,i*u+v,u,a,h,p,y);for(let v=i;v<i+a;v++)I1(r,v*u+e,1,s,h,p,y)}function I1(r,e,i,s,a,u,h){u[0]=0,h[0]=-_p,h[1]=_p,a[0]=r[e];for(let p=1,y=0,v=0;p<s;p++){a[p]=r[e+p*i];const w=p*p;do{const S=u[y];v=(a[p]-a[S]+w-S*S)/(p-S)/2}while(v<=h[y]&&--y>-1);y++,u[y]=p,h[y]=v,h[y+1]=_p}for(let p=0,y=0;p<s;p++){for(;h[y+1]<p;)y++;const v=u[y],w=p-v;r[e+p*i]=a[v]+w*w}}const va=2,Ix={none:0,ideographs:1,all:2};class fd{constructor(e,i,s){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=s,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const s=[],a=this.url||Mi.GLYPHS_URL;for(const u in e)for(const h of e[u])s.push({stack:u,id:h});me(s,({stack:u,id:h},p)=>{let y=this.entries[u];y||(y=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let v=y.glyphs[h];if(v!==void 0)return void p(null,{stack:u,id:h,glyph:v});if(v=this._tinySDF(y,u,h),v)return y.glyphs[h]=v,void p(null,{stack:u,id:h,glyph:v});const w=Math.floor(h/256);if(256*w>65535)return St("glyphs > 65535 not supported"),void p(null,{stack:u,id:h,glyph:v});if(y.ranges[w])return void p(null,{stack:u,id:h,glyph:v});let S=y.requests[w];S||(S=y.requests[w]=[],fd.loadGlyphRange(u,w,a,this.requestManager,(A,P)=>{if(P){y.ascender=P.ascender,y.descender=P.descender;for(const R in P.glyphs)this._doesCharSupportLocalGlyph(+R)||(y.glyphs[+R]=P.glyphs[+R]);y.ranges[w]=!0}for(const R of S)R(A,P);delete y.requests[w]})),S.push((A,P)=>{A?p(A):P&&p(null,{stack:u,id:h,glyph:P.glyphs[h]||null})})},(u,h)=>{if(u)i(u);else if(h){const p={};for(const{stack:y,id:v,glyph:w}of h)p[y]===void 0&&(p[y]={}),p[y].glyphs===void 0&&(p[y].glyphs={}),p[y].glyphs[v]=w&&{id:w.id,bitmap:w.bitmap.clone(),metrics:w.metrics},p[y].ascender=this.entries[y].ascender,p[y].descender=this.entries[y].descender;i(null,p)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ix.none&&(this.localGlyphMode===Ix.all?!!this.localFontFamily:!!this.localFontFamily&&(Kt["CJK Unified Ideographs"](e)||Kt["Hangul Syllables"](e)||Kt.Hiragana(e)||Kt.Katakana(e)||Kt["CJK Symbols and Punctuation"](e)||Kt["CJK Unified Ideographs Extension A"](e)||Kt["CJK Unified Ideographs Extension B"](e)||Kt.Osage(e)))}_tinySDF(e,i,s){const a=this.localFontFamily;if(!a||!this._doesCharSupportLocalGlyph(s))return;let u=e.tinySDF;if(!u){let O="400";/bold/i.test(i)?O="900":/medium/i.test(i)?O="500":/light/i.test(i)&&(O="200"),u=e.tinySDF=new fd.TinySDF({fontFamily:a,fontWeight:O,fontSize:24*va,buffer:3*va,radius:8*va}),u.fontWeight=O}if(this.localGlyphs[u.fontWeight][s])return this.localGlyphs[u.fontWeight][s];const h=String.fromCodePoint(s),{data:p,width:y,height:v,glyphWidth:w,glyphHeight:S,glyphLeft:A,glyphTop:P,glyphAdvance:R}=u.draw(h);return this.localGlyphs[u.fontWeight][s]={id:s,bitmap:new _c({width:y,height:v},p),metrics:{width:w/va,height:S/va,left:A/va,top:P/va-27,advance:R/va,localGlyph:!0}}}}fd.loadGlyphRange=function(r,e,i,s,a){const u=256*e,h=u+255,p=s.transformRequest(s.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${u}-${h}`),Oc.Glyphs);ta(p,(y,v)=>{if(y)a(y);else if(v){const w={},S=function(A){return new k_(A).readFields(CI,{})}(v);for(const A of S.glyphs)w[A.id]=A;a(null,{glyphs:w,ascender:S.ascender,descender:S.descender})}})},fd.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:s=.25,fontFamily:a="sans-serif",fontWeight:u="normal",fontStyle:h="normal",lang:p=null}={}){this.buffer=e,this.cutoff=s,this.radius=i,this.lang=p;const y=this.size=r+4*e,v=this._createCanvas(y),w=this.ctx=v.getContext("2d",{willReadFrequently:!0});w.font=`${h} ${u} ${r}px ${a}`,w.textBaseline="alphabetic",w.textAlign="left",w.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:s,actualBoundingBoxLeft:a,actualBoundingBoxRight:u}=this.ctx.measureText(r),h=Math.ceil(i),p=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(u-a))),y=Math.min(this.size-this.buffer,h+Math.ceil(s)),v=p+2*this.buffer,w=y+2*this.buffer,S=Math.max(v*w,0),A=new Uint8ClampedArray(S),P={data:A,width:v,height:w,glyphWidth:p,glyphHeight:y,glyphTop:h,glyphLeft:0,glyphAdvance:e};if(p===0||y===0)return P;const{ctx:R,buffer:O,gridInner:V,gridOuter:N}=this;this.lang&&(R.lang=this.lang),R.clearRect(O,O,p,y),R.fillText(r,O,O+h);const q=R.getImageData(O,O,p,y);N.fill(_p,0,S),V.fill(0,0,S);for(let W=0;W<y;W++)for(let K=0;K<p;K++){const se=q.data[4*(W*p+K)+3]/255;if(se===0)continue;const te=(W+O)*v+K+O;if(se===1)N[te]=0,V[te]=_p;else{const le=.5-se;N[te]=le>0?le*le:0,V[te]=le<0?le*le:0}}A1(N,0,0,v,w,v,this.f,this.v,this.z),A1(V,O,O,p,y,v,this.f,this.v,this.z);for(let W=0;W<S;W++){const K=Math.sqrt(N[W])-Math.sqrt(V[W]);A[W]=Math.round(255-255*(K/this.radius+this.cutoff))}return P}};const Ka=Su;function C1(r,e){return r+e[1]-e[0]}function Cx(r,e,i,s,a=1){const u=[],h=r.imagePrimary,p=h.pixelRatio,y=h.paddedRect.w-2*Ka,v=h.paddedRect.h-2*Ka,w=(r.right-r.left)*a,S=(r.bottom-r.top)*a,A=h.stretchX||[[0,y]],P=h.stretchY||[[0,v]],R=A.reduce(C1,0),O=P.reduce(C1,0),V=y-R,N=v-O;let q=0,W=R,K=0,se=O,te=0,le=V,fe=0,ge=N;if(h.content&&s){const we=h.content;q=N_(A,0,we[0]),K=N_(P,0,we[1]),W=N_(A,we[0],we[2]),se=N_(P,we[1],we[3]),te=we[0]-q,fe=we[1]-K,le=we[2]-we[0]-W,ge=we[3]-we[1]-se}const ze=(we,Ne,He,qe)=>{const Je=V_(we.stretch-q,W,w,r.left*a),et=U_(we.fixed-te,le,we.stretch,R),Ze=V_(Ne.stretch-K,se,S,r.top*a),Xe=U_(Ne.fixed-fe,ge,Ne.stretch,O),Be=V_(He.stretch-q,W,w,r.left*a),ke=U_(He.fixed-te,le,He.stretch,R),Ke=V_(qe.stretch-K,se,S,r.top*a),ht=U_(qe.fixed-fe,ge,qe.stretch,O),st=new Ye(Je,Ze),Nt=new Ye(Be,Ze),vt=new Ye(Be,Ke),At=new Ye(Je,Ke),Lt=new Ye(et/p,Xe/p),Si=new Ye(ke/p,ht/p),at=e*Math.PI/180;if(at){const dr=Math.sin(at),ie=Math.cos(at),oe=[ie,-dr,dr,ie];st._matMult(oe),Nt._matMult(oe),At._matMult(oe),vt._matMult(oe)}const Ot=we.stretch+we.fixed,li=He.stretch+He.fixed,Di=Ne.stretch+Ne.fixed,ki=qe.stretch+qe.fixed,mi=r.imageSecondary;return{tl:st,tr:Nt,bl:At,br:vt,texPrimary:{x:h.paddedRect.x+Ka+Ot,y:h.paddedRect.y+Ka+Di,w:li-Ot,h:ki-Di},texSecondary:mi?{x:mi.paddedRect.x+Ka+Ot,y:mi.paddedRect.y+Ka+Di,w:li-Ot,h:ki-Di}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Lt,pixelOffsetBR:Si,minFontScaleX:le/p/w,minFontScaleY:ge/p/S,isSDF:i}};if(s&&(h.stretchX||h.stretchY)){const we=P1(A,V,R),Ne=P1(P,N,O);for(let He=0;He<we.length-1;He++){const qe=we[He],Je=we[He+1];for(let et=0;et<Ne.length-1;et++)u.push(ze(qe,Ne[et],Je,Ne[et+1]))}}else u.push(ze({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:v+1}));return u}function OI(r,e){const i=r.stretchY||[[0,r.paddedRect.h-2*Ka]];return e&&(r.stretchX||r.stretchY)?M1(r.stretchX||[[0,r.paddedRect.w-2*Ka]])*M1(i):1}function N_(r,e,i){let s=0;for(const a of r)s+=Math.max(e,Math.min(i,a[1]))-Math.max(e,Math.min(i,a[0]));return s}function P1(r,e,i){const s=[{fixed:-Ka,stretch:0}];for(const[a,u]of r){const h=s[s.length-1];s.push({fixed:a-h.stretch,stretch:h.stretch}),s.push({fixed:a-h.stretch,stretch:h.stretch+(u-a)})}return s.push({fixed:e+Ka,stretch:i}),s}function M1(r){return 2*r.length+1}function V_(r,e,i,s){return r/e*i+s}function U_(r,e,i,s){return r-e*i/s}function kI(r,e,i,s){const a=e+r.positionedLines[s].lineOffset;return s===0?i+a/2:i+(a+(e+r.positionedLines[s-1].lineOffset))/2}function FI(r,e=1,i=!1){let s=1/0,a=1/0,u=-1/0,h=-1/0;const p=r[0];for(let P=0;P<p.length;P++){const R=p[P];(!P||R.x<s)&&(s=R.x),(!P||R.y<a)&&(a=R.y),(!P||R.x>u)&&(u=R.x),(!P||R.y>h)&&(h=R.y)}const y=Math.min(u-s,h-a);let v=y/2;const w=new rh([],BI);if(y===0)return new Ye(s,a);for(let P=s;P<u;P+=y)for(let R=a;R<h;R+=y)w.push(new pd(P+v,R+v,v,r));let S=function(P){let R=0,O=0,V=0;const N=P[0];for(let q=0,W=N.length,K=W-1;q<W;K=q++){const se=N[q],te=N[K],le=se.x*te.y-te.x*se.y;O+=(se.x+te.x)*le,V+=(se.y+te.y)*le,R+=3*le}return new pd(O/R,V/R,0,P)}(r),A=w.length;for(;w.length;){const P=w.pop();(P.d>S.d||!S.d)&&(S=P,i&&console.log("found best %d after %d probes",Math.round(1e4*P.d)/1e4,A)),P.max-S.d<=e||(v=P.h/2,w.push(new pd(P.p.x-v,P.p.y-v,v,r)),w.push(new pd(P.p.x+v,P.p.y-v,v,r)),w.push(new pd(P.p.x-v,P.p.y+v,v,r)),w.push(new pd(P.p.x+v,P.p.y+v,v,r)),A+=4)}return i&&(console.log(`num probes: ${A}`),console.log(`best distance: ${S.d}`)),S.p}function BI(r,e){return e.max-r.max}class pd{constructor(e,i,s,a){this.p=new Ye(e,i),this.h=s,this.d=function(u,h){let p=!1,y=1/0;for(let v=0;v<h.length;v++){const w=h[v];for(let S=0,A=w.length,P=A-1;S<A;P=S++){const R=w[S],O=w[P];R.y>u.y!=O.y>u.y&&u.x<(O.x-R.x)*(u.y-R.y)/(O.y-R.y)+R.x&&(p=!p),y=Math.min(y,en(u,R,O))}}return(p?1:-1)*Math.sqrt(y)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}}const NI=Object.keys,Px=Number.POSITIVE_INFINITY,VI=Math.sqrt(2);function yc(r,e,i,s,a){const u=Tx(r)&&r.collisionPadding?r.collisionPadding:[0,0,0,0],h={top:r.top-u[1],bottom:r.bottom+u[3],left:r.left-u[0],right:r.right+u[2],scaled:!1};return s!==void 0&&function(p,y){p.top*=y,p.bottom*=y,p.left*=y,p.right*=y,p.scaled=!0}(h,s),i&&function(p,y){if(!y)return;const v=Wi(y),w=new Ye(p.left,p.top),S=new Ye(p.right,p.top),A=new Ye(p.left,p.bottom),P=new Ye(p.right,p.bottom),R=new Ye(0,0);w._rotateAround(v,R),S._rotateAround(v,R),A._rotateAround(v,R),P._rotateAround(v,R),p.left=Math.min(w.x,S.x,A.x,P.x),p.right=Math.max(w.x,S.x,A.x,P.x),p.top=Math.min(w.y,S.y,A.y,P.y),p.bottom=Math.max(w.y,S.y,A.y,P.y)}(h,i),a&&(h.left+=a[0],h.right+=a[0],h.top+=a[1],h.bottom+=a[1]),e?{top:Math.min(e.top,h.top),bottom:Math.max(e.bottom,h.bottom),left:Math.min(e.left,h.left),right:Math.max(e.right,h.right),scaled:e.scaled||h.scaled}:h}function R1(r,[e,i]){let s=0,a=0;if(i===Px){e<0&&(e=0);const u=e/VI;switch(r){case"top-right":case"top-left":a=u-7;break;case"bottom-right":case"bottom-left":a=7-u;break;case"bottom":a=7-e;break;case"top":a=e-7}switch(r){case"top-right":case"bottom-right":s=-u;break;case"top-left":case"bottom-left":s=u;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":a=i-7;break;case"bottom-right":case"bottom-left":case"bottom":a=7-i}switch(r){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,a]}function UI(r,e,i,s,a,u,h,p,y,v,w,S,A,P){const R=r.layers[0],O=R.appearances;if(O.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const V={iconBBox:null,iconVerticalBBox:null},N={textBBox:null,textVerticalBBox:null},{baseIconRotate:q,baseTextRotate:W,iconScaleFactor:K}=function(te,le,fe){const ge=te.get("icon-rotate").evaluate(le,{},fe),ze=te.get("text-rotate").evaluate(le,{},fe),[we,Ne]=te.get("icon-size-scale-range");return{baseIconRotate:ge,baseTextRotate:ze,iconScaleFactor:U(1,we,Ne)}}(s,a,u);e&&(V.iconBBox=yc(e,V.iconBBox,q,h),i)&&(V.iconVerticalBBox=yc(i,V.iconVerticalBBox,q+90,h));const se=G_(S.horizontal);se&&(N.textBBox=yc(se,N.textBBox,W,1,P)),S.vertical&&(N.textVerticalBBox=yc(S.vertical,N.textVerticalBBox,W+90,1,P));for(const te of O)te.hasIconProperties()&&jI(V,r,R,te,a,u,p,q,h,y,e,v,K,w),te.hasTextProperties()&&GI(N,R,te,a,u,P,W,A,se,S.vertical);return{iconBBox:V.iconBBox,iconVerticalBBox:V.iconVerticalBBox,textBBox:N.textBBox,textVerticalBBox:N.textVerticalBBox}}function jI(r,e,i,s,a,u,h,p,y,v,w,S,A,P){const{appearanceIconOffset:R,appearanceIconRotate:O,appearanceIconSize:V}=function(K,se,te,le,fe,ge,ze,we){const Ne=K.hasProperty("icon-offset")?se.getAppearanceValueAndResolveTokens(K,"icon-offset",te,le,[]):null,He=Ne&&Array.isArray(Ne)?Ne:fe,qe=K.hasProperty("icon-rotate")?se.getAppearanceValueAndResolveTokens(K,"icon-rotate",te,le,[]):null,Je=typeof qe=="number"?qe:ge,et=K.hasProperty("icon-size")?se.getAppearanceValueAndResolveTokens(K,"icon-size",te,le,[]):null;return{appearanceIconOffset:He,appearanceIconRotate:Je,appearanceIconSize:typeof et=="number"?et*we.iconScaleFactor:ze}}(s,i,a,u,h,p,y,v);let N=null,q=null,W=null;s.hasProperty("icon-image")?W=function(K,se,te,le,fe,ge,ze){let we=null;const Ne=se.getAppearanceValueAndResolveTokens(te,"icon-image",le,fe,[]);if(Ne){const He=K.getResolvedImageFromTokens(Ne),qe=te.getUnevaluatedProperty("icon-size"),Je=gp(He,hd(K.zoom,qe,K.worldview),qe,fe,K.zoom,le,K.pixelRatio,ze,K.worldview);we=ge.get(Je.iconPrimary.toString())}return we}(e,i,s,a,u,S,A):w&&(W=w.imagePrimary),W&&(N=B_(W,null,R,P),e.allowVerticalPlacement&&(q=B_(W,null,R,P))),N&&(r.iconBBox=yc(N,r.iconBBox,O,V)),q&&(r.iconVerticalBBox=yc(q,r.iconVerticalBBox,O+90,V))}function GI(r,e,i,s,a,u,h,p,y,v){const{appearanceTextOffset:w,appearanceTextRotate:S,appearanceTextSize:A}=function(R,O,V,N,q,W,K){const se=R.hasProperty("text-offset")?O.getAppearanceValueAndResolveTokens(R,"text-offset",V,N,[]):null,te=se&&Array.isArray(se)?[se[0]*On,se[1]*On]:q,le=R.hasProperty("text-rotate")?O.getAppearanceValueAndResolveTokens(R,"text-rotate",V,N,[]):null,fe=typeof le=="number"?le:W,ge=R.hasProperty("text-size")?O.getAppearanceValueAndResolveTokens(R,"text-size",V,N,[]):null;return{appearanceTextOffset:te,appearanceTextRotate:fe,appearanceTextSize:typeof ge=="number"?ge:K}}(i,e,s,a,u,h,p),P=A/p;y&&(r.textBBox=yc(y,r.textBBox,S,P,w)),v&&(r.textVerticalBBox=yc(v,r.textVerticalBBox,S+90,P,w))}function j_(r,e,i,s,a,u,h,p,y){if(!e||!e.usvg)return;const v=y1(s),w=y1(a),S=u!=="both"&&u!=="width"||!_1(s)?1:w.width/v.width,A=u!=="both"&&u!=="height"||!g1(s)?1:w.height/v.height;i.scaleSelf(S,A);const P=i.toString();h.set(P,i),p.set(P,e);const{imagePosition:R}=Ax(P,e,Su);y.set(P,R)}function D1(r,e,i,s,a,u,h,p,y){if(!r)return;const v=function(w,S,A,P,R,O){if(w.kind==="camera")return w.maxSize;if(w.kind==="composite"){const V=S.possiblyEvaluate(new Mr(w.maxZoom,{worldview:O}),A).evaluate(R,{},A),N=S.possiblyEvaluate(new Mr(w.minZoom,{worldview:O}),A).evaluate(R,{},A);return Math.max(V,N)}return S.possiblyEvaluate(new Mr(P,{worldview:O})).evaluate(R,{},A)}(e,i,s,a,u,y);return r.scaleSelf(v*p*h)}function gp(r,e,i,s,a,u,h,p,y){return{iconPrimary:D1(r.getPrimary(),e,i,s,a,u,h,p,y),iconSecondary:D1(r.getSecondary(),e,i,s,a,u,h,p,y)}}function HI(r,e,i){if(!e)return;const s=i.get(r.toString()),a=i.get(e.toString());s&&a&&(s.paddedRect.w===a.paddedRect.w&&s.paddedRect.h===a.paddedRect.h||St(`Mismatch in icon variant sizes: ${r.toString()} and ${e.toString()}`),s.usvg!==a.usvg&&St(`Mismatch in icon variant image types: ${r.id} and ${e.id}`))}function L1(r,e,i,s){if(!r)return;const a=e.get(i.toString());if(r.imagePrimary=a,s){const u=e.get(s.toString());r.imageSecondary=u}}function qI(r,e){for(const i in r.horizontal)z1(r.horizontal[i],e);z1(r.vertical,e)}function z1(r,e){if(r){for(const i of r.positionedLines)for(const s of i.positionedGlyphs)if(s.image!==null){const a=s.image.toString();s.rect=e.get(a).paddedRect}}}function Mx(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $I(r,e,i,s,a,u,h,p,y){const v=G_(u.horizontal)||u.vertical,w=i.get("icon-text-fit-padding").evaluate(s,{},a);let S,A=e;return e&&y!=="none"&&(r.allowVerticalPlacement&&u.vertical&&(S=Sx(e,u.vertical,y,w,p,h)),v&&(A=Sx(e,v,y,w,p,h))),{defaultShapedIcon:A,verticallyShapedIcon:S}}function WI(r,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q,W,K,se,te,le){let fe=h.textMaxSize.evaluate(e,{},A);fe===void 0?fe=p*h.textScaleFactor:fe*=h.textScaleFactor;const ge=r.layers[0].layout,ze=On,we=p*h.textScaleFactor/ze,Ne=G_(i.horizontal)||i.vertical;if(V!=="none"&&r.appearanceFeatureData&&e.index<r.appearanceFeatureData.length){const vt=r.appearanceFeatureData[e.index];vt&&(vt.textShaping=Ne,vt.iconTextFitPadding=ge.get("icon-text-fit-padding").evaluate(e,{},A),vt.fontScale=we)}const He=P.name==="globe",qe=r.tilePixelRatio*fe/ze,Je=(Ke=r.overscaling,r.zoom>18&&Ke>2&&(Ke>>=1),Math.max(ut/(512*Ke),1)*ge.get("symbol-spacing")),et=ge.get("text-padding")*r.tilePixelRatio,Ze=ge.get("icon-padding")*r.tilePixelRatio,Xe=Wi(ge.get("text-max-angle")),Be=ge.get("icon-rotation-alignment")==="map"&&W!=="point",ke=Je/2;var Ke;r.hasAnyIconTextFit===!1&&V!=="none"&&(r.hasAnyIconTextFit=!0);const ht=e.properties?+e.properties[Fe]:null,st=ht&&r.elevationFeatureIdToIndex?r.elevationFeatureIdToIndex.get(ht):65535,Nt=(vt,At,Lt)=>{if(At.x<0||At.x>=ut||At.y<0||At.y>=ut)return;let Si=null;if(He){const{x:at,y:Ot,z:li}=P.projectTilePoint(At.x,At.y,Lt);Si={anchor:new Dl(at,Ot,li,0,void 0),up:P.upVector(Lt,At.x,At.y)}}(function(at,Ot,li,Di,ki,mi,dr,ie,oe,Ve,Qe,_t,gt,Vt,Ht,fi,bi,Ti,Ci,ti,ai,Gi,Xi,Ki,lr,xr,fr,Ji,rr,wi,zi,Br,Qt){const Pi=at.addToLineVertexArray(Ot,Di);let _r,wr,Rr,sn,Er,ei,jr,cr=0,kr=0,En=0,kn=0,_n=-1,gn=-1;const Mn={};let Cs=qu("");const Ar=li?li.anchor:Ot,tn=Ji!=="none";let on=0,zs=0;if(oe._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Yn=oe.layout.get("text-offset").evaluate(ai,{},lr);on=Yn[0]*On,zs=Yn[1]*On}else on=oe.layout.get("text-radial-offset").evaluate(ai,{},lr)*On,zs=Px;if(at.allowVerticalPlacement&&ki.vertical){const Yn=ki.vertical;if(Ht)ei=Rx(Yn),ie&&(jr=Rx(ie));else{const bs=oe.layout.get("text-rotate").evaluate(ai,{},lr)+90;Rr=H_(Ve,Ar,Ot,Qe,_t,gt,Yn,Vt,bs,fi,Br),ie&&(sn=H_(Ve,Ar,Ot,Qe,_t,gt,ie,Ti,bs,null,zi))}}if(mi){const Yn=at.iconSizeData,bs=oe.layout.get("icon-rotate").evaluate(ai,{},lr),Zs=Cx(mi,bs,Xi,tn,Gi.iconScaleFactor),bc=ie?Cx(ie,bs,Xi,tn,Gi.iconScaleFactor):void 0;wr=H_(Ve,Ar,Ot,Qe,_t,gt,mi,Ti,bs,null,wi);const bd=function(Sa,Op,Qw,sP,eT,tT,oP,aP){const iT=Sa.layers[0],rT=iT.appearances;let wd=Op.length;if(Qw&&(wd=Math.max(wd,Qw.length)),rT.length===0)return wd;const[lP,cP]=sP.get("icon-size-scale-range"),uP=U(1,lP,cP);for(const nT of rT){const sT=nT.getUnevaluatedProperties();if(sT._values["icon-image"].value!==void 0){const oT=iT.getAppearanceValueAndResolveTokens(nT,"icon-image",eT,tT,[]);if(oT){const aT=Sa.getResolvedImageFromTokens(oT);if(aT){const lT=sT._values["icon-size"],hP=gp(aT,hd(Sa.zoom,lT,Sa.worldview),lT,tT,Sa.zoom,eT,Sa.pixelRatio,uP,Sa.worldview),dP=oP.get(hP.iconPrimary.toString());wd=Math.max(wd,OI(dP,aP))}}}}return wd}(at,Zs,bc,oe.layout,ai,lr,at.iconAtlasPositions,tn);cr=4*bd;let Ta=null;Yn.kind==="source"?(Ta=[xa*oe.layout.get("icon-size").evaluate(ai,{},lr)*Gi.iconScaleFactor],Ta[0]>Ll&&St(`${at.layerIds[0]}: Value for "icon-size" is >= ${yp}. Reduce your "icon-size".`)):Yn.kind==="composite"&&(Ta=[xa*Gi.compositeIconSizes[0].evaluate(ai,{},lr)*Gi.iconScaleFactor,xa*Gi.compositeIconSizes[1].evaluate(ai,{},lr)*Gi.iconScaleFactor],(Ta[0]>Ll||Ta[1]>Ll)&&St(`${at.layerIds[0]}: Value for "icon-size" is >= ${yp}. Reduce your "icon-size".`)),at.addSymbols(at.icon,Zs,Ta,ti,Ci,ai,void 0,li,Ot,Pi.lineStartIndex,Pi.lineLength,-1,Ki,lr,xr,fr,at.symbolInstances.length,bd),_n=at.icon.placedSymbolArray.length-1,bc&&(kr=4*bd,at.addSymbols(at.icon,bc,Ta,ti,Ci,ai,Ws.vertical,li,Ot,Pi.lineStartIndex,Pi.lineLength,-1,Ki,lr,xr,fr,at.symbolInstances.length,bd),gn=at.icon.placedSymbolArray.length-1)}for(const Yn in ki.horizontal){const bs=Yn,Zs=ki.horizontal[bs];_r||(Cs=qu(Zs.text),Ht?Er=Rx(Zs):_r=H_(Ve,Ar,Ot,Qe,_t,gt,Zs,Vt,oe.layout.get("text-rotate").evaluate(ai,{},lr),fi,Br));const bc=Zs.positionedLines.length===1;if(En+=O1(at,li,Ot,Zs,dr,oe,Ht,ai,fi,Pi,ki.vertical?Ws.horizontal:Ws.horizontalOnly,bc?NI(ki.horizontal):[bs],Mn,_n,Gi,Ki,lr,at.symbolInstances.length,xr),bc)break}ki.vertical&&(kn+=O1(at,li,Ot,ki.vertical,dr,oe,Ht,ai,fi,Pi,Ws.vertical,["vertical"],Mn,gn,Gi,Ki,lr,at.symbolInstances.length,xr));let An=-1;const Zo=(Yn,bs)=>Yn?Math.max(Yn,bs):bs;An=Zo(Er,An),An=Zo(ei,An),An=Zo(jr,An);const Ya=An>-1?1:0;at.glyphOffsetArray.length>=65535&&St("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ai.sortKey!==void 0&&at.addToSortKeyRanges(at.symbolInstances.length,ai.sortKey),at.symbolInstances.emplaceBack(Ot.x,Ot.y,Ar.x,Ar.y,Ar.z,Mn.right>=0?Mn.right:-1,Mn.center>=0?Mn.center:-1,Mn.left>=0?Mn.left:-1,Mn.vertical>=0?Mn.vertical:-1,_n,gn,Cs,_r!==void 0?_r:at.collisionBoxArray.length,_r!==void 0?_r+1:at.collisionBoxArray.length,Rr!==void 0?Rr:at.collisionBoxArray.length,Rr!==void 0?Rr+1:at.collisionBoxArray.length,wr!==void 0?wr:at.collisionBoxArray.length,wr!==void 0?wr+1:at.collisionBoxArray.length,sn||at.collisionBoxArray.length,sn?sn+1:at.collisionBoxArray.length,Qe,En,kn,cr,kr,Ya,0,on,zs,An,0,tn?1:0,rr)})(r,At,Si,vt,i,s,u,a,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,et,q,v,0,Ze,Be,N,e,h,w,S,A,R,O,V,st,K,se,te)};if(W==="line")for(const vt of E_(e.geometry,0,0,ut,ut)){const At=zI(vt,Je,Xe,i.vertical||Ne,s,ze,qe,r.overscaling,ut);for(const Lt of At)Ne&&ZI(r,Ne.text,ke,Lt)||Nt(vt,Lt,A)}else if(W==="line-center"){for(const vt of e.geometry)if(vt.length>1){const At=LI(vt,Xe,i.vertical||Ne,s,ze,qe);At&&Nt(vt,At,A)}}else if(e.type==="Polygon")for(const vt of ep(e.geometry,0)){const At=FI(vt,16);Nt(vt[0],new Dl(At.x,At.y,0,0,void 0),A)}else if(e.type==="LineString")for(const vt of e.geometry)Nt(vt,new Dl(vt[0].x,vt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const vt of e.geometry)for(const At of vt)Nt([At],new Dl(At.x,At.y,0,0,void 0),A)}const yp=255,Ll=yp*xa;function O1(r,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q){const W=function(te,le,fe,ge,ze,we,Ne,He){const qe=[];if(le.positionedLines.length===0)return qe;const Je=ge.layout.get("text-rotate").evaluate(we,{})*Math.PI/180,et=function(Ke){const ht=Ke[0],st=Ke[1],Nt=ht*st;return Nt>0?[ht,-st]:Nt<0?[-ht,st]:ht===0?[st,ht]:[st,-ht]}(fe);let Ze=Math.abs(le.top-le.bottom);for(const Ke of le.positionedLines)Ze-=Ke.lineOffset;const Xe=le.positionedLines.length,Be=Ze/Xe;let ke=le.top-fe[1];for(let Ke=0;Ke<Xe;++Ke){const ht=le.positionedLines[Ke];ke=kI(le,Be,ke,Ke);for(const st of ht.positionedGlyphs){if(!st.rect)continue;const Nt=st.rect||{};let vt=u1+1,At=!0,Lt=1,Si=0;if(st.image){const bi=Ne.get(st.image.toString());if(!bi)continue;if(bi.sdf){St("SDF images are not supported in formatted text and will be ignored.");continue}At=!1,Lt=bi.pixelRatio,vt=Su/Lt}const at=(ze||He)&&st.vertical,Ot=st.metrics.advance*st.scale/2,li=st.metrics,Di=st.rect;if(Di===null)continue;He&&le.verticalizable&&(Si=st.image?Ot-st.metrics.width*st.scale/2:0);const ki=ze?[st.x+Ot,st.y]:[0,0];let mi=[0,0],dr=[0,0],ie=!1;ze||(at?(dr=[st.x+Ot+et[0],st.y+et[1]-Si],ie=!0):mi=[st.x+Ot+fe[0],st.y+fe[1]-Si]);const oe=Di.w*st.scale/(Lt*(st.localGlyph?va:1)),Ve=Di.h*st.scale/(Lt*(st.localGlyph?va:1));let Qe,_t,gt,Vt;if(at){const bi=st.y-ke,Ti=new Ye(-Ot,Ot-bi),Ci=-Math.PI/2,ti=new Ye(...dr);Qe=new Ye(-Ot+mi[0],mi[1]),Qe._rotateAround(Ci,Ti)._add(ti),Qe.x+=-bi+Ot,Qe.y-=(li.left-vt)*st.scale;const ai=st.image?li.advance*st.scale:On*st.scale,Gi=String.fromCodePoint(st.glyph);gI(Gi)?Qe.x+=(1-vt)*st.scale:yI(Gi)?Qe.x+=ai-li.height*st.scale+(-vt-1)*st.scale:Qe.x+=st.image||li.width+2*vt===Di.w&&li.height+2*vt===Di.h?(ai-Ve)/2:(ai-(li.height+2*vt)*st.scale)/2,_t=new Ye(Qe.x,Qe.y-oe),gt=new Ye(Qe.x+Ve,Qe.y),Vt=new Ye(Qe.x+Ve,Qe.y-oe)}else{const bi=(li.left-vt)*st.scale-Ot+mi[0],Ti=(-li.top-vt)*st.scale+mi[1],Ci=bi+oe,ti=Ti+Ve;Qe=new Ye(bi,Ti),_t=new Ye(Ci,Ti),gt=new Ye(bi,ti),Vt=new Ye(Ci,ti)}if(Je){let bi;bi=ze?new Ye(0,0):ie?new Ye(et[0],et[1]):new Ye(fe[0],fe[1]),Qe._rotateAround(Je,bi),_t._rotateAround(Je,bi),gt._rotateAround(Je,bi),Vt._rotateAround(Je,bi)}const Ht=new Ye(0,0),fi=new Ye(0,0);qe.push({tl:Qe,tr:_t,bl:gt,br:Vt,texPrimary:Nt,texSecondary:void 0,writingMode:le.writingMode,glyphOffset:ki,sectionIndex:st.sectionIndex,isSDF:At,pixelOffsetTL:Ht,pixelOffsetBR:fi,minFontScaleX:0,minFontScaleY:0})}}return qe}(0,s,y,u,h,p,a,r.allowVerticalPlacement),K=r.textSizeData;let se=null;K.kind==="source"?(se=[xa*u.layout.get("text-size").evaluate(p,{},V)*R.textScaleFactor],se[0]>Ll&&St(`${r.layerIds[0]}: Value for "text-size" is >= ${yp}. Reduce your "text-size".`)):K.kind==="composite"&&(se=[xa*R.compositeTextSizes[0].evaluate(p,{},V)*R.textScaleFactor,xa*R.compositeTextSizes[1].evaluate(p,{},V)*R.textScaleFactor],(se[0]>Ll||se[1]>Ll)&&St(`${r.layerIds[0]}: Value for "text-size" is >= ${yp}. Reduce your "text-size".`)),r.addSymbols(r.text,W,se,y,h,p,w,e,i,v.lineStartIndex,v.lineLength,P,O,V,q,!1,N,W.length);for(const te of S)A[te]=r.text.placedSymbolArray.length-1;return 4*W.length}function G_(r){for(const e in r)return r[e];return null}function H_(r,e,i,s,a,u,h,p,y,v,w){let S,A,P,R;if(S=w?w.top:h.top,A=w?w.bottom:h.bottom,P=w?w.left:h.left,R=w?w.right:h.right,Tx(h)&&h.collisionPadding){const O=h.collisionPadding;P-=O[0],S-=O[1],R+=O[2],A+=O[3]}if(y){const O=new Ye(P,S),V=new Ye(R,S),N=new Ye(P,A),q=new Ye(R,A),W=Wi(y);let K=new Ye(0,0);v&&(K=new Ye(v[0],v[1])),O._rotateAround(W,K),V._rotateAround(W,K),N._rotateAround(W,K),q._rotateAround(W,K),P=Math.min(O.x,V.x,N.x,q.x),R=Math.max(O.x,V.x,N.x,q.x),S=Math.min(O.y,V.y,N.y,q.y),A=Math.max(O.y,V.y,N.y,q.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,S,R,A,p,s,a,u),r.length-1}function Rx(r){Tx(r)&&r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function ZI(r,e,i,s){const a=r.compareText;if(e in a){const u=a[e];for(let h=u.length-1;h>=0;h--)if(s.dist(u[h])<i)return!0}else a[e]=[];return a[e].push(s),!1}function k1(r,e){const i=r.fovAboveCenter,s=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,a=(r._camera.position[2]*r.worldSize-s)/Math.cos(r._pitch),u=Math.sin(i)*a/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01));let h=Math.sin(r._pitch)*u+a;const p=a*(1/r._horizonShift);if(!r.elevation||r.elevation.exaggeration()===0){let y=Math.max(r.zoom-17,0);r.isOrthographic&&(y/=10),h*=1+y}return Math.min(1.01*h,p)}function xp(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),s=r.x*i,a=(r.x+1)*i,u=r.y*i,h=(r.y+1)*i,p=I(s),y=I(a),v=L(u),w=L(h),S=e.project(p,v),A=e.project(y,v),P=e.project(y,w),R=e.project(p,w);let O=Math.min(S.x,A.x,P.x,R.x),V=Math.min(S.y,A.y,P.y,R.y),N=Math.max(S.x,A.x,P.x,R.x),q=Math.max(S.y,A.y,P.y,R.y);const W=i/16;function K(te,le,fe,ge,ze,we){const Ne=(fe+ze)/2,He=(ge+we)/2,qe=e.project(I(Ne),L(He)),Je=Math.max(0,O-qe.x,V-qe.y,qe.x-N,qe.y-q);O=Math.min(O,qe.x),N=Math.max(N,qe.x),V=Math.min(V,qe.y),q=Math.max(q,qe.y),Je>W&&(K(te,qe,fe,ge,Ne,He),K(qe,le,Ne,He,ze,we))}K(S,A,s,u,a,u),K(A,P,a,u,a,h),K(P,R,a,h,s,h),K(R,S,s,h,s,u),O-=W,V-=W,N+=W,q+=W;const se=1/Math.max(N-O,q-V);return{scale:se,x:O*se,y:V*se,x2:N*se,y2:q*se,projection:e}}function F1(r,{x:e,y:i},s=0){return new Ye(((e-s)*r.scale-r.x)*ut,(i*r.scale-r.y)*ut)}const XI=mt(new Float32Array(16));class xc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new n(0,0)}projectTilePoint(e,i,s){return{x:e,y:i,z:0}}locationPoint(e,i,s,a=!0){return e._coordinatePoint(e.locationCoordinate(i,s),a)}pixelsPerMeter(e,i){return E(1,e)*i}pixelSpaceConversion(e,i,s){return 1}farthestPixelDistance(e){return k1(e,e.pixelsPerMeter)}pointCoordinate(e,i,s,a){const u=e.horizonLineFromTop(!1),h=new Ye(i,Math.max(u,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(h,a))}pointCoordinate3D(e,i,s){const a=new Ye(i,s);if(e.elevation)return e.elevation.pointCoordinate(a);{const u=this.pointCoordinate(e,a.x,a.y,0);return[u.x,u.y,u.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const s=e.horizonLineFromTop();return i.y<s}createInversionMatrix(e,i){return XI}createTileMatrix(e,i,s){let a,u,h;const p=s.canonical,y=mt(new Float64Array(16));if(this.isReprojectedInTileSpace){const v=xp(p,this);a=1,u=v.x+s.wrap*v.scale,h=v.y,Zt(y,y,[a/v.scale,a/v.scale,e.pixelsPerMeter/i])}else a=i/e.zoomScale(p.z),u=(p.x+Math.pow(2,p.z)*s.wrap)*a,h=p.y*a;return Xt(y,y,[u,h,0]),Zt(y,y,[a/ut,a/ut,1]),y}upVector(e,i,s){return[0,0,1]}upVectorScale(e,i,s){return{metersToTile:1}}}class KI extends xc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,s]=this.parallels=e.parallels||[29.5,45.5],a=Math.sin(Wi(i));this.n=(a+Math.sin(Wi(s)))/2,this.c=1+a*(2*this.n-a),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:s,c:a,r0:u}=this,h=Wi(e-this.center[0]),p=Wi(i),y=Math.sqrt(a-2*s*Math.sin(p))/s;return{x:y*Math.sin(h*s),y:y*Math.cos(h*s)-u,z:0}}unproject(e,i){const{n:s,c:a,r0:u}=this,h=u+i;let p=Math.atan2(e,Math.abs(h))*Math.sign(h);h*s<0&&(p-=Math.PI*Math.sign(e)*Math.sign(h));const y=Wi(this.center[0])*s;p=J(p,-Math.PI-y,Math.PI-y);const v=U(us(p/s)+this.center[0],-180,180),w=Math.asin(U((a-(e*e+h*h)*s*s)/(2*s),-1,1)),S=U(us(w),-z,z);return new n(v,S)}}const vp=1.340264,bp=-.081106,wp=893e-6,Tp=.003796,q_=Math.sqrt(3)/2;class YI extends xc{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(q_*Math.sin(i)),a=s*s,u=a*a*a;return{x:.5*(e*Math.cos(s)/(q_*(vp+3*bp*a+u*(7*wp+9*Tp*a)))/Math.PI+.5),y:1-.5*(s*(vp+bp*a+u*(wp+Tp*a))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=s*s,u=a*a*a;for(let w,S,A,P=0;P<12&&(S=s*(vp+bp*a+u*(wp+Tp*a))-i,A=vp+3*bp*a+u*(7*wp+9*Tp*a),w=S/A,s=U(s-w,-Math.PI/3,Math.PI/3),a=s*s,u=a*a*a,!(Math.abs(w)<1e-12));++P);const h=q_*e*(vp+3*bp*a+u*(7*wp+9*Tp*a))/Math.cos(s),p=Math.asin(Math.sin(s)/q_),y=U(180*h/Math.PI,-180,180),v=U(180*p/Math.PI,-z,z);return new n(y,v)}}class JI extends xc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const s=360*(e-.5),a=U(360*(.5-i),-z,z);return new n(s,a)}}const md=Math.PI/2;function $_(r){return Math.tan((md+r)/2)}class QI extends xc{constructor(e){super(e),this.center=e.center||[0,30];const[i,s]=this.parallels=e.parallels||[30,30];let a=Wi(i),u=Wi(s);this.southernCenter=a+u<0,this.southernCenter&&(a=-a,u=-u);const h=Math.cos(a),p=$_(a);this.n=a===u?Math.sin(a):Math.log(h/Math.cos(u))/Math.log($_(u)/p),this.f=h*Math.pow($_(a),this.n)/this.n}project(e,i){i=Wi(i),this.southernCenter&&(i=-i),e=Wi(e-this.center[0]);const s=1e-6,{n:a,f:u}=this;u>0?i<-md+s&&(i=-md+s):i>md-s&&(i=md-s);const h=u/Math.pow($_(i),a);let p=h*Math.sin(a*e),y=u-h*Math.cos(a*e);return p=.5*(p/Math.PI+.5),y=.5*(y/Math.PI+.5),{x:p,y:this.southernCenter?y:1-y,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:s,f:a}=this,u=a-i,h=Math.sign(u),p=Math.sign(s)*Math.sqrt(e*e+u*u);let y=Math.atan2(e,Math.abs(u))*h;u*s<0&&(y-=Math.PI*Math.sign(e)*h);const v=U(us(y/s)+this.center[0],-180,180),w=U(us(2*Math.atan(Math.pow(a/p,1/s))-md),-z,z);return new n(v,this.southernCenter?-w:w)}}class B1 extends xc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:x(e),y:b(i),z:0}}unproject(e,i){const s=I(e),a=L(i);return new n(s,a)}}const N1=Wi(z);class eC extends xc{project(e,i){const s=(i=Wi(i))*i,a=s*s;return{x:.5*((e=Wi(e))*(.8707-.131979*s+a*(a*(.003971*s-.001529*a)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+s*(.015085+a*(.028874*s-.044475-.005916*a)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let s=i=(2*(1-i)-1)*Math.PI,a=25,u=0,h=s*s;do{h=s*s;const v=h*h;u=(s*(1.007226+h*(.015085+v*(.028874*h-.044475-.005916*v)))-i)/(1.007226+h*(.045255+v*(.259866*h-.311325-.005916*11*v))),s=U(s-u,-N1,N1)}while(Math.abs(u)>1e-6&&--a>0);h=s*s;const p=U(us(e/(.8707+h*(h*(h*h*h*(.003971-.001529*h)-.013791)-.131979))),-180,180),y=us(s);return new n(p,y)}}const V1=Wi(z);class tC extends xc{project(e,i){i=Wi(i),e=Wi(e);const s=Math.cos(i),a=2/Math.PI,u=Math.acos(s*Math.cos(e/2)),h=Math.sin(u)/u,p=.5*(e*a+2*s*Math.sin(e/2)/h)||0,y=.5*(i+Math.sin(i)/h)||0;return{x:.5*(p/Math.PI+.5),y:1-.5*(y/Math.PI+1),z:0}}unproject(e,i){let s=e=(2*e-.5)*Math.PI,a=i=(2*(1-i)-1)*Math.PI,u=25;const h=1e-6;let p=0,y=0;do{const v=Math.cos(a),w=Math.sin(a),S=2*w*v,A=w*w,P=v*v,R=Math.cos(s/2),O=Math.sin(s/2),V=2*R*O,N=O*O,q=1-P*R*R,W=q?1/q:0,K=q?Math.acos(v*R)*Math.sqrt(1/q):0,se=.5*(2*K*v*O+2*s/Math.PI)-e,te=.5*(K*w+a)-i,le=.5*W*(P*N+K*v*R*A)+1/Math.PI,fe=W*(V*S/4-K*w*O),ge=.125*W*(S*O-K*w*P*V),ze=.5*W*(A*R+K*N*v)+.5,we=fe*ge-ze*le;p=(te*fe-se*ze)/we,y=(se*ge-te*le)/we,s=U(s-p,-Math.PI,Math.PI),a=U(a-y,-V1,V1)}while((Math.abs(p)>h||Math.abs(y)>h)&&--u>0);return new n(us(s),us(a))}}class U1 extends xc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Wi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:s,cosPhi:a}=this;return{x:Wi(e)*a*s+.5,y:-Math.sin(Wi(i))/a*s+.5,z:0}}unproject(e,i){const{scale:s,cosPhi:a}=this,u=-(i-.5)/s,h=U(us((e-.5)/s)/a,-180,180),p=Math.asin(U(u*a,-1,1)),y=U(us(p),-z,z);return new n(h,y)}}class iC extends B1{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,s){const a=Zf(e,i,s);return Ae(a,a,__(Io(s))),{x:a[0],y:a[1],z:a[2]}}locationPoint(e,i,s){const a=dc(i.lat,i.lng),u=zt([],a),h=s?e._centerAltitude+s:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;qn(a,a,u,E(1,0)*ut*h);const p=mt(new Float64Array(16));return wt(p,e.pixelMatrix,e.globeMatrix),Ae(a,a,p),new Ye(a[0],a[1])}pixelsPerMeter(e,i){return E(1,0)*i}pixelSpaceConversion(e,i,s){const a=E(1,e)*i,u=ii(E(1,45)*i,a,s);return this.pixelsPerMeter(e,i)/u}createTileMatrix(e,i,s){const a=ky(Io(s.canonical));return wt(new Float64Array(16),e.globeMatrix,a)}createInversionMatrix(e,i){const{center:s}=e,a=__(Io(i));return Sr(a,a,Wi(s.lng)),Li(a,a,Wi(s.lat)),Zt(a,a,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(a)}pointCoordinate(e,i,s,a){return pc(e,i,s,!0)||new Z(0,0)}pointCoordinate3D(e,i,s){const a=this.pointCoordinate(e,i,s,0);return[a.x,a.y,a.z]}isPointAboveHorizon(e,i){return!pc(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(a,u){const h=a.cameraToCenterDistance,p=a._centerAltitude*u,y=a._camera,v=a._camera.forward(),w=Oi([],Cr([],v,-h),[0,0,p]),S=a.worldSize/(2*Math.PI),A=[0,0,-S],P=a.width/a.height,R=Math.tan(a.fovAboveCenter),O=Cr([],y.up(),R),V=Cr([],y.right(),R*P),N=zt([],Oi([],Oi([],v,O),V)),q=[];let W;if(new Dt(w,N).closestPointOnSphere(A,S,q)){const K=Oi([],q,A),se=jt([],K,w);W=Math.cos(a.fovAboveCenter)*ln(se)}else{const K=jt([],w,A),se=jt([],A,w);zt(se,se);const te=ln(K)-S;W=Math.sqrt(te*(te+2*S));const le=Math.acos(W/(S+te))-Math.acos(Yt(v,se));W*=Math.cos(le)}return 1.01*W}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=mc(e.zoom);if(s>0){const a=k1(e,E(1,e.center.lat)*e.worldSize),u=e.worldSize/(2*Math.PI),h=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ii(i,a+u*(1-Math.cos(h)),Math.pow(s,10))}return i}upVector(e,i,s){return Zf(i,s,e,1)}upVectorScale(e){return{metersToTile:$o(m_(Io(e)))}}}function j1(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new B1(r);case"equirectangular":return new JI(r);case"naturalEarth":return new eC(r);case"equalEarth":return new YI(r);case"winkelTripel":return new tC(r);case"albers":return i?new U1(r):new KI(r);case"lambertConformalConic":return i?new U1(r):new QI(r);case"globe":return new iC(r)}throw new Error(`Invalid projection name: ${r.name}`)}const rC=xe.types,nC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Sp(r,e,i,s,a,u,h,p,y,v,w,S,A){const P=p?Math.min(Ll,Math.round(p[0])):0,R=p?Math.min(Ll,Math.round(p[1])):0;r.emplaceBack(e,i,Math.round(32*s),Math.round(32*a),u,h,(P<<1)+(y?1:0),0+(R<<1),16*v,16*w,256*S,256*A)}function Ep(r,e,i){r.emplaceBack(e,i)}function Ap(r,e,i,s,a,u,h){r.emplaceBack(e,i,s,a,u,h)}const W_=(r,e,i,s)=>{for(let a=0;a<e;a++)r.emplaceBack(i[0],i[1],i[2],s[0],s[1],s[2])};function _d(r,e,i,s,a){r.emplaceBack(e,i,s,a),r.emplaceBack(e,i,s,a),r.emplaceBack(e,i,s,a),r.emplaceBack(e,i,s,a)}function sC(r){for(const e of r.sections)if(vy(e.text))return!0;return!1}class Dx{constructor(e){this.layoutVertexArray=new Rf,this.indexArray=new wn,this.programConfigurations=e,this.segments=new Nr,this.dynamicLayoutVertexArray=new qa,this.opacityVertexArray=new Nh,this.placedSymbolArray=new l_,this.iconTransitioningVertexArray=new Hs,this.globeExtVertexArray=new Df,this.zOffsetVertexArray=new ua,this.orientationVertexArray=new Of,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getIconVertexData(e,i){const s=[],a=this.layoutVertexArray.uint16;for(let u=0;u<i;++u){const h=12*(e+u);s.push(...a.slice(h,h+12))}return s}updateIconVertexData(e,i,s,a,u,h,p,y,v,w,S,A,P){const R=this.layoutVertexArray.uint16,O=12*e;R[O]=i,R[O+1]=s,R[O+2]=a,R[O+3]=u,R[O+4]=h,R[O+5]=p,R[O+6]=y,R[O+7]=v,R[O+8]=w,R[O+9]=S,R[O+10]=A,R[O+11]=P}upload(e,i,s,a,u,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,aI.members,!!h),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,cI.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,nC,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,dI.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lI.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||u)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,uI.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,hI.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||a)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Mt(Dx,"SymbolBuffers");class Lx{constructor(e,i,s){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new s,this.segments=new Nr,this.collisionVertexArray=new Lf,this.collisionVertexArrayExt=new qa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fI.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,pI.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Mt(Lx,"CollisionBuffers");class Z_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(h=>h.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=mt([]),this.placementViewportMatrix=mt([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=hd(this.zoom,i["text-size"],this.worldview),this.iconSizeData=hd(this.zoom,i["icon-size"],this.worldview);const s=this.layers[0].layout,a=s.get("symbol-sort-key"),u=s.get("symbol-z-order");this.lut=e.lut,this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=u!=="viewport-y"&&a.constantOr(1)!==void 0,this.sortFeaturesByY=(u==="viewport-y"||u==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(h=>Ws[h]),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();return!(!i||i.length===0)&&i.some(s=>s.getProperty(e)!=null)}createArrays(){this.text=new Dx(new Eo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Dx(new Eo(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new Wh,this.lineVertexArray=new u_,this.symbolInstances=new Vf}calculateGlyphDependencies(e,i,s,a,u){for(const h of e){const p=h.codePointAt(0);if(p===void 0)break;if(i[p]=!0,a&&u&&p<=65535){const y=fp[h];y&&(i[y.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,s,a,u,h){let p=1;const y=e.getUnevaluatedProperties()._values["icon-size"],v=hd(this.zoom,y,this.worldview),w=dd(v,i);if(v.kind!=="constant"&&v.kind!=="camera"||(p=w.uSize),v.kind==="composite"){const{minZoom:S,maxZoom:A}=v,P=y.possiblyEvaluate(new Mr(S,{worldview:this.worldview}),a),R=y.possiblyEvaluate(new Mr(A,{worldview:this.worldview}),a),O=P.evaluate(s,{},a,u);p=O+(R.evaluate(s,{},a,u)-O)*w.uSizeT}return v.kind==="source"&&(p=y.possiblyEvaluate(new Mr(this.zoom,{worldview:this.worldview}),a).evaluate(s,{},a,u)),p*h}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!w_(this.activeReplacements,s)&&(this.activeReplacements=s,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?_s.build(e):e}populate(e,i,s,a){const u=this.layers[0],h=u.layout,p=this.projection.name==="globe",y=h.get("text-font"),v=h.get("text-field"),w=h.get("icon-image"),[S,A]=h.get("icon-size-scale-range"),P=U(i.scaleFactor||1,S,A),R=(v.value.kind!=="constant"||v.value.value instanceof ms&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),O=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,V=this.hasAnyAppearanceProperty("icon-image"),N=h.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!R&&!O&&!V)return;const q=i.iconDependencies,W=i.glyphDependencies,K=i.availableImages,se=new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),te=le=>{const fe=le.id.toString();q.has(fe)?q.get(fe).push(le):q.set(fe,[le])};for(const le of e){const{feature:fe,id:ge,index:ze,sourceLayerIndex:we}=le,Ne=u._featureFilter.needGeometry,He=be(fe,Ne);if(!u._featureFilter.filter(se,He,s))continue;if(Ne||(He.geometry=ue(fe,s,a)),p&&fe.type!==1&&s.z<=5){const Ke=He.geometry,ht=.98078528056,st=(Nt,vt)=>Yt(Zf(Nt.x,Nt.y,s,1),Zf(vt.x,vt.y,s,1))<ht;for(let Nt=0;Nt<Ke.length;Nt++)Ke[Nt]=ne(Ke[Nt],st)}let qe,Je;if(R){const Ke=u.getValueAndResolveTokens("text-field",He,s,K),ht=ms.factory(Ke);sC(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||au()==="unavailable"||this.hasRTLText&&ca.isParsed())&&(qe=_I(ht,u,He))}if(O){const Ke=u.getValueAndResolveTokens("icon-image",He,s,K);Je=this.getResolvedImageFromTokens(Ke)}const et=this.layers[0];let Ze=!1;if(!Je&&V){const Ke=et.getAppearances();for(const ht of Ke)if(ht.getProperty("icon-image")){const st=et.getAppearanceValueAndResolveTokens(ht,"icon-image",He,s,K);if(st){Je=this.getResolvedImageFromTokens(st),Ze=!0;break}}}if(!qe&&!Je)continue;const Xe=this.sortFeaturesByKey?N.evaluate(He,{},s):void 0,Be={id:ge,text:qe,icon:Je,index:ze,sourceLayerIndex:we,geometry:He.geometry,properties:fe.properties,type:rC[fe.type],sortKey:Xe};if(this.features.push(Be),this.featureToAppearanceIndex[ze]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:ge,properties:fe.properties,usesAppearanceIconAsPlaceholder:Ze,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),Je){const Ke=et._unevaluatedLayout._values,{iconPrimary:ht,iconSecondary:st}=gp(Je,this.iconSizeData,Ke["icon-size"],s,this.zoom,Be,this.pixelRatio,P,this.worldview);te(ht),st&&(this.hasAnySecondaryIcon=!0,te(st))}const ke=et.getAppearances();if(ke.length!==0&&ke.forEach(Ke=>{if(!Ke.getProperty("icon-image"))return;const ht=this.getCombinedIconPrimary(Ke,et,He,s,K,Be,P);ht&&te(ht)}),qe){const Ke=y.evaluate(He,{},s).join(","),ht=h.get("text-rotation-alignment")==="map"&&h.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ws.vertical)>=0;for(const st of qe.sections)if(st.image){const Nt=st.image.getPrimary().scaleSelf(this.pixelRatio),vt=Nt.id.toString(),At=q.get(vt)||[];At.push(Nt),q.set(vt,At)}else{const Nt=su(qe.toString()),vt=st.fontStack||Ke,At=W[vt]=W[vt]||{};this.calculateGlyphDependencies(st.text,At,ht,this.allowVerticalPlacement,Nt)}}}if(h.get("symbol-placement")==="line"&&(this.features=function(le){const fe={},ge={},ze=[];let we=0;function Ne(et){ze.push(le[et]),we++}function He(et,Ze,Xe){const Be=ge[et];return delete ge[et],ge[Ze]=Be,ze[Be].geometry[0].pop(),ze[Be].geometry[0]=ze[Be].geometry[0].concat(Xe[0]),Be}function qe(et,Ze,Xe){const Be=fe[Ze];return delete fe[Ze],fe[et]=Be,ze[Be].geometry[0].shift(),ze[Be].geometry[0]=Xe[0].concat(ze[Be].geometry[0]),Be}function Je(et,Ze,Xe){const Be=Xe?Ze[0][Ze[0].length-1]:Ze[0][0];return`${et}:${Be.x}:${Be.y}`}for(let et=0;et<le.length;et++){const Ze=le[et],Xe=Ze.geometry,Be=Ze.text?Ze.text.toString():null;if(!Be){Ne(et);continue}const ke=Je(Be,Xe),Ke=Je(Be,Xe,!0);if(ke in ge&&Ke in fe&&ge[ke]!==fe[Ke]){const ht=qe(ke,Ke,Xe),st=He(ke,Ke,ze[ht].geometry);delete fe[ke],delete ge[Ke],ge[Je(Be,ze[st].geometry,!0)]=st,ze[ht].geometry=null}else ke in ge?He(ke,Ke,Xe):Ke in fe?qe(ke,Ke,Xe):(Ne(et),fe[ke]=we-1,ge[Ke]=we-1)}return ze.filter(et=>et.geometry)}(this.features)),h.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const le of i.elevationFeatures)this.elevationFeatureIdToIndex.set(le.id,this.elevationFeatures.length),this.elevationFeatures.push(le)}}else h.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((le,fe)=>le.sortKey-fe.sortKey)}getCombinedIconPrimary(e,i,s,a,u,h,p){let y,v;const w=e.getUnevaluatedProperties();if(w._values["icon-image"].value!==void 0){const S=i.getAppearanceValueAndResolveTokens(e,"icon-image",s,a,u);y=this.getResolvedImageFromTokens(S)}else{const S=i.getValueAndResolveTokens("icon-image",s,a,u);y=this.getResolvedImageFromTokens(S)}if(y){const S=w._values["icon-size"]||i._unevaluatedLayout._values["icon-size"];v=gp(y,hd(this.zoom,S,this.worldview),S,a,this.zoom,h,this.pixelRatio,p,this.worldview).iconPrimary}return v}updateAppearanceBasedIconTextures(e,i,s,a){if(!this.appearanceFeatureData||!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)return!1;const u=this.layers[0];let h=!1,p=0;const y=u.layout,[v,w]=y.get("icon-size-scale-range"),S=U(1,v,w);for(let A=0;A<this.symbolInstances.length;A++){const P=this.symbolInstances.get(A),R=this.featureToAppearanceIndex[P.featureIndex],O=R!==void 0?this.appearanceFeatureData[R]:void 0;if(O&&P.placedIconSymbolIndex>=0){const V=O.id,N=i&&V!==void 0?i[String(V)]:void 0,q={type:"Point",id:O.id,properties:O.properties,geometry:[]},W=this.layers[0].appearances&&this.layers[0].appearances.find(K=>K.isActive({globals:a,feature:q,canonical:e,featureState:N}));if(O.activeAppearance===W){p+=P.numIconVertices;continue}if(W){O.activeAppearance=W;const K=this.getCombinedIconPrimary(W,u,q,e,s,{sortKey:void 0,text:void 0,icon:null,index:P.featureIndex,sourceLayerIndex:P.featureIndex,geometry:[],properties:O.properties,type:"Point",id:O.id},S);if(!K)continue;const se=K.toString(),te=this.iconAtlasPositions&&this.iconAtlasPositions.get(se);if(te){const le=u.getAppearanceValueAndResolveTokens(W,"icon-offset",q,e,s),fe=le&&Array.isArray(le)?le:[0,0];let ge=B_(te,void 0,fe,u.layout.get("icon-anchor").evaluate(q,{},e));const ze=u.getAppearanceValueAndResolveTokens(W,"icon-rotate",q,e,s),we=typeof ze=="number"?ze:0,Ne=te.sdf,He=u.layout.get("icon-text-fit").constantOr("none");He!=="none"&&O.textShaping&&O.iconTextFitPadding&&O.fontScale&&(ge=Sx(ge,O.textShaping,He,O.iconTextFitPadding,fe,O.fontScale));const qe=this.calculateEffectiveAppearanceIconSize(W,a.zoom,q,e,s,S),Je=0,et=1+(Math.min(Ll,Math.round(qe*xa))<<1),Ze=Cx(ge,we,Ne,He!=="none",S);O.isUsingAppearanceVertexData||(O.isUsingAppearanceVertexData=!0,O.layoutBasedVertexData=this.icon.getIconVertexData(p,P.numIconVertices));for(let Be=0;Be<Ze.length;++Be){const ke=Ze[Be],Ke=O.layoutBasedVertexData[0]||P.tileAnchorX,ht=O.layoutBasedVertexData[1]||P.tileAnchorY,st=16*ke.pixelOffsetTL.x,Nt=16*ke.pixelOffsetTL.y,vt=16*ke.pixelOffsetBR.x,At=16*ke.pixelOffsetBR.y,Lt=16*ke.minFontScaleX,Si=16*ke.minFontScaleY;this.icon.updateIconVertexData(p,Ke,ht,Math.round(32*ke.tl.x),Math.round(32*ke.tl.y),ke.texPrimary.x,ke.texPrimary.y,Je,et,st,Nt,Lt,Si),this.icon.updateIconVertexData(p+1,Ke,ht,Math.round(32*ke.tr.x),Math.round(32*ke.tr.y),ke.texPrimary.x+ke.texPrimary.w,ke.texPrimary.y,Je,et,vt,Nt,Lt,Si),this.icon.updateIconVertexData(p+2,Ke,ht,Math.round(32*ke.bl.x),Math.round(32*ke.bl.y),ke.texPrimary.x,ke.texPrimary.y+ke.texPrimary.h,Je,et,st,At,Lt,Si),this.icon.updateIconVertexData(p+3,Ke,ht,Math.round(32*ke.br.x),Math.round(32*ke.br.y),ke.texPrimary.x+ke.texPrimary.w,ke.texPrimary.y+ke.texPrimary.h,Je,et,vt,At,Lt,Si),p+=4}const Xe=P.numIconVertices-4*Ze.length;for(let Be=0;Be<Xe;++Be)this.icon.updateIconVertexData(p+Be,0,0,0,0,0,0,0,0,0,0,0,0);h=!0}else p+=P.numIconVertices}else if(O.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(p,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(p+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(p+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(p+3,0,0,0,0,0,0,0,0,0,0,0,0),h=!0),p+=P.numIconVertices,O.activeAppearance=null;else if(O.isUsingAppearanceVertexData){const se=O.layoutBasedVertexData.length/12;for(let te=0;te<se;++te){const le=te*12;this.icon.updateIconVertexData(p+te,O.layoutBasedVertexData[le+0],O.layoutBasedVertexData[le+1],O.layoutBasedVertexData[le+2],O.layoutBasedVertexData[le+3],O.layoutBasedVertexData[le+4],O.layoutBasedVertexData[le+5],O.layoutBasedVertexData[le+6],O.layoutBasedVertexData[le+7],O.layoutBasedVertexData[le+8],O.layoutBasedVertexData[le+9],O.layoutBasedVertexData[le+10],O.layoutBasedVertexData[le+11])}p+=se,O.isUsingAppearanceVertexData=!1,O.activeAppearance=null,h=!0}else p+=P.numIconVertices,O.activeAppearance=null}}return h}update(e,i,s,a,u,h,p){this.text.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,u,s,a,h,p,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const s=G(e),a=1/s;let u=!1,h=!1;for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p),v=Qi(1,0,0),w=Qi(0,1,0),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:A,numIconVertices:P,numVerticalIconVertices:R}=y,O=S>0||A>0,V=P>0,N=this.elevationFeatures[y.elevationFeatureIndex];if(N){const q=new Ye(y.tileAnchorX,y.tileAnchorY),W=.075+N.pointElevation(q);y.zOffset!==W&&(i=!0,y.zOffset=W),W!==0&&(this.hasAnyZOffset=!0);const K=N.computeSlopeNormal(q,a),se=Ys(Bi(),Qi(0,0,1),K);It(v,v,se),It(w,w,se),v[2]*=s,w[2]*=s,v[0]===1&&v[1]===0&&v[2]===0&&w[0]===0&&w[1]===1&&w[2]===0||(u=u||O,h=h||V)}if(O&&(W_(this.text.orientationVertexArray,S,v,w),W_(this.text.orientationVertexArray,A,v,w)),V){const{placedIconSymbolIndex:q,verticalPlacedIconSymbolIndex:W}=y;q>=0&&W_(this.icon.orientationVertexArray,P,v,w),W>=0&&W_(this.icon.orientationVertexArray,R,v,w)}}u||(this.text.orientationVertexArray=void 0),h||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(u,h,p)=>{s+=h,s>u.length&&u.resize(s);for(let y=-h;y<0;y++)u.emplace(y+s,p)},i=(u,h,p)=>{a+=h,a>u.length&&u.resize(a);for(let y=-h;y<0;y++)u.emplace(y+a,p)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let s=0,a=0;for(let u=0;u<this.symbolInstances.length;u++){const h=this.symbolInstances.get(u),{numHorizontalGlyphVertices:p,numVerticalGlyphVertices:y,numIconVertices:v}=h,w=h.zOffset,S=v>0;if((p>0||y>0)&&(e(this.text.zOffsetVertexArray,p,w),e(this.text.zOffsetVertexArray,y,w)),S){const{placedIconSymbolIndex:A,verticalPlacedIconSymbolIndex:P}=h;A>=0&&i(this.icon.zOffsetVertexArray,v,w),P>=0&&i(this.icon.zOffsetVertexArray,h.numVerticalIconVertices,w)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,s,a,u){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(h=>h.appearances&&h.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,s,a){return!!(e&&i&&s)&&!(!this.icon.layoutVertexArray||this.icon.layoutVertexArray.length===0)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,i,s,a)&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=j1(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const s=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:a,y:u}of i)this.lineVertexArray.emplaceBack(a,u);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,i,s,a,u,h,p,y,v,w,S,A,P,R,O,V,N,q){const W=e.indexArray,K=e.layoutVertexArray,se=e.globeExtVertexArray,te=e.segments.prepareSegment(4*q,K,W,this.canOverlap?h.sortKey:void 0),le=this.glyphOffsetArray.length,fe=te.vertexLength,ge=this.allowVerticalPlacement&&p===Ws.vertical?Math.PI/2:0,ze=h.text&&h.text.sections;for(let He=0;He<i.length;He++){const{tl:qe,tr:Je,bl:et,br:Ze,texPrimary:Xe,texSecondary:Be,pixelOffsetTL:ke,pixelOffsetBR:Ke,minFontScaleX:ht,minFontScaleY:st,glyphOffset:Nt,isSDF:vt,sectionIndex:At}=i[He],Lt=te.vertexLength,Si=Nt[1];if(Sp(K,v.x,v.y,qe.x,Si+qe.y,Xe.x,Xe.y,s,vt,ke.x,ke.y,ht,st),Sp(K,v.x,v.y,Je.x,Si+Je.y,Xe.x+Xe.w,Xe.y,s,vt,Ke.x,ke.y,ht,st),Sp(K,v.x,v.y,et.x,Si+et.y,Xe.x,Xe.y+Xe.h,s,vt,ke.x,Ke.y,ht,st),Sp(K,v.x,v.y,Ze.x,Si+Ze.y,Xe.x+Xe.w,Xe.y+Xe.h,s,vt,Ke.x,Ke.y,ht,st),y){const{x:at,y:Ot,z:li}=y.anchor,[Di,ki,mi]=y.up;Ap(se,at,Ot,li,Di,ki,mi),Ap(se,at,Ot,li,Di,ki,mi),Ap(se,at,Ot,li,Di,ki,mi),Ap(se,at,Ot,li,Di,ki,mi),_d(e.dynamicLayoutVertexArray,at,Ot,li,ge)}else _d(e.dynamicLayoutVertexArray,v.x,v.y,v.z,ge);if(V){const at=Be||Xe;Ep(e.iconTransitioningVertexArray,at.x,at.y),Ep(e.iconTransitioningVertexArray,at.x+at.w,at.y),Ep(e.iconTransitioningVertexArray,at.x,at.y+at.h),Ep(e.iconTransitioningVertexArray,at.x+at.w,at.y+at.h)}W.emplaceBack(Lt,Lt+1,Lt+2),W.emplaceBack(Lt+1,Lt+2,Lt+3),te.vertexLength+=4,te.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Nt[0]),He!==i.length-1&&At===i[He+1].sectionIndex||e.programConfigurations.populatePaintArrays(K.length,h,h.index,{},P,R,O,ze&&ze[At],this.worldview)}const we=q-i.length;we!==0&&this._addNullVertices(we,K,s,y,se,e,V,te,W);const Ne=y?y.anchor:v;e.placedSymbolArray.emplaceBack(Ne.x,Ne.y,Ne.z,v.x,v.y,le,this.glyphOffsetArray.length-le,fe,w,S,v.segment,s?s[0]:0,s?s[1]:0,a[0],a[1],p,0,0,0,A,0),e.symbolInstanceIndices.push(N)}_addNullVertices(e,i,s,a,u,h,p,y,v){for(let w=0;w<e;w++){for(let A=0;A<4;A++)Sp(i,0,0,0,0,0,0,s,!1,0,0,0,0),a&&Ap(u,0,0,0,0,0,0),_d(h.dynamicLayoutVertexArray,0,0,0,0),p&&Ep(h.iconTransitioningVertexArray,0,0);const S=y.vertexLength;v.emplaceBack(S,S+1,S+2),v.emplaceBack(S+1,S+2,S+3),y.vertexLength+=4,y.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,s,a,u,h,p){e.emplaceBack(i,s,a,u,h,Math.round(p.x),Math.round(p.y))}_addCollisionDebugVertices(e,i,s,a,u,h,p){const y=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),v=y.vertexLength,w=p.tileAnchorX,S=p.tileAnchorY;for(let P=0;P<4;P++)s.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(s.collisionVertexArrayExt,i,e.padding,p.zOffset),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,S,new Ye(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,S,new Ye(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,S,new Ye(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,a,u,h,w,S,new Ye(e.x1,e.y2)),y.vertexLength+=4;const A=s.indexArray;A.emplaceBack(v,v+1),A.emplaceBack(v+1,v+2),A.emplaceBack(v+2,v+3),A.emplaceBack(v+3,v),y.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,s,a,u,h){for(let p=a;p<u;p++){const y=s.get(p),v=this.getSymbolInstanceTextSize(e,h,i,p);this._addCollisionDebugVertices(y,v,this.textCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}_addIconDebugCollisionBoxes(e,i,s,a,u,h){for(let p=a;p<u;p++){const y=s.get(p),v=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._addCollisionDebugVertices(y,v,this.iconCollisionBox,y.projectedAnchorX,y.projectedAnchorY,y.projectedAnchorZ,h)}}generateCollisionDebugBuffers(e,i,s){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Lx(Uh,o1.members,Hs),this.iconCollisionBox=new Lx(Uh,o1.members,Hs);const a=dd(this.iconSizeData,e),u=dd(this.textSizeData,e,s);for(let h=0;h<this.symbolInstances.length;h++){const p=this.symbolInstances.get(h);this._addTextDebugCollisionBoxes(u,e,i,p.textBoxStartIndex,p.textBoxEndIndex,p),this._addTextDebugCollisionBoxes(u,e,i,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,i,p.iconBoxStartIndex,p.iconBoxEndIndex,p),this._addIconDebugCollisionBoxes(a,e,i,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex,p)}}getSymbolInstanceTextSize(e,i,s,a){const u=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:a),h=Ex(this.textSizeData,e,u)/On;return this.tilePixelRatio*h}getSymbolInstanceIconSize(e,i,s){const a=this.icon.placedSymbolArray.get(s),u=Ex(this.iconSizeData,e,a);return this.tilePixelRatio*u}_commitDebugCollisionVertexUpdate(e,i,s,a){e.emplaceBack(i,-s,-s,a),e.emplaceBack(i,s,-s,a),e.emplaceBack(i,s,s,a),e.emplaceBack(i,-s,s,a)}_updateTextDebugCollisionBoxes(e,i,s,a,u,h,p){for(let y=a;y<u;y++){const v=s.get(y),w=this.getSymbolInstanceTextSize(e,h,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,w,v.padding,h.zOffset)}}_updateIconDebugCollisionBoxes(e,i,s,a,u,h,p){for(let y=a;y<u;y++){const v=s.get(y),w=this.getSymbolInstanceIconSize(e,i,h.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,v.padding,h.zOffset)}}updateCollisionDebugBuffers(e,i,s,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const u=dd(this.iconSizeData,e,a),h=dd(this.textSizeData,e,s);for(let p=0;p<this.symbolInstances.length;p++){const y=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,i,y.textBoxStartIndex,y.textBoxEndIndex,y,s),this._updateTextDebugCollisionBoxes(h,e,i,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y,s),this._updateIconDebugCollisionBoxes(u,e,i,y.iconBoxStartIndex,y.iconBoxEndIndex,y,a),this._updateIconDebugCollisionBoxes(u,e,i,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y,a)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,s,a,u,h,p,y,v){const w={};if(i<s){const{x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K,featureIndex:se}=e.get(i);w.textBox={x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K},w.textFeatureIndex=se}if(a<u){const{x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K,featureIndex:se}=e.get(a);w.verticalTextBox={x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K},w.verticalTextFeatureIndex=se}if(h<p){const{x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K,featureIndex:se}=e.get(h);w.iconBox={x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K},w.iconFeatureIndex=se}if(y<v){const{x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K,featureIndex:se}=e.get(y);w.verticalIconBox={x1:S,y1:A,x2:P,y2:R,padding:O,projectedAnchorX:V,projectedAnchorY:N,projectedAnchorZ:q,tileAnchorX:W,tileAnchorY:K},w.verticalIconFeatureIndex=se}return w}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const s=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const s=e.placedSymbolArray.get(i),a=s.vertexStartIndex+4*s.numGlyphs;for(let u=s.vertexStartIndex;u<a;u+=4)e.indexArray.emplaceBack(u,u+1,u+2),e.indexArray.emplaceBack(u+1,u+2,u+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),s=Math.cos(e),a=[],u=[],h=[];for(let p=0;p<this.symbolInstances.length;++p){h.push(p);const y=this.symbolInstances.get(p);a.push(0|Math.round(i*y.tileAnchorX+s*y.tileAnchorY)),u.push(y.featureIndex)}return h.sort((p,y)=>a[p]-a[y]||u[y]-u[p]),h}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===i?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const s=this.symbolInstances.get(i);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:u,leftJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p,placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:v}=s;a>=0&&this.addIndicesForPlacedSymbol(this.text,a),u>=0&&u!==a&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&h!==u&&h!==a&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&this.addIndicesForPlacedSymbol(this.text,p),y>=0&&this.addIndicesForPlacedSymbol(this.icon,y),v>=0&&this.addIndicesForPlacedSymbol(this.icon,v)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let s;return this.elevationFeatures&&i<this.elevationFeatures.length&&(s=this.elevationFeatures[i]),s}}function G1(r,e){return e.replace(/{([^{}]+)}/g,(i,s)=>s in r?String(r[s]):"")}let H1,q1,zx;Mt(Z_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Z_.addDynamicAttributes=_d;class $1{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:vo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Mt($1,"FormatSectionOverride",{omit:["defaultValue"]});const Ox=()=>zx||(zx={layout:H1||(H1=new Xr({"symbol-placement":new lt(Se.layout_symbol["symbol-placement"]),"symbol-spacing":new lt(Se.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new lt(Se.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new pt(Se.layout_symbol["symbol-sort-key"]),"symbol-z-order":new lt(Se.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new lt(Se.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new lt(Se.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new lt(Se.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new lt(Se.layout_symbol["icon-ignore-placement"]),"icon-optional":new lt(Se.layout_symbol["icon-optional"]),"icon-rotation-alignment":new lt(Se.layout_symbol["icon-rotation-alignment"]),"icon-size":new pt(Se.layout_symbol["icon-size"]),"icon-size-scale-range":new lt(Se.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new pt(Se.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pt(Se.layout_symbol["icon-text-fit-padding"]),"icon-image":new pt(Se.layout_symbol["icon-image"]),"icon-image-use-theme":new lt({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new pt(Se.layout_symbol["icon-rotate"]),"icon-padding":new lt(Se.layout_symbol["icon-padding"]),"icon-keep-upright":new lt(Se.layout_symbol["icon-keep-upright"]),"icon-offset":new pt(Se.layout_symbol["icon-offset"]),"icon-anchor":new pt(Se.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new lt(Se.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new lt(Se.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new lt(Se.layout_symbol["text-rotation-alignment"]),"text-field":new pt(Se.layout_symbol["text-field"]),"text-font":new pt(Se.layout_symbol["text-font"]),"text-size":new pt(Se.layout_symbol["text-size"]),"text-size-scale-range":new lt(Se.layout_symbol["text-size-scale-range"]),"text-max-width":new pt(Se.layout_symbol["text-max-width"]),"text-line-height":new pt(Se.layout_symbol["text-line-height"]),"text-letter-spacing":new pt(Se.layout_symbol["text-letter-spacing"]),"text-justify":new pt(Se.layout_symbol["text-justify"]),"text-radial-offset":new pt(Se.layout_symbol["text-radial-offset"]),"text-variable-anchor":new lt(Se.layout_symbol["text-variable-anchor"]),"text-anchor":new pt(Se.layout_symbol["text-anchor"]),"text-max-angle":new lt(Se.layout_symbol["text-max-angle"]),"text-writing-mode":new lt(Se.layout_symbol["text-writing-mode"]),"text-rotate":new pt(Se.layout_symbol["text-rotate"]),"text-padding":new lt(Se.layout_symbol["text-padding"]),"text-keep-upright":new lt(Se.layout_symbol["text-keep-upright"]),"text-transform":new pt(Se.layout_symbol["text-transform"]),"text-offset":new pt(Se.layout_symbol["text-offset"]),"text-allow-overlap":new lt(Se.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new lt(Se.layout_symbol["text-ignore-placement"]),"text-optional":new lt(Se.layout_symbol["text-optional"]),visibility:new lt(Se.layout_symbol.visibility)})),paint:q1||(q1=new Xr({"icon-opacity":new pt(Se.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new pt(Se.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new pt(Se.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new pt(Se.paint_symbol["text-emissive-strength"]),"icon-color":new pt(Se.paint_symbol["icon-color"]),"icon-halo-color":new pt(Se.paint_symbol["icon-halo-color"]),"icon-halo-width":new pt(Se.paint_symbol["icon-halo-width"]),"icon-halo-blur":new pt(Se.paint_symbol["icon-halo-blur"]),"icon-translate":new lt(Se.paint_symbol["icon-translate"]),"icon-translate-anchor":new lt(Se.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new lt(Se.paint_symbol["icon-image-cross-fade"]),"text-opacity":new pt(Se.paint_symbol["text-opacity"]),"text-occlusion-opacity":new pt(Se.paint_symbol["text-occlusion-opacity"]),"text-color":new pt(Se.paint_symbol["text-color"],{runtimeType:Ss,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new pt(Se.paint_symbol["text-halo-color"]),"text-halo-width":new pt(Se.paint_symbol["text-halo-width"]),"text-halo-blur":new pt(Se.paint_symbol["text-halo-blur"]),"text-translate":new lt(Se.paint_symbol["text-translate"]),"text-translate-anchor":new lt(Se.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new lt(Se.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new lt(Se.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new lt(Se.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new lt(Se.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new pt(Se.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},zx);class X_ extends xs{constructor(e,i,s,a){super(e,Ox(),i,s,a,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=mt([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(a=>{a.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const a=[];for(const u of s)a.indexOf(u)<0&&a.push(u);this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,s,a){return this._saturation===e&&this._contrast===i&&this._brightnessMin===s&&this._brightnessMax===a||(this._colorAdjustmentMatrix=function(u,h,p,y){u=qr(u),h=Hi(h);const v=ft(),w=u/3,S=1-2*w,A=[S,w,w,0,w,S,w,0,w,w,S,0,0,0,0,1],P=.5-.5*h,R=y-p;return wt(v,[R,0,0,0,0,R,0,0,0,0,R,0,p,p,p,1],[h,0,0,0,0,h,0,0,0,0,h,0,P,P,P,1]),wt(v,v,A),v}(e,i,s,a),this._saturation=e,this._contrast=i,this._brightnessMin=s,this._brightnessMax=a),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,s,a){const u=this.layout.get(e).evaluate(i,{},s,a),h=this._unevaluatedLayout._values[e];return h.isDataDriven()||ru(h.value)||!u?u:G1(i.properties,u)}getAppearanceValueAndResolveTokens(e,i,s,a,u){const h=e.getProperty(i);if(!h)return;const p=h.evaluate(s,{},a,u),y=e.getUnevaluatedProperties()._values[i];return y.isDataDriven()||ru(y.value)||!p||typeof p!="string"?p:G1(s.properties,p)}createBucket(e){return new Z_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Ox().paint.overridableProperties){if(!X_.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),s=new $1(i),a=new Th(s,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let u=null;u=i.value.kind==="constant"||i.value.kind==="source"?new rc("source",a):new vl("composite",a,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new wl(i.property,u,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,s){return!(!this.layout||i.isDataDriven()||s.isDataDriven())&&X_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const s=e.get("text-field"),a=Ox().paint.properties[i];let u=!1;const h=p=>{for(const y of p)if(a.overrides&&a.overrides.hasOverride(y))return void(u=!0)};if(s.value.kind==="constant"&&s.value.value instanceof ms)h(s.value.value.sections);else if(s.value.kind==="source"){const p=v=>{u||(v instanceof ra&&zn(v.value)===jc?h(v.value.sections):v instanceof Bo?h(v.sections):v.eachChild(p))},y=s.value;y._styleExpression&&p(y._styleExpression.expression)}return u}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,s){return{config:new Wa(this,{zoom:i,lut:s}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let W1,Z1,X1,K1;var kx=Ii([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function K_(r,e,i,s,a,u,h,p){const y=[r,e,1,i,s,1,a,u,1],v=[h,p,1],w=Oe([],y),[S,A,P]=$e(v,v,w);return je(y,y,[S,0,0,0,A,0,0,0,P])}function Y1(r,e,i,s,a,u,h,p){const y=function(v,w,S,A,P,R,O,V){const N=K_(0,0,1,0,1,1,0,1),q=K_(v,w,S,A,P,R,O,V);return je(q,q,Oe([],N))}(r,e,i,s,a,u,h,p);return[y[2]/y[8]/ut,y[5]/y[8]/ut]}function Y_(r){return[r[0],Math.min(Math.max(r[1],-z),z)]}class J1 extends pl{constructor(e,i,s,a){super(),this.id=e,this.dispatcher=s,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(a),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new ko("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Hu(this.map._requestManager.transformRequest(this.url,Oc.Image),(s,a)=>{this._imageRequest=null,this._loaded=!0,s?this.fire(new Nc(s)):a&&(this.image=a instanceof HTMLImageElement?Ln.getImageData(a):a,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new up(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ko("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof up||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],s=e[0][1];for(const u of e)u[1]>s&&(s=u[1]),u[1]<i&&(i=u[1]);const a=(s+i)/2;if(a>z?this.onNorthPole=!0:a<-z&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const u=e.map(Z.fromLngLat);this.tileID=function(h){let p=1/0,y=1/0,v=-1/0,w=-1/0;for(const O of h)p=Math.min(p,O.x),y=Math.min(y,O.y),v=Math.max(v,O.x),w=Math.max(w,O.y);const S=Math.max(v-p,w-y),A=Math.max(0,Math.floor(-Math.log2(S))),P=Math.pow(2,A);let R=Math.floor((p+v)/2*P);return R>1&&(R-=1),new yr(A,R,Math.floor((y+w)/2*P))}(u),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ko("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof up||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const N in this.tiles){const q=this.tiles[N];q.state!=="loaded"&&(q.state="loaded",q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=xp(new yr(0,0,0),this.map.transform.projection),s=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(N){const q=N[1].x-N[0].x,W=N[1].y-N[0].y,K=N[2].x-N[1].x,se=N[2].y-N[1].y,te=N[3].x-N[2].x,le=N[3].y-N[2].y,fe=N[0].x-N[3].x,ge=N[0].y-N[3].y,ze=q*se-K*W,we=K*le-te*se,Ne=te*ge-fe*le,He=fe*W-q*ge;return ze>0&&we>0&&Ne>0&&He>0||ze<0&&we<0&&Ne<0&&He<0}(s))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const a=xp(this.tileID,this.map.transform.projection),[u,h,p,y]=this.coordinates.map(N=>{const q=a.projection.project(N[0],N[1]);return F1(a,q)._round()});this.perspectiveTransform=Y1(u.x,u.y,h.x,h.y,p.x,p.y,y.x,y.y);const v=this._boundsArray=new ac;v.emplaceBack(u.x,u.y,0,0),v.emplaceBack(h.x,h.y,ut,0),v.emplaceBack(y.x,y.y,0,ut),v.emplaceBack(p.x,p.y,ut,ut),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(v,kx.members),this.boundsSegments=Nr.simpleSegment(0,0,4,2);const w=[],S=[Y_((A=this.coordinates)[0]),Y_(A[1]),Y_(A[2]),Y_(A[3])];var A;const[P,R,O,V]=function(N){let q=N[0][0],W=q,K=N[0][1],se=K;for(let te=1;te<N.length;te++)N[te][0]<q?q=N[te][0]:N[te][0]>W&&(W=N[te][0]),N[te][1]<K?K=N[te][1]:N[te][1]>se&&(se=N[te][1]);return[q,K,W-q,se-K]}(S);{const N=new ac,[q,W,K,se]=function(Ze){let Xe=Ze[0].x,Be=Xe,ke=Ze[0].y,Ke=ke;for(let ht=1;ht<Ze.length;ht++)Ze[ht].x<Xe?Xe=Ze[ht].x:Ze[ht].x>Be&&(Be=Ze[ht].x),Ze[ht].y<ke?ke=Ze[ht].y:Ze[ht].y>Ke&&(Ke=Ze[ht].y);return[Xe,ke,Be-Xe,Ke-ke]}(s),te=Ze=>[(Ze.x-q)/K,(Ze.y-W)/se],[le,fe,ge,ze]=s.map(te),we=function(Ze,Xe,Be,ke,Ke,ht,st,Nt){const vt=K_(0,0,1,0,1,1,0,1);return je(vt,vt,Oe([],K_(Ze,Xe,Be,ke,Ke,ht,st,Nt)))}(le[0],le[1],fe[0],fe[1],ge[0],ge[1],ze[0],ze[1]);this.elevatedGlobePerspectiveTransform=Y1(le[0],le[1],fe[0],fe[1],ge[0],ge[1],ze[0],ze[1]);const Ne=(Ze,Xe)=>{w.push(Ze.lng);const Be=Math.round((Ze.lng-P)/O*ut),ke=Math.round((Ze.lat-R)/V*ut),Ke=te(Xe),ht=$e([],[Ke[0],Ke[1],1],we),st=Math.round(ht[0]/ht[2]*ut),Nt=Math.round(ht[1]/ht[2]*ut);N.emplaceBack(Be,ke,st,Nt)},He=s[3].x-s[0].x,qe=s[3].y-s[0].y,Je=s[2].x-s[1].x,et=s[2].y-s[1].y;for(let Ze=0;Ze<65;Ze++){const Xe=Ze/64,Be=[s[0].x+Xe*He,s[0].y+Xe*qe],ke=[s[1].x+Xe*Je,s[1].y+Xe*et],Ke=ke[0]-Be[0],ht=ke[1]-Be[1];for(let st=0;st<65;st++){const Nt=st/64,vt={x:Be[0]+Ke*Nt,y:Be[1]+ht*Nt};Ne(i.projection.unproject(vt.x,vt.y),vt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(N,kx.members)}{this.maxLongitudeTriangleSize=0;let N=[],q=new wn;const W=(K,se,te)=>{q.emplaceBack(K,se,te);const le=w[K],fe=w[se],ge=w[te],ze=Math.min(Math.min(le,fe),ge),we=Math.max(Math.max(le,fe),ge)-ze;we>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=we),N.push(ze+we/2)};for(let K=0;K<64;K++)for(let se=0;se<64;se++){const te=65*K+se,le=te+1,fe=te+65,ge=fe+1;W(te,fe,le),W(le,fe,ge)}[N,q]=function(K,se){const te=Array.from({length:K.length},(ge,ze)=>ze);te.sort((ge,ze)=>K[ge]-K[ze]);const le=[],fe=new wn;for(let ge=0;ge<te.length;ge++){const ze=te[ge];le.push(K[ze]);const we=3*ze,Ne=we+1;fe.emplaceBack(se.uint16[we],se.uint16[Ne],se.uint16[Ne+1])}return[le,fe]}(N,q),this.elevatedGlobeTrianglesCenterLongitudes=N,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(q)}this.elevatedGlobeSegments=Nr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,O/ut,0,V/ut,0,0,R,P,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,s=i.gl;!this._dirty||this.texture instanceof up||(this.texture?this.texture.update(this.image):(this.texture=new ax(i,this.image,s.RGBA8),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const s=this.elevatedGlobeTrianglesCenterLongitudes;let a=(u=e+180)+360*Math.round((s[0]-u)/360);var u;const h=new Nr,p=(S,A)=>{h.segments.push({vertexOffset:0,primitiveOffset:S,vertexLength:i.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(s[0]-a)<=y){const S=Hr(s,0,s.length,a+y);return S===s.length||p(S,yn(s,S+1,s.length,a+360-y)-S),h}a<s[0]&&(a+=360);const v=yn(s,0,s.length,a-y);if(v===s.length)return p(0,s.length),h;p(0,v-0);const w=Hr(s,v+1,s.length,a+y);return w!==s.length&&p(w,s.length-w),h}}const oC=(Math.pow(256,2)-1)/16907520;class Q1 extends xs{constructor(e,i,s,a){super(e,{layout:X1||(X1=new Xr({visibility:new lt(Se.layout_raster.visibility)})),paint:K1||(K1=new Xr({"raster-opacity":new lt(Se.paint_raster["raster-opacity"]),"raster-color":new Sl(Se.paint_raster["raster-color"]),"raster-color-mix":new lt(Se.paint_raster["raster-color-mix"]),"raster-color-range":new lt(Se.paint_raster["raster-color-range"]),"raster-hue-rotate":new lt(Se.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new lt(Se.paint_raster["raster-brightness-min"]),"raster-brightness-max":new lt(Se.paint_raster["raster-brightness-max"]),"raster-saturation":new lt(Se.paint_raster["raster-saturation"]),"raster-contrast":new lt(Se.paint_raster["raster-contrast"]),"raster-resampling":new lt(Se.paint_raster["raster-resampling"]),"raster-fade-duration":new lt(Se.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new lt(Se.paint_raster["raster-emissive-strength"]),"raster-array-band":new lt(Se.paint_raster["raster-array-band"]),"raster-elevation":new lt(Se.paint_raster["raster-elevation"]),"raster-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof J1&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[s,a]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(s)&&isNaN(a)||s===this._curRampRange[0]&&a===this._curRampRange[1]||(this.colorRamp=Xf({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:s,end:a}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[s,a])}}let ew,tw,iw,rw,nw;class sw extends xs{constructor(e,i,s,a){super(e,{layout:ew||(ew=new Xr({visibility:new lt(Se["layout_raster-particle"].visibility)})),paint:tw||(tw=new Xr({"raster-particle-array-band":new lt(Se["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new lt(Se["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Sl(Se["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new lt(Se["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new lt(Se["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new lt(Se["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new lt(Se["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new lt(Se["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},i,s,a),this._updateColorRamp(),this.lastInvalidatedAt=Ln.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Xf({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ln.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class aC extends xs{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Fx(r,e,i){const s=[0,0,1],a=vr([]);return Pr(a,a,i?-Wi(r)+Math.PI:Wi(r)),Dr(a,a,-Wi(e)),It(s,s,a),zt(s,s)}const ow={None:0,Model:1,Symbol:2,FillExtrusion:4};class J_{constructor(e,i,s,a){this.message=(e?`${e}: `:"")+s,a&&(this.identifier=a),i!=null&&i.__line__&&(this.line=i.__line__)}}function Bx(r,e){const i=r.indexOf("://")===-1;try{return new URL(r,i&&e?"http://example.com":void 0),!0}catch{return!1}}class aw{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class lw{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Bf,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let a=Math.floor(s[i+2]);const u=1.05*(s[i+2]-a);return a/=100,[s[i]%1*1.05,s[i+1]%1*1.05,u,a]}tileCoordinatesForInstance(e){const i=16*e,s=this.instancedDataArray.float32;let a=s[i+0];return a=a>ut?a-ut:a,new Ye(Math.trunc(a),Math.trunc(s[i+1]))}translationForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+4],s[i+5],s[i+6]]}rotationScaleForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+10],s[i+11],s[i+12],s[i+13],s[i+14],s[i+15]]}transformForInstance(e){const i=16*e,s=this.instancedDataArray.float32;return[s[i+7],s[i+8],s[i+9],s[i+4],s[i+10],s[i+11],s[i+12],s[i+5],s[i+13],s[i+14],s[i+15],s[i+6],0,0,0,1]}}class Nx{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,s,a){}populate(e,i,s,a){this.tileToMeter=G(s);const u=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:h,id:p,index:y,sourceLayerIndex:v}of e){const w=p??(h.properties&&h.properties.hasOwnProperty("id")?h.properties.id:void 0),S=be(h,u);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),S,s))continue;const A={id:w,sourceLayerIndex:v,index:y,geometry:u?S.geometry:ue(h,s,a),properties:h.properties,type:h.type,patterns:{}},P=this.addFeature(A,A.geometry,S);P&&i.featureIndex.insert(h,A.geometry,y,v,this.index,this.instancesPerModel[P].instancedDataArray.length,ut/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let s=0;for(const a of this.modelUris){const u=e.getModel(a,i);if(!u)continue;const h=this.instancesPerModel[a];if(h){const p=.5*Jo(u.aabb.max,u.aabb.min)*h.maxScale+h.maxXYTranslationDistance,y=Math.min(ut,Math.max(p/this.tileToMeter,ut/32));s=Math.max(y,s)}}return s}update(e,i,s,a){for(const u in this.instancesPerModel){const h=this.instancesPerModel[u];for(const p in e)h.idToFeaturesIndex.hasOwnProperty(p)&&(this.evaluate(h.features[h.idToFeaturesIndex[p]],e[p],h,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];for(const a of s.features){const u=this.layers[0],h=a.feature,p=this.canonical,y=u.paint.get("model-rotation").evaluate(h,{},p),v=u.paint.get("model-scale").evaluate(h,{},p),w=u.paint.get("model-translation").evaluate(h,{},p);bt(a.rotation,y)&&bt(a.scale,v)&&bt(a.translation,w)||(this.evaluate(a,a.featureStates,s,!0),e=!0)}}return e}updateReplacement(e,i,s,a){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(w_(this.activeReplacements,u))return!1;this.activeReplacements=u;let h=!1;for(const p in this.instancesPerModel){const y=this.instancesPerModel[p],v=y.instancedDataArray;for(const w of y.features){const S=w.instancedDataOffset,A=w.instancedDataCount;for(let P=0;P<A;P++){const R=16*(P+S);let O=v.float32[R+0];const V=O>ut;O=V?O-ut:O;const N=Math.floor(O),q=Math.floor(v.float32[R+1]);let W=!1;for(const K of this.activeReplacements)if(!Zv(K,s,ow.Model,a)&&!(K.min.x>N||N>K.max.x||K.min.y>q||q>K.max.y)&&(W=Qv(Jv(N,q,e.canonical,K.footprintTileId.canonical),K.footprint),W))break;v.float32[R]=W?O+ut:O,h=h||W!==V}}}return h}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const s=this.instancesPerModel[i];s.instancedDataArray.length<0||s.instancedDataArray.length===0||(s.instancedDataBuffer?s.instancedDataBuffer.updateData(s.instancedDataArray):s.instancedDataBuffer=e.createVertexBuffer(s.instancedDataArray,MA.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const s in this.instancesPerModel){const a=this.instancesPerModel[s];a.instancedDataArray.length!==0&&a.instancedDataBuffer&&a.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const s of this.modelUris)i.removeModel(s,"",!0)}addFeature(e,i,s){const a=this.layers[0],u=a.layout.get("model-id").evaluate(s,{},this.canonical);if(!u)return St(`modelId is not evaluated for layer ${a.id} and it is not going to get rendered.`),u;(Bx(u,!1)||this.styleDefinedModelURLs[u]!==void 0)&&(this.modelUris.includes(u)||this.modelUris.push(u)),this.instancesPerModel[u]||(this.instancesPerModel[u]=new lw);const h=this.instancesPerModel[u],p=h.instancedDataArray,y=new aw(s,p.length);for(const v of i)for(const w of v){if(w.x<0||w.x>=ut||w.y<0||w.y>=ut)continue;if(this.lookupDim!==0){const A=(this.lookupDim-1)/ut,P=this.lookupDim*(w.y*A|0)+w.x*A|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}}this.instanceCount++;const S=p.length;p.resize(S+1),h.instancesEvaluatedElevation.push(0),p.float32[16*S]=w.x,p.float32[16*S+1]=w.y}return y.instancedDataCount=h.instancedDataArray.length-y.instancedDataOffset,y.instancedDataCount>0&&(e.id&&(h.idToFeaturesIndex[e.id]=h.features.length),h.features.push(y),this.evaluate(y,{},h,!1)),u}getModelUris(){return this.modelUris}evaluate(e,i,s,a){const u=this.layers[0],h=e.feature,p=this.canonical,y=e.rotation=u.paint.get("model-rotation").evaluate(h,i,p),v=e.scale=u.paint.get("model-scale").evaluate(h,i,p),w=e.translation=u.paint.get("model-translation").evaluate(h,i,p),S=Object.assign({},u.paint.get("model-color").evaluate(h,i,p));S.a=u.paint.get("model-color-mix-intensity").evaluate(h,i,p);const A=[];this.maxVerticalOffset<w[2]&&(this.maxVerticalOffset=w[2]);const P=w[0]*w[0]+w[1]*w[1],R=P>0?Math.sqrt(P):0;s.maxScale=Math.max(Math.max(s.maxScale,v[0]),Math.max(v[1],v[2])),s.maxXYTranslationDistance=Math.max(s.maxXYTranslationDistance,R),this.maxScale=Math.max(Math.max(this.maxScale,v[0]),Math.max(v[1],v[2])),Nb(A,y,v);const O=Math.round(100*S.a)+S.b/1.05;for(let V=0;V<e.instancedDataCount;++V){const N=e.instancedDataOffset+V,q=16*N,W=s.instancedDataArray.float32;let K=0;a&&(K=W[q+6]-s.instancesEvaluatedElevation[N]);const se=0|W[q+1];W[q]=(0|W[q])+S.r/1.05,W[q+1]=se+S.g/1.05,W[q+2]=O,W[q+3]=1/(p.z>10?this.tileToMeter:G(p,se)),W[q+4]=w[0],W[q+5]=w[1],W[q+6]=w[2]+K,W[q+7]=A[0],W[q+8]=A[1],W[q+9]=A[2],W[q+10]=A[4],W[q+11]=A[5],W[q+12]=A[6],W[q+13]=A[8],W[q+14]=A[9],W[q+15]=A[10],s.instancesEvaluatedElevation[N]=w[2]}}}let cw,uw;Mt(Nx,"ModelBucket",{omit:["layers"]}),Mt(lw,"PerModelAttributes"),Mt(aw,"ModelFeature");class gd{constructor(e,i,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=s}static create(e,i,s){const a=s||e.findDEMTileFor(i);if(!a||!a.dem)return;const u=a.dem,h=a.tileID,p=1<<i.canonical.z-h.canonical.z;return new gd(a,u.dim/ut/p,[(i.canonical.x/p-h.canonical.x)*u.dim,(i.canonical.y/p-h.canonical.y)*u.dim])}tileCoordToPixel(e,i){const s=i*this._scale+this._offset[1];return new Ye(Math.floor(e*this._scale+this._offset[0]),Math.floor(s))}getElevationAt(e,i,s,a){const u=e*this._scale+this._offset[0],h=i*this._scale+this._offset[1],p=Math.floor(u),y=Math.floor(h),v=this._dem;return a=!!a,s?ii(ii(v.get(p,y,a),v.get(p,y+1,a),h-y),ii(v.get(p+1,y,a),v.get(p+1,y+1,a),h-y),u-p):v.get(p,y,a)}getElevationAtPixel(e,i,s){return this._dem.get(e,i,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*E(1,e)*this._dem.stride}}const Vx=new Float32Array(262144),Eu=new Uint8Array(262144);function hw(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,hw(i));return e}function dw(r,e,i){if(r.meshes)for(const s of r.meshes){if(s.aabb.min[0]===1/0)continue;const a=Ft.applyTransform(s.aabb,r.globalMatrix);i.insert(e,a.min[0],a.min[1],a.max[0],a.max[1])}if(r.children)for(const s of r.children)dw(s,e,i)}const fw=["","wall","door","roof","window","lamp","logo"];class pw{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:hw(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ft([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ft([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const s of this.node.meshes)this.node.lightMeshIndex!==e&&(s.transformedAabb=Ft.applyTransformFast(s.aabb,this.node.globalMatrix),i.encapsulate(s.transformedAabb)),e++;this.aabb=i}return this.aabb}}class Q_{constructor(e,i,s,a,u,h,p,y){this.id=s,this.layers=e,this.layerIds=this.layers.map(v=>v.fqid),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.modelTraits|=ld.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=ld.HasMapboxMeshFeatures),u&&(this.modelTraits|=ld.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.worldview=y,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const v of i)this.nodesInfo.push(new pw(v)),dw(v,p.featureIndexArray.length,p.grid),p.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,p.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const s of this.getNodesInfo()){const a=s.node;a.footprint&&i.push({footprint:a.footprint,id:e})}}updateAppearances(e,i,s,a){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const s=i?this.stateDependentLayers:this.layers;if(!ea(e,this.states))for(const a of s)this.evaluate(a,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const s of i){const a=s.node;this.uploaded?this.updatePbrBuffer(a):ux(a,e,!0)}for(const s of i)z_(s.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const s of e.meshes)s.pbrBuffer&&(s.pbrBuffer.updateData(s.featureArray),i=!0);return i}needsReEvaluation(e,i,s){const a=e.transform.projectionOptions,u=e.style.getBrightness(),h=this.brightness!==u;if(!this.uploaded||this.dirty||a.name!==this.projection.name||Ip(s.paint.get("model-color").value,h)||Ip(s.paint.get("model-color-mix-intensity").value,h)||Ip(s.paint.get("model-roughness").value,h)||Ip(s.paint.get("model-emissive-strength").value,h)||Ip(s.paint.get("model-height-based-emissive-strength-multiplier").value,h)){this.projection=a,this.brightness=u;const p=this.getNodesInfo();for(const y of p)y.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const s=this.getNodesInfo(),a=this.id.canonical;for(const u of s){const h=u.feature;u.evaluatedTranslation=i.paint.get("model-translation").evaluate(h,{},a),u.evaluatedScale=i.paint.get("model-scale").evaluate(h,{},a)}}evaluate(e,i){const s=this.getNodesInfo();for(const a of s){if(!a.node.meshes)continue;const u=a.feature,h=i&&i[u.id];if(ea(h,a.state))continue;a.state=structuredClone(h);const p=a.node.meshes&&a.node.meshes[0].featureData,y=a.evaluatedColor[2],v=a.evaluatedRMEA[2],w=this.id.canonical;if(a.hasTranslucentParts=!1,p){for(let S=0;S<fw.length;S++){const A=fw[S];A.length&&(u.properties.part=A);const P=e.paint.get("model-color").evaluate(u,h,w).toPremultipliedRenderColor(null),R=e.paint.get("model-color-mix-intensity").evaluate(u,h,w);a.evaluatedColor[S]=[P.r,P.g,P.b,R],a.evaluatedRMEA[S][0]=e.paint.get("model-roughness").evaluate(u,h,w),a.evaluatedRMEA[S][2]=e.paint.get("model-emissive-strength").evaluate(u,h,w),a.evaluatedRMEA[S][3]=P.a,a.emissionHeightBasedParams[S]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(u,h,w),!a.hasTranslucentParts&&P.a<1&&(a.hasTranslucentParts=!0)}delete u.properties.part,cC(a,y!==a.evaluatedColor[2]||v!==a.evaluatedRMEA[2],this.modelTraits)}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(u,h,w);a.evaluatedTranslation=e.paint.get("model-translation").evaluate(u,h,w),a.evaluatedScale=e.paint.get("model-scale").evaluate(u,h,w),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,s,a){const u=e.findDEMTileFor(s);if(u&&(u.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(u.dem&&u.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=u.tileID.overscaledZ;const h=gd.create(e,s,u);if(!h)return;this.modelTraits&ld.HasMapboxMeshFeatures&&this.updateDEM(e,h,s,a);for(const p of this.getNodesInfo()){const y=p.node;if(!y.footprint||!y.footprint.vertices||!y.footprint.vertices.length)continue;const v=y.footprint.vertices;let w=h.getElevationAt(v[0].x,v[0].y,!0,!0);for(let S=1;S<v.length;S++)w=Math.min(w,h.getElevationAt(v[S].x,v[S].y,!0,!0));y.elevation=w}}this.terrainTile=u.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,s,a){let u=i._dem._modifiedForSources[a];if(u===void 0&&(i._dem._modifiedForSources[a]=[],u=i._dem._modifiedForSources[a]),u.includes(s.canonical))return;const h=i._dem.dim;u.push(s.canonical);let p=!1;for(const y of this.getNodesInfo()){const v=y.node;if(!v.footprint||!v.footprint.grid)continue;const w=v.footprint.grid,S=i.tileCoordToPixel(w.min.x,w.min.y),A=i.tileCoordToPixel(w.max.x,w.max.y),P=Math.min(Math.min(h-A.y,S.x),Math.min(S.y,h-A.x));if(P<0)continue;const R=U(P,2,5);let O=Math.max(0,S.x-R),V=Math.max(0,S.y-R),N=Math.min(A.x+R,h-1),q=Math.min(A.y+R,h-1);for(let te=V;te<=q;++te)for(let le=O;le<=N;++le)Eu[te*h+le]=255;let W=0,K=0;for(let te=0;te<w.cellsY;++te)for(let le=0;le<w.cellsX;++le){if(!w.cells[te*w.cellsX+le])continue;const fe=i.tileCoordToPixel(w.min.x+le/w.xScale,w.min.y+te/w.yScale),ge=i.tileCoordToPixel(w.min.x+(le+1)/w.xScale,w.min.y+(te+1)/w.yScale);for(let ze=fe.y;ze<=Math.min(ge.y+1,h-1);++ze)for(let we=fe.x;we<=Math.min(ge.x+1,h-1);++we)Eu[ze*h+we]===255&&(Eu[ze*h+we]=0,W+=i.getElevationAtPixel(we,ze),K++)}const se=W/K;O=Math.max(1,S.x-R),V=Math.max(1,S.y-R),N=Math.min(A.x+R,h-2),q=Math.min(A.y+R,h-2),p=!0;for(let te=V;te<=q;++te)for(let le=O;le<=N;++le)Eu[te*h+le]===0&&(Vx[te*h+le]=i._dem.set(le,te,se));for(let te=1;te<R;++te){O=Math.max(1,S.x-te),V=Math.max(1,S.y-te),N=Math.min(A.x+te,h-2),q=Math.min(A.y+te,h-2);for(let le=V;le<=q;++le)for(let fe=O;fe<=N;++fe){const ge=le*h+fe;if(Eu[ge]===255){let ze=0,we=0,Ne=-1,He=-1;for(let qe=-1;qe<=1;++qe)for(let Je=-1;Je<=1;++Je){const et=(le+qe)*h+fe+Je;if(Eu[et]>=te)continue;const Ze=Vx[et],Xe=Math.abs(Ze);Xe>we&&(ze=Ze,we=Xe,Ne=Je,He=qe)}if(we>.1){const qe=1-(te+.5*Math.abs(Ne*He))/R;let Je=i._dem.get(fe,le)+ze*qe;const et=i._dem.get(fe+Ne,le+He),Ze=i._dem.get(fe-Ne,le-He,!0);(Je-et)*(Je-Ze)>0&&(Je=(et+Ze)/2),Vx[ge]=i._dem.set(fe,le,Je),Eu[ge]=te}}}}}p&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Ln.now())}setFilter(e){this.filter=e?Dh(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Mr(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)z_(i.node),hx(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const s=i.getReplacementRegionsForTile(e.toUnwrapped());for(const a of this.getNodesInfo()){const u=a.node.footprint;a.hiddenByReplacement=!!u&&!s.find(h=>h.footprint===u)}}getHeightAtTileCoord(e,i){const s=[],a=[0,0,0],u=mt([]);for(const h of this.getNodesInfo()){const p=h.node.meshes[0],y=p.transformedAabb;if(e<y.min[0]||i<y.min[1]||e>y.max[0]||i>y.max[1])continue;if(h.node.hidden===!0)return{height:1/0,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};Wt(u,h.node.globalMatrix),a[0]=e,a[1]=i,Ae(a,a,u);const v=(a[0]-p.aabb.min[0])/(p.aabb.max[0]-p.aabb.min[0])*wu|0,w=Math.min(63,(a[1]-p.aabb.min[1])/(p.aabb.max[1]-p.aabb.min[1])*wu|0)*wu+Math.min(63,v),S=p.heightmap[w];if(!(S<0&&h.node.footprint))return h.hiddenByReplacement?void 0:{height:S,maxHeight:h.feature.properties.height,hidden:!1,verticalScale:h.evaluatedScale[2]};if(h.node.footprint.grid.query(new Ye(e,i),new Ye(e,i),s),s.length>0)return{height:void 0,maxHeight:h.feature.properties.height,hidden:h.hiddenByReplacement,verticalScale:h.evaluatedScale[2]}}}}function Ip(r,e){return r instanceof rc&&!r.isLightConstant&&e}function lC(r,e,i,s,a,u,h,p){let y=(61440&e|(61440&e)>>4)>>8,v=(3840&e|(3840&e)>>4)>>4,w=240&e|(240&e)>>4;i[3]>0&&(y=ii(y,255*i[0],i[3]),v=ii(v,255*i[1],i[3]),w=ii(w,255*i[2],i[3]));const S=y<<8|v,A=w<<8|Math.floor(255*s[3]),P=function(te){const le=U(te,0,2);return Math.min(Math.round(.5*le*255),255)}(s[2])<<8|15*s[0]<<4|15*s[1],R=U(a[0],0,1),O=U(a[1],0,1),V=U(a[2],0,1),N=U(a[3],0,1);let q,W,K,se;if(R!==O&&h!==u&&O!==R){const te=h-u;W=1/(te*(O-R)),K=-(u+te*R)/(te*(O-R));const le=U(a[4],-1,1);se=Math.pow(10,le),q=255*V<<8|255*N}else q=65535,W=0,K=1,se=1;if(r.emplaceBack(S,A,P,q,W,K,se),p){const te=p.length;p.clear();for(let le=0;le<te;le++)p.emplaceBack(S,A,P,q,W,K,se)}}function cC(r,e,i){const s=r.node;let a=0;const u=i&ld.HasMeshoptCompression;for(const h of s.meshes){if(s.lights&&s.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new Gh,h.featureArray.reserve(h.featureData.length);let p=e;for(const y of h.featureData){const v=u?65535&y:y>>16&65535,w=u?y>>16&65535:65535&y,S=(15&w)<8?15&w:0,A=r.evaluatedRMEA[S],P=r.evaluatedColor[S],R=r.emissionHeightBasedParams[S];let O;if(p&&S===2&&s.lights&&(O=new Gh,O.resize(10*s.lights.length)),lC(h.featureArray,v,P,A,R,h.aabb.min[2],h.aabb.max[2],O),O&&p){p=!1;const V=s.meshes[s.lightMeshIndex];V.featureArray=O,V.featureArray._trim()}}h.featureArray._trim(),a++}}Mt(Q_,"Tiled3dModelBucket",{omit:["layers"]}),Mt(pw,"Tiled3dModelFeature");const uC=["id","tile","layer","source","sourceLayer","state"];class Au{constructor(e,i,s,a,u){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=s,this._y=a,this.properties=e?e.properties:{},this.id=u}clone(){const e=new Au(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of uC)this[i]!==void 0&&(e[i]=this[i]);return e}}class Iu extends pl{constructor(e,i,s,a){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=i,this._modelsInfo=new Map}load(){const e=[];for(const i in this._options.models){const s=this._options.models[i],a=this._modelsInfo.get(i);if(a){const u=a.model;u.position=s.position!=null?new n(s.position[0],s.position[1]):new n(0,0),u.orientation=s.orientation!=null?s.orientation:[0,0,0],a.modelSpec=s,Iu.applyModelSpecification(u,s),u.computeBoundsAndApplyParent(),this.models.push(u)}else{const u=Ob(this.map._requestManager.transformRequest(s.uri,Oc.Model).url).then(h=>{if(!h)return;const p=fx(h),y=new Vb(i,s.uri,s.position,s.orientation,p);Iu.applyModelSpecification(y,s),y.computeBoundsAndApplyParent(),this.models.push(y),this._modelsInfo.set(i,{modelSpec:s,model:y})}).catch(h=>{this.fire(new Nc(new Error(`Could not load model ${i} from ${s.uri}: ${h.message}`)))});e.push(u)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new ko("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(i=>{this._loaded=!0,this.fire(new Nc(new Error(`Could not load models: ${i.message}`)))})}static applyModelSpecification(e,i){i.nodeOverrides&&Iu.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&Iu.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(s=>typeof s=="string")){e.nodeOverrideNames=[];for(const s of i)e.nodeOverrideNames.push(s)}else Object.entries(i).forEach(([s,a])=>{const u={orientation:[0,0,0]};if(a.hasOwnProperty("orientation")){const h=a.orientation;h&&(u.orientation=h)}e.nodeOverrides.set(s,u)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(s=>typeof s=="string")){e.materialOverrideNames=[];for(const s of i)e.materialOverrideNames.push(s)}else Object.entries(i).forEach(([s,a])=>{const u={color:new or(1,1,1),colorMix:0,emissionStrength:0,opacity:1},h=a["model-color"];h!==void 0&&(u.color.r=h[0],u.color.g=h[1],u.color.b=h[2]);const p=a["model-color-mix-intensity"];p!==void 0&&(u.colorMix=p);const y=a["model-emissive-strength"];y!==void 0&&(u.emissionStrength=y);const v=a["model-opacity"];v!==void 0&&(u.opacity=v),e.materialOverrides.set(s,u)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=So(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const i=new Map;for(const s in e){const a=e[s];if(this._modelsInfo.has(s)){const u=this._modelsInfo.get(s);u&&u.modelSpec.uri===a.uri&&i.set(s,u)}}this._modelsInfo=i,this._options.models=e,this._loaded=!1,this.load()}}function Ux(r,e,i,s){const a=1<<r.z;e.lat=L((s/ut+r.y)/a),e.lng=I((i/ut+r.x)/a)}function hC(r,e,i,s){const a=r.getNodesInfo()[e];if(!a||a.hiddenByReplacement||!a.node.meshes)return;let u=Number.MAX_VALUE;const h=a.node,p=i.tile,y=s.calculatePosMatrix(p.tileID.toUnwrapped(),s.worldSize),v=a.evaluatedScale;let w=0;s.elevation&&h.elevation&&(w=h.elevation*s.elevation.exaggeration()),Xt(y,y,[(h.anchor?h.anchor[0]:0)*(v[0]-1),(h.anchor?h.anchor[1]:0)*(v[1]-1),w]),Zt(y,y,v);const S=i.queryGeometry,A=S.isPointQuery()?S.screenBounds:S.screenGeometry,P=function(O){const V=wt([],y,O.globalMatrix);wt(V,s.expandedFarZProjMatrix,V);for(let N=0;N<O.meshes.length;++N){const q=O.meshes[N];if(N===O.lightMeshIndex)continue;const W=cx(A,s,V,q.aabb);W!=null&&(u=Math.min(W,u))}if(O.children)for(const N of O.children)P(N)};if(P(h),u===Number.MAX_VALUE)return;const R=new n(0,0);return Ux(p.tileID.canonical,R,a.node.anchor[0],a.node.anchor[1]),{intersectionZ:u,position:R,feature:a.feature}}const dC={circle:class extends xs{constructor(r,e,i,s){super(r,{layout:Is||(Is=new Xr({"circle-sort-key":new pt(Se.layout_circle["circle-sort-key"]),"circle-elevation-reference":new lt(Se.layout_circle["circle-elevation-reference"]),visibility:new lt(Se.layout_circle.visibility)})),paint:Kr||(Kr=new Xr({"circle-radius":new pt(Se.paint_circle["circle-radius"]),"circle-color":new pt(Se.paint_circle["circle-color"]),"circle-blur":new pt(Se.paint_circle["circle-blur"]),"circle-opacity":new pt(Se.paint_circle["circle-opacity"]),"circle-translate":new lt(Se.paint_circle["circle-translate"]),"circle-translate-anchor":new lt(Se.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new lt(Se.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new lt(Se.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new pt(Se.paint_circle["circle-stroke-width"]),"circle-stroke-color":new pt(Se.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new pt(Se.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new lt(Se.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}createBucket(r){return new ar(r)}queryRadius(r){const e=r;return os("circle-radius",this,e)+os("circle-stroke-width",this,e)+Wn(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,s,a,u,h,p){const y=ao(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),v=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return bv(r,s,u,h,p,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",y,v)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e,i){const s=vv(this);return{config:new Wa(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}is3D(r){return!r&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends xs{createBucket(r){return new Tv(r)}constructor(r,e,i,s){super(r,{layout:Sv||(Sv=new Xr({visibility:new lt(Se.layout_heatmap.visibility)})),paint:Ev||(Ev=new Xr({"heatmap-radius":new pt(Se.paint_heatmap["heatmap-radius"]),"heatmap-weight":new pt(Se.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new lt(Se.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Sl(Se.paint_heatmap["heatmap-color"]),"heatmap-opacity":new lt(Se.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Xf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(r){return os("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,s,a,u,h,p){const y=this.paint.get("heatmap-radius").evaluate(e,i);return bv(r,s,u,h,p,!0,!0,new Ye(0,0),y)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e,i){return r==="heatmap"?{config:new Wa(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends xs{constructor(r,e,i,s){super(r,{layout:Av||(Av=new Xr({visibility:new lt(Se.layout_hillshade.visibility)})),paint:Iv||(Iv=new Xr({"hillshade-illumination-direction":new lt(Se.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new lt(Se.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new lt(Se.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new lt(Se.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new lt(Se.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new lt(Se.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new lt(Se.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}},fill:class extends xs{constructor(r,e,i,s){super(r,{layout:jv||(jv=new Xr({"fill-sort-key":new pt(Se.layout_fill["fill-sort-key"]),visibility:new lt(Se.layout_fill.visibility),"fill-elevation-reference":new lt(Se.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new pt(Se.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Gv||(Gv=new Xr({"fill-antialias":new lt(Se.paint_fill["fill-antialias"]),"fill-opacity":new pt(Se.paint_fill["fill-opacity"]),"fill-color":new pt(Se.paint_fill["fill-color"]),"fill-outline-color":new pt(Se.paint_fill["fill-outline-color"]),"fill-translate":new lt(Se.paint_fill["fill-translate"]),"fill-translate-anchor":new lt(Se.paint_fill["fill-translate-anchor"]),"fill-pattern":new pt(Se.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new lt(Se.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new lt(Se.paint_fill["fill-emissive-strength"]),"fill-z-offset":new pt(Se.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new pt(Se.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new pt(Se.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e,i){return{config:new Wa(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new $y(r)}queryRadius(){return Wn(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,s,a,u){return!r.queryGeometry.isAboveHorizon&&er(qs(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),s)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(r){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return r!=null?e&&!r:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends xs{constructor(r,e,i,s){super(r,{layout:mb||(mb=new Xr({visibility:new lt(Se["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new lt(Se["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:_b||(_b=new Xr({"fill-extrusion-opacity":new lt(Se["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new pt(Se["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new lt(Se["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new lt(Se["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new pt(Se["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new lt(Se["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new pt(Se["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new pt(Se["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new lt(Se["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new lt(Se["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new lt(Se["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new lt(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new lt(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new lt(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new lt(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new lt(Se["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new lt(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new lt(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new pt(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new pt(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new lt(Se["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new lt(Se["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new lt(Se["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new lt(Se["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new pt(Se["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new pt(Se["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new lt(Se["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new S_(r)}queryRadius(){return Wn(this.paint.get("fill-extrusion-translate"))}is3D(r){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,s,a,u,h,p,y){const v=ao(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),w=this.paint.get("fill-extrusion-height").evaluate(e,i),S=this.paint.get("fill-extrusion-base").evaluate(e,i),A=[0,0],P=p&&u.elevation,R=u.elevation?u.elevation.exaggeration():1,O=r.tile.getBucket(this);if(P&&O instanceof S_){const K=O.centroidVertexArray,se=y+1;se<K.length&&(A[0]=K.geta_centroid_pos0(se),A[1]=K.geta_centroid_pos1(se))}if(A[0]===0&&A[1]===1)return!1;u.projection.name==="globe"&&(s=pb([s],[new Ye(0,0),new Ye(ut,ut)],r.tileID.canonical).map(K=>K.polygon).flat());const V=P?p:null,[N,q]=Tb(u,s,S,w,v,h,V,A,R,u.center.lat,r.tileID.canonical),W=r.queryGeometry;return wb(N,q,W.isPointQuery()?W.screenBounds:W.screenGeometry)}},building:class extends xs{constructor(r,e,i,s){super(r,{layout:Wb||(Wb=new Xr({visibility:new lt(Se.layout_building.visibility),"building-facade":new pt(Se.layout_building["building-facade"]),"building-facade-floors":new pt(Se.layout_building["building-facade-floors"]),"building-facade-unit-width":new pt(Se.layout_building["building-facade-unit-width"]),"building-facade-window":new pt(Se.layout_building["building-facade-window"]),"building-roof-shape":new pt(Se.layout_building["building-roof-shape"]),"building-height":new pt(Se.layout_building["building-height"]),"building-base":new pt(Se.layout_building["building-base"]),"building-flood-light-wall-radius":new pt(Se.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new pt(Se.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new pt(Se.layout_building["building-flip-roof-orientation"])})),paint:Zb||(Zb=new Xr({"building-opacity":new lt(Se.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new lt(Se.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new lt(Se.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new lt(Se.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new lt(Se.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new lt(Se.paint_building["building-vertical-scale"]),"building-cast-shadows":new lt(Se.paint_building["building-cast-shadows"]),"building-color":new pt(Se.paint_building["building-color"]),"building-emissive-strength":new pt(Se.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new lt(Se.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new lt(Se.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new lt(Se.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new lt(Se.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new lt(Se.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new $b(r)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(r){return!0}queryRadius(r){return 0}queryIntersectsFeature(r,e,i,s,a,u,h,p,y){let v=this.layout.get("building-height").evaluate(e,i);const w=this.layout.get("building-base").evaluate(e,i),S=r.tile.getBucket(this).getFootprint(e);if(S){if(S.hiddenFlags!==0)return!1;v=S.height}const[A,P]=Tb(u,s,w,v,new Ye(0,0),h,null,[0,0],1,u.center.lat,r.tileID.canonical),R=r.queryGeometry;return wb(A,P,R.isPointQuery()?R.screenBounds:R.screenGeometry)}},line:class extends xs{constructor(r,e,i,s){const a=n1();super(r,a,e,i,s),a.layout&&(this.layout=new Tl(a.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Yc,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=(()=>{if(dp)return dp;const i=n1();return dp=new oI(i.paint.properties["line-width"].specification),dp.useIntegerZoom=!0,dp})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new _x(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e,i){const s=i1(this);return{config:new Wa(this,{zoom:e,lut:i}),defines:s,overrideFog:!1}}queryRadius(r){const e=r,i=s1(os("line-width",this,e),os("line-gap-width",this,e)),s=os("line-offset",this,e);return i/2+Math.abs(s)+Wn(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,s,a,u){if(r.queryGeometry.isAboveHorizon)return!1;const h=qs(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),u.angle,r.pixelToTileUnitsFactor),p=r.pixelToTileUnitsFactor/2*s1(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),y=this.paint.get("line-offset").evaluate(e,i);return y&&(s=function(v,w){const S=[],A=new Ye(0,0);for(let P=0;P<v.length;P++){const R=v[P],O=[];for(let V=0;V<R.length;V++){const N=R[V],q=R[V+1],W=V===0?A:N.sub(R[V-1])._unit()._perp(),K=V===R.length-1?A:q.sub(N)._unit()._perp(),se=W._add(K)._unit();se._mult(1/(se.x*K.x+se.y*K.y)),O.push(se._mult(w)._add(N))}S.push(O)}return S}(s,y*r.pixelToTileUnitsFactor)),function(v,w,S){for(let A=0;A<w.length;A++){const P=w[A];if(v.length>=3){for(let R=0;R<P.length;R++)if(gr(v,P[R]))return!0}if($r(v,P,S))return!0}return!1}(h,s,p)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(r){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:X_,background:class extends xs{constructor(r,e,i,s){super(r,{layout:W1||(W1=new Xr({visibility:new lt(Se.layout_background.visibility)})),paint:Z1||(Z1=new Xr({"background-pitch-alignment":new lt(Se.paint_background["background-pitch-alignment"]),"background-color":new lt(Se.paint_background["background-color"]),"background-pattern":new lt(Se.paint_background["background-pattern"]),"background-opacity":new lt(Se.paint_background["background-opacity"]),"background-emissive-strength":new lt(Se.paint_background["background-emissive-strength"]),"background-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e,i){return{overrideFog:!1}}is3D(r){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:Q1,"raster-particle":sw,sky:class extends xs{constructor(r,e,i,s){super(r,{layout:iw||(iw=new Xr({visibility:new lt(Se.layout_sky.visibility)})),paint:rw||(rw=new Xr({"sky-type":new lt(Se.paint_sky["sky-type"]),"sky-atmosphere-sun":new lt(Se.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new lt(Se.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new lt(Se.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new lt(Se.paint_sky["sky-gradient-radius"]),"sky-gradient":new Sl(Se.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new lt(Se.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new lt(Se.paint_sky["sky-atmosphere-color"]),"sky-opacity":new lt(Se.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Xf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const s=this.paint.get("sky-atmosphere-sun"),a=!s,u=r.style.light,h=u.properties.get("position");return a&&u.properties.get("anchor")==="viewport"&&St("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),a?Fx(h.azimuthal,90-h.polar,e):Fx(s[0],90-s[1],e)}const i=this.paint.get("sky-gradient-center");return Fx(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends xs{constructor(r,e,i,s){super(r,{paint:nw||(nw=new Xr({}))},e,null)}},model:class extends xs{constructor(r,e,i,s){super(r,{layout:cw||(cw=new Xr({visibility:new lt(Se.layout_model.visibility),"model-id":new pt(Se.layout_model["model-id"])})),paint:uw||(uw=new Xr({"model-opacity":new pt(Se.paint_model["model-opacity"]),"model-rotation":new pt(Se.paint_model["model-rotation"]),"model-scale":new pt(Se.paint_model["model-scale"]),"model-translation":new pt(Se.paint_model["model-translation"]),"model-color":new pt(Se.paint_model["model-color"]),"model-color-mix-intensity":new pt(Se.paint_model["model-color-mix-intensity"]),"model-type":new lt(Se.paint_model["model-type"]),"model-cast-shadows":new lt(Se.paint_model["model-cast-shadows"]),"model-receive-shadows":new lt(Se.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new lt(Se.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new pt(Se.paint_model["model-emissive-strength"]),"model-roughness":new pt(Se.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new pt(Se.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new lt(Se.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new lt(Se.paint_model["model-front-cutoff"]),"model-elevation-reference":new lt(Se.paint_model["model-elevation-reference"]),"model-color-use-theme":new pt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,s),this.layer=r,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Nx(r)}getProgramIds(){return["model"]}is3D(r){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(r){return r instanceof Q_?ut-1:0}queryRenderedFeatures(r,e,i){const s=e.getSource();if(!(s&&s instanceof Iu))return{};const a=s,u={};u[this.id]=[];const h=u[this.id];let p=0;for(const y of a.models){const v=e.getFeatureState(this.sourceLayer,y.id),w={type:"Unknown",id:y.id,properties:y.featureProperties},S=this.paint.get("model-rotation").evaluate(w,v),A=this.paint.get("model-scale").evaluate(w,v),P=this.paint.get("model-translation").evaluate(w,v),R=this.paint.get("model-elevation-reference");let O=[];L_(O,y,i,y.position,S,A,P,R==="ground",R==="ground",!1),i.projection.name==="globe"&&(O=D_(O,i));const V=wt([],i.projMatrix,O),N=cx(r.isPointQuery()?r.screenBounds:r.screenGeometry,i,V,y.aabb);if(N!=null){const q=new Au(void 0,0,0,0,y.id);q.layer=this.layer,q.properties=structuredClone(y.featureProperties),q.properties.layer=this.id,q.properties.uri=y.uri,q.properties.orientation=y.orientation,q.sourceLayer=this.sourceLayer,q.geometry={type:"Point",coordinates:[y.position.lng,y.position.lat]},q.state=v,q.source=this.source,h.push({featureIndex:p,feature:q,intersectionZ:N})}++p}return u}queryIntersectsFeature(r,e,i,s,a,u){if(!this.modelManager)return!1;const h=this.modelManager,p=r.tile.getBucket(this);if(!(p&&p instanceof Nx))return!1;for(const y in p.instancesPerModel){const v=p.instancesPerModel[y],w=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(v.idToFeaturesIndex.hasOwnProperty(w)){const S=v.features[v.idToFeaturesIndex[w]],A=h.getModel(y,this.scope);if(!A)return!1;let P=[];const R=new n(0,0),O=p.canonical;let V=Number.MAX_VALUE;for(let N=0;N<S.instancedDataCount;++N){const q=16*(S.instancedDataOffset+N),W=v.instancedDataArray.float32,K=[W[q+4],W[q+5],W[q+6]];Ux(O,R,Math.floor(W[q]),Math.floor(W[q+1])),L_(P,A,u,R,S.rotation,S.scale,K,!1,!1,!1),u.projection.name==="globe"&&(P=D_(P,u));const se=wt([],u.projMatrix,P),te=r.queryGeometry,le=cx(te.isPointQuery()?te.screenBounds:te.screenGeometry,u,se,A.aabb);le!=null&&(V=Math.min(le,V))}return V!==Number.MAX_VALUE&&V}}return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof vl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends xs{constructor(r,e,i,s){super(r,{layout:Hv||(Hv=new Xr({"clip-layer-types":new lt(Se.layout_clip["clip-layer-types"]),"clip-layer-scope":new lt(Se.layout_clip["clip-layer-scope"])})),paint:qv||(qv=new Xr({}))},e,i,s)}recalculate(r,e){super.recalculate(r,e)}createBucket(r){return new $v(r)}is3D(r){return!0}}},jx=new or(0,0,0),Gx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Hx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},eg={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},fC={PAINT_ORDER_FILL_AND_STROKE:1},Cp={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},mw={MASK_TYPE_LUMINANCE:1};function pC(r,e,i){r===1&&e.icons.push(function(s,a){return function(u){if(u.usvg_tree.height||(u.usvg_tree.height=u.usvg_tree.width),!u.metadata)return u;const{metadata:h}=u;if(h.content_area){const{content_area:p}=h;p.left==null&&(p.left=0),p.top==null&&(p.top=p.left),p.width==null&&(p.width=u.usvg_tree.width),p.height==null&&(p.height=p.width)}if(h.text_placeholder){const{text_placeholder:p}=h;p.top==null&&(p.top=p.left),p.height==null&&(p.height=p.width)}return h.stretch_x&&h.stretch_x.length&&_w(h,"x"),h.stretch_y&&h.stretch_y.length&&_w(h,"y"),u}(s.readFields(mC,{name:void 0},a))}(i,i.readVarint()+i.pos))}function _w(r,e){const i=[],s=r[`stretch_${e}`];let a=null;for(let u=0;u<s.length;u++)a===null?a=i.length===0?s[0]:i[i.length-1][1]+s[u]:(i.push([a,a+s[u]]),a=null);r[`stretch_${e}_areas`]=i}function mC(r,e,i){r===1?e.name=i.readString():r===2?e.metadata=function(s,a){return s.readFields(_C,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},a)}(i,i.readVarint()+i.pos):r===3&&(e.usvg_tree=function(s,a){return s.readFields(xC,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},a)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function _C(r,e,i){r===1?e.stretch_x=i.readPackedVarint():r===2?e.stretch_y=i.readPackedVarint():r===3?e.content_area=gw(i,i.readVarint()+i.pos):r===4?e.variables.push(function(s,a){return s.readFields(yC,{name:void 0},a)}(i,i.readVarint()+i.pos)):r===5&&(e.text_placeholder=gw(i,i.readVarint()+i.pos))}function gw(r,e){return r.readFields(gC,{},e)}function gC(r,e,i){r===1?e.left=i.readVarint():r===2?e.width=i.readVarint():r===3?e.top=i.readVarint():r===4&&(e.height=i.readVarint())}function yC(r,e,i){r===1?e.name=i.readString():r===2&&(e.rgb_color=rg(i.readVarint()),e.value="rgb_color")}function xC(r,e,i){r===1?e.width=e.height=i.readVarint():r===2?e.height=i.readVarint():r===3?e.children.push(tg(i,i.readVarint()+i.pos)):r===4?e.linear_gradients.push(function(s,a){return s.readFields(AC,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},a)}(i,i.readVarint()+i.pos)):r===5?e.radial_gradients.push(function(s,a){return s.readFields(CC,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},a)}(i,i.readVarint()+i.pos)):r===7?e.clip_paths.push(function(s,a){return s.readFields(PC,{children:[]},a)}(i,i.readVarint()+i.pos)):r===8&&e.masks.push(function(s,a){const u=s.readFields(MC,{left:0,width:20,mask_type:mw.MASK_TYPE_LUMINANCE,children:[]},a);return u.height==null&&(u.height=u.width),u.top==null&&(u.top=u.left),u}(i,i.readVarint()+i.pos))}function tg(r,e){return r.readFields(vC,{},e)}function vC(r,e,i){r===1?(e.group=function(s,a){return s.readFields(bC,{opacity:255,children:[]},a)}(i,i.readVarint()+i.pos),e.node="group"):r===2&&(e.path=function(s,a){return s.readFields(TC,{paint_order:1,commands:[],step:1,diffs:[],rule:Gx.PATH_RULE_NON_ZERO},a)}(i,i.readVarint()+i.pos),e.node="path")}function bC(r,e,i){r===1?e.transform=ig(i,i.readVarint()+i.pos):r===2?e.opacity=i.readVarint():r===5?e.clip_path_idx=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(tg(i,i.readVarint()+i.pos))}function ig(r,e){return r.readFields(wC,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function wC(r,e,i){r===1?e.sx=i.readFloat():r===2?e.ky=i.readFloat():r===3?e.kx=i.readFloat():r===4?e.sy=i.readFloat():r===5?e.tx=i.readFloat():r===6&&(e.ty=i.readFloat())}function TC(r,e,i){r===1?e.fill=function(s,a){return s.readFields(SC,{rgb_color:jx,paint:"rgb_color",opacity:255},a)}(i,i.readVarint()+i.pos):r===2?e.stroke=function(s,a){return s.readFields(EC,{rgb_color:jx,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},a)}(i,i.readVarint()+i.pos):r===3?e.paint_order=i.readVarint():r===5?i.readPackedVarint(e.commands):r===6?e.step=i.readFloat():r===7?i.readPackedSVarint(e.diffs):r===8&&(e.rule=i.readVarint())}function SC(r,e,i){r===1?(e.rgb_color=rg(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5&&(e.opacity=i.readVarint())}function rg(r){return new or((r>>16&255)/255,(r>>8&255)/255,(255&r)/255,1)}function EC(r,e,i){r===1?(e.rgb_color=rg(i.readVarint()),e.paint="rgb_color"):r===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):r===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):r===5?i.readPackedFloat(e.dasharray):r===6?e.dashoffset=i.readFloat():r===7?e.miterlimit=i.readFloat():r===8?e.opacity=i.readVarint():r===9?e.width=i.readFloat():r===10?e.linecap=i.readVarint():r===11&&(e.linejoin=i.readVarint())}function AC(r,e,i){r===1?e.transform=ig(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(yw(i,i.readVarint()+i.pos)):r===4?e.x1=i.readFloat():r===5?e.y1=i.readFloat():r===6?e.x2=i.readFloat():r===7&&(e.y2=i.readFloat())}function yw(r,e){return r.readFields(IC,{offset:0,opacity:255,rgb_color:jx},e)}function IC(r,e,i){r===1?e.offset=i.readFloat():r===2?e.opacity=i.readVarint():r===3&&(e.rgb_color=rg(i.readVarint()))}function CC(r,e,i){r===1?e.transform=ig(i,i.readVarint()+i.pos):r===2?e.spread_method=i.readVarint():r===3?e.stops.push(yw(i,i.readVarint()+i.pos)):r===4?e.cx=i.readFloat():r===5?e.cy=i.readFloat():r===6?e.r=i.readFloat():r===7?e.fx=i.readFloat():r===8?e.fy=i.readFloat():r===9&&(e.fr=i.readFloat())}function PC(r,e,i){r===1?e.transform=ig(i,i.readVarint()+i.pos):r===2?e.clip_path_idx=i.readVarint():r===3&&e.children.push(tg(i,i.readVarint()+i.pos))}function MC(r,e,i){r===1?e.left=e.top=i.readFloat():r===2?e.width=e.height=i.readFloat():r===3?e.top=i.readFloat():r===4?e.height=i.readFloat():r===5?e.mask_type=i.readVarint():r===6?e.mask_idx=i.readVarint():r===7&&e.children.push(tg(i,i.readVarint()+i.pos))}class RC{static calculate(e={},i=[]){const s=new Map,a=new Map;if(Object.keys(e).length===0)return s;i.forEach(u=>{a.set(u.name,u.rgb_color||new or(0,0,0))});for(const[u,h]of Object.entries(e))a.has(u)?s.set(a.get(u).toString(),h):console.warn(`Ignoring unknown image variable "${u}"`);return s}}function yd(r,e=255,i){const s=e/255,a=r.toString(),u=i.has(a)?i.get(a).clone():r.clone();return u.a*=s,u.toString()}function Pp(r,e){if(!Lo()){const i=document.createElement("canvas");return i.width=r,i.height=e,i}return new OffscreenCanvas(r,e)}let qx,Mp=null;function $x(r,e,i,s,a){for(const u of s.children)xw(r,e,i,u,a)}function xw(r,e,i,s,a){s.group?(r.save(),function(u,h,p,y,v){const w=y.mask_idx!=null?p.masks[y.mask_idx]:null,S=y.clip_path_idx!=null?p.clip_paths[y.clip_path_idx]:null;if(y.transform&&(h=xd(y.transform).preMultiplySelf(h)),!function(R,O,V){return R.opacity!==255||O||V}(y,S!=null,w!=null))return void $x(u,h,p,y,v);const A=Pp(u.canvas.width,u.canvas.height),P=A.getContext("2d");$x(P,h,p,y,v),S&&Aw(P,h,p,S),w&&Iw(P,h,p,w,v),u.globalAlpha=y.opacity/255,u.drawImage(A,0,0)}(r,e,i,s.group,a),r.restore()):s.path&&(r.save(),function(u,h,p,y,v){u.setTransform(h),y.paint_order===fC.PAINT_ORDER_FILL_AND_STROKE?(vw(u,p,y,v),ww(u,p,y,v)):(ww(u,p,y,v),vw(u,p,y,v))}(r,e,i,s.path,a),r.restore())}function vw(r,e,i,s){const a=i.fill;if(!a)return;const u=a.opacity/255;switch(r.save(),r.beginPath(),Cw(i,r),a.paint){case"rgb_color":r.fillStyle=yd(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":{const h=e.linear_gradients[a.linear_gradient_idx];h.transform&&r.setTransform(xd(h.transform).preMultiplySelf(r.getTransform())),r.fillStyle=Tw(r,h,u,s);break}case"radial_gradient_idx":{const h=e.radial_gradients[a.radial_gradient_idx];h.transform&&r.setTransform(xd(h.transform).preMultiplySelf(r.getTransform())),r.fillStyle=Sw(r,h,u,s)}}r.fill(bw(i)),r.restore()}function bw(r){return r.rule===Gx.PATH_RULE_NON_ZERO?"nonzero":r.rule===Gx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function ww(r,e,i,s){const a=i.stroke;if(!a)return;const u=Pw(i);r.lineWidth=a.width,r.miterLimit=a.miterlimit,r.setLineDash(a.dasharray),r.lineDashOffset=a.dashoffset;const h=a.opacity/255;switch(a.paint){case"rgb_color":r.strokeStyle=yd(a.rgb_color,a.opacity,s);break;case"linear_gradient_idx":r.strokeStyle=Tw(r,e.linear_gradients[a.linear_gradient_idx],h,s,!0);break;case"radial_gradient_idx":r.strokeStyle=Sw(r,e.radial_gradients[a.radial_gradient_idx],h,s,!0)}switch(a.linejoin){case eg.LINE_JOIN_MITER_CLIP:case eg.LINE_JOIN_MITER:r.lineJoin="miter";break;case eg.LINE_JOIN_ROUND:r.lineJoin="round";break;case eg.LINE_JOIN_BEVEL:r.lineJoin="bevel"}switch(a.linecap){case Hx.LINE_CAP_BUTT:r.lineCap="butt";break;case Hx.LINE_CAP_ROUND:r.lineCap="round";break;case Hx.LINE_CAP_SQUARE:r.lineCap="square"}r.stroke(u)}function Tw(r,e,i,s,a=!1){if(e.stops.length===1){const A=e.stops[0];return yd(A.rgb_color,A.opacity*i,s)}const{x1:u,y1:h,x2:p,y2:y}=e;let v=new DOMPoint(u,h),w=new DOMPoint(p,y);if(a){const A=xd(e.transform);v=A.transformPoint(v),w=A.transformPoint(w)}const S=r.createLinearGradient(v.x,v.y,w.x,w.y);for(const A of e.stops)S.addColorStop(A.offset,yd(A.rgb_color,A.opacity*i,s));return S}function Sw(r,e,i,s,a=!1){if(e.stops.length===1){const N=e.stops[0];return yd(N.rgb_color,N.opacity*i,s)}const u=xd(e.transform),{fx:h,fy:p,fr:y,cx:v,cy:w,r:S}=e;let A=new DOMPoint(h,p),P=new DOMPoint(v,w),R=y,O=S;if(a){A=u.transformPoint(A),P=u.transformPoint(P);const N=(u.a+u.d)/2;R=y*N,O=e.r*N}const V=r.createRadialGradient(A.x,A.y,R,P.x,P.y,O);for(const N of e.stops)V.addColorStop(N.offset,yd(N.rgb_color,N.opacity*i,s));return V}function Ew(r,e,i,s){const a=s.transform?xd(s.transform).preMultiplySelf(e):e,u=Pp(r.canvas.width,r.canvas.height),h=u.getContext("2d");for(const y of s.children)if(y.group)Ew(h,a,i,y.group);else if(y.path){const v=y.path,w=new Path2D;w.addPath(Pw(v),a),h.fill(w,bw(v))}const p=s.clip_path_idx!=null?i.clip_paths[s.clip_path_idx]:null;p&&Aw(h,a,i,p),r.globalCompositeOperation="source-over",r.drawImage(u,0,0)}function Aw(r,e,i,s){const a=Pp(r.canvas.width,r.canvas.height);Ew(a.getContext("2d"),e,i,s),r.globalCompositeOperation="destination-in",r.drawImage(a,0,0)}function Iw(r,e,i,s,a){if(s.children.length===0)return;const u=s.mask_idx!=null?i.masks[s.mask_idx]:null;u&&Iw(r,e,i,u,a);const h=r.canvas.width,p=r.canvas.height,y=Pp(h,p),v=y.getContext("2d"),w=s.width,S=s.height,A=s.left,P=s.top,R=new Path2D,O=new Path2D;O.rect(A,P,w,S),R.addPath(O,e),v.clip(R);for(const q of s.children)xw(v,e,i,q,a);const V=v.getImageData(0,0,h,p),N=V.data;if(s.mask_type===mw.MASK_TYPE_LUMINANCE)for(let q=0;q<N.length;q+=4)N[q+3]=N[q+3]/255*(.2126*N[q]+.7152*N[q+1]+.0722*N[q+2]);v.putImageData(V,0,0),r.globalCompositeOperation="destination-in",r.drawImage(y,0,0)}function xd(r){return r?new DOMMatrix([r.sx,r.ky,r.kx,r.sy,r.tx,r.ty]):new DOMMatrix}function Cw(r,e){const i=r.step;let s=r.diffs[0]*i,a=r.diffs[1]*i;e.moveTo(s,a);for(let u=0,h=2;u<r.commands.length;u++)switch(r.commands[u]){case Cp.PATH_COMMAND_MOVE:s+=r.diffs[h++]*i,a+=r.diffs[h++]*i,e.moveTo(s,a);break;case Cp.PATH_COMMAND_LINE:s+=r.diffs[h++]*i,a+=r.diffs[h++]*i,e.lineTo(s,a);break;case Cp.PATH_COMMAND_QUAD:{const p=s+r.diffs[h++]*i,y=a+r.diffs[h++]*i;s=p+r.diffs[h++]*i,a=y+r.diffs[h++]*i,e.quadraticCurveTo(p,y,s,a);break}case Cp.PATH_COMMAND_CUBIC:{const p=s+r.diffs[h++]*i,y=a+r.diffs[h++]*i,v=p+r.diffs[h++]*i,w=y+r.diffs[h++]*i;s=v+r.diffs[h++]*i,a=w+r.diffs[h++]*i,e.bezierCurveTo(p,y,v,w,s,a);break}case Cp.PATH_COMMAND_CLOSE:e.closePath()}return e}function Pw(r){return Cw(r,new Path2D)}class ng{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Mt(ng,"LRUCache");class Wx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new as(e,e.data)}getFromCache(e,i,s){return this.cacheMap.has(s)||this.cacheMap.set(s,new ng(150)),this.cacheMap.get(s).get(So(e.toString(),i))}setInCache(e,i,s,a){this.cacheDependenciesMap.has(a)||this.cacheDependenciesMap.set(a,new Map),this.cacheMap.has(a)||this.cacheMap.set(a,new ng(150));const u=this.cacheDependenciesMap.get(a),h=So(e.id.toString(),s);u.get(h)||u.set(h,new Set);const p=this.cacheMap.get(a),y=e.toString();u.get(h).add(y),p.put(So(e.toString(),s),i)}removeImagesFromCacheByIds(e,i,s=0){if(!this.cacheMap.has(s)||!this.cacheDependenciesMap.has(s))return;const a=this.cacheMap.get(s),u=this.cacheDependenciesMap.get(s);for(const h of e){const p=So(h.toString(),i);if(u.has(p)){for(const y of u.get(p))a.delete(y);u.delete(p)}}}rasterize(e,i,s,a){const u=this.getFromCache(e,s,a);if(u)return u.clone();const h=function(y,v){const w=RC.calculate(v.params,y.metadata?y.metadata.variables:[]),S=y.usvg_tree,A=S.width,P=S.height,R=Math.max(1,Math.round(A*v.sx)),O=Math.max(1,Math.round(P*v.sy)),V=new DOMMatrix([R/A,0,0,O/P,0,0]);return Mp===null&&(Mp=Pp(10,10),qx=Mp.getContext("2d",{willReadFrequently:!0})),Mp.width=R,Mp.height=O,$x(qx,V,S,S,w),qx.getImageData(0,0,R,O)}(i.icon,e),p=Wx._getImage(h);return this.setInCache(e,p,s,a),p.clone()}}class Mw{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const s=this.toIdx(e,i);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function Rw(r,e,i,s){let a=0,u=Number.MAX_VALUE;for(let h=0;h<3;h++)if(Math.abs(s[h])<1e-15){if(i[h]<r[h]||i[h]>e[h])return null}else{const p=1/s[h];let y=(r[h]-i[h])*p,v=(e[h]-i[h])*p;if(y>v){const w=y;y=v,v=w}if(y>a&&(a=y),v<u&&(u=v),a>u)return null}return a}function Dw(r,e,i,s,a,u,h,p,y,v,w){const S=s-r,A=a-e,P=u-i,R=h-r,O=p-e,V=y-i,N=w[1]*V-w[2]*O,q=w[2]*R-w[0]*V,W=w[0]*O-w[1]*R,K=S*N+A*q+P*W;if(Math.abs(K)<1e-15)return null;const se=1/K,te=v[0]-r,le=v[1]-e,fe=v[2]-i,ge=(te*N+le*q+fe*W)*se;if(ge<0||ge>1)return null;const ze=le*P-fe*A,we=fe*S-te*P,Ne=te*A-le*S,He=(w[0]*ze+w[1]*we+w[2]*Ne)*se;return He<0||ge+He>1?null:(R*ze+O*we+V*Ne)*se}function Lw(r,e,i){return(r-e)/(i-e)}function zw(r,e,i,s,a,u,h,p,y){const v=1<<i,w=u-s,S=h-a,A=(r+1)/v*w+s,P=(e+0)/v*S+a,R=(e+1)/v*S+a;p[0]=(r+0)/v*w+s,p[1]=P,y[0]=A,y[1]=R}class Ow{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(u){const h=Math.ceil(Math.log2(u.dim/8)),p=[];let y=Math.ceil(Math.pow(2,h));const v=1/y,w=(P,R,O,V,N)=>{const q=V?1:0,W=(P+1)*O-q,K=R*O,se=(R+1)*O-q;N[0]=P*O,N[1]=K,N[2]=W,N[3]=se};let S=new Mw(y);const A=[];for(let P=0;P<y*y;P++){w(P%y,Math.floor(P/y),v,!1,A);const R=vc(A[0],A[1],u),O=vc(A[2],A[1],u),V=vc(A[2],A[3],u),N=vc(A[0],A[3],u);S.minimums.push(Math.min(R,O,V,N)),S.maximums.push(Math.max(R,O,V,N)),S.leaves.push(1)}for(p.push(S),y/=2;y>=1;y/=2){const P=p[p.length-1];S=new Mw(y);for(let R=0;R<y*y;R++){w(R%y,Math.floor(R/y),2,!0,A);const O=P.getElevation(A[0],A[1]),V=P.getElevation(A[2],A[1]),N=P.getElevation(A[2],A[3]),q=P.getElevation(A[0],A[3]),W=P.isLeaf(A[0],A[1]),K=P.isLeaf(A[2],A[1]),se=P.isLeaf(A[2],A[3]),te=P.isLeaf(A[0],A[3]),le=Math.min(O.min,V.min,N.min,q.min),fe=Math.max(O.max,V.max,N.max,q.max),ge=W&&K&&se&&te;S.maximums.push(fe),S.minimums.push(le),S.leaves.push(fe-le<=5&&ge?1:0)}p.push(S)}return p}(this.dem),s=i.length-1,a=i[s];this._addNode(a.minimums[0],a.maximums[0],a.leaves[0]),this._construct(i,0,0,s,0)}raycastRoot(e,i,s,a,u,h,p=1){return Rw([e,i,-100],[s,a,this.maximums[0]*p],u,h)}raycast(e,i,s,a,u,h,p=1){if(!this.nodeCount)return null;const y=this.raycastRoot(e,i,s,a,u,h,p);if(y==null)return null;const v=[],w=[],S=[],A=[],P=[{idx:0,t:y,nodex:0,nodey:0,depth:0}];for(;P.length>0;){const{idx:R,t:O,nodex:V,nodey:N,depth:q}=P.pop();if(this.leaves[R]){zw(V,N,q,e,i,s,a,S,A);const K=1<<q,se=(V+0)/K,te=(V+1)/K,le=(N+0)/K,fe=(N+1)/K,ge=vc(se,le,this.dem)*p,ze=vc(te,le,this.dem)*p,we=vc(te,fe,this.dem)*p,Ne=vc(se,fe,this.dem)*p,He=Dw(S[0],S[1],ge,A[0],S[1],ze,A[0],A[1],we,u,h),qe=Dw(A[0],A[1],we,S[0],A[1],Ne,S[0],S[1],ge,u,h),Je=Math.min(He!==null?He:Number.MAX_VALUE,qe!==null?qe:Number.MAX_VALUE);if(Je!==Number.MAX_VALUE)return Je;{const et=qn([],u,h,O);if(kw(ge,ze,Ne,we,Lw(et[0],S[0],A[0]),Lw(et[1],S[1],A[1]))>=et[2])return O}continue}let W=0;for(let K=0;K<this._siblingOffset.length;K++){zw((V<<1)+this._siblingOffset[K][0],(N<<1)+this._siblingOffset[K][1],q+1,e,i,s,a,S,A),S[2]=-100,A[2]=this.maximums[this.childOffsets[R]+K]*p;const se=Rw(S,A,u,h);if(se!=null){const te=se;v[K]=te;let le=!1;for(let fe=0;fe<W&&!le;fe++)te>=v[w[fe]]&&(w.splice(fe,0,K),le=!0);le||(w[W]=K),W++}}for(let K=0;K<W;K++){const se=w[K];P.push({idx:this.childOffsets[R]+se,t:v[se],nodex:(V<<1)+this._siblingOffset[se][0],nodey:(N<<1)+this._siblingOffset[se][1],depth:q+1})}}return null}_addNode(e,i,s){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,s,a,u){if(e[a].isLeaf(i,s)===1)return;this.childOffsets[u]||(this.childOffsets[u]=this.nodeCount);const h=a-1,p=e[h];let y=0,v=0;for(let w=0;w<this._siblingOffset.length;w++){const S=2*i+this._siblingOffset[w][0],A=2*s+this._siblingOffset[w][1],P=p.getElevation(S,A),R=p.isLeaf(S,A),O=this._addNode(P.min,P.max,R);R&&(y|=1<<w),v||(v=O)}for(let w=0;w<this._siblingOffset.length;w++)y&1<<w||this._construct(e,2*i+this._siblingOffset[w][0],2*s+this._siblingOffset[w][1],h,v+w)}}function kw(r,e,i,s,a,u){return ii(ii(r,i,u),ii(e,s,u),a)}function vc(r,e,i){const s=i.dim,a=U(r*s-.5,0,s-1),u=U(e*s-.5,0,s-1),h=Math.floor(a),p=Math.floor(u),y=Math.min(h+1,s-1),v=Math.min(p+1,s-1);return kw(i.get(h,p),i.get(y,p),i.get(h,v),i.get(y,v),a-h,u-p)}const DC={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function LC(r,e,i){return(256*r*256+256*e+i)/10-1e4}function zC(r,e,i){return 256*r+e+i/256-32768}class sg{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,s,a=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return void St(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const u=this.dim=i.height-2,h=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=a,this._modifiedForSources={},!a){for(let y=0;y<u;y++)h[this._idx(-1,y)]=h[this._idx(0,y)],h[this._idx(u,y)]=h[this._idx(u-1,y)],h[this._idx(y,-1)]=h[this._idx(y,0)],h[this._idx(y,u)]=h[this._idx(y,u-1)];h[this._idx(-1,-1)]=h[this._idx(0,0)],h[this._idx(u,-1)]=h[this._idx(u-1,0)],h[this._idx(-1,u)]=h[this._idx(0,u-1)],h[this._idx(u,u)]=h[this._idx(u-1,u-1)]}const p=s==="terrarium"?zC:LC;for(let y=0;y<h.length;++y){const v=4*y;this.floatView[y]=p(this.pixels[v],this.pixels[v+1],this.pixels[v+2])}this._timestamp=Ln.now()}_buildQuadTree(){this._tree=new Ow(this)}get(e,i,s=!1){s&&(e=U(e,-1,this.dim),i=U(i,-1,this.dim));const a=this._idx(e,i);return this.floatView[a]}set(e,i,s){const a=this._idx(e,i),u=this.floatView[a];return this.floatView[a]=s,s-u}static getUnpackVector(e){return DC[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const s=[0,0,0,0],a=sg.getUnpackVector(i);let u=Math.floor((e+a[3])/a[2]);return s[2]=u%256,u=Math.floor(u/256),s[1]=u%256,u=Math.floor(u/256),s[0]=u,s}getPixels(){return new Mv({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let a=i*this.dim,u=i*this.dim+this.dim,h=s*this.dim,p=s*this.dim+this.dim;switch(i){case-1:a=u-1;break;case 1:u=a+1}switch(s){case-1:h=p-1;break;case 1:p=h+1}const y=-i*this.dim,v=-s*this.dim;for(let w=h;w<p;w++)for(let S=a;S<u;S++){const A=4*this._idx(S,w),P=4*this._idx(S+y,w+v);this.pixels[A+0]=e.pixels[P+0],this.pixels[A+1]=e.pixels[P+1],this.pixels[A+2]=e.pixels[P+2],this.pixels[A+3]=e.pixels[P+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function OC(r,e,i){r===1?e.headerLength=i.readFixed32():r===2?e.x=i.readVarint():r===3?e.y=i.readVarint():r===4?e.z=i.readVarint():r===5&&e.layers.push(function(s,a){return s.readFields(VC,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},a)}(i,i.readVarint()+i.pos))}function kC(r,e,i){r===1?(e.delta_filter=function(s,a){return s.readFields(FC,{blockSize:0},a)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):r===2?(i.readVarint(),e.filter="zigzag_filter"):r===3?(i.readVarint(),e.filter="bitshuffle_filter"):r===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function FC(r,e,i){r===1&&(e.blockSize=i.readVarint())}function BC(r,e,i){r===1?(i.readVarint(),e.codec="gzip_data"):r===2?(i.readVarint(),e.codec="jpeg_image"):r===3?(i.readVarint(),e.codec="webp_image"):r===4&&(i.readVarint(),e.codec="png_image")}function NC(r,e,i){let s=0,a=0;r===1?e.firstByte=i.readFixed64():r===2?e.lastByte=i.readFixed64():r===3?e.filters.push(function(u,h){return u.readFields(kC,{},h)}(i,i.readVarint()+i.pos)):r===4?e.codec=function(u,h){return u.readFields(BC,{},h)}(i,i.readVarint()+i.pos):r===5?a=i.readFloat():r===6?s=i.readFloat():r===7?e.bands.push(i.readString()):r===8?e.offset=i.readDouble():r===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=a),e.scale===0&&(e.scale=s)}function VC(r,e,i){r===1?e.version=i.readVarint():r===2?e.name=i.readString():r===3?e.units=i.readString():r===4?e.tileSize=i.readVarint():r===5?e.buffer=i.readVarint():r===6?e.pixelFormat=i.readVarint():r===7&&e.dataIndex.push(function(s,a){return s.readFields(NC,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},a)}(i,i.readVarint()+i.pos))}function UC(r,e,i){if(r===2)(function(s,a,u){s.readFields(jC,u,a)})(i,i.readVarint()+i.pos,e);else if(r===3)throw new Error("Not implemented")}function jC(r,e,i){if(r===1){let s=0;const a=i.readVarint()+i.pos;for(;i.pos<a;)e[s++]=i.readVarint()}}function GC(r,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let s=2;s>=1;s--){const a=s===1?1:0,u=s===2?1:0;for(let h=0;h<e[0];h++){const p=e[1]*h;for(let y=a;y<e[1];y++){const v=e[2]*(y+p);for(let w=u;w<e[2];w++){const S=e[3]*(w+v);for(let A=0;A<e[3];A++){const P=S+A;r[P]+=r[P-i]}}}}i*=e[s]}return r}function HC(r){for(let e=0,i=r.length;e<i;e++)r[e]=r[e]>>>1^-(1&r[e]);return r}function qC(r,e){switch(e){case"uint32":return r;case"uint16":for(let i=0;i<r.length;i+=2){const s=r[i],a=r[i+1];r[i]=(240&s)>>4|(61440&s)>>8|(240&a)<<4|61440&a,r[i+1]=15&s|(3840&s)>>4|(15&a)<<8|(3840&a)<<4}return r;case"uint8":for(let i=0;i<r.length;i+=4){const s=r[i],a=r[i+1],u=r[i+2],h=r[i+3];r[i+0]=(192&s)>>6|(192&a)>>4|(192&u)>>2|192&h,r[i+1]=(48&s)>>4|(48&a)>>2|48&u|(48&h)<<2,r[i+2]=(12&s)>>2|12&a|(12&u)<<2|(12&h)<<4,r[i+3]=3&s|(3&a)<<2|(3&u)<<4|(3&h)<<6}return r;default:throw new Error(`Invalid pixel format, "${e}"`)}}Mt(sg,"DEMData"),Mt(Ow,"DemMinMaxQuadTree",{omit:["dem"]});var Co=Uint8Array,Rp=Uint16Array,$C=Int32Array,Fw=new Co([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Bw=new Co([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),WC=new Co([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Nw=function(r,e){for(var i=new Rp(31),s=0;s<31;++s)i[s]=e+=1<<r[s-1];var a=new $C(i[30]);for(s=1;s<30;++s)for(var u=i[s];u<i[s+1];++u)a[u]=u-i[s]<<5|s;return{b:i,r:a}},Vw=Nw(Fw,2),Uw=Vw.b,ZC=Vw.r;Uw[28]=258,ZC[258]=28;for(var XC=Nw(Bw,0).b,jw=new Rp(32768),Pn=0;Pn<32768;++Pn){var vd=(43690&Pn)>>1|(21845&Pn)<<1;jw[Pn]=((65280&(vd=(61680&(vd=(52428&vd)>>2|(13107&vd)<<2))>>4|(3855&vd)<<4))>>8|(255&vd)<<8)>>1}var Dp=function(r,e,i){for(var s=r.length,a=0,u=new Rp(e);a<s;++a)r[a]&&++u[r[a]-1];var h,p=new Rp(e);for(a=1;a<e;++a)p[a]=p[a-1]+u[a-1]<<1;h=new Rp(1<<e);var y=15-e;for(a=0;a<s;++a)if(r[a])for(var v=a<<4|r[a],w=e-r[a],S=p[r[a]-1]++<<w,A=S|(1<<w)-1;S<=A;++S)h[jw[S]>>y]=v;return h},Lp=new Co(288);for(Pn=0;Pn<144;++Pn)Lp[Pn]=8;for(Pn=144;Pn<256;++Pn)Lp[Pn]=9;for(Pn=256;Pn<280;++Pn)Lp[Pn]=7;for(Pn=280;Pn<288;++Pn)Lp[Pn]=8;var Gw=new Co(32);for(Pn=0;Pn<32;++Pn)Gw[Pn]=5;var KC=Dp(Lp,9),YC=Dp(Gw,5),Zx=function(r){for(var e=r[0],i=1;i<r.length;++i)r[i]>e&&(e=r[i]);return e},ba=function(r,e,i){var s=e/8|0;return(r[s]|r[s+1]<<8)>>(7&e)&i},Xx=function(r,e){var i=e/8|0;return(r[i]|r[i+1]<<8|r[i+2]<<16)>>(7&e)},JC=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],wa=function(r,e,i){var s=new Error(e||JC[r]);if(s.code=r,Error.captureStackTrace&&Error.captureStackTrace(s,wa),!i)throw s;return s},QC=new Co(0),eP=typeof TextDecoder<"u"&&new TextDecoder;try{eP.decode(QC,{stream:!0})}catch{}const tP={gzip_data:"gzip"};class Wo extends Error{constructor(e){super(e),this.name="MRTError"}}const iP={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Hw={uint32:1,uint16:2,uint8:4},rP={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Kx;class og{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new Wo(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),s=new DataView(e);if(i[0]!==13)throw new Wo("File is not a valid MRT.");return s.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),s=this.getHeaderLength(e);if(i.length<s)throw new Wo(`Expected header with length >= ${s} but got buffer of length ${i.length}`);const a=new Kx(i.subarray(0,s)).readFields(OC,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==a.x||this.y!==a.y||this.z!==a.z))throw new Wo(`Invalid attempt to parse header ${a.z}/${a.x}/${a.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=a.x,this.y=a.y,this.z=a.z;for(const u of a.layers)this.layers[u.name]=new qw(u,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],s=this.getLayer(e.layerName);for(let a of e.blockIndices){const u=s.dataIndex[a],h=u.firstByte-e.firstByte,p=u.lastByte-e.firstByte;if(s._blocksInProgress.has(a))continue;const y={layerName:s.name,firstByte:h,lastByte:p,pixelFormat:s.pixelFormat,blockIndex:a,blockShape:[u.bands.length].concat(s.bandShape),buffer:s.buffer,codec:u.codec.codec,filters:u.filters.map(v=>v.filter)};s._blocksInProgress.add(a),i.push(y)}return new $w(i,()=>{i.forEach(a=>s._blocksInProgress.delete(a.blockIndex))},(a,u)=>{if(i.forEach(h=>s._blocksInProgress.delete(h.blockIndex)),a)throw a;u.forEach(h=>{this.getLayer(h.layerName).processDecodedData(h)})})}}class qw{constructor({version:e,name:i,units:s,tileSize:a,pixelFormat:u,buffer:h,dataIndex:p},y){if(this.version=e,this.version!==1)throw new Wo(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=s,this.tileSize=a,this.buffer=h,this.pixelFormat=iP[u],this.dataIndex=p,this.bandShape=[a+2*h,a+2*h,Hw[this.pixelFormat]],this._decodedBlocks=new ng(y?y.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Hw[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[s,a]of this.dataIndex.entries()){for(const[u,h]of a.bands.entries())if(h===e)return{bandIndex:i+u,blockIndex:s,blockBandIndex:u};i+=a.bands.length}break;case"number":for(const[s,a]of this.dataIndex.entries()){if(e>=i&&e<i+a.bands.length)return{bandIndex:e,blockIndex:s,blockBandIndex:e-i};i+=a.bands.length}break;default:throw new Wo(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,s=-1/0;const a=[],u=new Set;for(const h of e){const{blockIndex:p}=this.getBlockForBand(h);if(p<0)throw new Wo(`Invalid band: ${JSON.stringify(h)}`);const y=this.dataIndex[p];a.includes(p)||a.push(p),u.add(p),i=Math.min(i,y.firstByte),s=Math.max(s,y.lastByte)}if(u.size>this.cacheSize)throw new Wo(`Number of blocks to decode (${u.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:s,blockIndices:a}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:s}=this.getBlockForBand(e);if(i<0)throw new Wo(`Band not found: ${JSON.stringify(e)}`);const a=this._decodedBlocks.get(i.toString());if(!a)throw new Wo(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const u=this.dataIndex[i],h=this.bandShape.reduce((v,w)=>v*w,1),p=s*h,y=a.subarray(p,p+h);return{data:y,bytes:new Uint8Array(y.buffer).subarray(y.byteOffset,y.byteOffset+y.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:u.offset,scale:u.scale}}}og.setPbf=function(r){Kx=r};class $w{constructor(e,i,s){this.tasks=e,this._onCancel=i,this._onComplete=s,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}og.performDecoding=function(r,e){const i=new Uint8Array(r);return Promise.all(e.tasks.map(s=>{const{layerName:a,firstByte:u,lastByte:h,pixelFormat:p,blockShape:y,blockIndex:v,filters:w,codec:S}=s,A=i.subarray(u,h+1),P=new Uint32Array(y[0]*y[1]*y[2]);let R;if(S!=="gzip_data")throw new Wo(`Unhandled codec: ${S}`);return R=function(O,V){if(!globalThis.DecompressionStream&&V==="gzip_data")return Promise.resolve(((K=function(le){le[0]==31&&le[1]==139&&le[2]==8||wa(6,"invalid gzip data");var fe=le[3],ge=10;4&fe&&(ge+=2+(le[10]|le[11]<<8));for(var ze=(fe>>3&1)+(fe>>4&1);ze>0;ze-=!le[ge++]);return ge+(2&fe)}(W=O))+8>W.length&&wa(6,"invalid gzip data"),function(le,fe,ge,ze){var we=le.length;if(!we||fe.f&&!fe.l)return ge||new Co(0);var Ne=!ge,He=Ne||fe.i!=2,qe=fe.i;Ne&&(ge=new Co(3*we));var Je,et,Ze=function(fr){var Ji=ge.length;if(fr>Ji){var rr=new Co(Math.max(2*Ji,fr));rr.set(ge),ge=rr}},Xe=fe.f||0,Be=fe.p||0,ke=fe.b||0,Ke=fe.l,ht=fe.d,st=fe.m,Nt=fe.n,vt=8*we;do{if(!Ke){Xe=ba(le,Be,1);var At=ba(le,Be+1,3);if(Be+=3,!At){var Lt=le[(Ve=4+((Be+7)/8|0))-4]|le[Ve-3]<<8,Si=Ve+Lt;if(Si>we){qe&&wa(0);break}He&&Ze(ke+Lt),ge.set(le.subarray(Ve,Si),ke),fe.b=ke+=Lt,fe.p=Be=8*Si,fe.f=Xe;continue}if(At==1)Ke=KC,ht=YC,st=9,Nt=5;else if(At==2){var at=ba(le,Be,31)+257,Ot=ba(le,Be+10,15)+4,li=at+ba(le,Be+5,31)+1;Be+=14;for(var Di=new Co(li),ki=new Co(19),mi=0;mi<Ot;++mi)ki[WC[mi]]=ba(le,Be+3*mi,7);Be+=3*Ot;var dr=Zx(ki),ie=(1<<dr)-1,oe=Dp(ki,dr);for(mi=0;mi<li;){var Ve,Qe=oe[ba(le,Be,ie)];if(Be+=15&Qe,(Ve=Qe>>4)<16)Di[mi++]=Ve;else{var _t=0,gt=0;for(Ve==16?(gt=3+ba(le,Be,3),Be+=2,_t=Di[mi-1]):Ve==17?(gt=3+ba(le,Be,7),Be+=3):Ve==18&&(gt=11+ba(le,Be,127),Be+=7);gt--;)Di[mi++]=_t}}var Vt=Di.subarray(0,at),Ht=Di.subarray(at);st=Zx(Vt),Nt=Zx(Ht),Ke=Dp(Vt,st),ht=Dp(Ht,Nt)}else wa(1);if(Be>vt){qe&&wa(0);break}}He&&Ze(ke+131072);for(var fi=(1<<st)-1,bi=(1<<Nt)-1,Ti=Be;;Ti=Be){var Ci=(_t=Ke[Xx(le,Be)&fi])>>4;if((Be+=15&_t)>vt){qe&&wa(0);break}if(_t||wa(2),Ci<256)ge[ke++]=Ci;else{if(Ci==256){Ti=Be,Ke=null;break}var ti=Ci-254;Ci>264&&(ti=ba(le,Be,(1<<(Xi=Fw[mi=Ci-257]))-1)+Uw[mi],Be+=Xi);var ai=ht[Xx(le,Be)&bi],Gi=ai>>4;if(ai||wa(3),Be+=15&ai,Ht=XC[Gi],Gi>3){var Xi=Bw[Gi];Ht+=Xx(le,Be)&(1<<Xi)-1,Be+=Xi}if(Be>vt){qe&&wa(0);break}He&&Ze(ke+131072);var Ki=ke+ti;if(ke<Ht){var lr=0-Ht,xr=Math.min(Ht,Ki);for(lr+ke<0&&wa(3);ke<xr;++ke)ge[ke]=(void 0)[lr+ke]}for(;ke<Ki;++ke)ge[ke]=ge[ke-Ht]}}fe.l=Ke,fe.p=Ti,fe.b=ke,fe.f=Xe,Ke&&(Xe=1,fe.m=st,fe.d=ht,fe.n=Nt)}while(!Xe);return ke!=ge.length&&Ne?(Je=ge,((et=ke)==null||et>Je.length)&&(et=Je.length),new Co(Je.subarray(0,et))):ge.subarray(0,ke)}(W.subarray(K,-8),{i:2},new Co(((N=W)[(q=N.length)-4]|N[q-3]<<8|N[q-2]<<16|N[q-1]<<24)>>>0))));var N,q,W,K;const se=tP[V];if(!se)throw new Error(`Unhandled codec: ${V}`);const te=new globalThis.DecompressionStream(se);return new Response(new Blob([O]).stream().pipeThrough(te)).arrayBuffer().then(le=>new Uint8Array(le))}(A,S).then(O=>(function(V,N){V.readFields(UC,N)}(new Kx(O),P),new rP[p](P.buffer))),R.then(O=>{for(let V=w.length-1;V>=0;V--)switch(w[V]){case"delta_filter":GC(O,y);break;case"zigzag_filter":HC(O);break;case"bitshuffle_filter":qC(O,p);break;default:throw new Wo(`Unhandled filter "${w[V]}"`)}return{layerName:a,blockIndex:v,data:O}}).catch(O=>{throw O})}))},Mt($w,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Mt(og,"MapboxRasterTile"),Mt(qw,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Ww{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const s=e[i];this._stringToNumber[s]=i,this._numberToString[i]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Zw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new nc(ut,16,0),this.featureIndexArray=new jf,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,s,a,u,h=0,p=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,a,u,h);const v=this.grid;for(let w=0;w<i.length;w++){const S=i[w],A=[1/0,1/0,-1/0,-1/0];for(let P=0;P<S.length;P++){const R=S[P];A[0]=Math.min(A[0],R.x),A[1]=Math.min(A[1],R.y),A[2]=Math.max(A[2],R.x),A[3]=Math.max(A[3],R.y)}p!==0&&(A[0]-=p,A[1]-=p,A[2]+=p,A[3]+=p),A[0]<ut&&A[1]<ut&&A[2]>=0&&A[3]>=0&&v.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ce(new k_(this.rawTileData)).layers,this.sourceLayerCoder=new Ww(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:s,transform:a,tileTransform:u,pixelPosMatrix:h,availableImages:p,worldview:y}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const v=i.queryRadius?i.queryRadius:0,w=s.bufferedTilespaceBounds,S=this.grid.query(w.min.x,w.min.y,w.max.x,w.max.y,(O,V,N,q)=>vs(s.bufferedTilespaceGeometry,O-v,V-v,N+v,q+v));S.sort(nP);let A=null;a.elevation&&S.length>0&&(A=gd.create(a.elevation,this.tileID));const P={};let R;for(let O=0;O<S.length;O++){const V=S[O];if(V===R)continue;R=V;const N=this.featureIndexArray.get(V);let q=null;this.is3DTile?this.loadMatchingModelFeature(P,N,e,s,a,y):this.loadMatchingFeature(P,N,e,p,y,(W,K,se,te=0)=>(q||(q=ue(W,this.tileID.canonical,u)),K.queryIntersectsFeature(s,W,se,q,this.z,a,h,A,te)))}return P}loadMatchingFeature(e,i,s,a,u,h){const{featureIndex:p,bucketIndex:y,sourceLayerIndex:v,layoutVertexArrayOffset:w}=i,S=this.bucketLayerIDs[y],A=s.layers,P=Object.keys(A);if(P.length&&!Pt(P,S))return;const R=s.sourceCache,O=this.sourceLayerCoder.decode(v),V=this.vtLayers[O].feature(p),N=this.getId(V,O);for(let q=0;q<S.length;q++){const W=S[q];if(!A[W])continue;const{styleLayer:K,targets:se}=A[W];let te={};N!==void 0&&(te=R.getFeatureState(K.sourceLayer,N));const le=!h||h(V,K,te,w);if(!le)continue;const fe=new Au(V,this.z,this.x,this.y,N);fe.tile=this.tileID.canonical,fe.state=te;let ge=this.serializedLayersCache.get(W);ge||(ge=K.serialize(),ge.id=W,this.serializedLayersCache.set(W,ge)),fe.source=ge.source,fe.sourceLayer=ge["source-layer"],fe.layer=Object.assign({},ge),fe.layer.paint=Xw(ge.paint,K.paint,V,te,a),fe.layer.layout=Xw(ge.layout,K.layout,V,te,a);let ze=!1;for(const we of se){this.updateFeatureProperties(fe,we);const{filter:Ne}=we;if(Ne){if(V.properties=fe.properties,Ne.needGeometry){const He=be(V,!0);if(!Ne.filter(new Mr(this.tileID.overscaledZ,{worldview:u}),He,this.tileID.canonical))continue}else if(!Ne.filter(new Mr(this.tileID.overscaledZ,{worldview:u}),V))continue}ze=!0,we.targetId&&this.addFeatureVariant(fe,we)}ze&&this.appendToResult(e,W,p,fe,le)}}loadMatchingModelFeature(e,i,s,a,u,h){const{featureIndex:p,bucketIndex:y}=i,v=this.bucketLayerIDs[y],w=s.layers,S=Object.keys(w);if(!S.length||Pt(S,v))for(let A=0;A<v.length;A++){const P=v[A],{styleLayer:R,targets:O}=w[P];if(R.type!=="model")continue;const V=a.tile,N=V.getBucket(R);if(!(N&&N instanceof Q_))continue;const q=hC(N,p,a,u);if(!q)continue;const{z:W,x:K,y:se}=V.tileID.canonical,{feature:te,intersectionZ:le,position:fe}=q;let ge={};te.id!==void 0&&(ge=s.sourceCache.getFeatureState(R.sourceLayer,te.id));const ze=new Au({},W,K,se,te.id);ze.tile=this.tileID.canonical,ze.state=ge,ze.properties=te.properties,ze.geometry={type:"Point",coordinates:[fe.lng,fe.lat]};let we=this.serializedLayersCache.get(P);we||(we=R.serialize(),we.id=P,this.serializedLayersCache.set(P,we)),ze.source=we.source,ze.sourceLayer=we["source-layer"],ze.layer=Object.assign({},we);let Ne=!1;for(const He of O){this.updateFeatureProperties(ze,He);const{filter:qe}=He;if(qe){if(te.properties=ze.properties,qe.needGeometry){if(!qe.filter(new Mr(this.tileID.overscaledZ,{worldview:h}),te,this.tileID.canonical))continue}else if(!qe.filter(new Mr(this.tileID.overscaledZ,{worldview:h}),te))continue}Ne=!0,He.targetId&&this.addFeatureVariant(ze,He)}Ne&&this.appendToResult(e,P,p,ze,le)}}updateFeatureProperties(e,i,s){if(i.properties){const a={};for(const u in i.properties){const h=i.properties[u].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,s);h!=null&&(a[u]=h)}e.properties=a}}addFeatureVariant(e,i,s){const a={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(a.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(a)}appendToResult(e,i,s,a,u){let h=e[i];h===void 0&&(h=e[i]=[]),h.push({featureIndex:s,feature:a,intersectionZ:u})}lookupSymbolFeatures(e,i,s,a,u,h){const p={};this.loadVTLayers();for(const y of e)this.loadMatchingFeature(p,{bucketIndex:i,sourceLayerIndex:s,featureIndex:y,layoutVertexArrayOffset:0},a,u,h);return p}loadFeature(e){const{featureIndex:i,sourceLayerIndex:s}=e;this.loadVTLayers();const a=this.sourceLayerCoder.decode(s),u=this.vtFeatures[a];if(u[i])return u[i];const h=this.vtLayers[a].feature(i);return u[i]=h,h}hasLayer(e){for(const i of this.bucketLayerIDs)for(const s of i)if(e===s)return!0;return!1}getId(e,i){let s=e.id;if(this.promoteId){const a=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(a!=null)if(Array.isArray(a)){if(!this.promoteIdExpression){const u=ja(a);if(u.result!=="success"){const h=u.value.map(p=>`${p.key}: ${p.message}`).join(", ");return void St(`Failed to create expression for promoteId: ${h}`)}this.promoteIdExpression=u.value}s=this.promoteIdExpression.evaluate({zoom:0},e)}else s=e.properties[a];typeof s=="boolean"&&(s=Number(s))}return s}}function Xw(r,e,i,s,a){return Me(r,(u,h)=>{const p=e instanceof Tl?e.get(h):null;return p&&p.evaluate?p.evaluate(i,s,void 0,a):p})}function nP(r,e){return e-r}Mt(Zw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Kw=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,s]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const a=s>>4;if(a!==1)throw new Error(`Got v${a} data when expected v1.`);const u=Kw[15&s];if(!u)throw new Error("Unrecognized array type.");const[h]=new Uint16Array(e,2,1),[p]=new Uint32Array(e,4,1);return new Yx(p,h,u,e)}constructor(e,i=64,s=Float64Array,a){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const u=Kw.indexOf(this.ArrayType),h=2*e*this.ArrayType.BYTES_PER_ELEMENT,p=e*this.IndexArrayType.BYTES_PER_ELEMENT,y=(8-p%8)%8;if(u<0)throw new Error(`Unexpected typed array class: ${s}.`);a&&a instanceof ArrayBuffer?(this.data=a,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+y,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+h+p+y),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+p+y,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+u]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=i,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Jx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,s,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:h,nodeSize:p}=this,y=[0,u.length-1,0],v=[];for(;y.length;){const w=y.pop()||0,S=y.pop()||0,A=y.pop()||0;if(S-A<=p){for(let V=A;V<=S;V++){const N=h[2*V],q=h[2*V+1];N>=e&&N<=s&&q>=i&&q<=a&&v.push(u[V])}continue}const P=A+S>>1,R=h[2*P],O=h[2*P+1];R>=e&&R<=s&&O>=i&&O<=a&&v.push(u[P]),(w===0?e<=R:i<=O)&&(y.push(A),y.push(P-1),y.push(1-w)),(w===0?s>=R:a>=O)&&(y.push(P+1),y.push(S),y.push(1-w))}return v}within(e,i,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:a,coords:u,nodeSize:h}=this,p=[0,a.length-1,0],y=[],v=s*s;for(;p.length;){const w=p.pop()||0,S=p.pop()||0,A=p.pop()||0;if(S-A<=h){for(let V=A;V<=S;V++)Jw(u[2*V],u[2*V+1],e,i)<=v&&y.push(a[V]);continue}const P=A+S>>1,R=u[2*P],O=u[2*P+1];Jw(R,O,e,i)<=v&&y.push(a[P]),(w===0?e-s<=R:i-s<=O)&&(p.push(A),p.push(P-1),p.push(1-w)),(w===0?e+s>=R:i+s>=O)&&(p.push(P+1),p.push(S),p.push(1-w))}return y}}function Jx(r,e,i,s,a,u){if(a-s<=i)return;const h=s+a>>1;Yw(r,e,h,s,a,u),Jx(r,e,i,s,h-1,1-u),Jx(r,e,i,h+1,a,1-u)}function Yw(r,e,i,s,a,u){for(;a>s;){if(a-s>600){const v=a-s+1,w=i-s+1,S=Math.log(v),A=.5*Math.exp(2*S/3),P=.5*Math.sqrt(S*A*(v-A)/v)*(w-v/2<0?-1:1);Yw(r,e,i,Math.max(s,Math.floor(i-w*A/v+P)),Math.min(a,Math.floor(i+(v-w)*A/v+P)),u)}const h=e[2*i+u];let p=s,y=a;for(zp(r,e,s,i),e[2*a+u]>h&&zp(r,e,s,a);p<y;){for(zp(r,e,p,y),p++,y--;e[2*p+u]<h;)p++;for(;e[2*y+u]>h;)y--}e[2*s+u]===h?zp(r,e,s,y):(y++,zp(r,e,y,a)),y<=i&&(s=y+1),i<=y&&(a=y-1)}}function zp(r,e,i,s){Qx(r,i,s),Qx(e,2*i,2*s),Qx(e,2*i+1,2*s+1)}function Qx(r,e,i){const s=r[e];r[e]=r[i],r[i]=s}function Jw(r,e,i,s){const a=r-i,u=e-s;return a*a+u*u}o.$=Yu,o.A=ia,o.B=So,o.C=2,o.D=nd,o.E=pl,o.F=mp,o.G=S1,o.H=Ku,o.I=ds,o.J=Jm,o.K=Bt,o.L=ql,o.M=bh,o.N=iu,o.O=Nm,o.P=Ye,o.Q=ru,o.R=Oc,o.S=Rh,o.T=ax,o.U=ja,o.V=J_,o.W=wf,o.X=Kl,o.Y=Xl,o.Z=Kc,o._=gs,o.a=function(r){return Mi.API_CDN_URL_REGEX.test(r)},o.a$=L,o.a0=oi,o.a1=Qs,o.a2=jo,o.a3=class extends J_{},o.a4=wh,o.a5=Bm,o.a6=Se,o.a7=function(r){const e=r.value;return e?oi(e)?Bx(e,!0)?[]:[new J_(r.key,e,`invalid url "${e}"`)]:[new J_(r.key,e,`string expected, "${Bt(e)}" found`)]:[]},o.a8=Zm,o.a9=Xr,o.aA=U,o.aB=wt,o.aC=hi,o.aD=ns,o.aE=gr,o.aF=x,o.aG=X,o.aH=function(r,e){const i={};for(let s=0;s<e.length;s++){const a=e[s];a in r&&(i[a]=r[a])}return i},o.aI=c,o.aJ=b,o.aK=class{constructor(r){this.entries={},this.scheduler=r}request(r,e,i,s){const a=this.entries[r]=this.entries[r]||{callbacks:[]};if(a.result){const[u,h]=a.result;return this.scheduler?this.scheduler.add(()=>{s(u,h)},e):s(u,h),()=>{}}return a.callbacks.push(s),a.cancel||(a.cancel=i((u,h)=>{a.result=[u,h];for(const p of a.callbacks)this.scheduler?this.scheduler.add(()=>{p(u,h)},e):p(u,h);setTimeout(()=>delete this.entries[r],3e3)})),()=>{a.result||(a.callbacks=a.callbacks.filter(u=>u!==s),a.callbacks.length||(a.cancel(),delete this.entries[r]))}}},o.aL=function(r,e,i){const s=JSON.stringify(r.request);return r.data&&(this.deduped.entries[s]={result:[null,r.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},a=>{const u=ta(r.request,(h,p,y)=>{h?a(h):p&&a(null,{rawData:p,vectorTile:i?void 0:new Ce(new k_(p)),responseHeaders:new Map(y.entries())})});return()=>{u.cancel(),a()}},e)},o.aM=function(r){return r?{cacheControl:r.get("Cache-Control"),expires:r.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=Ds,o.aO=function(r){Js++,Js>Vu&&(r.getActor().send("enforceCacheSizeLimit",Nu),Js=0)},o.aP=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log2(r)))},o.aQ=Wr,o.aR=Q1,o.aS=sw,o.aT=n,o.aU=J1,o.aV=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let s=0;s<r.length;s++){const a=document.createElement("source");ty(r[s])||(i.crossOrigin="Anonymous"),a.src=r[s],i.appendChild(a)}return{cancel:()=>{}}},o.aW=up,o.aX=Iu,o.aY=Te,o.aZ=xp,o.a_=I,o.aa=lt,o.ab=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return pi(r.expression.evaluate(e))}interpolate(r,e,i){return{x:ii(r.x,e.x,i),y:ii(r.y,e.y,i),z:ii(r.z,e.z,i),azimuthal:ii(r.azimuthal,e.azimuthal,i),polar:ii(r.polar,e.polar,i)}}},o.ac=Mr,o.ad=vl,o.ae=Z,o.af=Ae,o.ag=ln,o.ah=$,o.ai=Tl,o.aj=mc,o.ak=ii,o.al=ut,o.am=Hd,o.an=Wi,o.ao=or,o.ap=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,s]){const a=pi([1,i,s]);return{x:a.x,y:a.y,z:a.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:ii(r.x,e.x,i),y:ii(r.y,e.y,i),z:ii(r.z,e.z,i)}}},o.aq=function(r,e,i=0,s=!0){const a=new Ye(i,i),u=r.sub(a),h=e.add(a),p=[u,new Ye(h.x,u.y),h,new Ye(u.x,h.y)];return s&&p.push(u.clone()),p},o.ar=function(r,e){const i=[];for(let s=0;s<r.length;s++){const a=J(s-1,-1,r.length-1),u=J(s+1,-1,r.length-1),h=r[s],p=r[u],y=r[a].sub(h).unit(),v=p.sub(h).unit(),w=v.angleWithSep(y.x,y.y),S=y.add(v).unit().mult(-1*e/Math.sin(w/2));i.push(h.add(S))}return i},o.as=F1,o.at=vs,o.au=function(r,e,i=0){return Qi(((e.x-i)*r.scale-r.x)*ut,(e.y*r.scale-r.y)*ut,D(e.z,e.y))},o.av=jt,o.aw=zt,o.ax=Dt,o.ay=Jb,o.az=function(r){let e=1/0,i=1/0,s=-1/0,a=-1/0;for(const u of r)e=Math.min(e,u.x),i=Math.min(i,u.y),s=Math.max(s,u.x),a=Math.max(a,u.y);return{min:new Ye(e,i),max:new Ye(s,a)}},o.b=function(r){return Mi.API_FONTS_REGEX.test(r)},o.b$=Jv,o.b0=wn,o.b1=ac,o.b2=ve,o.b3=a_,o.b4=Z_,o.b5=function(){ca.isLoading()||ca.isLoaded()||au()!=="deferred"||Wm()},o.b6=Dh,o.b7=be,o.b8=Au,o.b9=Zr,o.bA=mt,o.bB=mr,o.bC=ft,o.bD=function(r,e){const{x:i,y:s}=r.point,a=gv(i,s,r.worldSize/r._pixelsPerMercatorPixel,0,0);return wt(a,a,ky(Io(e)))},o.bE=he,o.bF=Ct,o.bG=Jo,o.bH=qn,o.bI=sr,o.bJ=Yt,o.bK=dd,o.bL=Ws,o.bM=Ex,o.bN=function(r,e,i,s,a){const u=5*e+2;r.float32[u+0]=i,r.float32[u+1]=s,r.float32[u+2]=a},o.bO=_d,o.bP=rn,o.bQ=Qo,o.bR=mo,o.bS=ku,o.bT=J,o.bU=function(r,e,i,s){var a=new pe(4);return a[0]=r,a[1]=e,a[2]=i,a[3]=s,a},o.bV=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,s=1<<i,a=Math.floor(r.x),u=Math.floor((r.x-a)*s),h=Math.floor(r.y*s),p=this.findDEMTileFor(new Wr(i,a,i,u,h));return!(!p||!p.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const s=this._source();if(!s||r.y<0||r.y>1)return e;const a=s.getSource().maxzoom,u=1<<a,h=Math.floor(r.x),p=r.x-h,y=new Wr(a,h,a,Math.floor(p*u),Math.floor(r.y*u)),v=this.findDEMTileFor(y);if(!v||!v.dem)return e;const w=v.dem,S=1<<v.tileID.canonical.z,A=(p*S-v.tileID.canonical.x)*w.dim,P=(r.y*S-v.tileID.canonical.y)*w.dim,R=Math.floor(A),O=Math.floor(P);return(i?this.exaggeration():1)*ii(ii(w.get(R,O),w.get(R,O+1),P-O),ii(w.get(R+1,O),w.get(R+1,O+1),P-O),A-R)}static getAtTileOffset(r,e,i,s){const a=1<<r.canonical.z;return s?s.pointElevation(e):i?i.getAtPointOrZero(new Z(r.wrap+(r.canonical.x+e.x/ut)/a,(r.canonical.y+e.y/ut)/a)):0}static getAtTileOffsetFunc(r,e,i,s){return(a,u,h)=>{const p=this.getAtTileOffset(r,a,u,h),y=s.upVector(r.canonical,a.x,a.y);return Cr(y,y,p*s.upVectorScale(r.canonical,e,i).metersToTile),y}}getForTilePoints(r,e,i,s){if(this.isUsingMockSource())return!1;const a=gd.create(this,r,s);return!!a&&(e.forEach(u=>{u[2]=this.exaggeration()*a.getElevationAt(u[0],u[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,s=e.tileID,a=1<<r.canonical.z-s.canonical.z;let u=r.canonical.x/a-s.canonical.x,h=r.canonical.y/a-s.canonical.y,p=0;for(let y=0;y<r.canonical.z-s.canonical.z&&!i.leaves[p];y++){u*=2,h*=2;const v=2*Math.floor(h)+Math.floor(u);p=i.childOffsets[p]+v,u%=1,h%=1}return{min:this.exaggeration()*i.minimums[p],max:this.exaggeration()*i.maximums[p]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,s=Number.MIN_VALUE;for(const a of r){const u=this.getMinMaxForTile(a.tileID);u&&(i=Math.min(i,u.min),s=Math.max(s,u.max),e=!0)}return e?{min:i,max:s}:null}},o.bW=E_,o.bX=$i,o.bY=On,o.bZ=Zv,o.b_=ow,o.ba=_x,o.bb=$y,o.bc=ue,o.bd=Ha,o.be=$a,o.bf=fc,o.bg=Nr,o.bh=id,o.bi=kx,o.bj=function(r,e){const i=mc(e.zoom);if(i===0)return Io(r);const s=p_(r),a=Oy(s),u=x(s.getWest())*e.worldSize,h=x(s.getEast())*e.worldSize,p=b(s.getNorth())*e.worldSize,y=b(s.getSouth())*e.worldSize,v=[u,p,0],w=[h,p,0],S=[u,y,0],A=[h,y,0],P=Wt([],e.globeMatrix);return Ae(v,v,P),Ae(w,w,P),Ae(S,S,P),Ae(A,A,P),a[0]=ga(a[0],S,i),a[1]=ga(a[1],A,i),a[2]=ga(a[2],w,i),a[3]=ga(a[3],v,i),Ft.fromPoints(a)},o.bk=__,o.bl=Wt,o.bm=Zf,o.bn=ga,o.bo=oc,o.bp=yu,o.bq=vn,o.br=Xt,o.bs=og,o.bt=k_,o.bu=ta,o.bv=function(r,e){const i=[];for(const s in r)s in e||i.push(s);return i},o.bw=me,o.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.by=ea,o.bz=rt,o.c=Xn,o.c$=function(r,e,i){let s=0;for(let a=0;a<2;++a)r[a]>0&&(s+=(r[a]-0)*(r[a]-0)),e[a]<0&&(s+=(0-e[a])*(0-e[a]));return s},o.c0=Qv,o.c1=wx,o.c2=R1,o.c3=Mx,o.c4=Yx,o.c5=Cr,o.c6=Jt,o.c7=vr,o.c8=function(r,e,i){i*=.5;var s=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(i),y=Math.cos(i);return r[0]=s*y+a*p,r[1]=a*y-s*p,r[2]=u*y+h*p,r[3]=h*y-u*p,r},o.c9=Dr,o.cA=Fi,o.cB=Yi,o.cC=Fb,o.cD=yr,o.cE=pv,o.cF=function(r,e,i,s,a,u,h,p,y){if(y.name==="globe")return pv(r,e,new yr(i,s,a),!1);const v=xp({z:i,x:s,y:a},y);return new Ft([(u+v.x/v.scale)*e,e*(v.y/v.scale),h],[(u+v.x2/v.scale)*e,e*(v.y2/v.scale),p])},o.cG=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},o.cH=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},o.cI=function(r){const e=Math.round((r+45+360)%360/90)%4;return Vd[e]},o.cJ=z,o.cK=Ai,o.cL=td,o.cM=function(r){const e=mt(new Float64Array(16));wt(e,r.pixelMatrix,r.globeMatrix);const i=[0,so,0],s=[0,oo,0];return Ae(i,i,e),Ae(s,s,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!By(r,new n(r.center.lat,90)),s[0]>0&&s[0]<=r.width&&s[1]>0&&s[1]<=r.height&&!By(r,new n(r.center.lat,-90))]},o.cN=function(r,e){const{scale:i}=r.tileTransform,s=i*ut/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return function(a,u,h){var p=u[1],y=u[2],v=u[3],w=h[0],S=h[1];return a[0]=u[0]*w,a[1]=p*w,a[2]=y*S,a[3]=v*S,a}(new Float32Array(4),e.inverseAdjustmentMatrix,[s,s])},o.cO=M_,o.cP=Ns,o.cQ=kb,o.cR=function(r){const e=kb(r,!0);return he([],[e[0],e[1],e[4],e[5]])},o.cS=Zt,o.cT=xt,o.cU=Li,o.cV=function(r){const{x:e,y:i}=r.point,{lng:s,lat:a}=r._center;return gv(e,i,r.worldSize,s,a)},o.cW=Hn,o.cX=us,o.cY=Ur,o.cZ=Kn,o.c_=no,o.ca=Jr,o.cb=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},o.cc=Rs,o.cd=function(r,e,i,s,a){var u=1/Math.tan(e/2);if(r[0]=u/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=u,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,a!=null&&a!==1/0){var h=1/(s-a);r[10]=(a+s)*h,r[14]=2*a*s*h}else r[10]=-1,r[14]=-2*s;return r},o.ce=function(r,e,i,s,a,u,h){var p=1/(e-i),y=1/(s-a),v=1/(u-h);return r[0]=-2*p,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*v,r[11]=0,r[12]=(e+i)*p,r[13]=(a+s)*y,r[14]=(h+u)*v,r[15]=1,r},o.cf=E,o.cg=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},o.ch=Yh,o.ci=du,o.cj=Tn,o.ck=qo,o.cl=pu,o.cm=j1,o.cn=function(){var r=new pe(4);return pe!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},o.co=function(r,e,i){var s=e[0],a=e[1],u=e[2],h=e[3],p=Math.sin(i),y=Math.cos(i);return r[0]=s*y+u*p,r[1]=a*y+h*p,r[2]=s*-p+u*y,r[3]=a*-p+h*y,r},o.cp=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},o.cq=bt,o.cr=function(r){var e=r[0],i=r[1],s=r[2],a=r[3];return Math.sqrt(e*e+i*i+s*s+a*a)},o.cs=ts,o.ct=It,o.cu=dn,o.cv=3,o.cw=2,o.cx=7,o.cy=6,o.cz=Ie,o.d=function(r){return Mi.API_TILEJSON_REGEX.test(r)},o.d$=class{constructor(r,e,i,s){this.context=r,this.format=s,this.size=i,this.texture=r.gl.createTexture();const[a,u,h]=this.size,{gl:p}=r;p.bindTexture(p.TEXTURE_3D,this.texture),r.pixelStoreUnpackFlipY.set(!1),r.pixelStoreUnpack.set(1),r.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&p.texImage3D(p.TEXTURE_3D,0,this.format,a,u,h,0,sx(this.format),ox(this.format),e.data)}bind(r,e){const{context:i}=this,{gl:s}=i;s.bindTexture(s.TEXTURE_3D,this.texture),r!==this.minFilter&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MAG_FILTER,r),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_MIN_FILTER,r),this.minFilter=r),e!==this.wrapS&&(s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_S,e),s.texParameteri(s.TEXTURE_3D,s.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}},o.d0=function(r){return r*r*r*r*r},o.d1=_,o.d2=45,o.d3=Jh,o.d4=function(r,e,i){const s=Math.sqrt(r*r+e*e+i*i),a=s>0?Math.acos(i/s)*al:0;let u=r!==0||e!==0?Math.atan2(-e,-r)*al+90:0;return u<0&&(u+=360),[s,u,a]},o.d5=Qi,o.d6=pi,o.d7=G,o.d8=Oi,o.d9=Ft,o.dA=function(r){return r({pluginStatus:ys,pluginURL:la}),Ph.on("pluginStateChange",r),r},o.dB=fu,o.dC=class extends ha{constructor(r){super(r),this.current=Qh}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let s=0;s<9;s++)if(i[s]!==this.current[s]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dD=ll,o.dE=function(r,e,i){const s=mc(i.zoom),a=r.style.map._antialias,u=r.terrain&&r.terrain.exaggeration()>0;return s===0&&!a&&!u},o.dF=function(r){const e=r.pixelsPerMeter,i=e/E(1,r.center.lat),s=mt(new Float64Array(16));return Xt(s,s,[r.point.x,r.point.y,0]),Zt(s,s,[i,i,e]),Float32Array.from(s)},o.dG=p_,o.dH=function(r){const e=z-5;r=U(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Wi(r))),3);return Math.round(i*(Wf.length-1))},o.dI=function(r,e,i,s){const a=e.getNorth(),u=e.getSouth(),h=e.getWest(),p=e.getEast(),y=1<<r.z,v=p-h,w=a-u,S=v/hc,A=-w/Wf[i],P=[0,S,0,A,0,0,a,h,0];if(r.z>0){const R=180/s;je(P,P,[R/v+1,0,0,0,R/w+1,0,-.5*R/S,.5*R/A,1])}return P[2]=y,P[5]=r.x,P[8]=r.y,P},o.dJ=Io,o.dK=function(r,e,i){const s=mt(new Float64Array(16)),a=(e/(1<<r)-.5)*Math.PI*2;return Sr(s,i.globeMatrix,a),Float32Array.from(s)},o.dL=Mv,o.dM=$o,o.dN=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},o.dO=ye,o.dP=function(r,e){var i=Math.sin(e),s=Math.cos(e);return r[0]=s,r[1]=i,r[2]=0,r[3]=-i,r[4]=s,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},o.dQ=$e,o.dR=_v,o.dS=Hi,o.dT=qr,o.dU=256,o.dV=function(r,e){const i=[0,0,0];return Ae(i,i,__(Io(e.canonical))),Ae(i,i,r),i},o.dW=r=>({u_matrix:new pu(r),u_texsize:new qo(r),u_pixels_to_tile_units:new ed(r),u_device_pixel_ratio:new Tn(r),u_width_scale:new Tn(r),u_floor_width_scale:new Tn(r),u_image:new Yh(r),u_units_to_pixels:new qo(r),u_tile_units_to_pixels:new Tn(r),u_alpha_discard_threshold:new Tn(r),u_trim_offset:new qo(r),u_trim_fade_range:new qo(r),u_trim_color:new Jh(r),u_zbias_factor:new Tn(r),u_tile_to_meter:new Tn(r),u_ground_shadow_factor:new du(r),u_pattern_transition:new Tn(r)}),o.dX=r=>({u_matrix:new pu(r),u_pixels_to_tile_units:new ed(r),u_device_pixel_ratio:new Tn(r),u_width_scale:new Tn(r),u_floor_width_scale:new Tn(r),u_units_to_pixels:new qo(r),u_dash_image:new Yh(r),u_gradient_image:new Yh(r),u_image_height:new Tn(r),u_texsize:new qo(r),u_tile_units_to_pixels:new Tn(r),u_alpha_discard_threshold:new Tn(r),u_trim_offset:new qo(r),u_trim_fade_range:new qo(r),u_trim_color:new Jh(r),u_zbias_factor:new Tn(r),u_tile_to_meter:new Tn(r),u_ground_shadow_factor:new du(r)}),o.dY=r=>({u_camera_to_center_distance:new Tn(r),u_extrude_scale:new ed(r),u_device_pixel_ratio:new Tn(r),u_matrix:new pu(r),u_inv_rot_matrix:new pu(r),u_merc_center:new qo(r),u_tile_id:new du(r),u_zoom_transition:new Tn(r),u_up_dir:new du(r),u_emissive_strength:new Tn(r)}),o.dZ=jh,o.d_=mI,o.da=Gn,o.db=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},o.dc=Ob,o.dd=fx,o.de=Vb,o.df=Bx,o.dg=function(r,e){return r.readFields(pC,{icons:[]},e)},o.dh=A_,o.di=fd,o.dj=Ix,o.dk=Gu,o.dl=ou,o.dm=jl,o.dn=qu,o.dp=Ge,o.dq=function(r){const e=r.indexOf(Al);return e>=0?r.slice(0,e):r},o.dr=function(r){return r.indexOf(Al)>=0},o.ds=function(r){const e=r.lastIndexOf(Al);return e>=0?r.slice(e+1):""},o.dt=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.du=function(r,e,i,s){return r.type==="custom"?new aC(r,e):new dC[r.type](r,e,i,s)},o.dv=tt,o.dw=function(r){const e=r.indexOf(Al);return e>=0?r.slice(e+1):""},o.dx=class extends Au{constructor(r,e){super(r._vectorTileFeature,r._z,r._x,r._y,r.id),r.state&&(this.state=Object.assign({},r.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=r.source,this.sourceLayer=r.sourceLayer,this.layer=r.layer)}toJSON(){const r=super.toJSON();return r.target=this.target,r.namespace=this.namespace,r}},o.dy=Ph,o.dz=fl,o.e=Mi,o.e$=Ei,o.e0=vv,o.e1=(r,e,i,s,a,u)=>{const h=r.transform,p=h.projection.name==="globe";let y;if(u.paint.get("circle-pitch-alignment")==="map")if(p){const w=_v(h.zoom,e.canonical)*h._pixelsPerMercatorPixel;y=Float32Array.from([w,0,0,w])}else y=h.calculatePixelsToTileUnitsMatrix(i);else y=new Float32Array([h.pixelsToGLUnits[0],0,0,h.pixelsToGLUnits[1]]);const v={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(h.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,u.paint.get("circle-translate"),u.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ln.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:RE,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:u.paint.get("circle-emissive-strength")};if(p){v.u_inv_rot_matrix=s,v.u_merc_center=a,v.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],v.u_zoom_transition=mc(h.zoom);const w=a[0]*ut,S=a[1]*ut;v.u_up_dir=h.projection.upVector(new yr(0,0,0),w,S)}return v},o.e2=i1,o.e3=_s,o.e4=(r,e,i,s,a,u,h,p,y,v)=>{const w=r.transform,S=w.pitch<15?Qb(.07,.7,U((14-w.zoom)/5,0,1)):.07,A=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:t1(r,e,i,s),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:w.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:a,u_width_scale:u,u_floor_width_scale:h,u_image:0,u_tile_units_to_pixels:e1(e,w),u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:p,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(A?null:i.lut).toArray01(),u_zbias_factor:S,u_tile_to_meter:G(e.tileID.canonical,0),u_ground_shadow_factor:y,u_pattern_transition:v}},o.e5=(r,e,i,s,a,u,h,p,y,v)=>{const w=r.transform,S=w.calculatePixelsToTileUnitsMatrix(e),A=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",P=w.pitch<15?Qb(.07,.7,U((14-w.zoom)/5,0,1)):.07;return{u_matrix:t1(r,e,i,s),u_pixels_to_tile_units:S,u_device_pixel_ratio:u,u_width_scale:h,u_floor_width_scale:p,u_units_to_pixels:[1/w.pixelsToGLUnits[0],1/w.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:a,u_texsize:r1(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:e1(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:y,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(A?null:i.lut).toArray01(),u_zbias_factor:P,u_tile_to_meter:G(e.tileID.canonical,0),u_ground_shadow_factor:v}},o.e6=Re,o.e7=Xf,o.e8=D,o.e9=lo,o.eA=function(r,e){var i=2*Math.acos(e[3]),s=Math.sin(i/2);return s>Q?(r[0]=e[0]/s,r[1]=e[1]/s,r[2]=e[2]/s):(r[0]=1,r[1]=0,r[2]=0),i},o.eB=Ux,o.eC=L_,o.eD=D_,o.eE=[1,1,1],o.eF=gd,o.eG=Gt,o.eH=function(r,e,i,s){var a=e[0],u=e[1],h=e[2],p=e[3];return r[0]=a+s*(i[0]-a),r[1]=u+s*(i[1]-u),r[2]=h+s*(i[2]-h),r[3]=p+s*(i[3]-p),r},o.eI=ld,o.eJ=Hs,o.eK=Ho,o.eL=function(r,e,i,s,a,u,h,p,y,v,w,S,A,P,R,O){var V=new pe(16);return V[0]=r,V[1]=e,V[2]=i,V[3]=s,V[4]=a,V[5]=u,V[6]=h,V[7]=p,V[8]=y,V[9]=v,V[10]=w,V[11]=S,V[12]=A,V[13]=P,V[14]=R,V[15]=O,V},o.eM=l,o.eN=cc,o.eO=Ff,o.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Ye(1/0,1/0),max:new Ye(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r,e=!1){const i=Kv(new Ye(0,0),new Ye(ut,ut),r),s=[];if(e&&!Wy(i,this._globalClipBounds))return s;for(const a of this._activeRegions){if(a.hiddenByOverlap||!Wy(i,a))continue;const u=oA(a.min,a.max,r);s.push({min:u.min,max:u.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId,order:a.order,clipMask:a.clipMask,clipScope:a.clipScope})}return s}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const s of e.cache.getVisibleCoordinates()){const a=e.cache.getTile(s).buckets[e.layer];a&&a.updateFootprints(s.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(r){const e=r.getFootprints();if(e.length===0)return;const i=r.getOrder(),s=r.getClipMask(),a=r.getClipScope();for(const u of e){if(!u.footprint)continue;const h=Kv(u.footprint.min,u.footprint.max,u.id);this._activeRegions.push({min:h.min,max:h.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:u.id,footprint:u.footprint,order:i,clipMask:s,clipScope:a})}this._sourceIds.push(r.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||b_(e.min,i.min)||b_(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(s,a){const u=(h,p)=>h+p;return s.length-a.length||s.reduce(u,"").localeCompare(a.reduce(u,""))}(e.clipScope,i.clipScope));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0;for(;!r&&e!==this._activeRegions.length;){const i=this._activeRegions[e],s=this._prevRegions[e];r=i.priority!==s.priority||!Xv(i,s)||i.order!==s.order||i.clipMask!==s.clipMask||!ea(i.clipScope,s.clipScope),this._activeRegions[e].hiddenByOverlap=s.hiddenByOverlap,++e}}if(r){++this._updateTime;for(const i of this._activeRegions)i.order!==tp&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const s=this._activeRegions;if(i>=s.length)return i;const a=s[i].priority;for(;i<s.length&&s[i].priority===a;)++i;return i};if(this._sourceIds.length>1){let i=0,s=e(i);for(;i!==s;){let a=i;const u=i;for(;a!==s;){const h=this._activeRegions[a];h.hiddenByOverlap=!1;for(let p=0;p<u;p++){const y=this._activeRegions[p];if(!y.hiddenByOverlap&&h.order===tp&&Wy(h,y)&&(h.hiddenByOverlap=Yv(h.footprint,h.tileId,y.footprint,y.tileId),h.hiddenByOverlap))break}++a}i=s,s=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},o.eQ=tp,o.eR=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new Ha,s=new wn,a=[],u=r+1+2,h=e[0]+1,p=e[0]+1+(1+e.length),y=(v,w,S)=>{let A=v===u-1?v-2:v===0?v:v-1;return A+=S?24575:0,[A,w]};for(let v=0;v<u;++v)i.emplaceBack(...y(v,0,!0));for(let v=0;v<h;++v)for(let w=0;w<u;++w)i.emplaceBack(...y(w,v,(w===0||w===u-1)&&!0));for(let v=0;v<e.length;++v){const w=e[v];for(let S=0;S<u;++S)i.emplaceBack(...y(S,w,!0))}for(let v=0;v<e.length;++v){const w=s.length,S=e[v]+1+2,A=new wn;for(let O=0;O<S-1;O++){const V=O===S-2,N=V?u*(p-e.length+v-O):u;for(let q=0;q<u-1;q++){const W=O*u+q;O===0||V||q===0||q===u-2?(A.emplaceBack(W+1,W,W+N),A.emplaceBack(W+N,W+N+1,W+1)):(s.emplaceBack(W+1,W,W+N),s.emplaceBack(W+N,W+N+1,W+1))}}const P=Nr.simpleSegment(0,w,i.length,s.length-w);for(let O=0;O<A.uint16.length;O+=3)s.emplaceBack(A.uint16[O],A.uint16[O+1],A.uint16[O+2]);const R=Nr.simpleSegment(0,w,i.length,s.length-w);a.push({withoutSkirts:P,withSkirts:R})}return{vertices:i,indices:s,segments:a}}_createGrid(r){const e=this._fillGridMeshWithLods(hc,Wf);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,fc.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new wn;for(let h=0;h<=hc;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new Cl,s=new Cl,a=new Cl,u=new Cl;this._poleSegments=[];for(let h=0,p=0;h<no;h++){const y=360/(1<<h);i.emplaceBack(0,-ns,0,.5,0),s.emplaceBack(0,-ns,0,.5,1),a.emplaceBack(0,-ns,0,.5,.5),u.emplaceBack(0,-ns,0,.5,.5);for(let v=0;v<=hc;v++){let w=v/hc,S=0;const A=ii(0,y,w),[P,R,O]=Pl(PE,ME,A,ns);i.emplaceBack(P,R,O,w,S),s.emplaceBack(P,R,O,w,1-S);const V=Wi(A);w=.5+.5*Math.sin(V),S=.5+.5*Math.cos(V),a.emplaceBack(P,R,O,w,S),u.emplaceBack(P,R,O,w,1-S)}this._poleSegments.push(Nr.simpleSegment(p,0,66,64)),p+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,Ao,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(s,Ao,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(a,Ao,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(u,Ao,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},o.eS=Wv,o.eT=Lc,o.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eV=Ee,o.eW=H,o.eX=function(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r},o.eY=ri,o.eZ=dc,o.e_=Rt,o.ea=S_,o.eb=fb,o.ec=Rl,o.ed=rb,o.ee=ib,o.ef=F,o.eg=function(r,e){if(r===e){var i=e[1],s=e[2],a=e[3],u=e[6],h=e[7],p=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=s,r[9]=u,r[11]=e[14],r[12]=a,r[13]=h,r[14]=p}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},o.eh=oC,o.ei=Ii,o.ej=Nf,o.ek=256,o.el=ky,o.em=Gs,o.en=Sr,o.eo=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},o.ep=Cl,o.eq=Om,o.er=kf,o.es=function(r,e,i,s,a){return U((r-e)/(i-e)*(a-s)+s,s,a)},o.et=Pr,o.eu=function(r,e){var i=e[0],s=e[1],a=e[2],u=e[3],h=e[4],p=e[5],y=e[6],v=e[7],w=e[8],S=w*h-p*v,A=-w*u+p*y,P=v*u-h*y,R=i*S+s*A+a*P;return R?(r[0]=S*(R=1/R),r[1]=(-w*s+a*v)*R,r[2]=(p*s-a*h)*R,r[3]=A*R,r[4]=(w*i-a*y)*R,r[5]=(-p*i+a*u)*R,r[6]=P*R,r[7]=(-v*i+s*y)*R,r[8]=(h*i-s*u)*R,r):null},o.ev=2,o.ew=ci,o.ex=Bi,o.ey=fs,o.ez=function(r,e){var i=new pe(3);fs(i,e);var s=1/i[0],a=1/i[1],u=1/i[2],h=e[0]*s,p=e[1]*a,y=e[2]*u,v=e[4]*s,w=e[5]*a,S=e[6]*u,A=e[8]*s,P=e[9]*a,R=e[10]*u,O=h+w+R,V=0;return O>0?(V=2*Math.sqrt(O+1),r[3]=.25*V,r[0]=(S-P)/V,r[1]=(A-y)/V,r[2]=(p-v)/V):h>w&&h>R?(V=2*Math.sqrt(1+h-w-R),r[3]=(S-P)/V,r[0]=.25*V,r[1]=(p+v)/V,r[2]=(A+y)/V):w>R?(V=2*Math.sqrt(1+w-h-R),r[3]=(A-y)/V,r[0]=(p+v)/V,r[1]=.25*V,r[2]=(S+P)/V):(V=2*Math.sqrt(1+R-h-w),r[3]=(p-v)/V,r[0]=(A+y)/V,r[1]=(S+P)/V,r[2]=.25*V),r},o.f=function(r){return btoa(encodeURIComponent(r).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},o.f0=function([r,e,i]){const s=Math.hypot(r,e,i),a=Math.atan2(r,i),u=.5*Math.PI-Math.acos(-e/s);return new n(us(a),us(u))},o.f1=ni,o.f2=lx,o.f3=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(pn==null){const s=i.navigator?i.navigator.userAgent:null;pn=!!i.safari||!(!s||!(/\b(iPad|iPhone|iPod)\b/.test(s)||s.match("Safari")&&!s.match("Chrome")))}return pn}(r)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f4=function(r,e){Nu=r,Vu=e},o.f5=By,o.f6=yv,o.f7=function(r){const e=[0,0,0],i=mt(new Float64Array(16));return wt(i,r.pixelMatrix,r.globeMatrix),Ae(e,e,i),new Ye(e[0],e[1])},o.f8=function(){const r=ap;r&&(r.isPreloaded()&&r.numActive()===1?(r.release(Qy),ap=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f9=function(){A_().acquire(Qy)},o.fA=sg,o.fB=xe,o.fC=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==Mb){const i=new Uint32Array(r,0,7),[,,s,a,u,h]=i;e=i.byteLength+a+u+h+u,(s!==r.byteLength||e>=r.byteLength)&&St("Invalid b3dm header information.")}return zb(r,e)},o.fD=function(r,e){const i=fx(r);for(const s of i){for(const a of s.meshes)FA(a);s.lights&&(s.lightMeshIndex=s.meshes.length,s.meshes.push(BA(s.lights,e)))}return i},o.fE=Q_,o.fF=Vi,o.fG=Eb,o.fH=ca,o.fI=Ls,o.fJ=function(r){xo(),zo?.then(e=>{e.keys().then(i=>{for(let s=0;s<i.length-r;s++)e.delete(i[s]).catch(a=>St(a.message))}).catch(i=>St(i.message))}).catch(e=>St(e.message))},o.fa=au,o.fb=function(r,e,i=!1){if(ys===Ls.deferred||ys===Ls.loading||ys===Ls.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");la=Ln.resolveURL(r),ys=Ls.deferred,Af=e,Ch(),i||Wm()},o.fc=function(r){sd=Ln.resolveURL(r),od||(od=new nd(A_(),new pl)),od.broadcast("setMeshoptUrl",sd)},o.fd=Cb,o.fe=function(r){ix=Ln.resolveURL(r),od||(od=new nd(A_(),new pl)),od.broadcast("setDracoUrl",ix)},o.ff=Ib,o.fg=op,o.fh=function(r){const e=yo();if(!e)return;const i=e.delete(Bu);r&&i.then(()=>r()).catch(r)},o.fi=bu,o.fj=Mt,o.fk=_c,o.fl=va,o.fm=Ww,o.fn=Zw,o.fo=Xb,o.fp=Fe,o.fq="hd_road_elevation",o.fr=tr,o.fs=Me,o.ft=Ml,o.fu=Ax,o.fv=Su,o.fw=function(r,e,i,s,a,u,h,p=1,y,v,w){r.createArrays(),r.tilePixelRatio=ut/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const S=r.layers[0].layout,A=r.layers[0]._unevaluatedLayout._values,P={};P.scaleFactor=p,P.textSizeScaleRange=S.get("text-size-scale-range"),P.iconSizeScaleRange=S.get("icon-size-scale-range");const[R,O]=P.textSizeScaleRange,[V,N]=P.iconSizeScaleRange;P.textScaleFactor=U(P.scaleFactor,R,O),P.iconScaleFactor=U(P.scaleFactor,V,N);const q=A["text-size"],W=A["icon-size"];if(r.textSizeData.kind==="composite"){const{minZoom:ge,maxZoom:ze}=r.textSizeData;P.compositeTextSizes=[q.possiblyEvaluate(new Mr(ge,{worldview:w}),u),q.possiblyEvaluate(new Mr(ze,{worldview:w}),u)]}if(r.iconSizeData.kind==="composite"){const{minZoom:ge,maxZoom:ze}=r.iconSizeData;P.compositeIconSizes=[W.possiblyEvaluate(new Mr(ge,{worldview:w}),u),W.possiblyEvaluate(new Mr(ze,{worldview:w}),u)]}P.layoutTextSize=q.possiblyEvaluate(new Mr(h+1,{worldview:w}),u),P.layoutIconSize=W.possiblyEvaluate(new Mr(h+1,{worldview:w}),u),P.textMaxSize=q.possiblyEvaluate(new Mr(18,{worldview:w}),u);const K=S.get("symbol-placement"),se=S.get("text-rotation-alignment")==="map"&&K!=="point",te=S.get("text-size");let le=!1;const fe=[];for(const ge of r.features){const ze=S.get("text-font").evaluate(ge,{},u).join(","),we=te.evaluate(ge,{},u)*P.textScaleFactor,Ne=P.layoutTextSize.evaluate(ge,{},u)*P.textScaleFactor,He=P.layoutIconSize.evaluate(ge,{},u)*P.iconScaleFactor,qe={horizontal:{},vertical:void 0},Je=ge.text;let et,Ze=[0,0];if(Je){const mi=Je.toString(),dr=S.get("text-letter-spacing").evaluate(ge,{},u)*On,ie=S.get("text-line-height").evaluate(ge,{},u)*On,oe=Sf(mi)?dr:0,Ve=S.get("text-anchor").evaluate(ge,{},u),Qe=S.get("text-variable-anchor");if(!Qe){const fi=S.get("text-radial-offset").evaluate(ge,{},u);if(fi)Ze=R1(Ve,[fi*On,Px]);else{const bi=S.get("text-offset").evaluate(ge,{},u);Ze=[bi[0]*On,bi[1]*On]}}let _t=se?"center":S.get("text-justify").evaluate(ge,{},u);const gt=K==="point",Vt=gt?S.get("text-max-width").evaluate(ge,{},u)*On:1/0,Ht=fi=>{r.allowVerticalPlacement&&su(mi)&&(qe.vertical=bx(Je,e,i,a,ze,Vt,ie,Ve,fi,oe,Ze,Ws.vertical,!0,Ne,we,y))};if(!se&&Qe){const fi=_t==="auto"?Qe.map(Ti=>Mx(Ti)):[_t];let bi=!1;for(let Ti=0;Ti<fi.length;Ti++){const Ci=fi[Ti];if(!qe.horizontal[Ci])if(bi)qe.horizontal[Ci]=qe.horizontal[0];else{const ti=bx(Je,e,i,a,ze,Vt,ie,"center",Ci,oe,Ze,Ws.horizontal,!1,Ne,we,y);ti&&(qe.horizontal[Ci]=ti,bi=ti.positionedLines.length===1)}}Ht("left")}else{if(_t==="auto"&&(_t=Mx(Ve)),gt||S.get("text-writing-mode").indexOf("horizontal")>=0||!su(mi)){const fi=bx(Je,e,i,a,ze,Vt,ie,Ve,_t,oe,Ze,Ws.horizontal,!1,Ne,we,y);fi&&(qe.horizontal[_t]=fi)}Ht(gt?"left":_t)}}let Xe,Be,ke,Ke,ht,st,Nt=!1;const vt=S.get("icon-text-fit").evaluate(ge,{},u);if(ge.icon&&ge.icon.hasPrimary()){const mi=gp(ge.icon,r.iconSizeData,A["icon-size"],u,r.zoom,ge,y,P.iconScaleFactor,w);Xe=mi.iconPrimary,ke=mi.iconSecondary;const dr=Xe.toString();if(Be=s.get(dr),Be&&(ht=S.get("icon-offset").evaluate(ge,{},u),st=S.get("icon-anchor").evaluate(ge,{},u),et=B_(a.get(dr),ke?a.get(ke.toString()):void 0,ht,st),Nt=Be.sdf,r.sdfIcons===void 0?r.sdfIcons=Be.sdf:r.sdfIcons!==Be.sdf&&St("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Be.pixelRatio!==r.pixelRatio||S.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0)),ke){const ie=ke.toString();Ke=s.get(ie)}}le=le||!(!ge.icon||!ge.icon.hasSecondary());const At=G_(qe.horizontal)||qe.vertical;r.iconsInText||(r.iconsInText=!!At&&At.iconsInText);const Lt=Ne*P.textScaleFactor/On,{defaultShapedIcon:Si,verticallyShapedIcon:at}=$I(r,et,S,ge,u,qe,Lt,ht,vt);vt!=="none"&&et&&(_1(et)||g1(et))&&(j_(0,Be,Xe,et,Si,vt,v,s,a),j_(0,Ke,ke,et,Si,vt,v,s,a),at&&(j_(0,Be,Xe,et,at,vt,v,s,a),j_(0,Ke,ke,et,at,vt,v,s,a))),et=Si;const{iconBBox:Ot,iconVerticalBBox:li,textBBox:Di,textVerticalBBox:ki}=UI(r,et,at,S,ge,u,He,ht,P,a,st,qe,Ne,Ze);fe.push({feature:ge,shapedTextOrientations:qe,shapedText:At,shapedIcon:et,iconPrimary:Xe,iconSecondary:ke,iconOffset:ht,iconAnchor:st,verticallyShapedIcon:at,layoutTextSize:Ne,layoutIconSize:He,textOffset:Ze,isSDFIcon:Nt,iconTextFit:vt,iconCollisionBounds:Ot,iconVerticalCollisionBounds:li,textCollisionBounds:Di,textVerticalCollisionBounds:ki})}return{featureData:fe,sizes:P,hasAnySecondaryIcon:le,textAlongLine:se,symbolPlacement:K}},o.fx=E1,o.fy=function(r,e,i,s,a,u,h,p,y,v){r.iconAtlasPositions=v.iconPositions;const{featureData:w,hasAnySecondaryIcon:S,sizes:A,textAlongLine:P,symbolPlacement:R}=e;for(const O of w){const{shapedIcon:V,verticallyShapedIcon:N,feature:q,shapedTextOrientations:W,shapedText:K,layoutTextSize:se,textOffset:te,isSDFIcon:le,iconPrimary:fe,iconSecondary:ge,iconTextFit:ze,iconOffset:we,iconCollisionBounds:Ne,iconVerticalCollisionBounds:He,textCollisionBounds:qe}=O;L1(V,v.iconPositions,fe,ge),L1(N,v.iconPositions,fe,ge),qI(W,v.iconPositions),HI(fe,ge,v.iconPositions),(K||V)&&WI(r,q,W,V,N,y,A,se,0,te,le,s,a,h,p,S,ze,we,P,R,Ne,He,qe)}i&&r.generateCollisionDebugBuffers(u,r.collisionBoxArray,A.textScaleFactor)},o.fz=Ce,o.g=function(r,e){return fl(Object.assign(r,{method:"GET"}),e)},o.h=function(r){return r.indexOf("mapbox:")===0},o.i=function(r){return Mi.API_STYLE_REGEX.test(r)&&!Xn(r)},o.j=Qr,o.k=Oo,o.l=function(r){return decodeURIComponent(atob(r).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(r,e){return fl(Object.assign(r,{type:"json"}),e)},o.n=Hu,o.o=Ln,o.p=function(r,e){return fl(Object.assign(r,{method:"POST"}),e)},o.q=as,o.r=Lo,o.s=function(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return ex||(ex=new bu("ImageRasterizer")),ex},o.u=function(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()},o.v=function(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)},o.w=St,o.x=Wx,o.y=Nc,o.z=ko}),k(["./shared"],function(o){function Q(Ee){const U=Ee?Ee.url.toString():void 0;return U?performance.getEntriesByName(U):[]}function pe(Ee){if(typeof Ee=="number"||typeof Ee=="boolean"||typeof Ee=="string"||Ee==null)return JSON.stringify(Ee);if(Array.isArray(Ee)){let $="[";for(const J of Ee)$+=`${pe(J)},`;return`${$}]`}let U="{";for(const $ of Object.keys(Ee).sort())U+=`${$}:${pe(Ee[$])},`;return`${U}}`}function he(Ee){let U="";for(const $ of o.bx)U+=`/${pe(Ee[$])}`;return U}class ye{constructor(U){this.keyCache={},this._layers={},this._layerConfigs={},U&&this.replace(U)}replace(U,$){this._layerConfigs={},this._layers={},this.update(U,[],$)}update(U,$,J){this._options=J;for(const de of U)this._layerConfigs[de.id]=de,(this._layers[de.id]=o.du(de,this.scope,null,this._options)).compileFilter(J),this.keyCache[de.id]&&delete this.keyCache[de.id];for(const de of $)delete this.keyCache[de],delete this._layerConfigs[de],delete this._layers[de];this.familiesBySource={};const me=function(de,ve){const Re={};for(let Me=0;Me<de.length;Me++){const tt=de[Me];let Ge=ve&&ve[tt.id];Ge||(tt.type==="symbol"?Ge=tt.id:(Ge=he(tt),tt.type==="line"&&tt.paint&&function qt(St){return typeof St=="string"&&St==="line-progress"||(Array.isArray(St)?St.some(qt):!(!St||typeof St!="object")&&Object.values(St).some(qt))}(tt.paint["line-width"])&&(Ge+=`/${pe(tt.paint["line-width"])}`))),ve&&(ve[tt.id]=Ge);let Pt=Re[Ge];Pt||(Pt=Re[Ge]=[]),Pt.push(tt)}const Te=[];for(const Me in Re)Te.push(Re[Me]);return Te}(Object.values(this._layerConfigs),this.keyCache);for(const de of me){const ve=de.map(Pt=>this._layers[Pt.id]),Re=ve[0];if(Re.visibility==="none")continue;const Te=Re.source||"";let Me=this.familiesBySource[Te];Me||(Me=this.familiesBySource[Te]={});const tt=Re.sourceLayer||"_geojsonTileLayer";let Ge=Me[tt];Ge||(Ge=Me[tt]=[]),Ge.push(ve)}}}const Oe=1*o.fl;class je{constructor(U){const $={},J=[];for(const Re in U){const Te=U[Re],Me=$[Re]={};for(const tt in Te.glyphs){const Ge=Te.glyphs[+tt];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const Pt=Ge.metrics.localGlyph?Oe:1,qt={x:0,y:0,w:Ge.bitmap.width+2*Pt,h:Ge.bitmap.height+2*Pt};J.push(qt),Me[tt]=qt}}const{w:me,h:de}=o.G(J),ve=new o.fk({width:me||1,height:de||1});for(const Re in U){const Te=U[Re];for(const Me in Te.glyphs){const tt=Te.glyphs[+Me];if(!tt||tt.bitmap.width===0||tt.bitmap.height===0)continue;const Ge=$[Re][Me],Pt=tt.metrics.localGlyph?Oe:1;o.fk.copy(tt.bitmap,ve,{x:0,y:0},{x:Ge.x+Pt,y:Ge.y+Pt},tt.bitmap)}}this.image=ve,this.positions=$}}function ft(Ee,U,$){Ee[U]?$&&(Ee[U].center=$):Ee[U]={floorIds:new Set,center:$||[0,0],floors:{}}}function rt(Ee,U,$,J){for(const me of U)ft(Ee,me),Ee[me].floors[$]=J,Ee[me].floorIds.add($)}function mt(Ee){return{id:Ee.properties.id.toString(),center:Ee.properties.center.toString().split(";").map(Number)}}function Wt(Ee){return{id:Ee.properties.id.toString(),isDefault:!!Ee.properties.is_default&&Ee.properties.is_default,connections:Ee.properties.connected_floor_ids?new Set(Ee.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:Ee.properties.conflicted_floor_ids?new Set(Ee.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:Ee.properties.building_ids?new Set(Ee.properties.building_ids.toString().split(";")):new Set,name:Ee.properties.name.toString(),zIndex:Ee.properties.z_index}}function wt(Ee,U){return U.every($=>Ee.properties&&Ee.properties[$]!=null)}function Xt(Ee){return wt(Ee,["type","id","name"])&&Ee.properties.type==="building"}function Zt(Ee){return wt(Ee,["type","id","name","z_index"])&&Ee.properties.type==="floor"}o.fj(je,"GlyphAtlas");class Li{constructor(U){this.tileID=new o.aQ(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.lut=U.lut,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.scope=U.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=U.showCollisionBoxes,this.collectResourceTiming=!!U.request&&U.request.collectResourceTiming,this.promoteId=U.promoteId,this.isSymbolTile=U.isSymbolTile,this.tileTransform=o.aZ(U.tileID.canonical,U.projection),this.projection=U.projection,this.worldview=U.worldview,this.localizableLayerIds=U.localizableLayerIds,this.brightness=U.brightness,this.extraShadowCaster=!!U.extraShadowCaster,this.tessellationStep=U.tessellationStep,this.scaleFactor=U.scaleFactor,this.worldview=U.worldview,this.indoor=U.indoor}parse(U,$,J,me,de,ve){this.status="parsing",this.data=U,this.collisionBoxArray=new o.b3;const Re=new o.fm(Object.keys(U.layers).sort()),Te=new o.fn(this.tileID,this.promoteId);Te.bucketLayerIDs=[];const Me={},tt=new o.fo(256,256),Ge={featureIndex:Te,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:tt,availableImages:J,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const yi=this.indoor.indoorState.activeFloorsVisible,_i=function(pi,Vi,Zr){const pn=function(Hr,Hi){if(!Hr)return o.w("No source layers defined in indoor specification"),Hi;if(Hr.size===0)return Hi;const qr=Hr.difference(Hi);for(const br of qr)o.w(`Missing source layer required in indoor specification: ${br}`);return Hi.intersection(Hi)}(Vi.sourceLayers,new Set(Object.keys(pi.layers))),Jr=Vi.indoorState,yn=function(Hr,Hi,qr,br){const Mi=new Set,Qr=new Set,Xn=new Set,is=new Map,ws={},cl=Vn=>{const Vs=is.get(Vn)||new Set;for(const hs of Mi)if((is.get(hs)||new Set).has(Vn)||Vs.has(hs))return!0;return!1};for(const Vn of Hi){const Vs=Hr.layers[Vn];if(Vs)for(let hs=0;hs<Vs.length;hs++){const Lo=Vs.feature(hs);if(Xt(Lo)){const{id:Ln,center:ul}=mt(Lo);ft(ws,Ln,ul),Mi.add(Ln)}else if(Zt(Lo)){const{id:Ln,isDefault:ul,connections:jl,conflicts:Bu,buildings:Nu,name:Vu,zIndex:zc}=Wt(Lo);rt(ws,Nu,Ln,{name:Vu,zIndex:zc}),is.set(Ln,Bu),(Ln===br||jl.has(br))&&Mi.add(Ln),Qr.add(Ln),ul&&Xn.add(Ln)}}else o.w(`indoor source layer not found: ${Vn}`)}if(qr)for(const Vn of qr)Qr.has(Vn)&&(cl(Vn)||Mi.add(Vn));for(const Vn of Xn)Mi.has(Vn)||cl(Vn)||Mi.add(Vn);return{buildings:ws,activeFloors:Mi}}(pi,pn,Jr.lastActiveFloors,Jr.selectedFloorId);return Zr.send("setIndoorData",yn),yn}(U,this.indoor,de);Ge.activeFloors=yi?_i.activeFloors:void 0}const Pt=[],qt=$.familiesBySource[this.source];for(const yi in qt){const _i=U.layers[yi];if(!_i)continue;let pi=!1,Vi=!1,Zr=!1;for(const Hi of qt[yi])Hi[0].type==="symbol"?pi=!0:Vi=!0,Hi[0].is3D()&&Hi[0].type!=="model"&&(Zr=!0);if(this.extraShadowCaster&&!Zr||this.isSymbolTile===!0&&!pi||this.isSymbolTile===!1&&!Vi)continue;_i.version===1&&o.w(`Vector tile source "${this.source}" layer "${yi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pn=Re.encode(yi),Jr=[],yn=this.localizableLayerIds&&this.localizableLayerIds.has(yi);let Hr=!1;for(let Hi=0,qr=0;Hi<_i.length;Hi++){const br=_i.feature(Hi),Mi=Te.getId(br,yi),Qr=br.properties?br.properties.worldview:null;if(yn&&this.worldview&&typeof Qr=="string")if(Qr==="all")br.properties.$localized=!0;else{if(!Qr.split(",").includes(this.worldview))continue;br.properties.$localized=!0,br.properties.worldview=this.worldview}!Hr&&br.properties&&br.properties.hasOwnProperty(o.fp)&&(Hr=!0),Jr.push({feature:br,id:Mi,index:qr,sourceLayerIndex:pn}),qr++}Hr&&!Ge.elevationFeatures&&U.layers.hasOwnProperty(o.fq)&&(Ge.elevationFeatures=o.fr.parseFrom(U.layers[o.fq],this.canonical));for(const Hi of qt[yi]){const qr=Hi[0];if(this.extraShadowCaster&&(!qr.is3D()||qr.type==="model")||this.isSymbolTile!==void 0&&qr.type==="symbol"!==this.isSymbolTile||qr.minzoom&&this.zoom<Math.floor(qr.minzoom)||qr.maxzoom&&this.zoom>=qr.maxzoom||qr.visibility==="none")continue;Sr(Hi,this.zoom,Ge.brightness,J,this.worldview);const br=Me[qr.id]=qr.createBucket({index:Te.bucketLayerIDs.length,layers:Hi,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pn,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:me,worldview:this.worldview,localizable:yn});Te.bucketLayerIDs.push(Hi.map(Qr=>o.B(Qr.id,Qr.scope)));let Mi=br.prepare?br.prepare():null;Mi!=null?(Mi=Mi.then(()=>br.populate(Jr,Ge,this.tileID.canonical,this.tileTransform)),Pt.push(Mi)):br.populate(Jr,Ge,this.tileID.canonical,this.tileTransform)}}const St=()=>{let yi,_i,pi,Vi,Zr,pn;tt.trim();const Jr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},yn=()=>{if(yi)return this.status="done",ve(yi);if(this.extraShadowCaster)this.status="done",ve(null,{buckets:Object.values(Me).filter(Hi=>!Hi.isEmpty()),featureIndex:Te,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:Ge.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(_i&&pi&&Vi){const Hi=new je(_i),qr=new Map;for(const[Qr,Xn]of pi.entries()){const{imagePosition:is}=o.fu(Qr,Xn,o.fv);qr.set(Qr,is)}const br={};for(const Qr in Me){const Xn=Me[Qr];Xn instanceof o.b4&&(Sr(Xn.layers,this.zoom,Ge.brightness,J,this.worldview),br[Qr]=o.fw(Xn,_i,Hi.positions,pi,qr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,Zr,this.worldview))}const Mi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(de,pi,Zr,()=>{Mi.iconsPending=!1,Hr(br,Hi,Mi)}),this.rasterizeIfNeeded(de,Vi,pn,()=>{Mi.patternsPending=!1,Hr(br,Hi,Mi)})}},Hr=(Hi,qr,br,Mi)=>{if(br.iconsPending||br.patternsPending)return;const Qr=new o.fx(pi,Vi,this.lut);for(const Xn in Me){const is=Me[Xn];if(Xn in Hi)o.fy(is,Hi[Xn],this.showCollisionBoxes,J,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,pi,Qr);else if(is.hasPattern&&(is instanceof o.ba||is instanceof o.bb||is instanceof o.ea)){Sr(is.layers,this.zoom,Ge.brightness,J,this.worldview);const ws=Object.fromEntries(Qr.patternPositions);is.addFeatures(Ge,this.tileID.canonical,ws,J,this.tileTransform,this.brightness)}}this.status="done",ve(null,{buckets:Object.values(Me).filter(Xn=>!Xn.isEmpty()),featureIndex:Te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:qr.image,lineAtlas:tt,imageAtlas:Qr,brightness:Ge.brightness})};if(!this.extraShadowCaster){const Hi=o.fs(Ge.glyphDependencies,Mi=>Object.keys(Mi).map(Number));Object.keys(Hi).length?de.send("getGlyphs",{uid:this.uid,stacks:Hi},(Mi,Qr)=>{yi||(yi=Mi,_i=Qr,yn())},void 0,!1,Jr):_i={};const qr=Array.from(Ge.iconDependencies.keys()).map(Mi=>o.I.parse(Mi));qr.length?de.send("getImages",{images:qr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(Mi,Qr)=>{yi||(yi=Mi,pi=new Map,Zr=this.updateImageMapAndGetImageTaskQueue(pi,Qr,Ge.iconDependencies),yn())},void 0,!1,Jr):(pi=new Map,Zr=new Map);const br=Array.from(Ge.patternDependencies.keys()).map(Mi=>o.I.parse(Mi));br.length?de.send("getImages",{images:br,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(Mi,Qr)=>{yi||(yi=Mi,Vi=new Map,pn=this.updateImageMapAndGetImageTaskQueue(Vi,Qr,Ge.patternDependencies),yn())},void 0,!1,Jr):(Vi=new Map,pn=new Map)}if(Ge.elevationFeatures&&Ge.elevationFeatures.length>0){const Hi=[];for(const br of Object.values(Me))if(br instanceof o.bb){const Mi=br.getUnevaluatedPortalGraph();Mi&&Hi.push(Mi)}const qr=o.ft.evaluate(Hi);for(const br of Object.values(Me))if(br instanceof o.bb){const Mi=U.layers[Re.decode(br.sourceLayerIndex)];br.setEvaluatedPortalGraph(qr,Mi,this.tileID.canonical,Ge.availableImages,Ge.brightness)}}yn()};Pt.length>0?Promise.allSettled(Pt).then(St).catch(ve):St()}updateParameters(U){this.scaleFactor=U.scaleFactor,this.showCollisionBoxes=U.showCollisionBoxes,this.projection=U.projection,this.brightness=U.brightness,this.tileTransform=o.aZ(U.tileID.canonical,U.projection),this.extraShadowCaster=U.extraShadowCaster,this.lut=U.lut,this.worldview=U.worldview,this.indoor=U.indoor}rasterizeIfNeeded(U,$,J,me){Array.from($.values()).some(de=>de.usvg)?this.rasterize(U,$,J,me):me()}updateImageMapAndGetImageTaskQueue(U,$,J){const me=new Map;for(const de of $.keys()){const ve=J.get(de)||[];for(const Re of ve){const Te=Re.toString(),Me=$.get(Re.id.toString());Me.usvg?me.has(Te)||(me.set(Te,Re),U.set(Te,Object.assign({},Me))):U.set(Te,Me)}}return me}rasterize(U,$,J,me){this.rasterizeTask=U.send("rasterizeImages",{scope:this.scope,tasks:J},(de,ve)=>{if(!de)for(const[Re,Te]of ve.entries()){const Me=Object.assign($.get(Re),{data:Te});$.set(Re,Me)}me()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function Sr(Ee,U,$,J,me){const de=new o.ac(U,{brightness:$,worldview:me});for(const ve of Ee)ve.recalculate(de,J)}class mr extends o.E{constructor(U,$,J,me,de,ve,Re){super(),this.actor=U,this.layerIndex=$,this.availableImages=J,this.availableModels=me,this.loadVectorData=ve||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(U.scheduler),this.isSpriteLoaded=de,this.scheduler=U.scheduler,this.brightness=Re}loadTile(U,$){const J=U.uid,me=U&&U.request,de=me&&me.collectResourceTiming,ve=this.loading[J]=new Li(U);ve.abort=this.loadVectorData(U,(Re,Te)=>{const Me=!this.loading[J];if(delete this.loading[J],ve.cancelRasterize(),Me||Re||!Te)return ve.status="done",Me||(this.loaded[J]=ve),$(Re);const tt=Te.rawData,Ge={},Pt=o.aM(Te.responseHeaders);Pt&&Pt.expires&&(Ge.expires=Pt.expires),Pt&&Pt.cacheControl&&(Ge.cacheControl=Pt.cacheControl),ve.vectorTile=Te.vectorTile||new o.fz(new o.bt(tt));const qt=()=>{ve.parse(ve.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(St,yi)=>{if(St||!yi)return $(St);const _i={};if(de){const pi=Q(me);pi.length>0&&(_i.resourceTiming=JSON.parse(JSON.stringify(pi)))}$(null,Object.assign({rawTileData:tt.slice(0),responseHeaders:Te.responseHeaders},yi,Ge,_i))})};this.isSpriteLoaded?qt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(qt,{type:"parseTile",isSymbolTile:U.isSymbolTile,zoom:U.tileZoom}):qt()}),this.loaded=this.loaded||{},this.loaded[J]=ve})}reloadTile(U,$){const J=this.loaded,me=U.uid;if(J&&J[me]){const de=J[me];de.updateParameters(U);const ve=(Re,Te)=>{const Me=de.reloadCallback;Me&&(delete de.reloadCallback,de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Me)),$(Re,Te)};de.status==="parsing"?de.reloadCallback=ve:de.status==="done"&&(de.vectorTile?de.parse(de.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,ve):ve())}else $(null,void 0)}abortTile(U,$){const J=U.uid,me=this.loading[J];me&&(me.abort&&me.abort(),delete this.loading[J]),$()}removeTile(U,$){const J=this.loaded,me=U.uid;J&&J[me]&&delete J[me],$()}}class vn{loadTile(U,$){const{uid:J,encoding:me,rawImageData:de,padding:ve}=U,Re=ImageBitmap&&de instanceof ImageBitmap?this.getImageData(de,ve):de;$(null,new o.fA(J,Re,me,ve<1))}reloadTile(U,$){$(null,null)}abortTile(U,$){$()}removeTile(U,$){$()}getImageData(U,$){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(U.width,U.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=U.width,this.offscreenCanvas.height=U.height,this.offscreenCanvasContext.drawImage(U,0,0,U.width,U.height);const J=this.offscreenCanvasContext.getImageData(-$,-$,U.width+2*$,U.height+2*$);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}o.bs.setPbf(o.bt);class Zn{constructor(U){this._mrt=new o.bs(U.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=U.uid,this.tileID=U.tileID,this.source=U.source}parse(U,$){const J=this._mrt;this.status="parsing",this._entireBuffer=U;try{J.parseHeader(U),this._isHeaderLoaded=!0;const me=[];for(const de in J.layers){const ve=J.getLayer(de),Re=ve.getDataRange(ve.getBandList()),Te=J.createDecodingTask(Re),Me=U.slice(Re.firstByte,Re.lastByte+1),tt=o.bs.performDecoding(Me,Te).then(Ge=>Te.complete(null,Ge)).catch(Ge=>Te.complete(Ge,null));me.push(tt)}Promise.allSettled(me).then(()=>$(null,J)).catch(de=>$(de))}catch(me){$(me)}}}class fs{constructor(U){this.actor=U,this.loading={},this.loaded={}}loadTile(U,$){const J=U.uid,me=U.request,de=this.loading[J]=new Zn(U),{cancel:ve}=o.bu(me,(Re,Te,Me)=>{const tt=!this.loading[J];if(delete this.loading[J],tt||Re||!Te)return de.status="done",tt||(this.loaded[J]=de),$(Re);de.parse(Te,(Ge,Pt)=>{if(Ge||!Pt)return $(Ge);$(null,Pt,Me)}),this.loaded[J]=de});de.abort=ve}reloadTile(U,$){$(null,void 0)}abortTile(U,$){const J=U.uid,me=this.loading[J];me&&(me.abort&&me.abort(),delete this.loading[J]),$()}removeTile(U,$){const J=U.uid;this.loaded[J]&&delete this.loaded[J],$()}decodeRasterArray(U,$){o.bs.performDecoding(U.buffer,U.task).then(J=>$(null,J)).catch(J=>$(J))}}const Rs=o.fB.prototype.toGeoJSON;class Ns{constructor(U){this._feature=U,this.extent=o.al,this.type=U.type,this.properties=U.tags,"id"in U&&!isNaN(U.id)&&(this.id=parseInt(U.id,10))}loadGeometry(){if(this._feature.type===1){const U=[];for(const $ of this._feature.geometry)U.push([new o.P($[0],$[1])]);return U}{const U=[];for(const $ of this._feature.geometry){const J=[];for(const me of $)J.push(new o.P(me[0],me[1]));U.push(J)}return U}}toGeoJSON(U,$,J){return Rs.call(this,U,$,J)}}class Fi{constructor(U,$){this.name=U,this.extent=o.al,this.length=$.length,this._jsonFeatures=$}feature(U){return new Ns(this._jsonFeatures[U])}}class Ro{constructor(U){this.layers={},this.extent=o.al;for(const $ of Object.keys(U))this.layers[$]=new Fi($,U[$])}}const ln=64/4096,Qi=128;class Ei{constructor(){this.features=new Map}clear(){this.features.clear()}load(U=[],$){for(const J of U){const me=J.id;if(me==null)continue;let de=this.features.get(me);de&&this.updateCache(de,$),J.geometry?(de=Gn(J),this.updateCache(de,$),this.features.set(me,de)):this.features.delete(me),this.updateCache(de,$)}}updateCache(U,$){for(const{canonical:J,uid:me}of Object.values($)){const{z:de,x:ve,y:Re}=J;Oi(U,Math.pow(2,de),ve,Re)&&delete $[me]}}getTile(U,$,J){const me=Math.pow(2,U),de=[];for(const ve of this.features.values())Oi(ve,me,$,J)&&de.push(Cr(ve,me,$,J));return{features:de}}getFeatures(){return[...this.features.values()]}}function Oi({minX:Ee,minY:U,maxX:$,maxY:J},me,de,ve){return Ee<(de+1+ln)/me&&U<(ve+1+ln)/me&&$>(de-ln)/me&&J>(ve-ln)/me}function Gn(Ee){const{id:U,geometry:$,properties:J}=Ee;if(!$)return;if($.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:me,coordinates:de}=$,ve={id:U,type:1,geometry:[],tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Re=ve.geometry;if(me==="Point")Hn(de,Re,ve);else if(me==="MultiPoint")for(const Te of de)Hn(Te,Re,ve);else if(me==="LineString")ve.type=2,Nn(de,Re,ve);else if(me==="MultiLineString")ve.type=2,fn(de,Re,ve);else if(me==="Polygon")ve.type=3,fn(de,Re,ve,!0);else{if(me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");ve.type=3;for(const Te of de)fn(Te,Re,ve,!0)}return ve}function Hn([Ee,U],$,J){const me=o.aF(Ee);let de=o.aJ(U);de=de<0?0:de>1?1:de,$.push(me,de),J.minX=Math.min(J.minX,me),J.minY=Math.min(J.minY,de),J.maxX=Math.max(J.maxX,me),J.maxY=Math.max(J.maxY,de)}function Nn(Ee,U,$,J=!1,me=!1){const de=[];for(const ve of Ee)Hn(ve,de,$);U.push(de),J&&function(ve,Re){let Te=0;for(let Me=0,tt=ve.length,Ge=tt-2;Me<tt;Ge=Me,Me+=2)Te+=(ve[Me]-ve[Ge])*(ve[Me+1]+ve[Ge+1]);if(Te>0===Re)for(let Me=0,tt=ve.length;Me<tt/2;Me+=2){const Ge=ve[Me],Pt=ve[Me+1];ve[Me]=ve[tt-2-Me],ve[Me+1]=ve[tt-1-Me],ve[tt-2-Me]=Ge,ve[tt-1-Me]=Pt}}(de,me)}function fn(Ee,U,$,J=!1){for(let me=0;me<Ee.length;me++)Nn(Ee[me],U,$,J,me===0)}function Cr(Ee,U,$,J){const{id:me,type:de,geometry:ve,tags:Re}=Ee,Te=[];if(de===1)(function(Me,tt,Ge,Pt,qt){for(let St=0;St<Me.length;St+=2){const yi=Math.round(o.al*(Me[St+0]*tt-Ge)),_i=Math.round(o.al*(Me[St+1]*tt-Pt));qt.push([yi,_i])}})(ve,U,$,J,Te);else if(de===2)for(const Me of ve)qn(Me,U,$,J,Te);else if(de===3)for(const Me of ve)Jo(Me,U,$,J,Te);return{id:me,type:de,geometry:Te,tags:Re}}function qn(Ee,U,$,J,me){const de=-Qi,ve=o.al+Qi;let Re;for(let Te=0;Te<Ee.length-2;Te+=2){let Me=Math.round(o.al*(Ee[Te+0]*U-$)),tt=Math.round(o.al*(Ee[Te+1]*U-J)),Ge=Math.round(o.al*(Ee[Te+2]*U-$)),Pt=Math.round(o.al*(Ee[Te+3]*U-J));const qt=Ge-Me,St=Pt-tt;Me<de&&Ge<de||(Me<de?(tt+=Math.round(St*((de-Me)/qt)),Me=de):Ge<de&&(Pt=tt+Math.round(St*((de-Me)/qt)),Ge=de),tt<de&&Pt<de||(tt<de?(Me+=Math.round(qt*((de-tt)/St)),tt=de):Pt<de&&(Ge=Me+Math.round(qt*((de-tt)/St)),Pt=de),Me>=ve&&Ge>=ve||(Me>=ve?(tt+=Math.round(St*((ve-Me)/qt)),Me=ve):Ge>=ve&&(Pt=tt+Math.round(St*((ve-Me)/qt)),Ge=ve),tt>=ve&&Pt>=ve||(tt>=ve?(Me+=Math.round(qt*((ve-tt)/St)),tt=ve):Pt>=ve&&(Ge=Me+Math.round(qt*((ve-tt)/St)),Pt=ve),Re&&Me===Re[Re.length-1][0]&&tt===Re[Re.length-1][1]||(Re=[[Me,tt]],me.push(Re)),Re.push([Ge,Pt])))))}}function Jo(Ee,U,$,J,me){const de=($-ln)/U,ve=(J-ln)/U,Re=($+1+ln)/U,Te=(J+1+ln)/U;function Me(Pt,qt){let St=0;return Pt<de?St|=1:Pt>Re&&(St|=2),qt<ve?St|=4:qt>Te&&(St|=8),St}let tt=[];for(let Pt=1;Pt<=8;Pt*=2){let qt=Ee[Ee.length-2],St=Ee[Ee.length-1],yi=!(Me(qt,St)&Pt);for(let _i=0;_i<Ee.length;_i+=2){const pi=Ee[_i],Vi=Ee[_i+1],Zr=!(Me(pi,Vi)&Pt);Zr!==yi&&(8&Pt?tt.push(qt+(pi-qt)*(Te-St)/(Vi-St),Te):4&Pt?tt.push(qt+(pi-qt)*(ve-St)/(Vi-St),ve):2&Pt?tt.push(Re,St+(Vi-St)*(Re-qt)/(pi-qt)):1&Pt&&tt.push(de,St+(Vi-St)*(de-qt)/(pi-qt))),Zr&&tt.push(pi,Vi),qt=pi,St=Vi,yi=Zr}if(!(Ee=tt).length||Pt===8)break;tt=[]}const Ge=[];for(let Pt=0;Pt<tt.length;Pt+=2)Ge.push([Math.round(o.al*(tt[Pt]*U-$)),Math.round(o.al*(tt[Pt+1]*U-J))]);me.push(Ge)}function Qn({name:Ee,features:U},$){$.writeStringField(1,Ee),$.writeVarintField(5,o.al);const J=new Map,me=new Map,de={keys:J,values:me,feature:null};for(const ve of U)de.feature=ve,$.writeMessage(2,Rt,de);for(const ve of J.keys())$.writeStringField(3,ve);for(const ve of me.keys())$.writeMessage(4,Ie,ve)}function Rt(Ee,U){const $=Ee.feature;$.id!==void 0&&Number.isSafeInteger(+$.id)&&U.writeVarintField(1,+$.id),$.tags&&U.writeMessage(2,ci,Ee),U.writeVarintField(3,$.type),U.writeMessage(4,sr,$)}function ci({keys:Ee,values:U,feature:$},J){for(const me of Object.keys($.tags)){let de=$.tags[me];if(de===null)continue;let ve=Ee.get(me);ve===void 0&&(ve=Ee.size,Ee.set(me,ve)),J.writeVarint(ve);const Re=typeof de;Re!=="string"&&Re!=="boolean"&&Re!=="number"&&(de=JSON.stringify(de));let Te=U.get(de);Te===void 0&&(Te=U.size,U.set(de,Te)),J.writeVarint(Te)}}function zt(Ee,U){return(U<<3)+(7&Ee)}function Yt(Ee){return Ee<<1^Ee>>31}function sr(Ee,U){const{geometry:$,type:J}=Ee;let me=0,de=0;if(J===1){U.writeVarint(zt(1,$.length));for(const ve of $){const Re=ve[0]-me,Te=ve[1]-de;U.writeVarint(Yt(Re)),U.writeVarint(Yt(Te)),me+=Re,de+=Te}}else for(const ve of $){U.writeVarint(zt(1,1));const Re=ve.length-(J===3?1:0);for(let Te=0;Te<Re;Te++){Te===1&&U.writeVarint(zt(2,Re-1));const Me=ve[Te][0]-me,tt=ve[Te][1]-de;U.writeVarint(Yt(Me)),U.writeVarint(Yt(tt)),me+=Me,de+=tt}J===3&&U.writeVarint(zt(7,1))}}function Ie(Ee,U){const $=typeof Ee;$==="string"?U.writeStringField(1,Ee):$==="boolean"?U.writeBooleanField(7,Ee):$==="number"&&(Ee%1!=0?U.writeDoubleField(3,Ee):Ee<0?U.writeSVarintField(6,Ee):U.writeVarintField(5,Ee))}const Ae={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},$e=Math.fround||(It=new Float32Array(1),Ee=>(It[0]=+Ee,It[0]));var It;const Ct=3,bt=5,jt=6;class ri{constructor(U){this.options=Object.assign(Object.create(Ae),U),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(U){const{log:$,minZoom:J,maxZoom:me}=this.options;$&&console.time("total time");const de=`prepare ${U.length} points`;$&&console.time(de),this.points=U;const ve=[];for(let Te=0;Te<U.length;Te++){const Me=U[Te];if(!Me.geometry)continue;const[tt,Ge]=Me.geometry.coordinates,Pt=$e(Ai(tt)),qt=$e(ni(Ge));ve.push(Pt,qt,1/0,Te,-1,1),this.options.reduce&&ve.push(0)}let Re=this.trees[me+1]=this._createTree(ve);$&&console.timeEnd(de);for(let Te=me;Te>=J;Te--){const Me=+Date.now();Re=this.trees[Te]=this._createTree(this._cluster(Re,Te)),$&&console.log("z%d: %d clusters in %dms",Te,Re.numItems,+Date.now()-Me)}return $&&console.timeEnd("total time"),this}getClusters(U,$){let J=((U[0]+180)%360+360)%360-180;const me=Math.max(-90,Math.min(90,U[1]));let de=U[2]===180?180:((U[2]+180)%360+360)%360-180;const ve=Math.max(-90,Math.min(90,U[3]));if(U[2]-U[0]>=360)J=-180,de=180;else if(J>de){const Ge=this.getClusters([J,me,180,ve],$),Pt=this.getClusters([-180,me,de,ve],$);return Ge.concat(Pt)}const Re=this.trees[this._limitZoom($)],Te=Re.range(Ai(J),ni(ve),Ai(de),ni(me)),Me=Re.data,tt=[];for(const Ge of Te){const Pt=this.stride*Ge;tt.push(Me[Pt+bt]>1?Jt(Me,Pt,this.clusterProps):this.points[Me[Pt+Ct]])}return tt}getChildren(U){const $=this._getOriginId(U),J=this._getOriginZoom(U),me="No cluster with the specified id.",de=this.trees[J];if(!de)throw new Error(me);const ve=de.data;if($*this.stride>=ve.length)throw new Error(me);const Re=this.options.radius/(this.options.extent*Math.pow(2,J-1)),Te=de.within(ve[$*this.stride],ve[$*this.stride+1],Re),Me=[];for(const tt of Te){const Ge=tt*this.stride;ve[Ge+4]===U&&Me.push(ve[Ge+bt]>1?Jt(ve,Ge,this.clusterProps):this.points[ve[Ge+Ct]])}if(Me.length===0)throw new Error(me);return Me}getLeaves(U,$,J){const me=[];return this._appendLeaves(me,U,$=$||10,J=J||0,0),me}getTile(U,$,J){const me=this.trees[this._limitZoom(U)],de=Math.pow(2,U),{extent:ve,radius:Re}=this.options,Te=Re/ve,Me=(J-Te)/de,tt=(J+1+Te)/de,Ge={features:[]};return this._addTileFeatures(me.range(($-Te)/de,Me,($+1+Te)/de,tt),me.data,$,J,de,Ge),$===0&&this._addTileFeatures(me.range(1-Te/de,Me,1,tt),me.data,de,J,de,Ge),$===de-1&&this._addTileFeatures(me.range(0,Me,Te/de,tt),me.data,-1,J,de,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(U){let $=this._getOriginZoom(U)-1;for(;$<=this.options.maxZoom;){const J=this.getChildren(U);if($++,J.length!==1)break;U=J[0].properties.cluster_id}return $}_appendLeaves(U,$,J,me,de){const ve=this.getChildren($);for(const Re of ve){const Te=Re.properties;if(Te&&Te.cluster?de+Te.point_count<=me?de+=Te.point_count:de=this._appendLeaves(U,Te.cluster_id,J,me,de):de<me?de++:U.push(Re),U.length===J)break}return de}_createTree(U){const $=new o.c4(U.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<U.length;J+=this.stride)$.add(U[J],U[J+1]);return $.finish(),$.data=U,$}_addTileFeatures(U,$,J,me,de,ve){for(const Re of U){const Te=Re*this.stride,Me=$[Te+bt]>1;let tt,Ge,Pt;if(Me)tt=Gt($,Te,this.clusterProps),Ge=$[Te],Pt=$[Te+1];else{const yi=this.points[$[Te+Ct]];tt=yi.properties;const[_i,pi]=yi.geometry.coordinates;Ge=Ai(_i),Pt=ni(pi)}const qt={type:1,geometry:[[Math.round(this.options.extent*(Ge*de-J)),Math.round(this.options.extent*(Pt*de-me))]],tags:tt};let St;St=Me||this.options.generateId?$[Te+Ct]:this.points[$[Te+Ct]].id,St!==void 0&&(qt.id=St),ve.features.push(qt)}}_limitZoom(U){return Math.max(this.options.minZoom,Math.min(Math.floor(+U),this.options.maxZoom+1))}_cluster(U,$){const{radius:J,extent:me,reduce:de,minPoints:ve}=this.options,Re=J/(me*Math.pow(2,$)),Te=U.data,Me=[],tt=this.stride;for(let Ge=0;Ge<Te.length;Ge+=tt){if(Te[Ge+2]<=$)continue;Te[Ge+2]=$;const Pt=Te[Ge],qt=Te[Ge+1],St=U.within(Te[Ge],Te[Ge+1],Re),yi=Te[Ge+bt];let _i=yi;for(const pi of St){const Vi=pi*tt;Te[Vi+2]>$&&(_i+=Te[Vi+bt])}if(_i>yi&&_i>=ve){let pi,Vi=Pt*yi,Zr=qt*yi,pn=-1;const Jr=(Ge/tt<<5)+($+1)+this.points.length;for(const yn of St){const Hr=yn*tt;if(Te[Hr+2]<=$)continue;Te[Hr+2]=$;const Hi=Te[Hr+bt];Vi+=Te[Hr]*Hi,Zr+=Te[Hr+1]*Hi,Te[Hr+4]=Jr,de&&(pi||(pi=this._map(Te,Ge,!0),pn=this.clusterProps.length,this.clusterProps.push(pi)),de(pi,this._map(Te,Hr)))}Te[Ge+4]=Jr,Me.push(Vi/_i,Zr/_i,1/0,Jr,-1,_i),de&&Me.push(pn)}else{for(let pi=0;pi<tt;pi++)Me.push(Te[Ge+pi]);if(_i>1)for(const pi of St){const Vi=pi*tt;if(!(Te[Vi+2]<=$)){Te[Vi+2]=$;for(let Zr=0;Zr<tt;Zr++)Me.push(Te[Vi+Zr])}}}}return Me}_getOriginId(U){return U-this.points.length>>5}_getOriginZoom(U){return(U-this.points.length)%32}_map(U,$,J){if(U[$+bt]>1){const ve=this.clusterProps[U[$+jt]];return J?Object.assign({},ve):ve}const me=this.points[U[$+Ct]].properties,de=this.options.map(me);return J&&de===me?Object.assign({},de):de}}function Jt(Ee,U,$){return{type:"Feature",id:Ee[U+Ct],properties:Gt(Ee,U,$),geometry:{type:"Point",coordinates:[(J=Ee[U],360*(J-.5)),hi(Ee[U+1])]}};var J}function Gt(Ee,U,$){const J=Ee[U+bt],me=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,de=Ee[U+jt],ve=de===-1?{}:Object.assign({},$[de]);return Object.assign(ve,{cluster:!0,cluster_id:Ee[U+Ct],point_count:J,point_count_abbreviated:me})}function Ai(Ee){return Ee/360+.5}function ni(Ee){const U=Math.sin(Ee*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function hi(Ee){const U=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(U))/Math.PI-90}function Bi(Ee,U,$,J){let me=J;const de=U+($-U>>1);let ve,Re=$-U;const Te=Ee[U],Me=Ee[U+1],tt=Ee[$],Ge=Ee[$+1];for(let Pt=U+3;Pt<$;Pt+=3){const qt=vr(Ee[Pt],Ee[Pt+1],Te,Me,tt,Ge);if(qt>me)ve=Pt,me=qt;else if(qt===me){const St=Math.abs(Pt-de);St<Re&&(ve=Pt,Re=St)}}me>J&&(ve-U>3&&Bi(Ee,U,ve,J),Ee[ve+2]=me,$-ve>3&&Bi(Ee,ve,$,J))}function vr(Ee,U,$,J,me,de){let ve=me-$,Re=de-J;if(ve!==0||Re!==0){const Te=((Ee-$)*ve+(U-J)*Re)/(ve*ve+Re*Re);Te>1?($=me,J=de):Te>0&&($+=ve*Te,J+=Re*Te)}return ve=Ee-$,Re=U-J,ve*ve+Re*Re}function Dr(Ee,U,$,J){const me={id:Ee??null,type:U,geometry:$,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(U==="Point"||U==="MultiPoint"||U==="LineString")Pr(me,$);else if(U==="Polygon")Pr(me,$[0]);else if(U==="MultiLineString")for(const de of $)Pr(me,de);else if(U==="MultiPolygon")for(const de of $)Pr(me,de[0]);return me}function Pr(Ee,U){for(let $=0;$<U.length;$+=3)Ee.minX=Math.min(Ee.minX,U[$]),Ee.minY=Math.min(Ee.minY,U[$+1]),Ee.maxX=Math.max(Ee.maxX,U[$]),Ee.maxY=Math.max(Ee.maxY,U[$+1])}function Yr(Ee,U,$,J){if(!U.geometry)return;const me=U.geometry.coordinates;if(me&&me.length===0)return;const de=U.geometry.type,ve=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2);let Re=[],Te=U.id;if($.promoteId?Te=U.properties[$.promoteId]:$.generateId&&(Te=J||0),de==="Point")Dn(me,Re);else if(de==="MultiPoint")for(const Me of me)Dn(Me,Re);else if(de==="LineString")es(me,Re,ve,!1);else if(de==="MultiLineString"){if($.lineMetrics){for(const Me of me)Re=[],es(Me,Re,ve,!1),Ee.push(Dr(Te,"LineString",Re,U.properties));return}ts(me,Re,ve,!1)}else if(de==="Polygon")ts(me,Re,ve,!0);else{if(de!=="MultiPolygon"){if(de==="GeometryCollection"){for(const Me of U.geometry.geometries)Yr(Ee,{id:Te,geometry:Me,properties:U.properties},$,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Me of me){const tt=[];ts(Me,tt,ve,!0),Re.push(tt)}}Ee.push(Dr(Te,de,Re,U.properties))}function Dn(Ee,U){U.push(Ys(Ee[0]),bn(Ee[1]),0)}function es(Ee,U,$,J){let me,de,ve=0;for(let Te=0;Te<Ee.length;Te++){const Me=Ys(Ee[Te][0]),tt=bn(Ee[Te][1]);U.push(Me,tt,0),Te>0&&(ve+=J?(me*tt-Me*de)/2:Math.sqrt(Math.pow(Me-me,2)+Math.pow(tt-de,2))),me=Me,de=tt}const Re=U.length-3;U[2]=1,Bi(U,0,Re,$),U[Re+2]=1,U.size=Math.abs(ve),U.start=0,U.end=U.size}function ts(Ee,U,$,J){for(let me=0;me<Ee.length;me++){const de=[];es(Ee[me],de,$,J),U.push(de)}}function Ys(Ee){return Ee/360+.5}function bn(Ee){const U=Math.sin(Ee*Math.PI/180),$=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return $<0?0:$>1?1:$}function rn(Ee,U,$,J,me,de,ve,Re){if(J/=U,de>=($/=U)&&ve<J)return Ee;if(ve<$||de>=J)return null;const Te=[];for(const Me of Ee){const tt=Me.geometry;let Ge=Me.type;const Pt=me===0?Me.minX:Me.minY,qt=me===0?Me.maxX:Me.maxY;if(Pt>=$&&qt<J){Te.push(Me);continue}if(qt<$||Pt>=J)continue;let St=[];if(Ge==="Point"||Ge==="MultiPoint")ps(tt,St,$,J,me);else if(Ge==="LineString")mo(tt,St,$,J,me,!1,Re.lineMetrics);else if(Ge==="MultiLineString")Qo(tt,St,$,J,me,!1);else if(Ge==="Polygon")Qo(tt,St,$,J,me,!0);else if(Ge==="MultiPolygon")for(const yi of tt){const _i=[];Qo(yi,_i,$,J,me,!0),_i.length&&St.push(_i)}if(St.length){if(Re.lineMetrics&&Ge==="LineString"){for(const yi of St)Te.push(Dr(Me.id,Ge,yi,Me.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(St.length===1?(Ge="LineString",St=St[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=St.length===3?"Point":"MultiPoint"),Te.push(Dr(Me.id,Ge,St,Me.tags))}}return Te.length?Te:null}function ps(Ee,U,$,J,me){for(let de=0;de<Ee.length;de+=3){const ve=Ee[de+me];ve>=$&&ve<=J&&_o(U,Ee[de],Ee[de+1],Ee[de+2])}}function mo(Ee,U,$,J,me,de,ve){let Re=Do(Ee);const Te=me===0?Dc:sl;let Me,tt,Ge=Ee.start;for(let _i=0;_i<Ee.length-3;_i+=3){const pi=Ee[_i],Vi=Ee[_i+1],Zr=Ee[_i+2],pn=Ee[_i+3],Jr=Ee[_i+4],yn=me===0?pi:Vi,Hr=me===0?pn:Jr;let Hi=!1;ve&&(Me=Math.sqrt(Math.pow(pi-pn,2)+Math.pow(Vi-Jr,2))),yn<$?Hr>$&&(tt=Te(Re,pi,Vi,pn,Jr,$),ve&&(Re.start=Ge+Me*tt)):yn>J?Hr<J&&(tt=Te(Re,pi,Vi,pn,Jr,J),ve&&(Re.start=Ge+Me*tt)):_o(Re,pi,Vi,Zr),Hr<$&&yn>=$&&(tt=Te(Re,pi,Vi,pn,Jr,$),Hi=!0),Hr>J&&yn<=J&&(tt=Te(Re,pi,Vi,pn,Jr,J),Hi=!0),!de&&Hi&&(ve&&(Re.end=Ge+Me*tt),U.push(Re),Re=Do(Ee)),ve&&(Ge+=Me)}let Pt=Ee.length-3;const qt=Ee[Pt],St=Ee[Pt+1],yi=me===0?qt:St;yi>=$&&yi<=J&&_o(Re,qt,St,Ee[Pt+2]),Pt=Re.length-3,de&&Pt>=3&&(Re[Pt]!==Re[0]||Re[Pt+1]!==Re[1])&&_o(Re,Re[0],Re[1],Re[2]),Re.length&&U.push(Re)}function Do(Ee){const U=[];return U.size=Ee.size,U.start=Ee.start,U.end=Ee.end,U}function Qo(Ee,U,$,J,me,de){for(const ve of Ee)mo(ve,U,$,J,me,de,!1)}function _o(Ee,U,$,J){Ee.push(U,$,J)}function Dc(Ee,U,$,J,me,de){const ve=(de-U)/(J-U);return _o(Ee,de,$+(me-$)*ve,1),ve}function sl(Ee,U,$,J,me,de){const ve=(de-$)/(me-$);return _o(Ee,U+(J-U)*ve,de,1),ve}function Gr(Ee,U){const $=[];for(let J=0;J<Ee.length;J++){const me=Ee[J],de=me.type;let ve;if(de==="Point"||de==="MultiPoint"||de==="LineString")ve=$n(me.geometry,U);else if(de==="MultiLineString"||de==="Polygon"){ve=[];for(const Re of me.geometry)ve.push($n(Re,U))}else if(de==="MultiPolygon"){ve=[];for(const Re of me.geometry){const Te=[];for(const Me of Re)Te.push($n(Me,U));ve.push(Te)}}$.push(Dr(me.id,de,ve,me.tags))}return $}function $n(Ee,U){const $=[];$.size=Ee.size,Ee.start!==void 0&&($.start=Ee.start,$.end=Ee.end);for(let J=0;J<Ee.length;J+=3)$.push(Ee[J]+U,Ee[J+1],Ee[J+2]);return $}function ku(Ee,U){if(Ee.transformed)return Ee;const $=1<<Ee.z,J=Ee.x,me=Ee.y;for(const de of Ee.features){const ve=de.geometry,Re=de.type;if(de.geometry=[],Re===1)for(let Te=0;Te<ve.length;Te+=2)de.geometry.push(ol(ve[Te],ve[Te+1],U,$,J,me));else for(let Te=0;Te<ve.length;Te++){const Me=[];for(let tt=0;tt<ve[Te].length;tt+=2)Me.push(ol(ve[Te][tt],ve[Te][tt+1],U,$,J,me));de.geometry.push(Me)}}return Ee.transformed=!0,Ee}function ol(Ee,U,$,J,me,de){return[Math.round($*(Ee*J-me)),Math.round($*(U*J-de))]}function go(Ee,U,$,J,me){const de=U===me.maxZoom?0:me.tolerance/((1<<U)*me.extent),ve={features:[],numPoints:0,numSimplified:0,numFeatures:Ee.length,source:null,x:$,y:J,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Re of Ee)Fu(ve,Re,de,me);return ve}function Fu(Ee,U,$,J){const me=U.geometry,de=U.type,ve=[];if(Ee.minX=Math.min(Ee.minX,U.minX),Ee.minY=Math.min(Ee.minY,U.minY),Ee.maxX=Math.max(Ee.maxX,U.maxX),Ee.maxY=Math.max(Ee.maxY,U.maxY),de==="Point"||de==="MultiPoint")for(let Re=0;Re<me.length;Re+=3)ve.push(me[Re],me[Re+1]),Ee.numPoints++,Ee.numSimplified++;else if(de==="LineString")Ye(ve,me,Ee,$,!1,!1);else if(de==="MultiLineString"||de==="Polygon")for(let Re=0;Re<me.length;Re++)Ye(ve,me[Re],Ee,$,de==="Polygon",Re===0);else if(de==="MultiPolygon")for(let Re=0;Re<me.length;Re++){const Te=me[Re];for(let Me=0;Me<Te.length;Me++)Ye(ve,Te[Me],Ee,$,!0,Me===0)}if(ve.length){let Re=U.tags||null;if(de==="LineString"&&J.lineMetrics){Re={};for(const Me in U.tags)Re[Me]=U.tags[Me];Re.mapbox_clip_start=me.start/me.size,Re.mapbox_clip_end=me.end/me.size}const Te={geometry:ve,type:de==="Polygon"||de==="MultiPolygon"?3:de==="LineString"||de==="MultiLineString"?2:1,tags:Re};U.id!==null&&(Te.id=U.id),Ee.features.push(Te)}}function Ye(Ee,U,$,J,me,de){const ve=J*J;if(J>0&&U.size<(me?ve:J))return void($.numPoints+=U.length/3);const Re=[];for(let Te=0;Te<U.length;Te+=3)(J===0||U[Te+2]>ve)&&($.numSimplified++,Re.push(U[Te],U[Te+1])),$.numPoints++;me&&function(Te,Me){let tt=0;for(let Ge=0,Pt=Te.length,qt=Pt-2;Ge<Pt;qt=Ge,Ge+=2)tt+=(Te[Ge]-Te[qt])*(Te[Ge+1]+Te[qt+1]);if(tt>0===Me)for(let Ge=0,Pt=Te.length;Ge<Pt/2;Ge+=2){const qt=Te[Ge],St=Te[Ge+1];Te[Ge]=Te[Pt-2-Ge],Te[Ge+1]=Te[Pt-1-Ge],Te[Pt-2-Ge]=qt,Te[Pt-1-Ge]=St}}(Re,de),Ee.push(Re)}const ea={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Nd{constructor(U,$){const J=($=this.options=function(de,ve){for(const Re in ve)de[Re]=ve[Re];return de}(Object.create(ea),$)).debug;if(J&&console.time("preprocess data"),$.maxZoom<0||$.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if($.promoteId&&$.generateId)throw new Error("promoteId and generateId cannot be used together.");let me=function(de,ve){const Re=[];if(de.type==="FeatureCollection")for(let Te=0;Te<de.features.length;Te++)Yr(Re,de.features[Te],ve,Te);else Yr(Re,de.type==="Feature"?de:{geometry:de},ve);return Re}(U,$);this.tiles={},this.tileCoords=[],J&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",$.indexMaxZoom,$.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),me=function(de,ve){const Re=ve.buffer/ve.extent;let Te=de;const Me=rn(de,1,-1-Re,Re,0,-1,2,ve),tt=rn(de,1,1-Re,2+Re,0,-1,2,ve);return(Me||tt)&&(Te=rn(de,1,-Re,1+Re,0,-1,2,ve)||[],Me&&(Te=Gr(Me,1).concat(Te)),tt&&(Te=Te.concat(Gr(tt,-1)))),Te}(me,$),me.length&&this.splitTile(me,0,0,0),J&&(me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(U,$,J,me,de,ve,Re){const Te=[U,$,J,me],Me=this.options,tt=Me.debug;for(;Te.length;){me=Te.pop(),J=Te.pop(),$=Te.pop(),U=Te.pop();const Ge=1<<$,Pt=al($,J,me);let qt=this.tiles[Pt];if(!qt&&(tt>1&&console.time("creation"),qt=this.tiles[Pt]=go(U,$,J,me,Me),this.tileCoords.push({z:$,x:J,y:me}),tt)){tt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",$,J,me,qt.numFeatures,qt.numPoints,qt.numSimplified),console.timeEnd("creation"));const Hi=`z${$}`;this.stats[Hi]=(this.stats[Hi]||0)+1,this.total++}if(qt.source=U,de==null){if($===Me.indexMaxZoom||qt.numPoints<=Me.indexMaxPoints)continue}else{if($===Me.maxZoom||$===de)continue;if(de!=null){const Hi=de-$;if(J!==ve>>Hi||me!==Re>>Hi)continue}}if(qt.source=null,U.length===0)continue;tt>1&&console.time("clipping");const St=.5*Me.buffer/Me.extent,yi=.5-St,_i=.5+St,pi=1+St;let Vi=null,Zr=null,pn=null,Jr=null,yn=rn(U,Ge,J-St,J+_i,0,qt.minX,qt.maxX,Me),Hr=rn(U,Ge,J+yi,J+pi,0,qt.minX,qt.maxX,Me);U=null,yn&&(Vi=rn(yn,Ge,me-St,me+_i,1,qt.minY,qt.maxY,Me),Zr=rn(yn,Ge,me+yi,me+pi,1,qt.minY,qt.maxY,Me),yn=null),Hr&&(pn=rn(Hr,Ge,me-St,me+_i,1,qt.minY,qt.maxY,Me),Jr=rn(Hr,Ge,me+yi,me+pi,1,qt.minY,qt.maxY,Me),Hr=null),tt>1&&console.timeEnd("clipping"),Te.push(Vi||[],$+1,2*J,2*me),Te.push(Zr||[],$+1,2*J,2*me+1),Te.push(pn||[],$+1,2*J+1,2*me),Te.push(Jr||[],$+1,2*J+1,2*me+1)}}getTile(U,$,J){U=+U,$=+$,J=+J;const me=this.options,{extent:de,debug:ve}=me;if(U<0||U>24)return null;const Re=1<<U,Te=al(U,$=$+Re&Re-1,J);if(this.tiles[Te])return ku(this.tiles[Te],de);ve>1&&console.log("drilling down to z%d-%d-%d",U,$,J);let Me,tt=U,Ge=$,Pt=J;for(;!Me&&tt>0;)tt--,Ge>>=1,Pt>>=1,Me=this.tiles[al(tt,Ge,Pt)];return Me&&Me.source?(ve>1&&(console.log("found parent tile z%d-%d-%d",tt,Ge,Pt),console.time("drilling down")),this.splitTile(Me.source,tt,Ge,Pt,U,$,J),ve>1&&console.timeEnd("drilling down"),this.tiles[Te]?ku(this.tiles[Te],de):null):null}}function al(Ee,U,$){return 32*((1<<Ee)*$+U)+Ee}function Wi(Ee,U){const $=Ee.tileID.canonical;if(!this._geoJSONIndex)return void U(null,null);const J=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!J)return void U(null,null);const me=Me=>Me.tags&&"3d_elevation_id"in Me.tags&&"source"in Me.tags&&Me.tags.source==="elevation",de=J.features.filter(Me=>me(Me));let ve={_geojsonTileLayer:J.features};de.length>0&&(ve={_geojsonTileLayer:J.features.filter(Me=>!me(Me)),hd_road_elevation:de});const Re=new Ro(ve),Te=function(Me){const tt=new o.bt;for(const Ge of Object.keys(Me))tt.writeMessage(3,Qn,{name:Ge,features:Me[Ge]});return tt.finish()}(ve).buffer;U(null,{vectorTile:Re,rawData:Te})}class us extends mr{constructor(U,$,J,me,de,ve,Re){super(U,$,J,me,de,Wi,Re),ve&&(this.loadGeoJSON=ve),this._dynamicIndex=new Ei}loadData(U,$){const J=U&&U.request,me=J&&J.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(U,(de,ve)=>{if(de||!ve)return $(de);if(typeof ve!="object")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));{try{if(U.filter){const Te=o.U(U.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Te.result==="error")throw new Error(Te.value.map(Me=>`${Me.key}: ${Me.message}`).join(", "));ve.features=ve.features.filter(Me=>Te.value.evaluate({zoom:0},Me))}U.dynamic?(ve.type==="Feature"&&(ve={type:"FeatureCollection",features:[ve]}),U.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(ve.features,this.loaded),U.cluster&&(ve.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=U.cluster?new ri(function({superclusterOptions:Te,clusterProperties:Me}){if(!Me||!Te)return Te;const tt={},Ge={},Pt={accumulated:null,zoom:0},qt={properties:null},St=Object.keys(Me);for(const yi of St){const[_i,pi]=Me[yi],Vi=o.U(pi),Zr=o.U(typeof _i=="string"?[_i,["accumulated"],["get",yi]]:_i);tt[yi]=Vi.value,Ge[yi]=Zr.value}return Te.map=yi=>{qt.properties=yi;const _i={};for(const pi of St)_i[pi]=tt[pi].evaluate(Pt,qt);return _i},Te.reduce=(yi,_i)=>{qt.properties=_i;for(const pi of St)Pt.accumulated=yi[pi],yi[pi]=Ge[pi].evaluate(Pt,qt)},Te}(U)).load(ve.features):U.dynamic?this._dynamicIndex:function(Te,Me){return new Nd(Te,Me)}(ve,U.geojsonVtOptions)}catch(Te){return $(Te)}const Re={};if(me){const Te=Q(J);Te&&(Re.resourceTiming={},Re.resourceTiming[U.source]=JSON.parse(JSON.stringify(Te)))}$(null,Re)}})}reloadTile(U,$){const J=this.loaded;return J&&J[U.uid]?U.partial?$(null,void 0):super.reloadTile(U,$):this.loadTile(U,$)}loadGeoJSON(U,$){if(U.request)o.m(U.request,$);else{if(typeof U.data!="string")return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return $(null,JSON.parse(U.data))}catch{return $(new Error(`Input data given to '${U.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(U,$){try{$(null,this._geoJSONIndex.getClusterExpansionZoom(U.clusterId))}catch(J){$(J)}}getClusterChildren(U,$){try{$(null,this._geoJSONIndex.getChildren(U.clusterId))}catch(J){$(J)}}getClusterLeaves(U,$){try{$(null,this._geoJSONIndex.getLeaves(U.clusterId,U.limit,U.offset))}catch(J){$(J)}}}class Vd{constructor(U,$,J){this.tileID=new o.aQ(U.tileID.overscaledZ,U.tileID.wrap,U.tileID.canonical.z,U.tileID.canonical.x,U.tileID.canonical.y),this.tileZoom=U.tileZoom,this.uid=U.uid,this.zoom=U.zoom,this.canonical=U.tileID.canonical,this.pixelRatio=U.pixelRatio,this.tileSize=U.tileSize,this.source=U.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=U.projection,this.brightness=$,this.worldview=J}parse(U,$,J,me){this.status="parsing";const de=new o.aQ(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),ve=[],Re=$.familiesBySource[J.source],Te=new o.fn(de,J.promoteId);Te.bucketLayerIDs=[],Te.is3DTile=!0,o.fC(U).then(Me=>{if(!Me)return me(new Error("Could not parse tile"));const tt=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("MAPBOX_mesh_features")||Me.json.asset.extras&&Me.json.asset.extras.MAPBOX_mesh_features,Ge=Me.json.extensionsUsed&&Me.json.extensionsUsed.includes("EXT_meshopt_compression"),Pt=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const qt in Re)for(const St of Re[qt]){const yi=St[0];Te.bucketLayerIDs.push(St.map(Vi=>o.B(Vi.id,Vi.scope))),yi.recalculate(Pt,[]);const _i=o.fD(Me,1/o.d7(J.tileID.canonical)),pi=new o.fE(St,_i,de,tt,Ge,this.brightness,Te,this.worldview);tt||(pi.needsUpload=!0),ve.push(pi),pi.evaluate(yi)}this.status="done",me(null,{buckets:ve,featureIndex:Te,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(Me=>me(new Error(Me.message)))}}class ll{constructor(U,$,J,me,de,ve,Re,Te){this.actor=U,this.layerIndex=$,this.availableImages=J,this.availableModels=me,this.brightness=Re,this.loading={},this.loaded={},this.worldview=Te}loadTile(U,$){const J=U.uid,me=this.loading[J]=new Vd(U,this.brightness,this.worldview);o.bu(U.request,(de,ve)=>{const Re=!this.loading[J];return delete this.loading[J],Re||de?(me.status="done",Re||(this.loaded[J]=me),$(de)):ve&&ve.byteLength!==0?void me.parse(ve,this.layerIndex,U,(Te,Me)=>{me.status="done",this.loaded=this.loaded||{},this.loaded[J]=me,Te||!Me?$(Te):$(null,Me)}):(me.status="done",this.loaded[J]=me,$())})}reloadTile(U,$){const J=this.loaded,me=U.uid;if(J&&J[me]){const de=J[me];de.projection=U.projection,de.brightness=U.brightness;const ve=(Re,Te)=>{de.reloadCallback&&(delete de.reloadCallback,this.loadTile(U,$)),$(Re,Te)};de.status==="parsing"?de.reloadCallback=ve:de.status==="done"&&this.loadTile(U,$)}}abortTile(U,$){const J=U.uid;this.loading[J]&&delete this.loading[J],$()}removeTile(U,$){const J=this.loaded,me=U.uid;J&&J[me]&&delete J[me],$()}}class Lc{constructor(U){this.self=U,this.actor=new o.fG(U,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cm({name:"mercator"}),this.workerSourceTypes={vector:mr,geojson:us,"raster-dem":vn,"raster-array":fs,"batched-model":ll},this.workerSources={},this.self.registerWorkerSource=($,J)=>{if(this.workerSourceTypes[$])throw new Error(`Worker source with name "${$}" already registered.`);this.workerSourceTypes[$]=J},this.self.registerRTLTextPlugin=$=>{if(o.fH.isParsed())throw new Error("RTL text plugin already registered.");o.fH.setState({pluginStatus:o.fI.parsed,pluginURL:o.fH.getPluginURL()}),o.fH.applyArabicShaping=$.applyArabicShaping,o.fH.processBidirectionalText=$.processBidirectionalText,o.fH.processStyledBidirectionalText=$.processStyledBidirectionalText;for(const J of this.rtlPluginParsingListeners)J(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(U,$,J){delete this.layerIndexes[U],delete this.availableImages[U],delete this.availableModels[U],delete this.workerSources[U],J()}checkIfReady(U,$,J){J()}setReferrer(U,$){this.referrer=$}spriteLoaded(U,$){this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={});const{scope:J,isLoaded:me}=$;if(this.isSpriteLoaded[U][J]=me,this.workerSources[U]&&this.workerSources[U][J])for(const de in this.workerSources[U][J]){const ve=this.workerSources[U][J][de];for(const Re in ve){const Te=ve[Re];Te instanceof mr&&(Te.isSpriteLoaded=me,Te.fire(new o.z("isSpriteLoaded")))}}}setImages(U,$,J){this.availableImages[U]||(this.availableImages[U]={});const{scope:me,images:de}=$;if(this.availableImages[U][me]=de,this.workerSources[U]&&this.workerSources[U][me]){for(const ve in this.workerSources[U][me]){const Re=this.workerSources[U][me][ve];for(const Te in Re)Re[Te].availableImages=de}J()}else J()}setModels(U,{scope:$,models:J},me){if(this.availableModels[U]||(this.availableModels[U]={}),this.availableModels[U][$]=J,this.workerSources[U]&&this.workerSources[U][$]){for(const de in this.workerSources[U][$]){const ve=this.workerSources[U][$][de];for(const Re in ve)ve[Re].availableModels=J}me()}else me()}setProjection(U,$){this.projections[U]=o.cm($)}setBrightness(U,$,J){this.brightness=$,J()}setWorldview(U,$,J){this.worldview=$,J()}setLayers(U,$,J){this.getLayerIndex(U,$.scope).replace($.layers,$.options),J()}updateLayers(U,$,J){this.getLayerIndex(U,$.scope).update($.layers,$.removedIds,$.options),J()}loadTile(U,$,J){$.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,$.type,$.source,$.scope).loadTile($,J)}decodeRasterArray(U,$,J){this.getWorkerSource(U,$.type,$.source,$.scope).decodeRasterArray($,J)}reloadTile(U,$,J){$.projection=this.projections[U]||this.defaultProjection,this.getWorkerSource(U,$.type,$.source,$.scope).reloadTile($,J)}abortTile(U,$,J){this.getWorkerSource(U,$.type,$.source,$.scope).abortTile($,J)}removeTile(U,$,J){this.getWorkerSource(U,$.type,$.source,$.scope).removeTile($,J)}removeSource(U,$,J){if(!(this.workerSources[U]&&this.workerSources[U][$.scope]&&this.workerSources[U][$.scope][$.type]&&this.workerSources[U][$.scope][$.type][$.source]))return;const me=this.workerSources[U][$.scope][$.type][$.source];delete this.workerSources[U][$.scope][$.type][$.source],me.removeSource!==void 0?me.removeSource($,J):J()}loadWorkerSource(U,$,J){try{this.self.importScripts($.url),J()}catch(me){J(me)}}syncRTLPluginState(U,$,J){if(o.fH.isParsed())J(null,!0);else if(o.fH.isParsing())this.rtlPluginParsingListeners.push(J);else try{o.fH.setState($);const me=o.fH.getPluginURL();!o.fH.isLoaded()||o.fH.isParsed()||o.fH.isParsing()||me==null||(o.fH.setState({pluginStatus:o.fI.parsing,pluginURL:o.fH.getPluginURL()}),this.self.importScripts(me),o.fH.isParsed()?J(null,!0):this.rtlPluginParsingListeners.push(J))}catch(me){J(me)}}setDracoUrl(U,$){this.dracoUrl=$}getAvailableImages(U,$){this.availableImages[U]||(this.availableImages[U]={});let J=this.availableImages[U][$];return J||(J=[]),J}getAvailableModels(U,$){this.availableModels[U]||(this.availableModels[U]={});let J=this.availableModels[U][$];return J||(J={}),J}getLayerIndex(U,$){this.layerIndexes[U]||(this.layerIndexes[U]={});let J=this.layerIndexes[U][$];return J||(J=this.layerIndexes[U][$]=new ye,J.scope=$),J}getWorkerSource(U,$,J,me){const de=this.workerSources;return de[U]||(de[U]={}),de[U][me]||(de[U][me]={}),de[U][me][$]||(de[U][me][$]={}),this.isSpriteLoaded[U]||(this.isSpriteLoaded[U]={}),de[U][me][$][J]||(de[U][me][$][J]=new this.workerSourceTypes[$]({send:(ve,Re,Te,Me,tt,Ge)=>this.actor.send(ve,Re,Te,U,tt,Ge),scheduler:this.actor.scheduler},this.getLayerIndex(U,me),this.getAvailableImages(U,me),this.getAvailableModels(U,me),this.isSpriteLoaded[U][me],void 0,this.brightness,this.worldview)),de[U][me][$][J]}rasterizeImagesWorker(U,$,J){const me=new Map;for(const[de,{image:ve,imageVariant:Re}]of $.tasks.entries()){const Te=this.imageRasterizer.rasterize(Re,ve,$.scope,U);me.set(de,Te)}J(void 0,me)}removeRasterizedImages(U,$,J){this.imageRasterizer.removeImagesFromCacheByIds($.imageIds,$.scope,U),J()}enforceCacheSizeLimit(U,$){o.fJ($)}getWorkerPerformanceMetrics(U,$,J){J(void 0,void 0)}}return o.fF(self)&&(self.worker=new Lc(self)),Lc}),k(["./shared"],function(o){var Q="3.17.0";const pe={create:"create",load:"load",fullLoad:"fullLoad"},he={mark(l){performance.mark(l)},measure(l,t,n){performance.measure(l,t,n)}};function ye(l){const t=l.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var Oe,je={},ft=function(){if(Oe)return je;function l(c){return!t(c)}function t(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var m,_,x=new Blob([""],{type:"text/javascript"}),b=URL.createObjectURL(x);try{_=new Worker(b),m=!0}catch{m=!1}return _&&_.terminate(),URL.revokeObjectURL(b),m}()?function(){var m=document.createElement("canvas");m.width=m.height=1;var _=m.getContext("2d");if(!_)return!1;var x=_.getImageData(0,0,1,1);return x&&x.width===m.width}()?(n[d=c&&c.failIfMajorPerformanceCaveat]===void 0&&(n[d]=function(m){var _,x=function(b){var E=document.createElement("canvas"),I=Object.create(l.webGLContextAttributes);return I.failIfMajorPerformanceCaveat=b,E.getContext("webgl2",I)}(m);if(!x)return!1;try{_=x.createShader(x.VERTEX_SHADER)}catch{return!1}return!(!_||x.isContextLost())&&(x.shaderSource(_,"void main() {}"),x.compileShader(_),x.getShaderParameter(_,x.COMPILE_STATUS)===!0)}(d)),n[d]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var d}Oe=1,je.supported=l,je.notSupportedReason=t;var n={};return l.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},je}();function rt(l,t,n){const c=document.createElement(l);return t!=null&&(c.className=t),n&&n.appendChild(c),c}function mt(l,t,n){const c=document.createElementNS("http://www.w3.org/2000/svg",l);for(const d of Object.keys(t))c.setAttributeNS(null,d,String(t[d]));return n&&n.appendChild(c),c}const Wt=typeof document<"u"?document.documentElement&&document.documentElement.style:null,wt=Wt&&Wt.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Xt;function Zt(){Wt&&wt&&(Xt=Wt[wt],Wt[wt]="none")}function Li(){Wt&&wt&&(Wt[wt]=Xt)}function Sr(l){l.preventDefault(),l.stopPropagation(),window.removeEventListener("click",Sr,!0)}function mr(){window.addEventListener("click",Sr,!0),window.setTimeout(()=>{window.removeEventListener("click",Sr,!0)},0)}function vn(l,t){const n=l.getBoundingClientRect();return Rs(l,n,t)}function Zn(l,t){const n=l.getBoundingClientRect(),c=[];for(let d=0;d<t.length;d++)c.push(Rs(l,n,t[d]));return c}function fs(l){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&l.button===2&&l.ctrlKey?0:l.button}function Rs(l,t,n){const c=l.offsetWidth===t.width?1:l.offsetWidth/t.width;return new o.P((n.clientX-t.left)*c,(n.clientY-t.top)*c)}const Ns="01",Fi="NO_ACCESS_TOKEN";class Ro{constructor(t,n,c){this._transformRequestFn=t,this._customAccessToken=n,this._silenceAuthErrors=!!c,this._createSkuToken()}_createSkuToken(){const t=function(){let n="";for(let c=0;c<10;c++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ns,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,n){return this._transformRequestFn&&this._transformRequestFn(t,n)||{url:t}}normalizeStyleURL(t,n){if(!o.h(t))return t;const c=Qi(t);return c.params.push(`sdk=js-${Q}`),c.path=`/styles/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeGlyphsURL(t,n){if(!o.h(t))return t;const c=Qi(t);return c.path=`/fonts/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeModelURL(t,n){if(!o.h(t))return t;const c=Qi(t);return c.path=`/models/v1${c.path}`,this._makeAPIURL(c,this._customAccessToken||n)}normalizeSourceURL(t,n,c,d){if(!o.h(t))return t;const m=Qi(t);return m.path=`/v4/${m.authority}.json`,m.params.push("secure"),c&&m.params.push(`language=${c}`),d&&m.params.push(`worldview=${d}`),this._makeAPIURL(m,this._customAccessToken||n)}normalizeIconsetURL(t,n){const c=Qi(t);return o.h(t)?(c.path=`/styles/v1${c.path}/iconset.pbf`,this._makeAPIURL(c,this._customAccessToken||n)):Ei(c)}normalizeSpriteURL(t,n,c,d){const m=Qi(t);return o.h(t)?(m.path=`/styles/v1${m.path}/sprite${n}${c}`,this._makeAPIURL(m,this._customAccessToken||d)):(m.path+=`${n}${c}`,Ei(m))}normalizeTileURL(t,n,c){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.h(t))return t;const d=Qi(t);d.path=d.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||c&&d.authority!=="raster"&&c===512?"@2x":""}${o.k.supported?".webp":"$1"}`),d.authority==="raster"?d.path=`/${o.e.RASTER_URL_PREFIX}${d.path}`:d.authority==="rasterarrays"?d.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${d.path}`:d.authority==="3dtiles"?d.path=`/${o.e.TILES3D_URL_PREFIX}${d.path}`:(d.path=d.path.replace(/^.+\/v4\//,"/"),d.path=`/${o.e.TILE_URL_VERSION}${d.path}`);const m=this._customAccessToken||function(_){for(const x of _){const b=x.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(d.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&d.params.push(`sku=${this._skuToken}`),this._makeAPIURL(d,m)}canonicalizeTileURL(t,n){const c=Qi(t);if(!c.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!c.path.match(/\.[\w]+$/))return t;let d="mapbox://";c.path.match(/^\/raster\/v1\//)?d+=`raster/${c.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:c.path.match(/^\/rasterarrays\/v1\//)?d+=`rasterarrays/${c.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:d+=`tiles/${c.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let m=c.params;return n&&(m=m.filter(_=>!_.match(/^access_token=/))),m.length&&(d+=`?${m.join("&")}`),d}canonicalizeTileset(t,n){const c=!!n&&o.h(n),d=[];for(const m of t.tiles||[])o.j(m)?d.push(this.canonicalizeTileURL(m,c)):d.push(m);return d}_makeAPIURL(t,n){const c="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",d=Qi(o.e.API_URL);if(t.protocol=d.protocol,t.authority=d.authority,t.protocol==="http"){const m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(d.path!=="/"&&(t.path=`${d.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Ei(t);if(n=n||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${c}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${c}`)}return t.params=t.params.filter(m=>m.indexOf("access_token")===-1),t.params.push(`access_token=${n||""}`),Ei(t)}}const ln=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Qi(l){const t=l.match(ln);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function Ei(l){const t=l.params.length?`?${l.params.join("&")}`:"";return`${l.protocol}://${l.authority}${l.path}${t}`}const Oi="mapbox.eventData";function Gn(l){if(!l)return null;const t=l.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.l(t[1]))}catch{return null}}class Hn{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const n=Gn(o.e.ACCESS_TOKEN);let c="";return c=n&&n.u?o.f(n.u):o.e.ACCESS_TOKEN||"",t?`${Oi}.${t}:${c}`:`${Oi}:${c}`}fetchEventData(){const t=o.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid"),d=this.getStorageKey("uuidTimestamp");if(t)try{const m=localStorage.getItem(n);m&&(this.eventData=JSON.parse(m));const _=localStorage.getItem(c);_&&(this.anonId=_);const x=localStorage.getItem(d);x&&(this.anonIdTimestamp=Number(x));const b=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<b)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=o.s("localStorage"),n=this.getStorageKey(),c=this.getStorageKey("uuid"),d=this.getStorageKey("uuidTimestamp"),m=this.anonId,_=this.anonIdTimestamp;if(t&&m)try{localStorage.setItem(c,m),Object.keys(this.eventData).length>=1&&localStorage.setItem(n,JSON.stringify(this.eventData)),_&&localStorage.setItem(d,_.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,c,d){if(!o.e.EVENTS_URL)return;const m=Qi(o.e.EVENTS_URL);m.params.push(`access_token=${d||o.e.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(t).toISOString()},x=n?Object.assign(_,n):_,b={url:Ei(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=o.p(b,E=>{this.pendingRequest=null,c(E),this.saveEventData(),this.processRequests(d)})}queueRequest(t,n){this.queue.push(t),this.processRequests(n)}}class Nn extends Hn{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!o.e.EVENTS_URL||!t&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const n=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:n},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:n,payload:c}=this.queue.shift();this.postEvent(n,c,()=>{},t)}}const fn=new class extends Hn{constructor(l){super("appUserTurnstile"),this._customAccessToken=l}postTurnstileEvent(l,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(l)&&l.some(n=>o.h(n)||o.j(n))&&this.queueRequest(Date.now(),t)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Gn(o.e.ACCESS_TOKEN),n=t?t.u:o.e.ACCESS_TOKEN;let c=n!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),c=!0);const d=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(d),x=(d-this.eventData.lastSuccess)/864e5;c=c||x>=1||x<-1||m.getDate()!==_.getDate()}else c=!0;c?this.postEvent(d,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Q,skuId:Ns,"enabled.telemetry":!1,userId:this.anonId},m=>{m||(this.eventData.lastSuccess=d,this.eventData.tokenU=n)},l):this.processRequests()}},Cr=fn.postTurnstileEvent.bind(fn),qn=new class extends Hn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(l,t,n,c){this.skuToken=t,this.errorCb=c,o.e.EVENTS_URL&&(n||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(Fi)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Q,skuId:Ns,skuToken:this.skuToken,userId:this.anonId},c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l))}remove(){this.errorCb=null}},Jo=qn.postMapLoadEvent.bind(qn),Qn=new class extends Hn{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(l){let t=this.mapInstanceIdMap.get(l);return t||(t=o.u(),this.mapInstanceIdMap.set(l,t)),t}getEventId(l){const t=this.eventIdPerMapInstanceMap.get(l)||0;return this.eventIdPerMapInstanceMap.set(l,t+1),t}postStyleLoadEvent(l,t){const{map:n,style:c,importedStyles:d}=t;if(!o.e.EVENTS_URL||!l&&!o.e.ACCESS_TOKEN)return;const m=this.getMapInstanceId(n),_={mapInstanceId:m,eventId:this.getEventId(m),style:c};d.length&&(_.importedStyles=d),this.queueRequest({timestamp:Date.now(),payload:_},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:n}=this.queue.shift();this.postEvent(t,n,()=>{},l)}},Rt=Qn.postStyleLoadEvent.bind(Qn),ci=new Nn({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),zt=ci.postMetricsEvent.bind(ci),Yt=new Nn({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),sr=Yt.postMetricsEvent.bind(Yt),Ie=new class extends Hn{constructor(){super("gljs.performance")}postPerformanceEvent(l,t){o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},l)}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:n}=this.queue.shift(),c=function(d){const m=performance.getEntriesByType("resource"),_=performance.getEntriesByType("mark"),x=function(z){const B={};if(z){for(const F in z)if(F!=="other")for(const H of z[F]){const G=`${F}ResolveRangeMin`,Z=`${F}ResolveRangeMax`,Y=`${F}RequestCount`,X=`${F}RequestCachedCount`;B[G]=Math.min(B[G]||1/0,H.startTime),B[Z]=Math.max(B[Z]||-1/0,H.responseEnd);const ce=ne=>{B[ne]===void 0&&(B[ne]=0),++B[ne]};H.transferSize!==void 0&&H.transferSize===0&&ce(X),ce(Y)}}return B}(function(z,B){const F={};if(z)for(const H of z){const G=B(H);F[G]===void 0&&(F[G]=[]),F[G].push(H)}return F}(m,ye)),b=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,I=E?E.effectiveType:void 0,L={counters:[],metadata:[],attributes:[]},D=(z,B,F)=>{F!=null&&z.push({name:B,value:F.toString()})};for(const z in x)D(L.counters,z,x[z]);if(d.interactionRange[0]!==1/0&&d.interactionRange[1]!==-1/0&&(D(L.counters,"interactionRangeMin",d.interactionRange[0]),D(L.counters,"interactionRangeMax",d.interactionRange[1])),_)for(const z of Object.values(pe)){const B=_.find(F=>F.name===z);B&&D(L.counters,z,B.startTime)}return D(L.counters,"visibilityHidden",d.visibilityHidden),D(L.attributes,"style",function(z){if(z)for(const B of z){const F=B.name.split("?")[0];if(o.i(F)){const H=F.split("/").slice(-2);if(H.length===2)return`mapbox://styles/${H[0]}/${H[1]}`}}}(m)),D(L.attributes,"terrainEnabled",d.terrainEnabled?"true":"false"),D(L.attributes,"fogEnabled",d.fogEnabled?"true":"false"),D(L.attributes,"projection",d.projection),D(L.attributes,"zoom",d.zoom),D(L.metadata,"devicePixelRatio",b),D(L.metadata,"connectionEffectiveType",I),D(L.metadata,"navigatorUserAgent",navigator.userAgent),D(L.metadata,"screenWidth",window.screen.width),D(L.metadata,"screenHeight",window.screen.height),D(L.metadata,"windowWidth",window.innerWidth),D(L.metadata,"windowHeight",window.innerHeight),D(L.metadata,"mapWidth",d.width/b),D(L.metadata,"mapHeight",d.height/b),D(L.metadata,"webglRenderer",d.renderer),D(L.metadata,"webglVendor",d.vendor),D(L.metadata,"sdkVersion",Q),D(L.metadata,"sdkIdentifier","mapbox-gl-js"),L}(n);for(const d of c.metadata);for(const d of c.counters);for(const d of c.attributes);this.postEvent(t,c,()=>{},l)}},Ae=Ie.postPerformanceEvent.bind(Ie),$e=new class extends Hn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(l,t,n,c){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const d=Qi(o.e.API_URL+o.e.SESSION_PATH);d.params.push(`sku=${t||""}`),d.params.push(`access_token=${c||o.e.ACCESS_TOKEN||""}`);const m={url:Ei(d),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(m,_=>{this.pendingRequest=null,n(_),this.saveEventData(),this.processRequests(c)})}getSessionAPI(l,t,n,c){this.skuToken=t,this.errorCb=c,o.e.SESSION_PATH&&o.e.API_URL&&(n||o.e.ACCESS_TOKEN?this.queueRequest({id:l,timestamp:Date.now()},n):this.errorCb(new Error(Fi)))}processRequests(l){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:n}=this.queue.shift();t&&this.success[t]||this.getSession(n,this.skuToken,c=>{c?this.errorCb(c):t&&(this.success[t]=!0)},l)}remove(){this.errorCb=null}},It=$e.getSessionAPI.bind($e),Ct=new Set;function bt(l,t){t?Ct.add(l):Ct.delete(l)}class jt{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,n){this._updatedSourceCaches[t]=n,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const n=t.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(t.id),this.setDirty()}removeLayer(t){const n=t.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][t.id]=t,this._updatedLayers[n].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const n in this._updatedLayers)t[n]=t[n]||{},t[n].updatedIds=Array.from(this._updatedLayers[n].values());for(const n in this._removedLayers)t[n]=t[n]||{},t[n].removedIds=Object.keys(this._removedLayers[n]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,n){this._updatedImages[n]=this._updatedImages[n]||new Set,this._updatedImages[n].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ri(l){const{userImage:t}=l;return!!(t&&t.render&&t.render())&&(l.data.replace(new Uint8Array(t.data.buffer)),!0)}class Jt extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const n=this.atlasTexture.get(t);n&&(n.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,n){this.imageProviders.has(n)||this.imageProviders.set(n,new Map),this.imageProviders.get(n).set(t.id,t)}removeImageProvider(t,n){this.imageProviders.has(n)&&this.imageProviders.get(n).delete(t)}getPendingImageProviders(){const t=[];for(const n of this.imageProviders.values())for(const c of n.values())c.hasPendingRequests()&&t.push(c);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,n){if(this.loaded.get(n)!==t&&(this.loaded.set(n,t),t)){for(const{ids:c,callback:d}of this.requestors)this._notify(c,n,d);this.requestors=[]}}hasImage(t,n){return!!this.getImage(t,n)}getImage(t,n){return this.images.get(n).get(t.toString())}addImage(t,n,c){this._validate(t,c)&&this.images.get(n).set(t.toString(),c)}_validate(t,n){let c=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),c=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),c=!1),this._validateContent(n.content,n)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "content" value`))),c=!1),c}_validateStretch(t,n){if(!t)return!0;let c=0;for(const d of t){if(d[0]<c||d[1]<d[0]||n<d[1])return!1;c=d[1]}return!0}_validateContent(t,n){return t?t.length!==4||!n.usvg&&(t[0]<0||n.data.width<t[0]||t[1]<0||n.data.height<t[1]||t[2]<0||n.data.width<t[2]||t[3]<0||n.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,n,c){const d=this.images.get(n).get(t.toString());c.version=d.version+1,this.images.get(n).set(t.toString(),c),this.updatedImages.get(n).add(t),this.removeFromImageRasterizerCache(t,n)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,n){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:n}):this.imageRasterizer.removeImagesFromCacheByIds([t],n))}removeImage(t,n){const c=this.images.get(n),d=c.get(t.toString());c.delete(t.toString()),this.patterns.get(n).delete(t.toString()),this.removeFromImageRasterizerCache(t,n),d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(n=>o.I.from(n))}getImages(t,n,c){const d=[],m=[],_=this.imageProviders.get(n);for(const I of t){if(!I.iconsetId){d.push(I);continue}const L=_.get(I.iconsetId);L&&(this.getImage(I,n)?m.push(I):L.addPendingRequest(I))}if(d.length===0)return void this._notify(m,n,c);let x=!0;const b=!!this.loaded.get(n),E=this.images.get(n);if(!b)for(const I of d)E.has(I.toString())||(x=!1);b||x?this._notify(d,n,c):this.requestors.push({ids:d,scope:n,callback:c})}rasterizeImages(t,n){const c=new Map,{tasks:d,scope:m}=t;for(const[_,x]of d.entries()){const b=this.getImage(x.id,m);b&&c.set(_,{image:b,imageVariant:x})}this._rasterizeImages(m,c,n)}_rasterizeImages(t,n,c){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:n,scope:t},c);else{const d=new Map;for(const[m,{image:_,imageVariant:x}]of n.entries())d.set(m,this.imageRasterizer.rasterize(x,_,t,0));c(void 0,d)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,n,c){const d=this.images.get(n),m=new Map;for(const _ of t){if(!d.get(_.toString())){if(_.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:_.name}))}const x=d.get(_.toString());if(!x){o.w(`Image "${_.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const b={data:x.usvg?null:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,usvg:x.usvg,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)};x.usvg&&Object.assign(b,{width:x.icon.usvg_tree.width,height:x.icon.usvg_tree.height}),m.set(o.I.toString(_),b)}c(null,m)}getPixelSize(t){const{width:n,height:c}=this.atlasImage.get(t);return{width:n,height:c}}getPattern(t,n,c){const d=t.toString(),m=this.patterns.get(n),_=m.get(d),x=this.getImage(t,n);if(!x)return null;if(_){if(_.position.version===x.version)return _.position;_.position.version=x.version}else{if(x.usvg&&!x.data){const b=this.getPatternInFlightId(d,n);if(this.patternsInFlight.has(b))return null;this.patternsInFlight.add(b);const E=new o.A(t).scaleSelf(o.o.devicePixelRatio),I=new Map([[E.toString(),{image:x,imageVariant:E}]]);return this._rasterizeImages(n,I,(L,D)=>this.storePatternImage(E,n,x,c,D)),null}this.storePattern(t,n,x)}return this._updatePatternAtlas(n,c),m.get(d).position}getPatternInFlightId(t,n){return o.B(t,n)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,n,c,d,m){const _=t.toString(),x=m?m.get(_):void 0;x&&(c.data=x,this.storePattern(t.id,n,c),this._updatePatternAtlas(n,d),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),n)))}storePattern(t,n,c){const d={w:c.data.width+2*o.C,h:c.data.height+2*o.C,x:0,y:0},m=new o.F(d,c,o.C);this.patterns.get(n).set(t.toString(),{bin:d,position:m})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,n){const c=t.gl;let d=this.atlasTexture.get(n);d?this.dirty&&(d.update(this.atlasImage.get(n)),this.dirty=!1):(d=new o.T(t,this.atlasImage.get(n),c.RGBA8),this.atlasTexture.set(n,d)),d.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(t,n){const c=this.patterns.get(t),d=Array.from(c.values()).map(({bin:E})=>E),{w:m,h:_}=o.G(d),x=this.atlasImage.get(t);x.resize({width:m||1,height:_||1});const b=this.images.get(t);for(const[E,{bin:I,position:L}]of c.entries()){let D=L.padding;const z=I.x+D,B=I.y+D,F=b.get(E).data,H=F.width,G=F.height;D=D>1?D-1:D,o.q.copy(F,x,{x:0,y:0},{x:z,y:B},{width:H,height:G},n),o.q.copy(F,x,{x:0,y:G-D},{x:z,y:B-D},{width:H,height:D},n),o.q.copy(F,x,{x:0,y:0},{x:z,y:B+G},{width:H,height:D},n),o.q.copy(F,x,{x:H-D,y:0},{x:z-D,y:B},{width:D,height:G},n),o.q.copy(F,x,{x:0,y:0},{x:z+H,y:B},{width:D,height:G},n),o.q.copy(F,x,{x:H-D,y:G-D},{x:z-D,y:B-D},{width:D,height:D},n),o.q.copy(F,x,{x:0,y:G-D},{x:z+H,y:B-D},{width:D,height:D},n),o.q.copy(F,x,{x:0,y:0},{x:z+H,y:B+G},{width:D,height:D},n),o.q.copy(F,x,{x:H-D,y:0},{x:z-D,y:B+G},{width:D,height:D},n)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,n){const c=this.images.get(n);for(const d of t){if(this.callbackDispatchedThisFrame.get(n).has(d.toString()))continue;this.callbackDispatchedThisFrame.get(n).add(d.toString());const m=c.get(d.toString());ri(m)&&this.updateImage(d,n,m)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Gt(l){const t=l.value,n=l.valueSpec,c=l.style,d=l.styleSpec,m=l.key,_=l.arrayElementValidator||Gr;if(!Array.isArray(t))return[new o.V(m,t,`array expected, ${o.K(t)} found`)];if(n.length&&t.length!==n.length)return[new o.V(m,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new o.V(m,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let x={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};d.$version<7&&(x.function=n.function),o.H(n.value)&&(x=n.value);let b=[];for(let E=0;E<t.length;E++)b=b.concat(_({array:t,arrayIndex:E,value:t[E],valueSpec:x,style:c,styleSpec:d,key:`${m}[${E}]`},!0));return b}function Ai(l){const t=l.key,n=l.value,c=l.valueSpec;if(!o.L(n))return[new o.V(t,n,`number expected, ${o.K(n)} found`)];if(n!=n)return[new o.V(t,n,"number expected, NaN found")];if("minimum"in c){let d=c.minimum;if(Array.isArray(c.minimum)&&(d=c.minimum[l.arrayIndex]),n<d)return[new o.V(t,n,`${n} is less than the minimum value ${d}`)]}if("maximum"in c){let d=c.maximum;if(Array.isArray(c.maximum)&&(d=c.maximum[l.arrayIndex]),n>d)return[new o.V(t,n,`${n} is greater than the maximum value ${d}`)]}return[]}function ni(l){const t=l.key,n=l.value;if(!o.H(n))return[new o.V(t,n,`object expected, ${o.K(n)} found`)];const c=l.valueSpec,d=o.J(n.type);let m,_,x,b={};const E=d!=="categorical"&&n.property===void 0,I=!E,L=function(F){const H=F.stops;return Array.isArray(H)&&Array.isArray(H[0])&&o.H(H[0][0])}(n),D=$n({key:l.key,value:l.value,valueSpec:l.styleSpec.function,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{stops:function(F){if(d==="identity")return[new o.V(F.key,F.value,'identity function may not have a "stops" property')];let H=[];const G=F.value;return H=H.concat(Gt({key:F.key,value:G,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:z})),Array.isArray(G)&&G.length===0&&H.push(new o.V(F.key,G,"array must have at least one stop")),H},default:function(F){return Gr({key:F.key,value:F.value,valueSpec:c,style:F.style,styleSpec:F.styleSpec})}}});return d==="identity"&&E&&D.push(new o.V(l.key,l.value,'missing required property "property"')),d==="identity"||n.stops||D.push(new o.V(l.key,l.value,'missing required property "stops"')),d==="exponential"&&c.expression&&!o.M(c)&&D.push(new o.V(l.key,l.value,"exponential functions not supported")),l.styleSpec.$version>=8&&(I&&!o.N(c)?D.push(new o.V(l.key,l.value,"property functions not supported")):E&&!o.O(c)&&D.push(new o.V(l.key,l.value,"zoom functions not supported"))),d!=="categorical"&&!L||n.property!==void 0||D.push(new o.V(l.key,l.value,'"property" property is required')),D;function z(F){let H=[];const G=F.value,Z=F.key;if(!Array.isArray(G))return[new o.V(Z,G,`array expected, ${o.K(G)} found`)];if(G.length!==2)return[new o.V(Z,G,`array length 2 expected, length ${G.length} found`)];if(L){if(!o.H(G[0]))return[new o.V(Z,G,`object expected, ${o.K(G[0])} found`)];const Y=G[0];if(Y.zoom===void 0)return[new o.V(Z,G,"object stop key must have zoom")];if(Y.value===void 0)return[new o.V(Z,G,"object stop key must have value")];const X=o.J(Y.zoom);if(typeof X!="number")return[new o.V(Z,Y.zoom,"stop zoom values must be numbers")];if(x&&x>X)return[new o.V(Z,Y.zoom,"stop zoom values must appear in ascending order")];X!==x&&(x=X,_=void 0,b={}),H=H.concat($n({key:`${Z}[0]`,value:G[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Ai,value:B}}))}else H=H.concat(B({key:`${Z}[0]`,value:G[0],style:F.style,styleSpec:F.styleSpec},G));return o.Q(o.S(G[1]))?H.concat([new o.V(`${Z}[1]`,G[1],"expressions are not allowed in function stops.")]):H.concat(Gr({key:`${Z}[1]`,value:G[1],valueSpec:c,style:F.style,styleSpec:F.styleSpec}))}function B(F,H){const G=o.K(F.value),Z=o.J(F.value),Y=F.value!==null?F.value:H;if(m){if(G!==m)return[new o.V(F.key,Y,`${G} stop domain type must match previous stop domain type ${m}`)]}else m=G;if(G!=="number"&&G!=="string"&&G!=="boolean"&&typeof Z!="number"&&typeof Z!="string"&&typeof Z!="boolean")return[new o.V(F.key,Y,"stop domain value must be a number, string, or boolean")];if(G!=="number"&&d!=="categorical"){let X=`number expected, ${G} found`;return o.N(c)&&d===void 0&&(X+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(F.key,Y,X)]}return d!=="categorical"||G!=="number"||typeof Z=="number"&&isFinite(Z)&&Math.floor(Z)===Z?d!=="categorical"&&G==="number"&&typeof Z=="number"&&typeof _=="number"&&_!==void 0&&Z<_?[new o.V(F.key,Y,"stop domain values must appear in ascending order")]:(_=Z,d==="categorical"&&Z in b?[new o.V(F.key,Y,"stop domain values must be unique")]:(b[Z]=!0,[])):[new o.V(F.key,Y,`integer expected, found ${String(Z)}`)]}}function hi(l){const t=(l.expressionContext==="property"?o.W:o.U)(o.S(l.value),l.valueSpec);if(t.result==="error")return t.value.map(c=>new o.V(`${l.key}${c.key}`,l.value,c.message));const n=t.value.expression||t.value._styleExpression.expression;if(l.expressionContext==="property"&&l.propertyKey==="text-font"&&!n.outputDefined())return[new o.V(l.key,l.value,`Invalid data expression for "${l.propertyKey}". Output values must be contained as literals within the expression.`)];if(l.expressionContext==="property"&&l.propertyType==="layout"&&!o.Z(n))return[new o.V(l.key,l.value,'"feature-state" data expressions are not supported with layout properties.')];if(l.expressionContext==="filter")return Bi(n,l);if(l.expressionContext==="appearance")return vr(n,l);if(l.expressionContext&&l.expressionContext.indexOf("cluster")===0){if(!o.X(n,["zoom","feature-state"]))return[new o.V(l.key,l.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(l.expressionContext==="cluster-initial"&&!o.Y(n))return[new o.V(l.key,l.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Bi(l,t){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const d of t.valueSpec.expression.parameters)n.delete(d);if(n.size===0)return[];const c=[];return l instanceof o._&&n.has(l.name)?[new o.V(t.key,t.value,`["${l.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(l.eachChild(d=>{c.push(...Bi(d,t))}),c)}function vr(l,t){const n=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const d of t.valueSpec.expression.parameters)n.add(d);if(n.size===0)return[];const c=[];return l instanceof o._&&!n.has(l.name)?[new o.V(t.key,t.value,`["${l.name}"] is not an allowed parameter`)]:(l.eachChild(d=>{c.push(...vr(d,t))}),c)}function Dr(l){const t=l.key,n=l.value,c=l.valueSpec,d=[];return Array.isArray(c.values)?c.values.indexOf(o.J(n))===-1&&d.push(new o.V(t,n,`expected one of [${c.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(c.values).indexOf(o.J(n))===-1&&d.push(new o.V(t,n,`expected one of [${Object.keys(c.values).join(", ")}], ${JSON.stringify(n)} found`)),d}function Pr(l){return o.a2(o.S(l.value))?hi(Object.assign({},l,{expressionContext:"filter",valueSpec:l.styleSpec[`filter_${l.layerType||"fill"}`]})):Yr(l)}function Yr(l){const t=l.value,n=l.key;if(!Array.isArray(t))return[new o.V(n,t,`array expected, ${o.K(t)} found`)];if(t.length<1)return[new o.V(n,t,"filter array must have at least 1 element")];const c=l.styleSpec;let d=Dr({key:`${n}[0]`,value:t[0],valueSpec:c.filter_operator});const m=()=>{t.length>=2&&(o.a0(t[1])||d.push(new o.V(`${n}[1]`,t[1],`string expected, ${o.K(t[1])} found`)));for(let _=2;_<t.length;_++)o.J(t[1])==="$type"?d=d.concat(Dr({key:`${n}[${_}]`,value:t[_],valueSpec:c.geometry_type})):o.a0(t[_])||o.L(t[_])||o.$(t[_])||d.push(new o.V(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${o.K(t[_])} found.`))};switch(o.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.J(t[1])==="$type"&&d.push(new o.V(n,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&d.push(new o.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`)),m();break;case"==":case"!=":t.length!==3&&d.push(new o.V(n,t,`filter array for operator "${t[0]}" must have 3 elements`)),m();break;case"in":case"!in":m();break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)d=d.concat(Yr({key:`${n}[${_}]`,value:t[_],style:l.style,styleSpec:l.styleSpec}));break;case"has":case"!has":t.length!==2?d.push(new o.V(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):o.a0(t[1])||d.push(new o.V(`${n}[1]`,t[1],`string expected, ${o.K(t[1])} found`))}return d}function Dn(l,t){const n=l.key,c=l.style,d=l.layer,m=l.styleSpec,_=l.value,x=l.objectKey,b=m[`${t}_${l.layerType}`];if(!b)return[];const E=x.match(/^(.*)-use-theme$/);if(E&&b[E[1]])return o.Q(o.S(_))?[].concat(Gr({key:n,value:_,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:x})):Gr({key:n,value:_,valueSpec:{type:"string"},style:c,styleSpec:m});const I=x.match(/^(.*)-transition$/);if(t==="paint"&&I&&b[I[1]]&&b[I[1]].transition)return Gr({key:n,value:_,valueSpec:m.transition,style:c,styleSpec:m});const L=l.valueSpec||b[x];if(!L)return[new o.a3(n,_,`unknown property "${x}"`)];let D;if(o.a0(_)&&o.N(L)&&!L.tokens&&(D=/^{([^}]+)}$/.exec(_))){const B=`\`{ "type": "identity", "property": ${D?JSON.stringify(D[1]):'"_"'} }\``;return[new o.V(n,_,`"${x}" does not support interpolation syntax
Use an identity property function instead: ${B}.`)]}const z=[];if(l.layerType==="symbol")x!=="text-field"||!c||c.glyphs||c.imports||z.push(new o.V(n,_,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&o.a4(o.S(_))&&o.J(_.type)==="identity"&&z.push(new o.V(n,_,'"text-font" does not support identity functions'));else if(l.layerType==="model"&&t==="paint"&&d&&d.layout&&d.layout.hasOwnProperty("model-id")&&o.N(L)&&(o.a5(L)||o.O(L))){const B=o.W(o.S(_),L).value,F="expression"in B&&B.expression||"_styleExpression"in B&&B._styleExpression&&B._styleExpression.expression;F&&!o.X(F,["measure-light"])&&(x==="model-emissive-strength"&&o.Y(F)&&o.Z(F)||z.push(new o.V(n,_,`${x} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return z.concat(Gr({key:l.key,value:_,valueSpec:L,style:c,styleSpec:m,expressionContext:"property",propertyType:t,propertyKey:x}))}function es(l){return Dn(l,"paint")}function ts(l){return Dn(l,"layout")}function Ys(l){let t=[];const n=l.value,c=l.key,d=l.style,m=l.styleSpec;if(!o.H(n))return[new o.V(c,n,"object expected")];n.type||n.ref||t.push(new o.V(c,n,'either "type" or "ref" is required'));let _=o.J(n.type);const x=o.J(n.ref);if(n.id){const b=o.J(n.id);for(let E=0;E<l.arrayIndex;E++){const I=d.layers[E];o.J(I.id)===b&&t.push(new o.V(c,n.id,`duplicate layer id "${b}", previously used at line ${I.id.__line__}`))}}if("ref"in n){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in n&&t.push(new o.V(c,n[E],`"${E}" is prohibited for ref layers`))}),d.layers.forEach(E=>{o.J(E.id)===x&&(b=E)}),b?b.ref?t.push(new o.V(c,n.ref,"ref cannot reference another ref layer")):_=o.J(b.type):typeof x=="string"&&t.push(new o.V(c,n.ref,`ref layer "${x}" not found`))}else if(_!=="background"&&_!=="sky"&&_!=="slot")if(n.source)if(o.a0(n.source)){const b=d.sources&&d.sources[n.source],E=b&&o.J(b.type);b?E==="vector"&&_==="raster"?t.push(new o.V(c,n.source,`layer "${n.id}" requires a raster source`)):E==="raster"&&_!=="raster"?t.push(new o.V(c,n.source,`layer "${n.id}" requires a vector source`)):E!=="vector"||n["source-layer"]?E==="raster-dem"&&_!=="hillshade"?t.push(new o.V(c,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):E!=="raster-array"||["raster","raster-particle"].includes(_)?_==="line"&&n.paint&&(n.paint["line-gradient"]||n.paint["line-trim-offset"])&&E==="geojson"&&!b.lineMetrics?t.push(new o.V(c,n,`layer "${n.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):_==="raster-particle"&&E!=="raster-array"&&t.push(new o.V(c,n.source,`layer "${n.id}" requires a 'raster-array' source.`)):t.push(new o.V(c,n.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(c,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new o.V(c,n.source,`source "${n.source}" not found`))}else t.push(new o.V(`${c}.source`,n.source,'"source" must be a string'));else t.push(new o.V(c,n,'missing required property "source"'));return t=t.concat($n({key:c,value:n,valueSpec:m.layer,style:l.style,styleSpec:l.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Gr({key:`${c}.type`,value:n.type,valueSpec:m.layer.type,style:l.style,styleSpec:l.styleSpec,object:n,objectKey:"type"}),filter:b=>Pr(Object.assign({layerType:_},b)),layout:b=>$n({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>ts(Object.assign({layerType:_},E))}}),paint:b=>$n({layer:n,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>es(Object.assign({layerType:_,layer:n},E))}}),appearances(b){const E=Gt({key:b.key,value:b.value,valueSpec:b.valueSpec,style:b.style,styleSpec:b.styleSpec,arrayElementValidator:D=>function(z){const{key:B,layer:F,layerType:H}=z,G=o.J(z.value),Z=o.J(G.name),Y=o.J(G.condition),X=$n({key:B,value:G,valueSpec:z.styleSpec.appearance,style:z.style,styleSpec:z.styleSpec,objectElementValidators:{condition:ce=>function(ne){const ae=[];return ae.push(...hi({key:ne.key,value:ne.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),ae}(Object.assign({layer:F,layerType:H},ce)),properties:ce=>function(ne){const ae=[],{styleSpec:re,layer:ee,layerType:ue}=ne,be=re[`paint_${ue}`],xe=re[`layout_${ue}`],De=ne.object[ne.objectKey];for(const Le in De){const Ue=Le in be?"paint":Le in xe?"layout":void 0;if(!Ue){ae.push(new o.V(ne.key,Le,`unknown property "${Le}" for layer type "${ue}"`));continue}const it=Object.assign({},ne,{key:`${ne.key}.${Le}`,object:De,objectKey:Le,layer:ee,layerType:ue,value:De[Le],valueSpec:Ue==="paint"?be[Le]:xe[Le]});ae.push(...Dn(it,Ue))}return ae}(Object.assign({layer:F,layerType:H},ce))}});return Z!=="hidden"&&Y===void 0&&X.push(new o.V(z.key,"name",'Appearance with name different than "hidden" must have a condition')),X}(Object.assign({layerType:_,layer:n},D))}),I=Array.isArray(b.value)?b.value:[],L=new Set;return I.forEach((D,z)=>{const B=o.J(D.name);if(B)if(L.has(B)){const F=o.J(n.id);E.push(new o.V(b.key,B,`Duplicated appearance name "${B}" for layer "${F}"`))}else L.add(B)}),E}}})),t}function bn({key:l,value:t}){return o.a0(t)?[]:[new o.V(l,t,`string expected, ${o.K(t)} found`)]}const rn={promoteId:function l({key:t,value:n}){if(o.a0(n))return bn({key:t,value:n});if(Array.isArray(n)){const d=[],m=o.S(n),_=o.U(m);return _.result==="error"&&_.value.forEach(x=>{d.push(new o.V(`${t}${x.key}`,null,`${x.message}`))}),o.X(_.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||d.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),d}if(!o.H(n))return[new o.V(t,n,`string, expression or object expected, "${o.K(n)}" found`)];const c=[];for(const d in n)c.push(...l({key:`${t}.${d}`,value:n[d]}));return c}};function ps(l){const t=l.value,n=l.key,c=l.styleSpec,d=l.style;if(!o.H(t))return[new o.V(n,t,`object expected, ${o.K(t)} found`)];if(!("type"in t))return[new o.V(n,t,'"type" is required')];const m=o.J(t.type);let _=[];switch(["vector","raster","raster-dem","raster-array"].includes(m)&&("url"in t||"tiles"in t||_.push(new o.a3(n,t,'Either "url" or "tiles" is required.'))),m){case"vector":case"raster":case"raster-dem":case"raster-array":return _=_.concat($n({key:n,value:t,valueSpec:c[`source_${m.replace("-","_")}`],style:l.style,styleSpec:c,objectElementValidators:rn})),_;case"geojson":if(_=$n({key:n,value:t,valueSpec:c.source_geojson,style:d,styleSpec:c,objectElementValidators:rn}),"cluster"in t&&"clusterProperties"in t){if(!o.H(t.clusterProperties))return[new o.V(`${n}.clusterProperties`,t,`object expected, ${o.K(t)} found`)];for(const x in t.clusterProperties){const b=t.clusterProperties[x];if(!Array.isArray(b))return[new o.V(`${n}.clusterProperties.${x}`,b,"array expected")];const[E,I]=b,L=typeof E=="string"?[E,["accumulated"],["get",x]]:E;_.push(...hi({key:`${n}.${x}.map`,value:I,expressionContext:"cluster-map"})),_.push(...hi({key:`${n}.${x}.reduce`,value:L,expressionContext:"cluster-reduce"}))}}return _;case"video":return $n({key:n,value:t,valueSpec:c.source_video,style:d,styleSpec:c});case"image":return $n({key:n,value:t,valueSpec:c.source_image,style:d,styleSpec:c});case"canvas":return[new o.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dr({key:`${n}.type`,value:t.type,valueSpec:{values:mo(c)}})}}function mo(l){return l.source.reduce((t,n)=>{const c=l[n];return c.type.type==="enum"&&(t=t.concat(Object.keys(c.type.values||{}))),t},[])}function Do(l){const t=l.value,n=l.styleSpec,c=n.light,d=l.style;if(t===void 0)return[];if(!o.H(t))return[new o.V("light",t,`object expected, ${o.K(t)} found`)];let m=[];for(const _ in t){const x=_.match(/^(.*)-transition$/),b=_.match(/^(.*)-use-theme$/);m=m.concat(b&&c[b[1]]?Gr({key:_,value:t[_],valueSpec:{type:"string"},style:d,styleSpec:n}):x&&c[x[1]]&&c[x[1]].transition?Gr({key:_,value:t[_],valueSpec:n.transition,style:d,styleSpec:n}):c[_]?Gr({key:_,value:t[_],valueSpec:c[_],style:d,styleSpec:n}):[new o.V(_,t[_],`unknown property "${_}"`)])}return m}function Qo(l){const t=l.value;if(!t)return[];const n=l.key;if(!o.H(t))return[new o.V(n,t,`object expected, ${o.K(t)} found`)];let c=[];const d=l.styleSpec,m=d["light-3d"],_=l.style,x=l.style.lights;for(const I of["type","id"])if(!(I in t))return c=c.concat([new o.V(n,t,`missing property "${I}"`)]),c;if(!o.a0(t.type))return c=c.concat([new o.V(`${n}.type`,t.type,"string expected")]),c;if(x)for(let I=0;I<l.arrayIndex;I++){const L=o.J(t.type),D=x[I];o.J(D.type)===L&&c.push(new o.V(n,t.id,`duplicate light type "${t.type}", previously defined at line ${D.id.__line__}`))}const b=`properties_light_${t.type}`;if(!(b in d))return c=c.concat([new o.V(`${n}.type`,t,`Invalid light type ${t.type}`)]),c;const E=d[b];for(const I in t)if(I==="properties"){const L=t[I];if(!o.H(L))return c=c.concat([new o.V("properties",L,`object expected, ${o.K(L)} found`)]),c;for(const D in L){const z=D.match(/^(.*)-transition$/),B=D.match(/^(.*)-use-theme$/);c=c.concat(B&&E[B[1]]?Gr({key:I,value:L[D],valueSpec:{type:"string"},style:_,styleSpec:d}):z&&E[z[1]]&&E[z[1]].transition?Gr({key:I,value:t[I],valueSpec:d.transition,style:_,styleSpec:d}):E[D]?Gr({key:D,value:L[D],valueSpec:E[D],style:_,styleSpec:d}):[new o.a3(l.key,L[D],`unknown property "${D}"`)])}}else c=c.concat(m[I]?Gr({key:I,value:t[I],valueSpec:m[I],style:_,styleSpec:d}):[new o.a3(I,t[I],`unknown property "${I}"`)]);return c}function _o(l){const t=l.value,n=l.key,c=l.style,d=l.styleSpec,m=d.terrain;if(t==null)return[];if(!o.H(t))return[new o.V("terrain",t,`object expected, ${o.K(t)} found`)];let _=[];for(const x in t){const b=x.match(/^(.*)-transition$/),E=x.match(/^(.*)-use-theme$/);_=_.concat(E&&m[E[1]]?Gr({key:x,value:t[x],valueSpec:{type:"string"},style:c,styleSpec:d}):b&&m[b[1]]&&m[b[1]].transition?Gr({key:x,value:t[x],valueSpec:d.transition,style:c,styleSpec:d}):m[x]?Gr({key:x,value:t[x],valueSpec:m[x],style:c,styleSpec:d}):[new o.a3(x,t[x],`unknown property "${x}"`)])}if(t.source)if(o.a0(t.source)){const x=c.sources&&c.sources[t.source],b=x&&o.J(x.type);x?b!=="raster-dem"&&_.push(new o.V(`${n}.source`,t.source,`terrain cannot be used with a source of type ${b}, it only be used with a "raster-dem" source type`)):_.push(new o.V(`${n}.source`,t.source,`source "${t.source}" not found`))}else _.push(new o.V(`${n}.source`,t.source,"source must be a string"));else _.push(new o.V(n,t,'terrain is missing required property "source"'));return _}function Dc(l){const t=l.value,n=l.style,c=l.styleSpec,d=c.fog;if(t===void 0)return[];if(!o.H(t))return[new o.V("fog",t,`object expected, ${o.K(t)} found`)];let m=[];for(const _ in t){const x=_.match(/^(.*)-transition$/),b=_.match(/^(.*)-use-theme$/);m=m.concat(b&&d[b[1]]?Gr({key:_,value:t[_],valueSpec:{type:"string"},style:n,styleSpec:c}):x&&d[x[1]]&&d[x[1]].transition?Gr({key:_,value:t[_],valueSpec:c.transition,style:n,styleSpec:c}):d[_]?Gr({key:_,value:t[_],valueSpec:d[_],style:n,styleSpec:c}):[new o.a3(_,t[_],`unknown property "${_}"`)])}return m}const sl={"*":()=>[],array:Gt,boolean:function(l){const t=l.value,n=l.key;return o.$(t)?[]:[new o.V(n,t,`boolean expected, ${o.K(t)} found`)]},number:Ai,color:function({key:l,value:t}){return o.a0(t)?o.a1.parseCSSColor(t)===null?[new o.V(l,t,`color expected, "${t}" found`)]:[]:[new o.V(l,t,`color expected, ${o.K(t)} found`)]},enum:Dr,filter:Pr,function:ni,layer:Ys,object:$n,source:ps,model:o.a7,light:Do,"light-3d":Qo,terrain:_o,fog:Dc,string:bn,formatted:function(l){return bn(l).length===0?[]:hi(l)},resolvedImage:function(l){return bn(l).length===0?[]:hi(l)},projection:function(l){const t=l.value,n=l.styleSpec,c=n.projection,d=l.style;if(o.H(t)){let m=[];for(const _ in t)m=m.concat(Gr({key:_,value:t[_],valueSpec:c[_],style:d,styleSpec:n}));return m}return o.a0(t)?[]:[new o.V("projection",t,`object or string expected, ${o.K(t)} found`)]},import:function(l){const t=l.key,{value:n,styleSpec:c}=l;if(!o.H(n))return[new o.V(t,n,"import must be an object")];const{data:d,...m}=n;Object.defineProperty(m,"__line__",{value:n.__line__,enumerable:!1});let _=$n(Object.assign({},l,{value:m,valueSpec:c.import}));return o.J(m.id)===""&&_.push(new o.V(`${l.key}.id`,m,"import id can't be an empty string")),d&&(_=_.concat(ol(d,c,{key:`${l.key}.data`}))),_},iconset:function(l){const t=l.value,n=l.key,c=l.styleSpec,d=l.style;if(!o.H(t))return[new o.V(n,t,"object expected")];if(!t.type)return[new o.V(n,t,'"type" is required')];const m=o.J(t.type);let _=[];if(_=_.concat($n({key:n,value:t,valueSpec:c[`iconset_${m}`],style:d,styleSpec:c})),function(x,b){return!(x!=="source"||!b.source)}(m,t)){const x=d.sources&&d.sources[t.source],b=x&&o.J(x.type);x?b!=="raster-array"&&_.push(new o.V(n,t.source,`iconset cannot be used with a source of type ${String(b)}, it only be used with a "raster-array" source type`)):_.push(new o.V(n,t.source,`source "${t.source}" not found`))}return _}};function Gr(l,t=!1){const n=l.value,c=l.valueSpec,d=l.styleSpec;if(c.expression){if(o.a4(o.J(n)))return ni(l);if(o.Q(o.S(n)))return hi(l)}if(c.type&&sl[c.type]){const m=sl[c.type](l);return t===!0&&m.length>0&&Array.isArray(l.value)?hi(l):m}return $n(Object.assign({},l,{valueSpec:c.type?d[c.type]:c}))}function $n(l){const t=l.key,n=l.value,c=l.valueSpec||{},d=l.objectElementValidators||{},m=l.style,_=l.styleSpec;if(!o.H(n))return[new o.V(t,n,`object expected, ${o.K(n)} found`)];let x=[];for(const b in n){const E=b.split(".")[0];let I;d[E]?I=d[E]:c[E]?I=Gr:d["*"]?I=d["*"]:c["*"]&&(I=Gr),I?x=x.concat(I({key:(t&&`${t}.`)+b,value:n[b],valueSpec:c[E]||c["*"],style:m,styleSpec:_,object:n,objectKey:b},n)):x.push(new o.a3(t,n[b],`unknown property "${b}"`))}for(const b in c){if(d[b])continue;const E=c[b];E.required&&E.default===void 0&&n[b]===void 0&&x.push(new o.V(t,n,`missing required property "${b}"`))}return x}function ku({key:l,value:t}){const n=bn({key:l,value:t});if(n.length)return n;const c=t;return c.indexOf("{fontstack}")===-1&&n.push(new o.V(l,t,'"glyphs" url must include a "{fontstack}" token')),c.indexOf("{range}")===-1&&n.push(new o.V(l,t,'"glyphs" url must include a "{range}" token')),n}function ol(l,t=o.a6,n={}){return $n({key:n.key||"",value:l,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:l,objectElementValidators:{glyphs:ku}})}function go(l,t=o.a6){return $(ol(l,t))}const Fu=l=>$(ps(l)),Ye=l=>$(Do(l)),ea=l=>$(Qo(l)),Nd=l=>$(_o(l)),al=l=>$(Dc(l)),Wi=l=>$(function(t){const n=t.value,c=t.style,d=t.styleSpec,m=d.snow;if(n===void 0)return[];if(!o.H(n))return[new o.V("snow",n,`object expected, ${o.K(n)} found`)];let _=[];for(const x in n){const b=x.match(/^(.*)-transition$/);_=_.concat(b&&m[b[1]]&&m[b[1]].transition?Gr({key:x,value:n[x],valueSpec:d.transition,style:c,styleSpec:d}):m[x]?Gr({key:x,value:n[x],valueSpec:m[x],style:c,styleSpec:d}):[new o.a3(x,n[x],`unknown property "${x}"`)])}return _}(l)),us=l=>$(function(t){const n=t.value,c=t.style,d=t.styleSpec,m=d.rain;if(n===void 0)return[];if(!o.H(n))return[new o.V("rain",n,`object expected, ${o.K(n)} found`)];let _=[];for(const x in n){const b=x.match(/^(.*)-transition$/);_=_.concat(b&&m[b[1]]&&m[b[1]].transition?Gr({key:x,value:n[x],valueSpec:d.transition,style:c,styleSpec:d}):m[x]?Gr({key:x,value:n[x],valueSpec:m[x],style:c,styleSpec:d}):[new o.a3(x,n[x],`unknown property "${x}"`)])}return _}(l)),Vd=l=>$(Ys(l)),ll=l=>$(Pr(l)),Lc=l=>$(es(l)),Ee=l=>$(ts(l)),U=l=>$(o.a7(l));function $(l){return l.slice().sort((t,n)=>t.line&&n.line?t.line-n.line:0)}function J(l,t){let n=!1;if(t&&t.length)for(const c of t)c instanceof o.a3?o.w(c.message):(l.fire(new o.y(new Error(c.message))),n=!0);return n}const me=o.a6.light;let de;class ve extends o.E{constructor(t,n="flat"){super(),this._transitionable=new o.a8(de||(de=new o.a9({anchor:new o.aa(me.anchor),position:new o.ab(me.position),color:new o.aa(me.color),intensity:new o.aa(me.intensity)}))),this.setLight(t,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,n,c={}){this._validate(Ye,t,c)||(this._transitionable.setTransitionOrValue(t),this.id=n)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,c){return(!c||c.validate!==!1)&&J(this,t.call(go,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const Re=o.a6.terrain;let Te=class extends o.E{constructor(l,t,n,c,d){super(),this.scope=n,this._transitionable=new o.a8(new o.a9({source:new o.aa(Re.source),exaggeration:new o.aa(Re.exaggeration)}),n,c),this._transitionable.setTransitionOrValue(l,c),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=d}get(){return this._transitionable.serialize()}set(l,t){this._transitionable.setTransitionOrValue(l,t)}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}getExaggeration(l){return this._transitioning.possiblyEvaluate(new o.ac(l,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const l=this._transitionable._values.exaggeration;if(!l)return null;const t=l.value.expression;if(!t)return null;let n=-1,c=-1,d=1;for(const m of t.zoomStops)d=t.evaluate(new o.ac(m,{worldview:this.worldview})),d>.01?(n=m,c=-1):c=m;return d<.01&&n>0&&c>n?[n,c]:null}isZoomDependent(){const l=this._transitionable._values.exaggeration;return l!=null&&l.value!=null&&l.value.expression!=null&&l.value.expression instanceof o.ad}};const Me=45,tt=65,Ge=.05;function Pt(l,t,n,c){const d=o.ah(Me,tt,n),[m,_]=qt(l,c);let x=1-Math.min(1,Math.exp((t-m)/(_-m)*-6));return x*=x*x,x=Math.min(1,1.00747*x),x*d*l.alpha}function qt(l,t){const n=.5/Math.tan(.5*t);return[l.range[0]+n,l.range[1]+n]}function St(l,t,n,c,d){const m=o.af([],[t,n,c],d.mercatorFogMatrix);return Pt(l,o.ag(m),d.pitch,d._fov)}function yi(l,t,n,c,d,m,_){const x=[[n,c,0],[d,c,0],[d,m,0],[n,m,0]];let b=Number.MAX_VALUE,E=-Number.MAX_VALUE;for(const I of x){const L=o.af([],I,t),D=o.ag(L);b=Math.min(b,D),E=Math.max(E,D)}return[Pt(l,b,_.pitch,_._fov),Pt(l,E,_.pitch,_._fov)]}const _i=o.a6.fog;class pi extends o.E{constructor(t,n,c,d){super();const m=new o.a9({range:new o.aa(_i.range),color:new o.aa(_i.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(_i["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(_i["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(_i["horizon-blend"]),"star-intensity":new o.aa(_i["star-intensity"]),"vertical-range":new o.aa(_i["vertical-range"])});this._transitionable=new o.a8(m,c,new Map(d)),this.set(t,d),this._transitioning=this._transitionable.untransitioned(),this._transform=n,this.properties=new o.ai(m),this.scope=c}get state(){const t=this._transform,n=t.projection.name==="globe",c=o.aj(t.zoom),d=this.properties.get("range"),m=[.5,3];return{range:n?[o.ak(m[0],d[0],c),o.ak(m[1],d[1],c)]:d,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,n,c={}){if(this._validate(al,t,c))return;const d=Object.assign({},t);for(const m of Object.keys(_i))d[m]===void 0&&(d[m]=_i[m].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,n)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(Me,tt,t))*n.a}getOpacityAtLatLng(t,n){return this._transform.projection.supportsFog?function(c,d,m){const _=o.ae.fromLngLat(d),x=m.elevation?m.elevation.getAtPointOrZero(_):0;return St(c,_.x,_.y,x,m)}(this.state,t,n):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const n=this._transform.calculateFogTileMatrix(t.toUnwrapped());return yi(this.state,n,0,0,o.al,o.al,this._transform)}getOpacityForBounds(t,n,c,d,m){return this._transform.projection.supportsFog?yi(this.state,t,n,c,d,m,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?qt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const n=[4,5,6,7];for(const c of n){const d=t.points[c];let m;if(d[2]>=0)m=d;else{const _=t.points[c-4];m=o.am(_,d,_[2]/(_[2]-d[2]))}if(St(this.state,m[0],m[1],0,this._transform)>=Ge)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,n,c){return(!c||c.validate!==!1)&&J(this,t.call(go,Object.assign({value:n,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let Vi,Zr,pn,Jr,yn=class extends o.E{constructor(l,t,n,c){super();const d=Vi||(Vi=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(d,n,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(d),this.scope=n}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),c=o.an(n[0]),d=-Math.max(o.an(n[1]),.01),m=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],_=this.properties.get("vignette"),x=this.properties.get("vignette-color");return x.a=_,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*l),direction:m,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(l,t,n={}){if(this._validate(Wi,l,n))return;const c=Object.assign({},l),d=o.a6.snow;for(const m of Object.keys(d))c[m]===void 0&&(c[m]=d[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,n){return(!n||n.validate!==!1)&&J(this,l.call(go,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},Hr=class extends o.E{constructor(l,t,n,c){super();const d=Zr||(Zr=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(d,n,new Map(c)),this.set(l,c),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(d),this.scope=n}get state(){const l=this.properties.get("opacity"),t=this.properties.get("color"),n=this.properties.get("direction"),c=o.an(n[0]),d=-Math.max(o.an(n[1]),.01),m=[Math.cos(c)*Math.cos(d),Math.sin(c)*Math.cos(d),Math.sin(d)],_=this.properties.get("vignette-color");return _.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*l),direction:m,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:_}}get(){return this._transitionable.serialize()}set(l,t,n={}){if(this._validate(us,l,n))return;const c=Object.assign({},l),d=o.a6.rain;for(const m of Object.keys(d))c[m]===void 0&&(c[m]=d[m].default);this._options=c,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(l){this._transitionable.setTransitionOrValue(this._options,new Map(l))}updateTransitions(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(l){this.properties=this._transitioning.possiblyEvaluate(l)}_validate(l,t,n){return(!n||n.validate!==!1)&&J(this,l.call(go,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class Hi extends o.E{constructor(t,n,c,d){super(),this.scope=c,this._options=t,this.properties=new o.ai(n),this._transitionable=new o.a8(n,c,new Map(d)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,n){this._options=t,this._transitionable.setTransitionOrValue(t.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class qr{constructor(t,n,c){this.screenBounds=t,this.cameraPoint=c.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,c)}static createFromScreenPoints(t,n){let c,d;if(t instanceof o.P||typeof t[0]=="number"){const m=o.P.convert(t);c=[m],d=n.isPointAboveHorizon(m)}else{const m=o.P.convert(t[0]),_=o.P.convert(t[1]),x=m.add(_)._div(2);c=[m,_],d=o.aq(m,_).every(b=>n.isPointAboveHorizon(b))&&n.isPointAboveHorizon(x)}return new qr(c,d,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],d=o.aq(n,c,0,!1);return this.cameraPoint.y>c.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<c.x?d.splice(3,0,this.cameraPoint):this.cameraPoint.x>=c.x?d[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(d[3]=this.cameraPoint)),o.ar(d,t)}bufferedCameraGeometryGlobe(t){const n=this.screenBounds[0],c=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],d=o.aq(n,c,t),m=this.cameraPoint.clone();switch(3*((m.y>n.y)+(m.y>c.y))+((m.x>n.x)+(m.x>c.x))){case 0:d[0]=m,d[4]=m.clone();break;case 1:d.splice(1,0,m);break;case 2:d[1]=m;break;case 3:d.splice(4,0,m);break;case 5:d.splice(2,0,m);break;case 6:d[3]=m;break;case 7:d.splice(3,0,m);break;case 8:d[2]=m}return d}containsTile(t,n,c,d=0){const m=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/n._pixelsPerMercatorPixel+1,_=c?this._bufferedCameraMercator(m,n):this._bufferedScreenMercator(m,n);let x=t.tileID.wrap+(_.unwrapped?d:0);const b=_.polygon.map(H=>o.as(t.tileTransform,H,x));if(!o.at(b,0,0,o.al,o.al))return;x=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?d:0);const E=this.screenGeometryMercator.polygon.map(H=>o.au(t.tileTransform,H,x)),I=E.map(H=>new o.P(H[0],H[1])),L=n.getFreeCameraOptions().position||new o.ae(0,0,0),D=o.au(t.tileTransform,L,x),z=E.map(H=>{const G=o.av(H,H,D);return o.aw(G,G),new o.ax(D,G)}),B=o.ay(t,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:I,tilespaceRays:z,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(F=o.az(b),F.min.x=o.aA(F.min.x,0,o.al),F.min.y=o.aA(F.min.y,0,o.al),F.max.x=o.aA(F.max.x,0,o.al),F.max.y=o.aA(F.max.y,0,o.al),F),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:B};var F}_bufferedScreenMercator(t,n){const c=Qr(t);if(this._screenRaycastCache[c])return this._screenRaycastCache[c];{let d;return d=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),n):{polygon:this.bufferedScreenGeometry(t).map(m=>n.pointCoordinate3D(m)),unwrapped:!0},this._screenRaycastCache[c]=d,d}}_bufferedCameraMercator(t,n){const c=Qr(t);if(this._cameraRaycastCache[c])return this._cameraRaycastCache[c];{let d;return d=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),n):{polygon:this.bufferedCameraGeometry(t).map(m=>n.pointCoordinate3D(m)),unwrapped:!0},this._cameraRaycastCache[c]=d,d}}_projectAndResample(t,n){const c=function(m,_){const x=o.aB([],_.pixelMatrix,_.globeMatrix),b=[0,-o.aD,0,1],E=[0,o.aD,0,1],I=[0,0,0,1];o.aC(b,b,x),o.aC(E,E,x),o.aC(I,I,x);const L=new o.P(b[0]/b[3],b[1]/b[3]),D=new o.P(E[0]/E[3],E[1]/E[3]),z=o.aE(m,L)&&b[3]<I[3],B=o.aE(m,D)&&E[3]<I[3];if(!z&&!B)return null;const F=function(ae,re,ee){for(let ue=1;ue<ae.length;ue++){const be=Mi(re.pointCoordinate3D(ae[ue-1]).x),xe=Mi(re.pointCoordinate3D(ae[ue]).x);if(ee<0){if(be<xe)return{idx:ue,t:-be/(xe-1-be)}}else if(xe<be)return{idx:ue,t:(1-be)/(xe+1-be)}}return null}(m,_,z?-1:1);if(!F)return null;const{idx:H,t:G}=F;let Z=H>1?br(m.slice(0,H),_):[],Y=H<m.length?br(m.slice(H),_):[];Z=Z.map(ae=>new o.P(Mi(ae.x),ae.y)),Y=Y.map(ae=>new o.P(Mi(ae.x),ae.y));const X=[...Z];X.length===0&&X.push(Y[Y.length-1]);const ce=o.ak(X[X.length-1].y,(Y.length===0?Z[0]:Y[0]).y,G);let ne;return ne=z?[new o.P(0,ce),new o.P(0,0),new o.P(1,0),new o.P(1,ce)]:[new o.P(1,ce),new o.P(1,1),new o.P(0,1),new o.P(0,ce)],X.push(...ne),Y.length===0?X.push(Z[0]):X.push(...Y),{polygon:X.map(ae=>new o.ae(ae.x,ae.y)),unwrapped:!1}}(t,n);if(c)return c;const d=function(m,_){let x=!1,b=-1/0,E=0;for(let L=0;L<m.length-1;L++)m[L].x>b&&(b=m[L].x,E=L);for(let L=0;L<m.length-1;L++){const D=(E+L)%(m.length-1),z=m[D],B=m[D+1];Math.abs(z.x-B.x)>.5&&(z.x<B.x?(z.x+=1,D===0&&(m[m.length-1].x+=1)):(B.x+=1,D+1===m.length-1&&(m[0].x+=1)),x=!0)}const I=o.aF(_.center.lng);return x&&I<Math.abs(I-1)&&m.forEach(L=>{L.x-=1}),{polygon:m,unwrapped:x}}(br(t,n).map(m=>new o.P(Mi(m.x),m.y)),n);return{polygon:d.polygon.map(m=>new o.ae(m.x,m.y)),unwrapped:d.unwrapped}}}function br(l,t){return o.aG(l,n=>{const c=t.pointCoordinate3D(n);n.x=c.x,n.y=c.y},1/256)}function Mi(l){return l<0?1+l%1:l%1}function Qr(l){return 100*l|0}function Xn(l,t,n,c,d){const m=function(x,b){if(x)return d(x);if(b){if(l.url&&b.tiles&&l.tiles&&delete l.tiles,b.variants){if(!Array.isArray(b.variants))return d(new Error("variants must be an array"));for(const I of b.variants){if(I==null||typeof I!="object"||I.constructor!==Object)return d(new Error("variant must be an object"));if(!Array.isArray(I.capabilities))return d(new Error("capabilities must be an array"));if(I.capabilities.length===1&&I.capabilities[0]==="meshopt"){b=Object.assign(b,I);break}}}const E=o.aH(Object.assign({},b,l),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);E.tiles=t.canonicalizeTileset(E,l.url),d(null,E)}},_=function(x,b,E){if(!x)return null;if(!b&&!E)return x;E=E||x.worldview_default;const I=Object.values(x.language||{});if(I.length===0)return null;const L=Object.values(x.worldview||{});if(L.length===0)return null;const D=I.every(B=>B===b),z=L.every(B=>B===E);return D&&z?x:b in(x.language_options||{})||E in(x.worldview_options||{})?null:x.language_options&&x.worldview_options?x:null}(l.data,n,c);return _?o.o.frame(()=>m(null,_)):l.url?o.m(t.transformRequest(t.normalizeSourceURL(l.url,null,n,c),o.R.Source),m):o.o.frame(()=>{const{data:x,...b}=l;m(null,b)})}function is(l,t){const n=Math.pow(2,t.z),c=Math.floor(o.aF(l.getWest())*n),d=Math.floor(o.aJ(l.getNorth())*n),m=Math.ceil(o.aF(l.getEast())*n),_=Math.ceil(o.aJ(l.getSouth())*n);return t.x>=c&&t.x<m&&t.y>=d&&t.y<_}class ws{constructor(t,n,c){this.bounds=t?o.aI.convert(this.validateBounds(t)):null,this.minzoom=n||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const n of t)this.extraBounds.push(o.aI.convert(this.validateBounds(n)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!is(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const n of this.extraBounds)if(is(n,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const n=new ws(t.bounds,t.minzoom,t.maxzoom);return n.addExtraBounds(t.extra_bounds),n}}class cl extends o.E{constructor(t,n,c,d){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(n,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(d),this._tileWorkers={},this._deduped=new o.aK}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=Xn(this._options,this.map._requestManager,n,c,(d,m)=>{if(this._tileJSONRequest=null,this._loaded=!0,d)n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),c&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.y(d));else if(m){if(Object.assign(this,m),this.hasWorldviews=!!m.worldview_options,m.worldview_default&&(this.worldviewDefault=m.worldview_default),m.vector_layers){this.vectorLayers=m.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const _ of m.vector_layers)this.vectorLayerIds.push(_.id),m.worldview&&m.worldview[_.source]&&this.localizableLayerIds.add(_.id)}this.tileBounds=ws.fromTileJSON(m),Cr(m.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(d)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,n){const c=t.tileID.canonical.url(this.tiles,this.scheme),d=this.map._requestManager.normalizeTileURL(c),m=this.map._requestManager.transformRequest(d,o.R.Tile),_=this.map.style?this.map.style.getLut(this.scope):null,x=_?{image:_.image.clone()}:null,b={request:m,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:x,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&o.h(c)&&(b.localizableLayerIds=this.localizableLayerIds),b.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=n:t.request=t.actor.send("reloadTile",b,E.bind(this));else if(t.actor=this._tileWorkers[d]=this._tileWorkers[d]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",b,E.bind(this),void 0,!0);else{const I=o.aL.call({deduped:this._deduped},b,(L,D)=>{if(L||!D)E.call(this,L);else{const z=o.aM(D.responseHeaders);b.data={rawData:D.rawData.slice(0),expires:z.expires,cacheControl:z.cacheControl},t.actor&&t.actor.send("loadTile",b,E.bind(this),void 0,!0)}},!0);t.request={cancel:I}}function E(I,L){return delete t.request,t.aborted?n(null):I&&I instanceof o.aN&&I.status!==404?n(I):(L&&L.resourceTiming&&(t.resourceTiming=L.resourceTiming),this.map._refreshExpiredTiles&&L&&t.setExpiryData(L),t.loadVectorData(L,this.map.painter),o.aO(this.dispatcher),n(null,L),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Vn extends o.E{constructor(t,n,c,d){super(),this.id=t,this.dispatcher=c,this.setEventedParent(d),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},n),Object.assign(this,o.aH(n,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const n=this.map.getWorldview();this._tileJSONRequest=Xn(this._options,this.map._requestManager,null,n,(c,d)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new o.y(c)):d&&(Object.assign(this,d),d.raster_layers&&(this.rasterLayers=d.raster_layers,this.rasterLayerIds=this.rasterLayers.map(m=>m.id)),this.tileBounds=ws.fromTileJSON(d),Cr(d.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(c)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,n){const c=o.o.devicePixelRatio>=2,d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),c,this.tileSize);t.request=o.n(this.map._requestManager.transformRequest(d,o.R.Tile),(m,_,x)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(m)return t.state="errored",n(m);if(!_)return n(null);const b=o.aM(x);this.map._refreshExpiredTiles&&t.setExpiryData(b),t.setTexture(_,this.map.painter),t.state="loaded",o.aO(this.dispatcher),n(null)})}abortTile(t,n){t.request&&(t.request.cancel(),delete t.request),n&&n()}unloadTile(t,n){t.texture&&t.texture instanceof o.T?(t.destroy(!1),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),n&&n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Vs([l,t],n,c,{scaled:d=!0}={}){const{tileSize:m,buffer:_}=c,{x,y:b,z:E}=n;if(!isFinite(x)||!isFinite(b)||!isFinite(E))throw new Error("Invalid MRT header");const I=2**E,L=I*o.aF(l),D=I*o.aJ(t);return function([z,B],F,{scaled:H=!0}={}){if(!F)throw new Error("bandView is undefined");const{data:G,tileSize:Z,buffer:Y,offset:X,scale:ce,dimension:ne}=F;if(z<-Y||z>Z+Y||B<-Y||B>Z+Y)throw new Error(`Point (${z}, ${B}) out of bounds for tileSize=${Z}, buffer=${Y}`);const ae=(B+Y)*(Z+2*Y)+(z+Y);if(new Uint32Array(G.buffer)[ae]===4294967295)return null;let re=[];re=H?[]:new F.data.constructor(ne);for(let ee=0;ee<ne;ee++)re[ee]=Math.round(1e12*(G[ne*ae+ee]*ce+X))/1e12;return re}([Math.min(Math.max(-_,Math.floor((L-x)*m)),m-1+_),Math.min(Math.max(-_,Math.floor((D-b)*m)),m-1+_)],c,{scaled:d})}class hs extends Vn{constructor(t,n,c,d){super(t,n,c,d),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},n)}triggerRepaint(t){const n=this.map.painter._terrain,c=this.map.style.getSourceCache(this.id);n&&n.enabled&&c&&n._clearRenderCacheForTile(c.id,t.tileID),this.map.triggerRepaint()}loadTile(t,n){const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),d=this.map._requestManager.transformRequest(c,o.R.Tile),m={request:d,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=d,t.actor||(t.actor=this.dispatcher.getActor());const _=(x,b,E)=>{if(delete t.request,t.aborted)return t.state="unloaded",n(null);if(x)return x.name==="AbortError"?void 0:(t.state="errored",n(x));if(this.map._refreshExpiredTiles&&b){const I=o.aM(E);t.setExpiryData(I)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!b)return n(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=b}n(null)};t.request=this.partial?t.fetchHeader(void 0,_.bind(this)):t.actor.send("loadTile",m,_.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,n){const c=t.texturePerLayer;if(t.flushAllQueues(),c.size){t.destroy(!1);for(const d of c.values())this.map.painter.saveTileTexture(d)}else t.destroy()}prepareTile(t,n,c,d){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(n,c,d,(m,_)=>{if(m)return t.state="errored",this.fire(new o.y(m)),void this.triggerRepaint(t);_&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(c,_,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const n=this.rasterLayers.find(({id:m})=>m===t),c=n&&n.fields,d=c&&c.bands&&c.bands;return d?d[0]:0}getTextureDescriptor(t,n,c){if(!t)return;const d=n.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!d)return;let m=null;n instanceof o.aR?m=n.paint.get("raster-array-band"):n instanceof o.aS&&(m=n.paint.get("raster-particle-array-band"));const _=m||this.getInitialBand(d);if(_==null)return;if(!t.textureDescriptorPerLayer.get(n.id))return void this.prepareTile(t,d,n.id,_);if(t.updateNeeded(n.id,_)&&!c)return;const x=t.textureDescriptorPerLayer.get(n.id);return Object.assign({},x,{texture:t.texturePerLayer.get(n.id)})}getImages(t,n){const c=new Map;for(const d of t)for(const m of n){const[_,x]=m.split("/"),b=d.getLayer(_);if(!b||!b.hasBand(x)||!b.hasDataForBand(x))continue;const{bytes:E,tileSize:I,buffer:L}=b.getBandView(x),D=I+2*L,z={data:new o.q({width:D,height:D},E),pixelRatio:2,sdf:!1,usvg:!1,version:0};c.set(m,z)}return c}queryRasterArrayValueByBandId(t,n,c){const d=n._mrt;return new Promise(m=>{const _={},x=new Set;for(const[b,E]of Object.entries(d.layers)){if(c.layerName&&b!==c.layerName)continue;const I={};_[b]=I;for(const{bands:L}of E.dataIndex)for(const D of L)c.bands&&!c.bands.includes(D)||(x.add(o.B(b,D)),n.fetchBand(b,null,D,z=>{o.o.frame(()=>{I[D]=z?null:Vs([t.lng,t.lat],d,E.getBandView(D)),x.delete(o.B(b,D)),x.size===0&&m(_)})},!1))}x.size===0&&m(_)})}_loadTileForQuery(t,n){if(this._loadTileLoaded[t.uid])return void n(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(n);this._loadTilePending[t.uid]=[n];const c=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),d=this.map._requestManager.transformRequest(c,o.R.Tile);t.actor.send("loadTile",{request:d,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(m,_,x)=>{if(m)return this._loadTilePending[t.uid].forEach(b=>b(m,null)),void delete this._loadTilePending[t.uid];if(!_)return this._loadTilePending[t.uid].forEach(b=>b(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&_){const b=o.aM(x);t.setExpiryData(b)}t._mrt=_,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(b=>b(null,_)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,n,c){return new Promise((d,m)=>{this._loadTileForQuery(n,(_,x)=>{_?m(_):d(x?this.queryRasterArrayValueByBandId(t,n,c):null)})})}queryRasterArrayValue(t,n){const c=o.aT.convert(t),d=this.findLoadedParent(c);return d&&d._mrt?n.bands||!this.partial?this.queryRasterArrayValueByBandId(c,d,n):this.queryRasterArrayValueByAllBands(c,d,n):Promise.resolve(null)}findLoadedParent(t){const n=o.ae.fromLngLat(t,this.map.transform.tileSize),c=this.maxzoom+1,d=1<<c,m=Math.floor(n.x),_=Math.floor((n.x-m)*d),x=Math.floor(n.y*d),b=this.map.style.getSourceCache(this.id),E=new o.aQ(c,m,c,_,x);return b.findLoadedParent(E,this.minzoom)}}const Lo={vector:cl,raster:Vn,"raster-dem":class extends Vn{constructor(l,t,n,c){super(l,t,n,c),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function c(d,m){d&&(l.state="errored",t(d)),m&&(l.dem=m,l.dem.onDeserialize(),l.needsHillshadePrepare=!0,l.needsDEMTextureUpload=!0,l.state="loaded",t(null))}l.request=o.n(this.map._requestManager.transformRequest(n,o.R.Tile),(function(d,m,_){if(delete l.request,l.aborted)l.state="unloaded",t(null);else if(d)l.state="errored",t(d);else if(m){const x=o.aM(_);this.map._refreshExpiredTiles&&l.setExpiryData(x);const b=ImageBitmap&&m instanceof ImageBitmap&&o.r(),E=1-(m.width-o.aP(m.width))/2;E<1||l.neighboringTiles||(l.neighboringTiles=this._getNeighboringTiles(l.tileID));const I=b?m:o.o.getImageData(m,E),L={uid:l.uid,tileID:l.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:I,encoding:this.encoding,padding:E};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadTile",L,c.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(l){const t=l.canonical,n=Math.pow(2,t.z),c=(t.x-1+n)%n,d=t.x===0?l.wrap-1:l.wrap,m=(t.x+1+n)%n,_=t.x+1===n?l.wrap+1:l.wrap,x={};return x[new o.aQ(l.overscaledZ,d,t.z,c,t.y).key]={backfilled:!1},x[new o.aQ(l.overscaledZ,_,t.z,m,t.y).key]={backfilled:!1},t.y>0&&(x[new o.aQ(l.overscaledZ,d,t.z,c,t.y-1).key]={backfilled:!1},x[new o.aQ(l.overscaledZ,l.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},x[new o.aQ(l.overscaledZ,_,t.z,m,t.y-1).key]={backfilled:!1}),t.y+1<n&&(x[new o.aQ(l.overscaledZ,d,t.z,c,t.y+1).key]={backfilled:!1},x[new o.aQ(l.overscaledZ,l.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},x[new o.aQ(l.overscaledZ,_,t.z,m,t.y+1).key]={backfilled:!1}),x}},"raster-array":hs,geojson:class extends o.E{constructor(l,t,n,c){super(),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(c),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const d=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*d,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*d,extent:o.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*d,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(l){this.map=l,this.setData(this._data)}setData(l){return this._data=l,this._updateWorkerData(),this}updateData(l){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof l!="string"&&(l.type==="Feature"&&(l={type:"FeatureCollection",features:[l]}),l.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof l!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const n of this._data.features)t.set(n.id,n);for(const n of l.features)t.set(n.id,n);this._data.features=[...t.values()]}else this._data=l;return this._updateWorkerData(!0),this}getClusterExpansionZoom(l,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterChildren(l,t){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id,scope:this.scope},t),this}getClusterLeaves(l,t,n,c){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:l,limit:t,offset:n},c),this}_updateWorkerData(l=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:l},this.workerOptions);t.scope=this.scope;const n=this._data;typeof n=="string"?(t.request=this.map._requestManager.transformRequest(o.o.resolveURL(n),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(c,d)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new o.y(c));else{const m={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&d&&d.resourceTiming&&d.resourceTiming[this.id]&&(m.resourceTiming=d.resourceTiming[this.id]),l&&(this._partialReload=!0),this.fire(new o.z("data",m)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(l),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const l=o.B(this.id,this.scope);this.map.style.clearSource(l),this._updateWorkerData()}loadTile(l,t){const n=l.actor?"reloadTile":"loadTile";l.actor=this.actor;const c=this.map.style?this.map.style.getLut(this.scope):null,d=c?{image:c.image.clone()}:null,m=this._partialReload,_={type:this.type,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:d,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:l.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:m,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};l.request=this.actor.send(n,_,(x,b)=>m&&!b?(l.state="loaded",t(null)):(delete l.request,l.destroy(!1),l.aborted?t(null):x?t(x):(l.loadVectorData(b,this.map.painter,n==="reloadTile"),t(null))),void 0,n==="loadTile")}abortTile(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0}unloadTile(l,t){this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id,scope:this.scope}),l.destroy()}onRemove(l){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aU{constructor(l,t,n,c){super(l,t,n,c),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const l=this.options;this.urls=[];for(const t of l.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aV(this.urls,(t,n)=>{this._loaded=!0,t?this.fire(new o.y(t)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(l){if(this.video){const t=this.video.seekable;l<t.start(0)||l>t.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=l}}getVideo(){return this.video}onAdd(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const l=this.map.painter.context,t=l.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(l,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(l)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aU,model:o.aX,"batched-model":class extends o.E{constructor(l,t,n,c){super(),this.type="batched-model",this.id=l,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(c)}onAdd(l){this.map=l,this.load()}reload(){this.cancelTileJSONRequest();const l=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(l))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(l){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=Xn(this._options,this.map._requestManager,t,n,(c,d)=>{this._tileJSONRequest=null,this._loaded=!0,c?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new o.y(c))):d&&(Object.assign(this,d),d.bounds&&(this.tileBounds=new ws(d.bounds,this.minzoom,this.maxzoom)),Cr(d.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),l&&l(c)})}hasTransition(){return!1}hasTile(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)}loaded(){return this._loaded}loadTile(l,t){const n=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),c={request:this.map._requestManager.transformRequest(n,o.R.Tile),data:void 0,uid:l.uid,tileID:l.tileID,tileZoom:l.tileZoom,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:l.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(l.actor&&l.state!=="expired")if(l.state==="loading")l.reloadCallback=t;else{if(l.buckets){const m=Object.values(l.buckets);for(const _ of m)_.dirty=!0;return void(l.state="loaded")}l.request=l.actor.send("reloadTile",c,d.bind(this))}else l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",c,d.bind(this),void 0,!0);function d(m,_){return l.aborted?t(null):m&&m.status!==404?t(m):(this.map._refreshExpiredTiles&&_&&l.setExpiryData(_),l.loadModelData(_,this.map.painter),l.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aU{constructor(l,t,n,c){super(l,t,n,c),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(d=>!Array.isArray(d)||d.length!==2||d.some(m=>typeof m!="number"))||this.fire(new o.y(new o.V(`sources.${l}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${l}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${l}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${l}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${l}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()}onRemove(l){this.pause()}prepare(){let l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!l&&!this._playing||this.texture instanceof o.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const l of[this.canvas.width,this.canvas.height])if(isNaN(l)||l<=0)return!0;return!1}},custom:class extends o.E{constructor(l,t,n,c){super(),this.id=l,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=t,this.setEventedParent(c),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ws(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(l){this.map=l,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(l),this.load()}onRemove(l){this._implementation.onRemove&&this._implementation.onRemove(l)}hasTile(l){if(this._implementation.hasTile){const{x:t,y:n,z:c}=l.canonical;return this._implementation.hasTile({x:t,y:n,z:c})}return!this.tileBounds||this.tileBounds.contains(l.canonical)}loadTile(l,t){const{x:n,y:c,z:d}=l.tileID.canonical,m=new AbortController;l.request=Promise.resolve(this._implementation.loadTile({x:n,y:c,z:d},{signal:m.signal})).then((function(_){return delete l.request,l.aborted?(l.state="unloaded",t(null)):_===void 0?(l.state="errored",t(null)):_===null?(this.loadTileData(l,{width:this.tileSize,height:this.tileSize,data:null}),l.state="loaded",t(null)):function(x){return x instanceof ImageData||x instanceof HTMLCanvasElement||x instanceof ImageBitmap||x instanceof HTMLImageElement}(_)?(this.loadTileData(l,_),l.state="loaded",void t(null)):(l.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(_=>{_.name!=="AbortError"&&(l.state="errored",t(_))}),l.request.cancel=()=>m.abort()}loadTileData(l,t){l.setTexture(t,this.map.painter)}unloadTile(l,t){if(l.texture&&l.texture instanceof o.T?(l.destroy(!1),l.texture&&l.texture instanceof o.T&&this.map.painter.saveTileTexture(l.texture)):l.destroy(),this._implementation.unloadTile){const{x:n,y:c,z:d}=l.tileID.canonical;this._implementation.unloadTile({x:n,y:c,z:d})}t&&t()}abortTile(l,t){l.request&&l.request.cancel&&(l.request.cancel(),delete l.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(l=>({x:l.canonical.x,y:l.canonical.y,z:l.canonical.z}))}_clearTiles(){const l=o.B(this.id,this.scope);this.map.style.clearSource(l)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ln=function(l,t,n,c){const d=new Lo[t.type](l,t,n,c);if(d.id!==l)throw new Error(`Expected Source id to be ${l} instead of ${d.id}`);return o.aY(["load","abort","unload","serialize","prepare"],d),d};function ul(l,t,n=""){return`${n}:${t.id||""}:${t.layer.id}:${function(c){if("layerId"in c)return`layer:${c.layerId}`;{const{featuresetId:d,importId:m}=c;return`featureset:${d}${m?`:import:${m}`:""}`}}(l.target)}`}function jl(l,t,n,c=""){if(l.uniqueFeatureID){const d=ul(l,t,c);if(n.has(d))return!0;n.add(d)}return!1}function Bu(l,t,n,c,d=!1){const m=t.sourceCache.transform,_=t.sourceCache.tilesIn(l,t.has3DLayers,d);_.sort(zc);const x=[];for(const b of _){const E=b.tile.queryRenderedFeatures(t,b,n,c,m,d);Object.keys(E).length&&x.push({wrappedTileID:b.tile.tileID.wrapped().key,queryResults:E})}for(const b in t.layers){const E=t.layers[b];if(E.styleLayer){const I=E.styleLayer.queryRenderedFeatures(l,t.sourceCache,c);Object.keys(I).length&&x.push({wrappedTileID:0,queryResults:I})}}return x.length===0?{}:function(b){const E={},I={};for(const L of b){const D=L.queryResults,z=L.wrappedTileID,B=I[z]=I[z]||{};for(const F in D){const H=D[F],G=B[F]=B[F]||{},Z=E[F]=E[F]||[];for(const Y of H)G[Y.featureIndex]||(G[Y.featureIndex]=!0,Z.push(Y))}}return E}(x)}function Nu(l,t,n,c,d,m){const _={},x=c.queryRenderedSymbols(l),b=[];for(const E of Object.keys(x).map(Number))b.push(d[E]);b.sort(zc);for(const E of b){const I=E.featureIndex.lookupSymbolFeatures(x[E.bucketInstanceId],E.bucketIndex,E.sourceLayerIndex,t,n,m);for(const L in I){const D=_[L]=_[L]||[],z=I[L];z.sort((B,F)=>{const H=E.featureSortOrder;if(H){const G=H.indexOf(B.featureIndex);return H.indexOf(F.featureIndex)-G}return F.featureIndex-B.featureIndex});for(const B of z)D.push(B)}}return _}function Vu(l,t){const n=l.getRenderableIds().map(m=>l.getTileByID(m)),c=[],d={};for(let m=0;m<n.length;m++){const _=n[m],x=_.tileID.canonical.key;d[x]||(d[x]=!0,_.querySourceFeatures(c,t))}return c}function zc(l,t){const n=l.tileID,c=t.tileID;return n.overscaledZ-c.overscaledZ||n.canonical.y-c.canonical.y||n.wrap-c.wrap||n.canonical.x-c.canonical.x}function zo(l,t){const n={};if(!t)return n;for(const c of l){const d=c.layerIds.map(m=>t.getLayer(m)).filter(Boolean);if(d.length!==0){c.layers=d,c.stateDependentLayerIds&&(c.stateDependentLayers=c.stateDependentLayerIds.map(m=>d.filter(_=>_.id===m)[0]));for(const m of d)n[m.fqid]=c}}return n}const Ts=32,yo=33,xo=new Uint16Array(8184);for(let l=0;l<2046;l++){let t=l+2,n=0,c=0,d=0,m=0,_=0,x=0;for(1&t?d=m=_=Ts:n=c=x=Ts;(t>>=1)>1;){const E=n+d>>1,I=c+m>>1;1&t?(d=n,m=c,n=_,c=x):(n=d,c=m,d=_,m=x),_=E,x=I}const b=4*l;xo[b+0]=n,xo[b+1]=c,xo[b+2]=d,xo[b+3]=m}const Js=new Uint16Array(2178),Oo=new Uint8Array(1089),Ma=new Uint16Array(1089);function hl(l){return l===0?-.03125:l===32?.03125:0}const Uu={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class dl{constructor(t,n,c,d,m,_){this.tileID=t,this.uid=o.b2(),this.uses=0,this.tileSize=n,this.tileZoom=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,d&&d.style&&(this._lastUpdatedBrightness=d.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",d&&d.transform&&(this.projection=d.transform.projection),this.worldview=_,this._hasAppearances=null}registerFadeDuration(t){const n=t+this.timeAdded;n<o.o.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,n,c){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=zo(t.buckets,n.style),this.hasSymbolBuckets=!1;for(const d in this.buckets){const m=this.buckets[d];if(m instanceof o.b4){if(this.hasSymbolBuckets=!0,!c)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const d in this.buckets){const m=this.buckets[d];if(m instanceof o.b4&&m.hasRTLText){this.hasRTLText=!0,o.b5();break}}this.queryPadding=0;for(const d in this.buckets){const m=this.buckets[d],_=n.style.getOwnLayer(d);if(!_)continue;const x=_.queryRadius(m);this.queryPadding=Math.max(this.queryPadding,x)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,n,c){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,zo(t.buckets,n.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,n){for(const m in this.buckets){const _=this.buckets[m];if(_.uploadPending()){let x={},b=[],E={zoom:0,pitch:0,brightness:0,worldview:""};if(n){if(n.style){b=n.style.listImages();const I=_.layers[0],L=I.sourceLayer||"_geojsonTileLayer",D=n.style.getLayerSourceCache(I);D&&(x=D._state.getState(L,void 0))}E={zoom:n.transform.zoom||0,pitch:n.transform.pitch||0,brightness:n.style.getBrightness()||0,worldview:n.worldview||""}}_.upload(t,this.tileID.canonical,x,b,E)}}const c=t.gl,d=this.imageAtlas;d&&!d.uploaded&&(this.imageAtlasTexture=new o.T(t,d.image,c.RGBA8,{useMipmap:!!d.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(t,n,c){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,c),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const d=n.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(n)),(this._lastUpdatedBrightness||d||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&d&&Math.abs(this._lastUpdatedBrightness-d)<.001||(this.updateBuckets(n,this._lastUpdatedBrightness!==d),this._lastUpdatedBrightness=d))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const n in this.buckets){const c=this.buckets[n];c.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,c.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,n,c,d,m,_){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const x=this.evaluateQueryRenderedFeaturePadding(),b=function(E,I){const L=o.bq([],[.5*E.width,.5*-E.height,1]);return o.br(L,L,[1,-1,0]),o.aB(L,L,E.calculateProjMatrix(I.toUnwrapped())),Float32Array.from(L)}(m,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:n,pixelPosMatrix:b,transform:d,availableImages:c,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:x})}querySourceFeatures(t,n){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const d=c.loadVTLayers(),m=n?n.sourceLayer:"",_=d._geojsonTileLayer||d[m];if(!_)return;const x=o.b6(n&&n.filter),{z:b,x:E,y:I}=this.tileID.canonical,L={z:b,x:E,y:I};for(let D=0;D<_.length;D++){const z=_.feature(D);if(x.needGeometry){const H=o.b7(z,!0);if(!x.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),H,this.tileID.canonical))continue}else if(!x.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),z))continue;const B=c.getId(z,m),F=new o.b8(z,b,E,I,B);F.tile=L,t.push(F)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const n=this.expirationTime;if(t.cacheControl){const c=o.b9(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let d=!1;if(this.expirationTime>c)d=!1;else if(n)if(this.expirationTime<n)d=!0;else{const m=this.expirationTime-n;m?this.expirationTime=c+Math.max(m,3e4):d=!0}else d=!0;d?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const n in this.buckets)if(t.style.hasLayer(n)&&this.buckets[n].layers.some(c=>c.appearances&&c.appearances.length>0))return!0;return!1}updateBuckets(t,n){if(!this.latestFeatureIndex||!t.style)return;const c=t.style.listImages(),d=t.style.getBrightness();for(const m in this.buckets){if(!t.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0],b=x.sourceLayer||"_geojsonTileLayer",E=t.style.getLayerSourceCache(x);let I={};E&&(I=E._state.getState(b,void 0));const L=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},D=Object.keys(I).length>0&&!n;_.hasAppearances=_.layers.some(F=>F.appearances&&F.appearances.length>0);const z=D?_.stateDependentLayers:_.layers;if(D&&_.stateDependentLayers.length!==0||n){const F=this.latestFeatureIndex.loadVTLayers();_.update(I,F[b],c,L,z,n,d)}if(D&&_.stateDependentLayers.length!==0||n||_.hasAppearances){const F={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};_.updateAppearances(this.tileID.canonical,I,c,F)}(_ instanceof o.ba||_ instanceof o.bb)&&t._terrain&&t._terrain.enabled&&E&&_.uploadPending()&&t._terrain._clearRenderCacheForTile(E.id,this.tileID);const B=t&&t.style&&t.style.getOwnLayer(m);B&&(this.queryPadding=Math.max(this.queryPadding,B.queryRadius(_)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.o.now()+t}setTexture(t,n){const c=n.context,d=c.gl;this.texture=this.texture||n.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(c,t,d.RGBA8,{useMipmap:!0}),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE))}setDependencies(t,n){const c={};for(const d of n)c[d]=!0;this.dependencies[t]=c}hasDependency(t,n){for(const c of t){const d=this.dependencies[c];if(d){for(const m of n)if(d[m])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;const c=o.bc(Uu,this.tileID.canonical,this.tileTransform)[0],d=new o.bd,m=new o.be;for(let _=0;_<c.length;_++){const{x,y:b}=c[_];d.emplaceBack(x,b),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(m),this._tileDebugBuffer=t.createVertexBuffer(d,o.bf.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,d.length,m.length)}_makeTileBoundsBuffers(t,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;const c=o.bc(Uu,this.tileID.canonical,this.tileTransform)[0];let d,m;if(this.isRaster){const _=function(x,b){const E=o.aZ(x,b),I=Math.pow(2,x.z);for(let H=0;H<yo;H++)for(let G=0;G<yo;G++){const Z=o.a_((x.x+(G+hl(G))/Ts)/I),Y=o.a$((x.y+(H+hl(H))/Ts)/I),X=b.project(Z,Y),ce=H*yo+G;Js[2*ce+0]=Math.round((X.x*E.scale-E.x)*o.al),Js[2*ce+1]=Math.round((X.y*E.scale-E.y)*o.al)}Oo.fill(0),Ma.fill(0);for(let H=2045;H>=0;H--){const G=4*H,Z=xo[G+0],Y=xo[G+1],X=xo[G+2],ce=xo[G+3],ne=Z+X>>1,ae=Y+ce>>1,re=ne+ae-Y,ee=ae+Z-ne,ue=Y*yo+Z,be=ce*yo+X,xe=ae*yo+ne,De=Math.hypot((Js[2*ue+0]+Js[2*be+0])/2-Js[2*xe+0],(Js[2*ue+1]+Js[2*be+1])/2-Js[2*xe+1])>=16;Oo[xe]=Oo[xe]||(De?1:0),H<1022&&(Oo[xe]=Oo[xe]||Oo[(Y+ee>>1)*yo+(Z+re>>1)]||Oo[(ce+ee>>1)*yo+(X+re>>1)])}const L=new o.b1,D=new o.b0;let z=0;function B(H,G){const Z=G*yo+H;return Ma[Z]===0&&(L.emplaceBack(Js[2*Z+0],Js[2*Z+1],H*o.al/Ts,G*o.al/Ts),Ma[Z]=++z),Ma[Z]-1}function F(H,G,Z,Y,X,ce){const ne=H+Z>>1,ae=G+Y>>1;if(Math.abs(H-X)+Math.abs(G-ce)>1&&Oo[ae*yo+ne])F(X,ce,H,G,ne,ae),F(Z,Y,X,ce,ne,ae);else{const re=B(H,G),ee=B(Z,Y),ue=B(X,ce);D.emplaceBack(re,ee,ue)}}return F(0,0,Ts,Ts,Ts,0),F(Ts,Ts,0,0,0,Ts),{vertices:L,indices:D}}(this.tileID.canonical,n);d=_.vertices,m=_.indices}else{d=new o.b1,m=new o.b0;for(const{x,y:b}of c)d.emplaceBack(x,b,0,0);const _=o.bh(d.int16.subarray(0,4*d.length),void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=t.createVertexBuffer(d,o.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(m),this._tileBoundsSegments=o.bg.simpleSegment(0,0,d.length,m.length)}_makeGlobeTileDebugBuffers(t,n){const c=n.projection;if(!c||c.name!=="globe"||n.freezeTileCoverage)return;const d=this.tileID.canonical,m=o.bj(d,n),_=o.bk(m),x=o.aj(n.zoom);let b;x>0&&(b=o.bl(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,d,n,_,b,x),this._makeGlobeTileDebugTextBuffer(t,d,n,_,b,x)}_globePoint(t,n,c,d,m,_,x){let b=o.bm(t,n,c);if(_){const E=1<<c.z,I=o.aF(d.center.lng),L=o.aJ(d.center.lat),D=(c.x+.5)/E-I;let z=0;D>.5?z=-1:D<-.5&&(z=1);let B=(t/o.al+c.x)/E+z,F=(n/o.al+c.y)/E;B=(B-I)*d._pixelsPerMercatorPixel+I,F=(F-L)*d._pixelsPerMercatorPixel+L;const H=[B*d.worldSize,F*d.worldSize,0];o.af(H,H,_),b=o.bn(b,H,x)}return o.af(b,b,m)}_makeGlobeTileDebugBorderBuffer(t,n,c,d,m,_){const x=new o.bd,b=new o.be,E=new o.bo,I=(D,z,B,F,H)=>{const G=(B-D)/(H-1),Z=(F-z)/(H-1),Y=x.length;for(let X=0;X<H;X++){const ce=D+X*G,ne=z+X*Z;x.emplaceBack(ce,ne);const ae=this._globePoint(ce,ne,n,c,d,m,_);E.emplaceBack(ae[0],ae[1],ae[2]),b.emplaceBack(Y+X)}},L=o.al;I(0,0,L,0,16),I(L,0,L,L,16),I(L,L,0,L,16),I(0,L,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(b),this._tileDebugBuffer=t.createVertexBuffer(x,o.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(E,o.bp.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,x.length,b.length)}_makeGlobeTileDebugTextBuffer(t,n,c,d,m,_){const x=o.al/4,b=new o.bd,E=new o.b0,I=new o.bo,L=25;E.reserve(32),b.reserve(L),I.reserve(L);const D=(z,B)=>L*z+B;for(let z=0;z<L;z++){const B=z*x;for(let F=0;F<L;F++){const H=F*x;b.emplaceBack(H,B);const G=this._globePoint(H,B,n,c,d,m,_);I.emplaceBack(G[0],G[1],G[2])}}for(let z=0;z<4;z++)for(let B=0;B<4;B++){const F=D(z,B),H=D(z,B+1),G=D(z+1,B),Z=D(z+1,B+1);E.emplaceBack(F,H,G),E.emplaceBack(G,H,Z)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(E),this._tileDebugTextBuffer=t.createVertexBuffer(b,o.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(I,o.bp.members),this._tileDebugTextSegments=o.bg.simpleSegment(0,0,L,32)}destroy(t=!0){for(const n in this.buckets)this.buckets[n].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof o.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bs.setPbf(o.bt);class ju extends dl{constructor(t,n,c,d,m){super(t,n,c,d,m),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,n,c){const d=c.context,m=d.gl;let _=this.texturePerLayer.get(t)||c.getTileTexture(n.width);_&&_ instanceof o.T?_.update(n,{premultiply:!1}):_=new o.T(d,n,m.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,_)}flushQueues(t){const n=this._workQueuePerLayer.get(t)||[],c=this._fetchQueuePerLayer.get(t)||[];for(;n.length;)n.pop()();for(;c.length;)c.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const n=this._workQueuePerLayer.get(t)||[];for(;n.length;)n.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const n=this._fetchQueuePerLayer.get(t)||[];for(;n.length;)n.pop()()}}fetchHeader(t=16384,n){const c=this._mrt=new o.bs(30),d=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.bu(d,(m,_,x)=>{if(m)n(m);else try{const b=c.getHeaderLength(_);if(b>t)return void(this.request=this.fetchHeader(b,n));c.parseHeader(_),this._isHeaderLoaded=!0;let E=0;for(const I of Object.values(c.layers))E=Math.max(E,I.dataIndex[I.dataIndex.length-1].lastByte);_.byteLength>=E&&(this.entireBuffer=_),n(null,this.entireBuffer||_,x)}catch(b){n(b)}}),this.request}fetchBandForRender(t,n,c,d){this.fetchBand(t,n,c,m=>{if(m)return void d(m);this.updateTextureDescriptor(t,n,c);const _=this.textureDescriptorPerLayer.get(n);d(null,_?_.img:null)})}fetchBand(t,n,c,d,m=!0){const _=this._mrt;if(!this._isHeaderLoaded||!_)return void d(new Error("Tile header is not ready"));const x=this.actor;if(!x)return void d(new Error("Can't fetch tile band without an actor"));let b;const E=o.B(String(c),o.B(this.tileID.key,t));let I=this._taskQueue.get(E);I?I.add(d):(I=new Set,I.add(d),this._taskQueue.set(E,I));const L=(F,H)=>{b.complete(F,H),F?d(F):(I.forEach(G=>G(null,H)),this._taskQueue.delete(E))},D=(F,H)=>{if(F)return d(F);const G=x.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:H,task:b},L,void 0,!0);if(n!==null){const Z=this._workQueuePerLayer.get(n)||[];Z.push(()=>{G&&G.cancel(),b.cancel()}),this._workQueuePerLayer.has(n)||this._workQueuePerLayer.set(n,Z)}};let z;try{z=_.getLayer(t)}catch(F){if(this.state==="reloading")return;throw F}if(!z)return void d(new Error(`Unknown sourceLayer "${t}"`));if(z.hasDataForBand(c))return I.forEach(F=>F(null,null)),void this._taskQueue.delete(E);const B=z.getDataRange([c]);if(b=_.createDecodingTask(B),!b||b.tasks.length)if(n!==null&&this.flushQueues(n),this.entireBuffer)D(null,this.entireBuffer.slice(B.firstByte,B.lastByte+1));else{const F=Object.assign({},this.requestParams,{headers:{Range:`bytes=${B.firstByte}-${B.lastByte}`}}),H=o.bu(F,D);if(n!==null){const G=this._fetchQueuePerLayer.get(n)||[];G.push(()=>{H.cancel(),b.cancel()}),this._fetchQueuePerLayer.has(n)||this._fetchQueuePerLayer.set(n,G)}}}updateNeeded(t,n){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==n||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,n,c){if(!this._mrt)return;const d=this._mrt.getLayer(t);if(!d||!d.hasBand(c)||!d.hasDataForBand(c))return;const{bytes:m,tileSize:_,buffer:x,offset:b,scale:E}=d.getBandView(c),I=_+2*x,L=new o.q({width:I,height:I},m),D=this.texturePerLayer.get(n);D&&D instanceof o.T&&D.update(L,{premultiply:!1}),this.textureDescriptorPerLayer.set(n,{layer:t,band:c,img:L,buffer:x,offset:b,tileSize:_,format:d.pixelFormat,mix:[E,256*E,65536*E,16777216*E]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const n of this.texturePerLayer.values())n&&n instanceof o.T&&n.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class um{constructor(t,n){this.max=t,this.onRemove=n,this.reset()}reset(){for(const t in this.data)for(const n of this.data[t])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(t,n,c){const d=t.wrapped().key;this.data[d]===void 0&&(this.data[d]=[]);const m={value:n,timeout:void 0};if(c!==void 0&&(m.timeout=setTimeout(()=>{this.remove(t,m)},c)),this.data[d].push(m),this.order.push(d),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const n=this.data[t].shift();return n.timeout&&clearTimeout(n.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),n.value}getByKey(t){const n=this.data[t];return n?n[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,n){if(!this.has(t))return this;const c=t.wrapped().key,d=n===void 0?0:this.data[c].indexOf(n),m=this.data[c][d];return this.data[c].splice(d,1),m.timeout&&clearTimeout(m.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(m.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(t){const n=[];for(const c in this.data)for(const d of this.data[c])t(d.value)||n.push(d);for(const c of n)this.remove(c.value.tileID,c)}}class Oc{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,n,c){const d=String(n);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][d]=this.stateChanges[t][d]||{},Object.assign(this.stateChanges[t][d],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const m in this.state[t])m!==d&&(this.deletedStates[t][m]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][d]===null){this.deletedStates[t][d]={};for(const m in this.state[t][d])c[m]||(this.deletedStates[t][d][m]=null)}else for(const m in c)this.deletedStates[t]&&this.deletedStates[t][d]&&this.deletedStates[t][d][m]===null&&delete this.deletedStates[t][d][m]}removeFeatureState(t,n,c){if(this.deletedStates[t]===null)return;const d=String(n);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&n!==void 0)this.deletedStates[t][d]!==null&&(this.deletedStates[t][d]=this.deletedStates[t][d]||{},this.deletedStates[t][d][c]=null);else if(n!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][d])for(c in this.deletedStates[t][d]={},this.stateChanges[t][d])this.deletedStates[t][d][c]=null;else this.deletedStates[t][d]=null;else this.deletedStates[t]=null}getState(t,n){const c=this.state[t]||{},d=this.stateChanges[t]||{},m=this.deletedStates[t];if(m===null)return{};if(n!==void 0){const x=String(n),b=Object.assign({},c[x],d[x]);if(m){const E=m[n];if(E===null)return{};for(const I in E)delete b[I]}return b}const _=Object.assign({},c,d);if(m)for(const x in m)delete _[x];return _}initializeTileState(t,n){t.refreshFeatureState(n)}coalesceChanges(t,n){const c={};for(const d in this.stateChanges){this.state[d]=this.state[d]||{};const m={};for(const _ in this.stateChanges[d])this.state[d][_]||(this.state[d][_]={}),Object.assign(this.state[d][_],this.stateChanges[d][_]),m[_]=this.state[d][_];c[d]=m}for(const d in this.deletedStates){this.state[d]=this.state[d]||{};const m={};if(this.deletedStates[d]===null)for(const _ in this.state[d])m[_]={},this.state[d][_]={};else for(const _ in this.deletedStates[d]){if(this.deletedStates[d][_]===null)this.state[d][_]={};else if(this.state[d][_])for(const x of Object.keys(this.deletedStates[d][_]))delete this.state[d][_][x];m[_]=this.state[d][_]}c[d]=c[d]||{},Object.assign(c[d],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const d in t)t[d].refreshFeatureState(n)}}class Ds extends o.E{constructor(t,n,c){super(),this.id=t,this._onlySymbols=c,n.on("data",d=>{d.dataType==="source"&&d.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&d.dataType==="source"&&d.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new um(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Oc,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,n){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,n)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const c=this._tiles[n];c.upload(t,this.map?this.map.painter:void 0),c.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Gu).map(t=>t.key)}getRenderableIds(t,n){const c=[];for(const d in this._tiles)this._isIdRenderable(+d,t,n)&&c.push(this._tiles[d]);return t?c.sort((d,m)=>{const _=d.tileID,x=m.tileID,b=new o.P(_.canonical.x,_.canonical.y)._rotate(this.transform.angle),E=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return _.overscaledZ-x.overscaledZ||E.y-b.y||E.x-b.x}).map(d=>d.tileID.key):c.map(d=>d.tileID).sort(Gu).map(d=>d.key)}hasRenderableParent(t){const n=this.findLoadedParent(t,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(t,n,c){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(n||!this._tiles[t].holdingForFade())&&(c||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,n){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=n),this._loadTile(c,this._tileLoaded.bind(this,c,t,n)))}_tileLoaded(t,n,c,d,m){if(d){if(t.state="errored",d.status!==404)this._source.fire(new o.y(d,{tile:t}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const x=this.map.painter.terrain;this.update(this.transform,x.getScaledDemTileSize(),!0),x.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=o.o.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(n,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let _=new Map;m&&m.responseHeaders&&(_=m.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:_}))}_backfillDEM(t){const n=this.getRenderableIds();for(let d=0;d<n.length;d++){const m=n[d];if(t.neighboringTiles&&t.neighboringTiles[m]){const _=this.getTileByID(m);c(t,_),c(_,t)}}function c(d,m){if(!d.dem||d.dem.borderReady)return;d.needsHillshadePrepare=!0,d.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-d.tileID.canonical.x;const x=m.tileID.canonical.y-d.tileID.canonical.y,b=Math.pow(2,d.tileID.canonical.z),E=m.tileID.key;_===0&&x===0||Math.abs(x)>1||(Math.abs(_)>1&&(Math.abs(_+b)===1?_+=b:Math.abs(_-b)===1&&(_-=b)),m.dem&&d.dem&&(d.dem.backfillBorder(m.dem,_,x),d.neighboringTiles&&d.neighboringTiles[E]&&(d.neighboringTiles[E].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,n,c,d){for(const m in this._tiles){let _=this._tiles[m];if(d[m]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>c)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const E=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[E.key],_&&_.hasData()&&(x=E)}let b=x;for(;b.overscaledZ>n;)if(b=b.scaledTo(b.overscaledZ-1),t[b.key]){d[x.key]=x;break}}}findLoadedParent(t,n){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=n?c:null}for(let c=t.overscaledZ-1;c>=n;c--){const d=t.scaledTo(c),m=this._getLoadedTile(d);if(m)return m}}_getLoadedTile(t){const n=this._tiles[t.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,n){n=n||this._source.tileSize;const c=Math.ceil(t.width/n)+1,d=Math.ceil(t.height/n)+1,m=Math.floor(c*d*5),_=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,m):m,x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(t){const n=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,n){const c={};for(const d in this._tiles){const m=this._tiles[d];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+n),c[m.tileID.key]=m}this._tiles=c;for(const d in this._timers)clearTimeout(this._timers[d]),delete this._timers[d];for(const d in this._tiles)this._setTileReloadTimer(+d,this._tiles[d])}}update(t,n,c,d,m){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!c)return;this.updateCacheSize(t,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const _=this._source.type==="batched-model";let x,b=this._source.maxzoom;const E=this.map&&this.map.painter?this.map.painter._terrain:null;if(E&&E.sourceCache===this&&E.attenuationRange()){const D=E.attenuationRange()[0],z=Math.floor(D)-Math.log2(E.getDemUpscale());b>z&&(b=z)}if(this.used||this.usedForTerrain){if(this._source.tileID)x=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(D=>new o.aQ(D.canonical.z,D.wrap,D.canonical.z,D.canonical.x,D.canonical.y));else if(this.tileCoverLift!==0){const D=t.clone();D.tileCoverLift=this.tileCoverLift,x=D.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:b,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.minzoom<=1&&t.projection.name==="globe"&&(x.push(new o.aQ(1,0,1,0,0)),x.push(new o.aQ(1,0,1,1,0)),x.push(new o.aQ(1,0,1,0,1)),x.push(new o.aQ(1,0,1,1,1)))}else if(x=t.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:b,roundZoom:this._source.roundZoom&&!c,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:_}),this._source.hasTile){const D=this._source.hasTile.bind(this._source);x=x.filter(z=>D(z))}}else x=[];if(x.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!fl(this._source.type)){const D=t.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!c}),z=Math.min(D,this._source.maxzoom);if(_){const B=t.extendTileCover(x,z);for(const F of B)x.push(F)}else if(m){const B=t.extendTileCoverToNearPlane(x,this.transform.getFrustum(z),z);for(const F of B)x.push(F)}else if(this.castsShadows&&d){const B=t.extendTileCover(x,z,d,16);for(const F of B)this._shadowCasterTiles[F.key]=!0,x.push(F)}}const I=this._updateRetainedTiles(x);if(fl(this._source.type)&&x.length!==0){const D={},z={},B=Object.keys(I);for(const H of B){const G=I[H],Z=this._tiles[H];if(!Z||Z.fadeEndTime&&Z.fadeEndTime<=o.o.now())continue;const Y=this.findLoadedParent(G,Math.max(G.overscaledZ-Ds.maxOverzooming,this._source.minzoom));Y&&(this._addTile(Y.tileID),D[Y.tileID.key]=Y.tileID),z[H]=G}const F=x[x.length-1].overscaledZ;for(const H in this._tiles){const G=this._tiles[H];if(I[H]||!G.hasData())continue;let Z=G.tileID;for(;Z.overscaledZ>F;){Z=Z.scaledTo(Z.overscaledZ-1);const Y=this._tiles[Z.key];if(Y&&Y.hasData()&&z[Z.key]){I[H]=G.tileID;break}}}for(const H in D)I[H]||(this._coveredTiles[H]=!0,I[H]=D[H])}for(const D in I)this._tiles[D].clearFadeHold();const L=o.bv(this._tiles,I);for(const D of L){const z=this._tiles[D];z.hasSymbolBuckets&&!z.holdingForFade()?z.setHoldDuration(this.map._fadeDuration):z.hasSymbolBuckets&&!z.symbolFadeFinished()||this._removeTile(+D)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const n={};if(t.length===0)return n;const c={},d=t.reduce((E,I)=>Math.min(E,I.overscaledZ),1/0),m=t[0].overscaledZ,_=Math.max(m-Ds.maxOverzooming,this._source.minzoom),x=Math.max(m+Ds.maxUnderzooming,this._source.minzoom),b={};for(const E of t){const I=this._addTile(E);n[E.key]=E,I.hasData()||d<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,d,x,n);for(const E of t){let I=this._tiles[E.key];if(I.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],z=this.getTile(D);if(z&&z.hasData()){n[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(n[D[0].key]&&n[D[1].key]&&n[D[2].key]&&n[D[3].key])continue}let L=I.wasRequested();for(let D=E.overscaledZ-1;D>=_;--D){const z=E.scaledTo(D);if(c[z.key]||(c[z.key]=!0,I=this.getTile(z),!I&&L&&(I=this._addTile(z)),I&&(n[z.key]=z,L=I.wasRequested(),I.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const n=[];let c,d=this._tiles[t].tileID;for(;d.overscaledZ>0;){if(d.key in this._loadedParentTiles){c=this._loadedParentTiles[d.key];break}n.push(d.key);const m=d.scaledTo(d.overscaledZ-1);if(c=this._getLoadedTile(m),c)break;d=m}for(const m of n)this._loadedParentTiles[m]=c}}_addTile(t){let n=this._tiles[t.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),n;n=this._cache.getAndRemove(t),n&&(this._setTileReloadTimer(t.key,n),n.tileID=t,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,n)));const c=!!n;if(!c){const d=this.map?this.map.painter:null,m=this._source.tileSize*t.overscaleFactor();n=this._source.type==="raster-array"?new ju(t,m,this.transform.tileZoom,d,this._isRaster):new dl(t,m,this.transform.tileZoom,d,this._isRaster,this._source.worldview),this._loadTile(n,this._tileLoaded.bind(this,n,t.key,n.state))}return n.uses++,this._tiles[t.key]=n,c||this._source.fire(new o.z("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n}_setTileReloadTimer(t,n){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=n.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const n=this._tiles[t];n&&(n.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),n.uses>0||(n.hasData()&&n.state!=="reloading"||n.state==="empty"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,n,c){const d=[],m=this.transform;if(!m)return d;const _=m.projection.name==="globe",x=o.aF(m.center.lng);for(const b in this._tiles){const E=this._tiles[b];if(c&&E.clearQueryDebugViz(),E.holdingForFade())continue;let I;if(_){const L=E.tileID.canonical;if(L.z===0){const D=[Math.abs(o.aA(x,...ta(L,-1))-x),Math.abs(o.aA(x,...ta(L,1))-x)];I=[0,2*D.indexOf(Math.min(...D))-1]}else{const D=[Math.abs(o.aA(x,...ta(L,-1))-x),Math.abs(o.aA(x,...ta(L,0))-x),Math.abs(o.aA(x,...ta(L,1))-x)];I=[D.indexOf(Math.min(...D))-1]}}else I=[0];for(const L of I){const D=t.containsTile(E,m,n,L);D&&d.push(D)}}return d}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,n){const c=this.getRenderableIds(t,n).map(m=>this._tiles[m].tileID),d=this.transform.projection.name==="globe";for(const m of c)m.projMatrix=this.transform.calculateProjMatrix(m.toUnwrapped()),m.expandedProjMatrix=d?this.transform.calculateProjMatrix(m.toUnwrapped(),!1,!0):m.projMatrix;return c}sortCoordinatesByDistance(t){const n=t.slice(),c=this.transform._camera.position,d=this.transform._camera.forward(),m={};for(const _ of n){const x=1/(1<<_.canonical.z);m[_.key]=((_.canonical.x+.5)*x+_.wrap-c[0])*d[0]+((_.canonical.y+.5)*x-c[1])*d[1]-c[2]*d[2]}return n.sort((_,x)=>m[_.key]-m[x.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(fl(this._source.type))for(const t in this._tiles){const n=this._tiles[t];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(t,n,c){this._state.updateState(t=t||"_geojsonTileLayer",n,c)}removeFeatureState(t,n,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",n,c)}getFeatureState(t,n){return this._state.getState(t=t||"_geojsonTileLayer",n)}setDependencies(t,n,c){const d=this._tiles[t];d&&d.setDependencies(n,c)}reloadTilesForDependencies(t,n){for(const c in this._tiles)this._tiles[c].hasDependency(t,n)&&this._reloadTile(+c,"reloading");this._cache.filter(c=>!c.hasDependency(t,n))}_preloadTiles(t,n){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(t,n))};return void this._source.on("data",b)}const c=new Map,d=Array.isArray(t)?t:[t],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const b of d){const E=b.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const I of E)c.set(I.key,I);this.usedForTerrain&&b.updateElevation(!1)}const x=Array.from(c.values());o.bw(x,(b,E)=>{const I=new dl(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(I,L=>{this._source.type==="raster-dem"&&I.dem&&this._backfillDEM(I),E(L,I)})},n)}}function Gu(l,t){const n=Math.abs(2*l.wrap)-+(l.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return l.overscaledZ-t.overscaledZ||c-n||t.canonical.y-l.canonical.y||t.canonical.x-l.canonical.x}function fl(l){return l==="raster"||l==="image"||l==="video"||l==="custom"}function ta(l,t){const n=1<<l.z;return[l.x/n+t,(l.x+1)/n+t]}Ds.maxOverzooming=10,Ds.maxUnderzooming=3;class ty{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,n=!1;for(const c in this.style._mergedLayers){const d=this.style._mergedLayers[c];if(d.type==="fill-extrusion"||d.type==="building")this.layers.push({layer:d,visible:t,visibilityChanged:n});else if(d.type==="model"){const m=this.style.getLayerSource(d);m&&m.type==="batched-model"&&this.layers.push({layer:d,visible:t,visibilityChanged:n})}}}onNewFrame(t){this.layersGotHidden=!1;for(const n of this.layers){const c=n.layer;let d=!1;c.type==="fill-extrusion"?d=!c.isHidden(t)&&c.paint.get("fill-extrusion-opacity")>0:c.type==="building"?d=!c.isHidden(t)&&c.paint.get("building-opacity")>0:c.type==="model"&&(d=!c.isHidden(t)&&c.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!d&&n.visible,n.visible=d}}updateZOffset(t,n){this.currentBuildingBuckets=[];for(const d of this.layers){const m=d.layer,_=this.style.getLayerSourceCache(m);let x=1;m.type==="fill-extrusion"?x=d.visible?m.paint.get("fill-extrusion-vertical-scale"):0:m.type==="building"&&(x=d.visible?m.paint.get("building-vertical-scale"):0);let b=_?_.getTile(n):null;if(!b&&_)for(const E in _._tiles){const I=_._tiles[E];if(n.canonical.isChildOf(I.tileID.canonical)){b=I;break}}this.currentBuildingBuckets.push({bucket:b?b.getBucket(m):null,tileID:b?b.tileID:n,verticalScale:x})}t.hasAnyZOffset=!1;let c=!1;for(let d=0;d<t.symbolInstances.length;d++){const m=t.symbolInstances.get(d),_=m.zOffset,x=this._getHeightAtTileOffset(n,m.tileAnchorX,m.tileAnchorY);m.zOffset=x!==Number.NEGATIVE_INFINITY?x:_,c||_===m.zOffset||(c=!0),t.hasAnyZOffset||m.zOffset===0||(t.hasAnyZOffset=!0)}c&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,n,c,d){let m=n,_=c;if(t.canonical.z!==d.canonical.z){const x=d.canonical,b=1/(1<<t.canonical.z-x.z);m=(n+t.canonical.x*o.al)*b-x.x*o.al|0,_=(c+t.canonical.y*o.al)*b-x.y*o.al|0}return{tileX:m,tileY:_}}_getHeightAtTileOffset(t,n,c){let d,m;for(let _=0;_<this.layers.length;++_){const x=this.layers[_].layer;if(x.type!=="fill-extrusion"&&x.type!=="building")continue;const{bucket:b,tileID:E,verticalScale:I}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:L,tileY:D}=this._mapCoordToOverlappingTile(t,n,c,E),z=b.getHeightAtTileCoord(L,D);z&&z.height!==void 0&&(z.hidden?d=z.height:m=Math.max(z.height*I,m||0))}if(m!==void 0)return m;for(let _=0;_<this.layers.length;++_){const x=this.layers[_];if(x.layer.type!=="model"||!x.visible)continue;const{bucket:b,tileID:E}=this.currentBuildingBuckets[_];if(!b)continue;const{tileX:I,tileY:L}=this._mapCoordToOverlappingTile(t,n,c,E),D=b.getHeightAtTileCoord(I,L);if(D&&!D.hidden)return D.height===void 0&&d!==void 0?Math.min(D.maxHeight,d)*D.verticalScale:D.height?D.height*D.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function hm(l,t){const n={};for(const c in l)c!=="ref"&&(n[c]=l[c]);return o.bx.forEach(c=>{c in t&&(n[c]=t[c])}),n}function kc(l){l=l.slice();const t=Object.create(null);for(let n=0;n<l.length;n++)t[l[n].id]=l[n];for(let n=0;n<l.length;n++)"ref"in l[n]&&(l[n]=hm(l[n],t[l[n].ref]));return l}const qi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Hu(l,t,n){n.push({command:qi.addSource,args:[l,t[l]]})}function Ud(l,t,n){t.push({command:qi.removeSource,args:[l]}),n[l]=!0}function dm(l,t,n,c){Ud(l,n,c),Hu(l,t,n)}function fm(l,t,n){let c;for(c in l[n])if(l[n].hasOwnProperty(c)&&c!=="data"&&!o.by(l[n][c],t[n][c]))return!1;for(c in t[n])if(t[n].hasOwnProperty(c)&&c!=="data"&&!o.by(l[n][c],t[n][c]))return!1;return!0}function Ra(l,t,n,c,d,m){let _;for(_ in t=t||{},l=l||{})l.hasOwnProperty(_)&&(o.by(l[_],t[_])||n.push({command:m,args:[c,_,t[_],d]}));for(_ in t)t.hasOwnProperty(_)&&!l.hasOwnProperty(_)&&(o.by(l[_],t[_])||n.push({command:m,args:[c,_,t[_],d]}))}function Fc(l){return l.id}function Bc(l,t){return l[t.id]=t,l}function jd(l,t,n){const c=t.createTileMatrix(l,l.worldSize,n.toUnwrapped());return o.aB(new Float32Array(16),l.projMatrix,c)}function qu(l,t,n){if(t.projection.name===n.projection.name)return l.projMatrix;const c=n.clone();return c.setProjection(t.projection),jd(c,t.getProjection(),l)}function ko(l,t,n){return t.name===n.projection.name?l.projMatrix:jd(n,t,l)}class Nc{constructor(t,n){this.reset(t,n)}reset(t,n){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.aA(t,0,1);let n=1,c=this._distances[n];const d=t*this.paddedLength+this.padding;for(;c<d&&n<this._distances.length;)c=this._distances[++n];const m=n-1,_=this._distances[m],x=c-_,b=x>0?(d-_)/x:0;return this.points[m].mult(1-b).add(this.points[n].mult(b))}}class Gd{constructor(t,n,c){const d=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(n/c);for(let _=0;_<this.xCellCount*this.yCellCount;_++)d.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,n,c,d,m){this._forEachCell(n,c,d,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(c),this.bboxes.push(d),this.bboxes.push(m)}insertCircle(t,n,c,d){this._forEachCell(n-d,c-d,n+d,c+d,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(n),this.circles.push(c),this.circles.push(d)}_insertBoxCell(t,n,c,d,m,_){this.boxCells[m].push(_)}_insertCircleCell(t,n,c,d,m,_){this.circleCells[m].push(_)}_query(t,n,c,d,m,_){if(c<0||t>this.width||d<0||n>this.height)return!m&&[];const x=[];if(t<=0&&n<=0&&this.width<=c&&this.height<=d){if(m)return!0;for(let b=0;b<this.boxKeys.length;b++)x.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const E=this.circles[3*b],I=this.circles[3*b+1],L=this.circles[3*b+2];x.push({key:this.circleKeys[b],x1:E-L,y1:I-L,x2:E+L,y2:I+L})}return _?x.filter(_):x}return this._forEachCell(t,n,c,d,this._queryCell,x,{hitTest:m,seenUids:{box:{},circle:{}}},_),m?x.length>0:x}_queryCircle(t,n,c,d,m){const _=t-c,x=t+c,b=n-c,E=n+c;if(x<0||_>this.width||E<0||b>this.height)return!d&&[];const I=[];return this._forEachCell(_,b,x,E,this._queryCellCircle,I,{hitTest:d,circle:{x:t,y:n,radius:c},seenUids:{box:{},circle:{}}},m),d?I.length>0:I}query(t,n,c,d,m){return this._query(t,n,c,d,!1,m)}hitTest(t,n,c,d,m){return this._query(t,n,c,d,!0,m)}hitTestCircle(t,n,c,d){return this._queryCircle(t,n,c,!0,d)}_queryCell(t,n,c,d,m,_,x,b){const E=x.seenUids,I=this.boxCells[m];if(I!==null){const D=this.bboxes;for(const z of I)if(!E.box[z]){E.box[z]=!0;const B=4*z;if(t<=D[B+2]&&n<=D[B+3]&&c>=D[B+0]&&d>=D[B+1]&&(!b||b(this.boxKeys[z]))){if(x.hitTest)return _.push(!0),!0;_.push({key:this.boxKeys[z],x1:D[B],y1:D[B+1],x2:D[B+2],y2:D[B+3]})}}}const L=this.circleCells[m];if(L!==null){const D=this.circles;for(const z of L)if(!E.circle[z]){E.circle[z]=!0;const B=3*z;if(this._circleAndRectCollide(D[B],D[B+1],D[B+2],t,n,c,d)&&(!b||b(this.circleKeys[z]))){if(x.hitTest)return _.push(!0),!0;{const F=D[B],H=D[B+1],G=D[B+2];_.push({key:this.circleKeys[z],x1:F-G,y1:H-G,x2:F+G,y2:H+G})}}}}}_queryCellCircle(t,n,c,d,m,_,x,b){const E=x.circle,I=x.seenUids,L=this.boxCells[m];if(L!==null){const z=this.bboxes;for(const B of L)if(!I.box[B]){I.box[B]=!0;const F=4*B;if(this._circleAndRectCollide(E.x,E.y,E.radius,z[F+0],z[F+1],z[F+2],z[F+3])&&(!b||b(this.boxKeys[B])))return _.push(!0),!0}}const D=this.circleCells[m];if(D!==null){const z=this.circles;for(const B of D)if(!I.circle[B]){I.circle[B]=!0;const F=3*B;if(this._circlesCollide(z[F],z[F+1],z[F+2],E.x,E.y,E.radius)&&(!b||b(this.circleKeys[B])))return _.push(!0),!0}}}_forEachCell(t,n,c,d,m,_,x,b){const E=this._convertToXCellCoord(t),I=this._convertToYCellCoord(n),L=this._convertToXCellCoord(c),D=this._convertToYCellCoord(d);for(let z=E;z<=L;z++)for(let B=I;B<=D;B++)if(m.call(this,t,n,c,d,this.xCellCount*B+z,_,x,b))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,n,c,d,m,_){const x=d-t,b=m-n,E=c+_;return E*E>x*x+b*b}_circleAndRectCollide(t,n,c,d,m,_,x){const b=(_-d)/2,E=Math.abs(t-(d+b));if(E>b+c)return!1;const I=(x-m)/2,L=Math.abs(n-(m+I));if(L>I+c)return!1;if(E<=b||L<=I)return!0;const D=E-b,z=L-I;return D*D+z*z<=c*c}}const Da={unknown:0,flipRequired:1,flipNotRequired:2},pl=Math.tan(85*Math.PI/180);function ds(l,t,n,c,d,m,_){const x=o.bC();if(n)if(m.name==="globe"){const b=o.bD(d,t);o.aB(x,x,b)}else{const b=o.bE([],_);x[0]=b[0],x[1]=b[1],x[4]=b[2],x[5]=b[3],c||o.bB(x,x,d.angle)}else o.aB(x,d.labelPlaneMatrix,l);return x}function $u(l,t,n,c,d,m,_){const x=ds(l,t,n,c,d,m,_);return m.name==="globe"&&n||(x[2]=x[6]=x[10]=x[14]=0),x}function Vc(l,t,n,c,d,m,_){if(n){if(m.name==="globe"){const x=ds(l,t,n,c,d,m,_);return o.bl(x,x),o.aB(x,l,x),x}{const x=o.bz(l),b=o.bA([]);return b[0]=_[0],b[1]=_[1],b[4]=_[2],b[5]=_[3],o.aB(x,x,b),c||o.bB(x,x,-d.angle),x}}return d.glCoordMatrix}function Qs(l,t,n,c){const d=[l,t,n,1];n?o.aC(d,d,c):Ut(d,d,c);const m=d[3];return d[0]/=m,d[1]/=m,d[2]/=m,d}function or(l,t){return Math.min(.5+l/t*.5,1.5)}function pm(l,t){const n=l[0]/l[3],c=l[1]/l[3];return n>=-t[0]&&n<=t[0]&&c>=-t[1]&&c<=t[1]}function mm(l,t,n,c,d,m,_,x,b,E,I=1){const L=n.transform,D=c?l.textSizeData:l.iconSizeData,z=o.bK(D,n.transform.zoom,I),B=L.projection.name==="globe",F=[256/n.width*2+1,256/n.height*2+1],H=c?l.text.dynamicLayoutVertexArray:l.icon.dynamicLayoutVertexArray;H.clear();let G=null;B&&(G=c?l.text.globeExtVertexArray:l.icon.globeExtVertexArray);const Z=l.lineVertexArray,Y=c?l.text.placedSymbolArray:l.icon.placedSymbolArray,X=n.transform.width/n.transform.height;let ce,ne=!1;for(let ae=0;ae<Y.length;ae++){const re=Y.get(ae),{numGlyphs:ee,writingMode:ue}=re;if(ue!==o.bL.vertical||ne||ce===o.bL.horizontal||(ne=!0),ce=ue,(re.hidden||ue===o.bL.vertical)&&!ne){vo(ee,H);continue}ne=!1;const be=new o.P(re.tileAnchorX,re.tileAnchorY),xe=l.elevationType==="road",De=!!L.elevation||xe;let{x:Le,y:Ue,z:it}=L.projection.projectTilePoint(be.x,be.y,E.canonical),Ce=null;if(De){const Et=xe?l.getElevationFeatureForText(ae):null;Ce={getElevation:b,elevation:L.elevation,elevationFeature:Et};const[$t,di,Ri]=b(be,L.elevation,Et);Le+=$t,Ue+=di,it+=Ri}const _e=[Le,Ue,it,1];if(o.aC(_e,_e,t),!pm(_e,F)){vo(ee,H);continue}const Fe=_e[3],Pe=or(n.transform.getCameraToCenterDistance(L.projection),Fe),We=o.bM(D,z,re),dt=_?We/Pe:We*Pe,Tt=Qs(Le,Ue,it,d);if(Tt[3]<=0){vo(ee,H);continue}let ct={};const nt=o.an(l.layers[0].layout.get("text-max-angle")),kt=Math.cos(nt),Dt=_?null:Ce,xt=Hd(re,dt,!1,x,t,d,m,l.glyphOffsetArray,Z,H,G,Tt,be,ct,X,Dt,L.projection,E,_,kt);ne=xt.useVertical,Dt&&xt.needsFlipping&&(ct={}),(xt.notEnoughRoom||ne||xt.needsFlipping&&Hd(re,dt,!0,x,t,d,m,l.glyphOffsetArray,Z,H,G,Tt,be,ct,X,Dt,L.projection,E,_,kt).notEnoughRoom)&&vo(ee,H)}c?(l.text.dynamicLayoutVertexBuffer.updateData(H),G&&l.text.globeExtVertexBuffer&&l.text.globeExtVertexBuffer.updateData(G)):(l.icon.dynamicLayoutVertexBuffer.updateData(H),G&&l.icon.globeExtVertexBuffer&&l.icon.globeExtVertexBuffer.updateData(G))}function _m(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H){const{lineStartIndex:G,glyphStartIndex:Z,segment:Y}=x,X=Z+x.numGlyphs,ce=G+x.lineLength,ne=t.getoffsetX(Z),ae=t.getoffsetX(X-1),re=Gl(l*ne,n,c,d,m,_,Y,G,ce,b,E,I,L,D,!0,z,B,F,H);if(!re)return null;const ee=Gl(l*ae,n,c,d,m,_,Y,G,ce,b,E,I,L,D,!0,z,B,F,H);return ee?{first:re,last:ee}:null}function ii(l,t,n,c){return l===o.bL.horizontal&&Math.abs(c)>Math.abs(n)?{useVertical:!0}:l===o.bL.vertical?c>0?{needsFlipping:!0}:null:t!==Da.unknown&&function(d,m){return d===0||Math.abs(m/d)>pl}(n,c)?t===Da.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function Hd(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G,Z,Y){const X=t/24,ce=l.lineOffsetX*X,ne=l.lineOffsetY*X,{lineStartIndex:ae,glyphStartIndex:re,numGlyphs:ee,segment:ue,writingMode:be,flipState:xe}=l,De=ae+l.lineLength,Le=Ue=>{if(I){const[Fe,Pe,We]=Ue.up,dt=E.length;o.bN(I,dt+0,Fe,Pe,We),o.bN(I,dt+1,Fe,Pe,We),o.bN(I,dt+2,Fe,Pe,We),o.bN(I,dt+3,Fe,Pe,We)}const[it,Ce,_e]=Ue.point;o.bO(E,it,Ce,_e,Ue.angle)};if(ee>1){const Ue=_m(X,x,ce,ne,n,L,D,l,b,m,z,F,!1,H,G,Z,Y);if(!Ue)return{notEnoughRoom:!0};if(c&&!n){let[it,Ce,_e]=Ue.first.point,[Fe,Pe,We]=Ue.last.point;[it,Ce]=Qs(it,Ce,_e,_),[Fe,Pe]=Qs(Fe,Pe,We,_);const dt=ii(be,xe,(Fe-it)*B,Pe-Ce);if(l.flipState=dt&&dt.needsFlipping?Da.flipRequired:Da.flipNotRequired,dt)return dt}Le(Ue.first);for(let it=re+1;it<re+ee-1;it++){const Ce=Gl(X*x.getoffsetX(it),ce,ne,n,L,D,ue,ae,De,b,m,z,F,!1,!1,H,G,Z,Y);if(!Ce)return E.length-=4*(it-re),{notEnoughRoom:!0};Le(Ce)}Le(Ue.last)}else{if(c&&!n){const it=Qs(D.x,D.y,0,d),Ce=ae+ue+1,_e=new o.P(b.getx(Ce),b.gety(Ce)),Fe=Qs(_e.x,_e.y,0,d),Pe=Fe[3]>0?Fe:eo(D,_e,it,1,d,void 0,H,G.canonical),We=ii(be,xe,(Pe[0]-it[0])*B,Pe[1]-it[1]);if(l.flipState=We&&We.needsFlipping?Da.flipRequired:Da.flipNotRequired,We)return We}const Ue=Gl(X*x.getoffsetX(re),ce,ne,n,L,D,ue,ae,De,b,m,z,F,!1,!1,H,G,Z,Y);if(!Ue)return{notEnoughRoom:!0};Le(Ue)}return{}}function Uc(l,t,n,c,d){const{x:m,y:_,z:x}=c.projectTilePoint(l.x,l.y,t);if(!d)return Qs(m,_,x,n);const[b,E,I]=d.getElevation(l,d.elevation,d.elevationFeature);return Qs(m+b,_+E,x+I,n)}function eo(l,t,n,c,d,m,_,x){const b=Uc(l.sub(t)._unit()._add(l),x,d,_,m);return o.av(b,n,b),o.aw(b,b),o.bH(b,n,b,c)}function Gl(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G,Z){const Y=c?l-t:l+t;let X=Y>0?1:-1,ce=0;c&&(X*=-1,ce=Math.PI),X<0&&(ce+=Math.PI);let ne=x+_+(X>0?0:1)|0,ae=d,re=d,ee=0,ue=0;const be=Math.abs(Y),xe=[],De=[];let Le=m,Ue=Le,it=o.bF([]);const Ce=()=>eo(Ue,Le,re,be-ee+1,I,D,F,H.canonical);for(;ee+ue<=be;){if(ne+=X,ne<x||ne>=b)return null;if(re=ae,Ue=Le,xe.push(re),z&&De.push(Ue),Le=new o.P(E.getx(ne),E.gety(ne)),ae=L[ne],!ae){const Dt=Uc(Le,H.canonical,I,F,D);ae=Dt[3]>0?L[ne]=Dt:Ce()}ee+=ue;const nt=o.av([],ae,re),kt=o.bG(re,ae);if(n&&kt>0&&ue>0&&o.bJ(it,nt)/(ue*kt)<Z)return null;ue=kt,it=nt}B&&D&&(L[ne]&&(ae=Ce(),ue=o.bG(re,ae),it=o.av([],ae,re)),L[ne]=ae);const _e=(be-ee)/ue,Fe=Le.sub(Ue)._mult(_e)._add(Ue),Pe=o.bH([],re,it,_e);let We=[0,0,1],dt=it[0],Tt=it[1];if(G&&(We=F.upVector(H.canonical,Fe.x,Fe.y),We[0]!==0||We[1]!==0||We[2]!==1)){const nt=[We[2],0,-We[0]],kt=o.bI([],We,nt);o.aw(nt,nt),o.aw(kt,kt),dt=o.bJ(it,nt),Tt=o.bJ(it,kt)}if(n){const nt=o.bI([],We,it);o.aw(nt,nt),o.bH(Pe,Pe,nt,n*X)}const ct=ce+Math.atan2(Tt,dt);return xe.push(Pe),z&&De.push(Fe),{point:Pe,angle:ct,path:xe,tilePath:De,up:We}}function vo(l,t){const n=t.length,c=n+4*l;t.resize(c),t.float32.fill(-1/0,4*n,4*c)}function Ut(l,t,n){const c=t[0],d=t[1];return l[0]=n[0]*c+n[4]*d+n[12],l[1]=n[1]*c+n[5]*d+n[13],l[3]=n[3]*c+n[7]*d+n[15],l}const Ni=100;class ur{constructor(t,n,c=new Gd(t.width+200,t.height+200,25),d=new Gd(t.width+200,t.height+200,25)){this.transform=t,this.grid=c,this.ignoredGrid=d,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Ni,this.screenBottomBoundary=t.height+Ni,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=n}placeCollisionBox(t,n,c,d,m,_,x,b,E,I,L){let D=c.projectedAnchorX,z=c.projectedAnchorY,B=c.projectedAnchorZ;const F=c.tileAnchorX,H=c.tileAnchorY,G=c.elevation,Z=c.tileID,Y=t.getProjection();if(G&&Z){const[De,Le,Ue]=Y.upVector(Z.canonical,c.tileAnchorX,c.tileAnchorY),it=Y.upVectorScale(Z.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;D+=De*G*it,z+=Le*G*it,B+=Ue*G*it}const X=t.projection.name==="globe",ce=t.projection.name==="globe"?o.aj(this.transform.zoom):0;if(Z&&X&&ce<1&&!_){const De=1<<Z.canonical.z,Le=o.bP(F,H);o.bQ(Le,Le,1/o.al),o.bR(Le,Le,o.bP(Z.canonical.x,Z.canonical.y)),o.bQ(Le,Le,1/De),o.bS(Le,Le,o.bP(d[0],d[1])),Le[0]=o.bT(Le[0],-.5,.5),o.bQ(Le,Le,o.al);const Ue=o.bU(Le[0],Le[1],o.al/(2*Math.PI),1);o.aC(Ue,Ue,m),D=o.ak(D,Ue[0],ce),z=o.ak(z,Ue[1],ce),B=o.ak(B,Ue[2],ce)}const ne=this.projectAndGetPerspectiveRatio(I,D,z,B,c.tileID,Y.name==="globe"||!!G||this.transform.pitch>0,Y),ae=E*ne.perspectiveRatio,re=(c.x1*n+x.x-c.padding)*ae+ne.point.x,ee=(c.y1*n+x.y-c.padding)*ae+ne.point.y,ue=(c.x2*n+x.x+c.padding)*ae+ne.point.x,be=(c.y2*n+x.y+c.padding)*ae+ne.point.y,xe=ne.perspectiveRatio<=.55||ne.occluded;return!this.isInsideGrid(re,ee,ue,be)||!b&&this.grid.hitTest(re,ee,ue,be,L)||xe?{box:[],offscreen:!1,occluded:ne.occluded}:{box:[re,ee,ue,be],offscreen:this.isOffscreen(re,ee,ue,be),occluded:!1}}placeCollisionCircles(t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H){const G=[],Z=this.transform.elevation,Y=t.getProjection(),X=t.elevationType==="road",ce=!!Z||X,ne=o.bV.getAtTileOffsetFunc(H,this.transform.center.lat,this.transform.worldSize,Y),ae=new o.P(c.tileAnchorX,c.tileAnchorY),re=new o.P(c.tileAnchorX,c.tileAnchorY);let{x:ee,y:ue,z:be}=Y.projectTilePoint(re.x,re.y,H.canonical),xe=null;if(ce){const kt=X?t.getElevationFeatureForText(d):null;xe={getElevation:ne,elevation:Z,elevationFeature:kt};const[Dt,xt,Et]=ne(ae,Z,kt);ee+=Dt,ue+=xt,be+=Et}const De=Y.name==="globe",Le=this.projectAndGetPerspectiveRatio(b,ee,ue,be,H,De||!!Z||this.transform.pitch>0,Y),{perspectiveRatio:Ue}=Le,it=(D?x/Ue:x*Ue)/o.bY,Ce=Qs(ee,ue,be,E),_e=c.lineOffsetX*it,Fe=c.lineOffsetY*it,Pe=o.an(t.layers[0].layout.get("text-max-angle")),We=Math.cos(Pe),dt=Le.signedDistanceFromCamera>0?_m(it,_,_e,Fe,X&&c.flipState===1,Ce,re,c,m,E,{},ce&&!D?xe:null,D&&ce,Y,H,D,We):null;let Tt=!1,ct=!1,nt=!0;if(dt&&!Le.occluded){const kt=.5*B*Ue+F,Dt=new o.P(-100,-100),xt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Et=new Nc,{first:$t,last:di}=dt,Ri=$t.path.length;let Yi=[];for(let ui=Ri-1;ui>=1;ui--)Yi.push($t.path[ui]);for(let ui=1;ui<di.path.length;ui++)Yi.push(di.path[ui]);const Ft=2.5*kt;I&&(Yi=Yi.map(([ui,tr,hr],ar)=>(ce&&!De&&(hr=ne(ar<Ri-1?$t.tilePath[Ri-1-ar]:di.tilePath[ar-Ri+2],Z,xe.elevationFeature)[2]),Qs(ui,tr,hr,I))),Yi.some(ui=>ui[3]<=0)&&(Yi=[]));let Zi=[];if(Yi.length>0){let ui=1/0,tr=-1/0,hr=1/0,ar=-1/0;for(const $i of Yi)ui=Math.min(ui,$i[0]),hr=Math.min(hr,$i[1]),tr=Math.max(tr,$i[0]),ar=Math.max(ar,$i[1]);tr>=Dt.x&&ui<=xt.x&&ar>=Dt.y&&hr<=xt.y&&(Zi=[Yi.map($i=>new o.P($i[0],$i[1]))],(ui<Dt.x||tr>xt.x||hr<Dt.y||ar>xt.y)&&(Zi=o.bW(Zi,Dt.x,Dt.y,xt.x,xt.y)))}for(const ui of Zi){Et.reset(ui,.25*kt);let tr=0;tr=Et.length<=.5*kt?1:Math.ceil(Et.paddedLength/Ft)+1;for(let hr=0;hr<tr;hr++){const ar=hr/Math.max(tr-1,1),$i=Et.lerp(ar),xi=$i.x+Ni,er=$i.y+Ni;G.push(xi,er,kt,0);const $r=xi-kt,Or=er-kt,ir=xi+kt,ji=er+kt;if(nt=nt&&this.isOffscreen($r,Or,ir,ji),ct=ct||this.isInsideGrid($r,Or,ir,ji),!n&&this.grid.hitTestCircle(xi,er,kt,z)&&(Tt=!0,!L))return{circles:[],offscreen:!1,collisionDetected:Tt,occluded:!1}}}}return{circles:!L&&Tt||!ct?[]:G,offscreen:nt,collisionDetected:Tt,occluded:Le.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const n=[];let c=1/0,d=1/0,m=-1/0,_=-1/0;for(const I of t){const L=new o.P(I.x+Ni,I.y+Ni);c=Math.min(c,L.x),d=Math.min(d,L.y),m=Math.max(m,L.x),_=Math.max(_,L.y),n.push(L)}const x=this.grid.query(c,d,m,_).concat(this.ignoredGrid.query(c,d,m,_)),b={},E={};for(const I of x){const L=I.key;if(b[L.bucketInstanceId]===void 0&&(b[L.bucketInstanceId]={}),b[L.bucketInstanceId][L.featureIndex])continue;const D=[new o.P(I.x1,I.y1),new o.P(I.x2,I.y1),new o.P(I.x2,I.y2),new o.P(I.x1,I.y2)];o.bX(n,D)&&(b[L.bucketInstanceId][L.featureIndex]=!0,E[L.bucketInstanceId]===void 0&&(E[L.bucketInstanceId]=[]),E[L.bucketInstanceId].push(L.featureIndex))}return E}insertCollisionBox(t,n,c,d,m){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:d,collisionGroupID:m},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,n,c,d,m){const _=n?this.ignoredGrid:this.grid,x={bucketInstanceId:c,featureIndex:d,collisionGroupID:m};for(let b=0;b<t.length;b+=4)_.insertCircle(x,t[b],t[b+1],t[b+2])}projectAndGetPerspectiveRatio(t,n,c,d,m,_,x){const b=[n,c,d,1];let E=!1;d||this.transform.pitch>0?(o.aC(b,b,t),this.fogState&&m&&x.name!=="globe"&&(E=function(D,z,B,F,H,G){const Z=G.calculateFogTileMatrix(H),Y=[z,B,F];return o.af(Y,Y,Z),Pt(D,o.ag(Y),G.pitch,G._fov)}(this.fogState,n,c,d,m.toUnwrapped(),this.transform)>.9)):Ut(b,b,t);const I=b[3];return{point:new o.P((b[0]/I+1)/2*this.transform.width+Ni,(-b[1]/I+1)/2*this.transform.height+Ni),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/I*.5,1.5),signedDistanceFromCamera:I,occluded:_&&b[2]>I||E}}isOffscreen(t,n,c,d){return c<Ni||t>=this.screenRightBoundary||d<Ni||n>this.screenBottomBoundary}isInsideGrid(t,n,c,d){return c>=0&&t<this.gridRightBoundary&&d>=0&&n<this.gridBottomBoundary}getViewportMatrix(){const t=o.bA([]);return o.br(t,t,[-100,-100,0]),t}}class Ss{constructor(t,n,c,d){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):d&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Fo{constructor(t,n,c,d,m,_=!1){this.text=new Ss(t?t.text:null,n,c,m),this.icon=new Ss(t?t.icon:null,n,d,m),this.clipped=_}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nr{constructor(t,n,c,d=!1){this.text=t,this.icon=n,this.skipFade=c,this.clipped=d}}class Wu{constructor(){this.invProjMatrix=o.bC(),this.viewportMatrix=o.bC(),this.circles=[]}}class jc{constructor(t,n,c,d,m){this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=c,this.bucketIndex=d,this.tileID=m}}class Gc{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const n=++this.maxGroupID;this.collisionGroups[t]={ID:n,predicate:c=>c.collisionGroupID===n}}return this.collisionGroups[t]}}function rs(l,t,n,c,d){const{horizontalAlign:m,verticalAlign:_}=o.c1(l),x=-(m-.5)*t,b=-(_-.5)*n,E=o.c2(l,c);return new o.P(x+E[0]*d,b+E[1]*d)}function mn(l,t,n,c,d){const m=new o.P(l,t);return n&&m._rotate(c?d:-d),m}class iy{constructor(t,n,c,d,m,_){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new ur(this.transform,m),this.buildingIndex=_,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new Gc(c),this.collisionCircleArrays={},this.prevPlacement=d,d&&(d.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,n,c,d,m=1){const _=c.getBucket(n),x=c.latestFeatureIndex;if(!_||!x||n.fqid!==_.layerIds[0])return;const b=_.layers[0].layout,E=_.layers[0].paint,I=c.collisionBoxArray,L=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),D=c.tileSize/o.al,z=c.tileID.toUnwrapped();this.transform.setProjection(_.projection);const B=(F=c.tileID,H=_.getProjection(),G=this.transform,H.name===this.projection?G.calculateProjMatrix(F.toUnwrapped()):jd(G,H,F));var F,H,G;const Z=b.get("text-pitch-alignment")==="map",Y=b.get("text-rotation-alignment")==="map";n.compileFilter(n.options);const X=n.dynamicFilter(),ce=n.dynamicFilterNeedsFeature(),ne=this.transform.calculatePixelsToTileUnitsMatrix(c),ae=$u(B,c.tileID.canonical,Z,Y,this.transform,_.getProjection(),ne);let re=null;const ee=_.getProjection().createInversionMatrix(this.transform,c.tileID.canonical);if(Z){const _e=Vc(B,c.tileID.canonical,Z,Y,this.transform,_.getProjection(),ne);re=o.aB([],this.transform.labelPlaneMatrix,_e)}let ue=null;X&&c.latestFeatureIndex&&(ue={unwrappedTileID:z,dynamicFilter:X,dynamicFilterNeedsFeature:ce}),this.retainedQueryData[_.bucketInstanceId]=new jc(_.bucketInstanceId,x,_.sourceLayerIndex,_.index,c.tileID);const[be,xe]=_.layers[0].layout.get("text-size-scale-range"),De=o.aA(m,be,xe),[Le,Ue]=b.get("icon-size-scale-range"),it=o.aA(m,Le,Ue),Ce={bucket:_,layout:b,paint:E,posMatrix:B,invMatrix:ee,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:ae,labelToScreenMatrix:re,clippingData:ue,scale:L,textPixelRatio:D,holdingForFade:c.holdingForFade(),collisionBoxArray:I,partiallyEvaluatedTextSize:o.bK(_.textSizeData,this.transform.zoom,De),partiallyEvaluatedIconSize:o.bK(_.iconSizeData,this.transform.zoom,it),collisionGroup:this.collisionGroups.get(_.sourceID),latestFeatureIndex:c.latestFeatureIndex};if(d)for(const _e of _.sortKeyRanges){const{sortKey:Fe,symbolInstanceStart:Pe,symbolInstanceEnd:We}=_e;t.push({sortKey:Fe,symbolInstanceStart:Pe,symbolInstanceEnd:We,parameters:Ce})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:_.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G,Z,Y,X,ce){const{textOffset0:ne,textOffset1:ae,crossTileID:re}=F,ee=[ne,ae],ue=rs(t,_,x,ee,b),be=this.collisionIndex.placeCollisionBox(G,b,n,c,d,m,mn(ue.x,ue.y,E,I,this.transform.angle),B,L,D,z.predicate);if(Y){const xe=G.getSymbolInstanceIconSize(ce,this.transform.zoom,F.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(G,xe,Y,c,d,m,mn(ue.x,ue.y,E,I,this.transform.angle),B,L,D,z.predicate).box.length===0)return}if(be.box.length>0){let xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[re]&&this.prevPlacement.placements[re]&&this.prevPlacement.placements[re].text&&(xe=this.prevPlacement.variableOffsets[re].anchor),this.variableOffsets[re]={textOffset:ee,width:_,height:x,anchor:t,textScale:b,prevAnchor:xe},this.markUsedJustification(G,t,F,Z),G.allowVerticalPlacement&&(this.markUsedOrientation(G,Z,F),this.placedOrientations[re]=Z),{shift:ue,placedGlyphBoxes:be}}}placeLayerBucketPart(t,n,c,d,m=1){const{bucket:_,layout:x,paint:b,posMatrix:E,textLabelPlaneMatrix:I,labelToScreenMatrix:L,clippingData:D,textPixelRatio:z,mercatorCenter:B,invMatrix:F,holdingForFade:H,collisionBoxArray:G,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:Y,collisionGroup:X,latestFeatureIndex:ce}=t.parameters,ne=x.get("text-optional"),ae=x.get("icon-optional"),re=x.get("text-allow-overlap"),ee=x.get("icon-allow-overlap"),ue=x.get("text-rotation-alignment")==="map",be=x.get("icon-rotation-alignment")==="map",xe=x.get("text-pitch-alignment")==="map",De=b.get("symbol-z-offset"),Le=x.get("symbol-elevation-reference")==="sea",Ue=x.get("symbol-placement"),[it,Ce]=x.get("text-size-scale-range"),[_e,Fe]=x.get("icon-size-scale-range"),Pe=o.aA(m,it,Ce),We=o.aA(m,_e,Fe),dt=x.get("text-variable-anchor"),Tt=ue&&Ue!=="point",ct=be&&Ue!=="point",nt=dt&&_.hasTextData(),kt=_.hasIconTextFit()&&nt&&_.hasIconData();this.transform.setProjection(_.projection);const Dt=nt||Tt,xt=ct||kt;let Et=re&&(ee||!_.hasIconData()||ae),$t=ee&&(re||!_.hasTextData()||ne);const di=!De.isConstant();!_.collisionArrays&&G&&_.deserializeCollisionBoxes(G),c&&d&&_.updateCollisionDebugBuffers(this.transform.zoom,G,Pe,We);const Ri=(Ft,Zi,ui)=>{const{crossTileID:tr,numVerticalGlyphVertices:hr}=Ft;let ar=null;if(D&&D.dynamicFilterNeedsFeature||di){const Kr=this.retainedQueryData[_.bucketInstanceId];ar=ce.loadFeature({featureIndex:Ft.featureIndex,bucketIndex:Kr.bucketIndex,sourceLayerIndex:Kr.sourceLayerIndex,layoutVertexArrayOffset:0});const nn=ar.properties?ar.properties.worldview:null;if(_.localizable&&_.worldview&&typeof nn=="string")if(nn==="all")ar.properties.$localized=!0;else{if(!nn.split(",").includes(_.worldview))return;ar.properties.$localized=!0,ar.properties.worldview=_.worldview}}if(D&&!(0,D.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:_.worldview},ar,this.retainedQueryData[_.bucketInstanceId].tileID.canonical,new o.P(Ft.tileAnchorX,Ft.tileAnchorY),this.transform.calculateDistanceTileData(D.unwrappedTileID)))return this.placements[tr]=new nr(!1,!1,!1,!0),void n.add(tr);const $i=De.evaluate(ar,{});if(n.has(tr))return;if(H)return void(this.placements[tr]=new nr(!1,!1,!1));let xi=!1,er=!1,$r=!0,Or=!1,ir=!1,ji=null,vi={box:null,offscreen:null,occluded:null},Lr={box:null},en=null,Vr=null,gr=null,vs=0,Kn=0,Sn=0;ui.textFeatureIndex?vs=ui.textFeatureIndex:Ft.useRuntimeCollisionCircles&&(vs=Ft.featureIndex),ui.verticalTextFeatureIndex&&(Kn=ui.verticalTextFeatureIndex);const ss=_.elevationFeatures?_.elevationFeatures[Ft.elevationFeatureIndex]:void 0,os=Kr=>{Kr.tileID=this.retainedQueryData[_.bucketInstanceId].tileID;const nn=this.transform.elevation;Kr.elevation=Le?$i:$i+o.bV.getAtTileOffset(Kr.tileID,new o.P(Kr.tileAnchorX,Kr.tileAnchorY),nn,ss),Kr.elevation+=Ft.zOffset},Wn=ui.textBox;if(Wn){os(Wn);const Kr=yr=>{let dn=o.bL.horizontal;if(_.allowVerticalPlacement&&!yr&&this.prevPlacement){const Wr=this.prevPlacement.placedOrientations[tr];Wr&&(this.placedOrientations[tr]=Wr,dn=Wr,this.markUsedOrientation(_,dn,Ft))}return dn},nn=(yr,dn)=>{if(_.allowVerticalPlacement&&hr>0&&ui.verticalTextBox){for(const Wr of _.writingModes)if(Wr===o.bL.vertical?(vi=dn(),Lr=vi):vi=yr(),vi&&vi.box&&vi.box.length)break}else vi=yr()};if(dt){let yr=dt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[tr]){const Ur=this.prevPlacement.variableOffsets[tr];yr.indexOf(Ur.anchor)>0&&(yr=yr.filter(lo=>lo!==Ur.anchor),yr.unshift(Ur.anchor))}const dn=(Ur,lo,gu)=>{const Ao=_.getSymbolInstanceTextSize(Z,Ft,this.transform.zoom,Zi),yu=(Ur.x2-Ur.x1)*Ao+2*Ur.padding,fc=(Ur.y2-Ur.y1)*Ao+2*Ur.padding,$o=Ft.hasIconTextFit&&!ee?lo:null;$o&&os($o);let ma={box:[],offscreen:!1,occluded:!1};const pc=re?2*yr.length:yr.length;for(let Za=0;Za<pc;++Za){const _a=this.attemptAnchorPlacement(yr[Za%yr.length],Ur,B,F,Dt,yu,fc,Ao,ue,xe,z,E,X,Za>=yr.length,Ft,Zi,_,gu,$o,Z,Y);if(_a&&(ma=_a.placedGlyphBoxes,ma&&ma.box&&ma.box.length)){xi=!0,ji=_a.shift;break}}return ma};nn(()=>dn(Wn,ui.iconBox,o.bL.horizontal),()=>{const Ur=ui.verticalTextBox;return Ur&&os(Ur),_.allowVerticalPlacement&&!(vi&&vi.box&&vi.box.length)&&hr>0&&Ur?dn(Ur,ui.verticalIconBox,o.bL.vertical):{box:null,offscreen:null,occluded:null}}),vi&&(xi=vi.box,$r=vi.offscreen,Or=vi.occluded);const Wr=Kr(!(!vi||!vi.box));if(!xi&&this.prevPlacement){const Ur=this.prevPlacement.variableOffsets[tr];Ur&&(this.variableOffsets[tr]=Ur,this.markUsedJustification(_,Ur.anchor,Ft,Wr))}}else{const yr=(dn,Wr)=>{const Ur=_.getSymbolInstanceTextSize(Z,Ft,this.transform.zoom,Zi),lo=this.collisionIndex.placeCollisionBox(_,Ur,dn,B,F,Dt,new o.P(0,0),re,z,E,X.predicate);return lo&&lo.box&&lo.box.length&&(this.markUsedOrientation(_,Wr,Ft),this.placedOrientations[tr]=Wr),lo};nn(()=>yr(Wn,o.bL.horizontal),()=>{const dn=ui.verticalTextBox;return _.allowVerticalPlacement&&hr>0&&dn?(os(dn),yr(dn,o.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Kr(!!(vi&&vi.box&&vi.box.length))}}if(en=vi,xi=en&&en.box&&en.box.length>0,$r=en&&en.offscreen,Or=en&&en.occluded,Ft.useRuntimeCollisionCircles){const Kr=Ft.centerJustifiedTextSymbolIndex>=0?Ft.centerJustifiedTextSymbolIndex:Ft.verticalPlacedTextSymbolIndex,nn=_.text.placedSymbolArray.get(Kr),yr=o.bM(_.textSizeData,Z,nn),dn=x.get("text-padding");Vr=this.collisionIndex.placeCollisionCircles(_,re,nn,Kr,_.lineVertexArray,_.glyphOffsetArray,yr,E,I,L,c,xe,X.predicate,Ft.collisionCircleDiameter*yr/o.bY,dn,this.retainedQueryData[_.bucketInstanceId].tileID),xi=re||Vr.circles.length>0&&!Vr.collisionDetected,$r=$r&&Vr.offscreen,Or=Vr.occluded}if(ui.iconFeatureIndex&&(Sn=ui.iconFeatureIndex),ui.iconBox){const Kr=nn=>{os(nn);const yr=Ft.hasIconTextFit&&ji?mn(ji.x,ji.y,ue,xe,this.transform.angle):new o.P(0,0),dn=_.getSymbolInstanceIconSize(Y,this.transform.zoom,Ft.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(_,dn,nn,B,F,xt,yr,ee,z,E,X.predicate)};Lr&&Lr.box&&Lr.box.length&&ui.verticalIconBox?(gr=Kr(ui.verticalIconBox),er=gr.box.length>0):(gr=Kr(ui.iconBox),er=gr.box.length>0),$r=$r&&gr.offscreen,ir=gr.occluded}const qs=ne||Ft.numHorizontalGlyphVertices===0&&hr===0,ao=ae||Ft.numIconVertices===0;if(qs||ao?ao?qs||(er=er&&xi):xi=er&&xi:er=xi=er&&xi,xi&&en&&en.box&&this.collisionIndex.insertCollisionBox(en.box,x.get("text-ignore-placement"),_.bucketInstanceId,Lr&&Lr.box&&Kn?Kn:vs,X.ID),er&&gr&&this.collisionIndex.insertCollisionBox(gr.box,x.get("icon-ignore-placement"),_.bucketInstanceId,Sn,X.ID),Vr&&(xi&&this.collisionIndex.insertCollisionCircles(Vr.circles,x.get("text-ignore-placement"),_.bucketInstanceId,vs,X.ID),c)){const Kr=_.bucketInstanceId;let nn=this.collisionCircleArrays[Kr];nn===void 0&&(nn=this.collisionCircleArrays[Kr]=new Wu);for(let yr=0;yr<Vr.circles.length;yr+=4)nn.circles.push(Vr.circles[yr+0]),nn.circles.push(Vr.circles[yr+1]),nn.circles.push(Vr.circles[yr+2]),nn.circles.push(Vr.collisionDetected?1:0)}const Is=_.projection.name!=="globe";Et=Et&&(Is||!Or),$t=$t&&(Is||!ir),this.placements[tr]=new nr(xi||Et,er||$t,$r||_.justReloaded),n.add(tr)},Yi=this.retainedQueryData[_.bucketInstanceId].tileID;if(_.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(_,Yi),_.elevationType==="road"&&_.updateRoadElevation(Yi.canonical),_.updateZOffset(),_.sortFeaturesByY){const Ft=_.getSortedSymbolIndexes(this.transform.angle);for(let Zi=Ft.length-1;Zi>=0;--Zi){const ui=Ft[Zi];Ri(_.symbolInstances.get(ui),ui,_.collisionArrays[ui])}_.hasAnyZOffset&&o.w(`${_.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(_.hasAnyZOffset){const Ft=_.getSortedIndexesByZOffset();for(let Zi=0;Zi<Ft.length;++Zi){const ui=Ft[Zi];Ri(_.symbolInstances.get(ui),ui,_.collisionArrays[ui])}}else for(let Ft=t.symbolInstanceStart;Ft<t.symbolInstanceEnd;Ft++)Ri(_.symbolInstances.get(Ft),Ft,_.collisionArrays[Ft]);if(c&&_.bucketInstanceId in this.collisionCircleArrays){const Ft=this.collisionCircleArrays[_.bucketInstanceId];o.bl(Ft.invProjMatrix,E),Ft.viewportMatrix=this.collisionIndex.getViewportMatrix()}_.justReloaded=!1}markUsedJustification(t,n,c,d){const{leftJustifiedTextSymbolIndex:m,centerJustifiedTextSymbolIndex:_,rightJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:b,crossTileID:E}=c,I=o.c3(n),L=d===o.bL.vertical?b:I==="left"?m:I==="center"?_:I==="right"?x:-1;m>=0&&(t.text.placedSymbolArray.get(m).crossTileID=L>=0&&m!==L?0:E),_>=0&&(t.text.placedSymbolArray.get(_).crossTileID=L>=0&&_!==L?0:E),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=L>=0&&x!==L?0:E),b>=0&&(t.text.placedSymbolArray.get(b).crossTileID=L>=0&&b!==L?0:E)}markUsedOrientation(t,n,c){const d=n===o.bL.horizontal||n===o.bL.horizontalOnly?n:0,m=n===o.bL.vertical?n:0,{leftJustifiedTextSymbolIndex:_,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:E}=c,I=t.text.placedSymbolArray;_>=0&&(I.get(_).placedOrientation=d),x>=0&&(I.get(x).placedOrientation=d),b>=0&&(I.get(b).placedOrientation=d),E>=0&&(I.get(E).placedOrientation=m)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const n=this.prevPlacement;let c=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;const d=n?n.symbolFadeChange(t):1,m=n?n.opacities:{},_=n?n.variableOffsets:{},x=n?n.placedOrientations:{};for(const b in this.placements){const E=this.placements[b],I=m[b];I?(this.opacities[b]=new Fo(I,d,E.text,E.icon,null,E.clipped),c=c||E.text!==I.text.placed||E.icon!==I.icon.placed):(this.opacities[b]=new Fo(null,d,E.text,E.icon,E.skipFade,E.clipped),c=c||E.text||E.icon)}for(const b in m){const E=m[b];if(!this.opacities[b]){const I=new Fo(E,d,!1,!1);I.isHidden()||(this.opacities[b]=I,c=c||E.text.placed||E.icon.placed)}}for(const b in _)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=_[b]);for(const b in x)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=x[b]);c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:t)}updateLayerOpacities(t,n,c,d){d&&(this.lastReplacementSourceUpdateTime=d.updateTime);const m=new Set;for(const _ of n){const x=_.getBucket(t);x&&_.latestFeatureIndex&&t.fqid===x.layerIds[0]&&(this.updateBucketOpacities(x,m,_,_.collisionBoxArray,c,d,_.tileID,t.scope),x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,_.tileID),x.elevationType==="road"&&x.updateRoadElevation(_.tileID.canonical),x.updateZOffset())}}updateBucketOpacities(t,n,c,d,m,_,x,b){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const E=t.layers[0].layout,I=t.layers[0].paint,L=!!t.layers[0].dynamicFilter(),D=new Fo(null,0,!1,!1,!0),z=E.get("text-allow-overlap"),B=E.get("icon-allow-overlap"),F=E.get("text-variable-anchor"),H=E.get("text-rotation-alignment")==="map",G=E.get("text-pitch-alignment")==="map",Z=I.get("symbol-z-offset"),Y=E.get("symbol-elevation-reference")==="sea",X=!Z.isConstant(),ce=new Fo(null,0,z&&(B||!t.hasIconData()||E.get("icon-optional")),B&&(z||!t.hasTextData()||E.get("text-optional")),!0);!t.collisionArrays&&d&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(d);const ne=(re,ee,ue)=>{for(let be=0;be<ee/4;be++)re.opacityVertexArray.emplaceBack(ue)};let ae=0;_&&t.updateReplacement(x,_);for(let re=0;re<t.symbolInstances.length;re++){const ee=t.symbolInstances.get(re),{numHorizontalGlyphVertices:ue,numVerticalGlyphVertices:be,crossTileID:xe,numIconVertices:De,tileAnchorX:Le,tileAnchorY:Ue}=ee;let it=null;const Ce=this.retainedQueryData[t.bucketInstanceId];X&&ee&&Ce&&(it=c.latestFeatureIndex.loadFeature({featureIndex:ee.featureIndex,bucketIndex:Ce.bucketIndex,sourceLayerIndex:Ce.sourceLayerIndex,layoutVertexArrayOffset:0}));const _e=Z.evaluate(it,{}),Fe=n.has(xe);let Pe=this.opacities[xe];Fe?Pe=D:Pe||(Pe=ce,this.opacities[xe]=Pe),n.add(xe);const We=ue>0||be>0,dt=De>0,Tt=this.placedOrientations[xe],ct=Tt===o.bL.vertical,nt=Tt===o.bL.horizontal||Tt===o.bL.horizontalOnly;!We&&!dt||Pe.isHidden()||ae++;let kt=!1;if((We||dt)&&_)for(const Dt of t.activeReplacements){if(o.bZ(Dt,m,o.b_.Symbol,b)||Dt.min.x>Le||Le>Dt.max.x||Dt.min.y>Ue||Ue>Dt.max.y)continue;const xt=o.b$(Le,Ue,x.canonical,Dt.footprintTileId.canonical);if(kt=o.c0(xt,Dt.footprint),kt)break}if(We){const Dt=kt?ml:_s(Pe.text);ne(t.text,ue,ct?ml:Dt),ne(t.text,be,nt?ml:Dt);const xt=Pe.text.isHidden(),{leftJustifiedTextSymbolIndex:Et,centerJustifiedTextSymbolIndex:$t,rightJustifiedTextSymbolIndex:di,verticalPlacedTextSymbolIndex:Ri}=ee,Yi=t.text.placedSymbolArray,Ft=xt||ct?1:0;Et>=0&&(Yi.get(Et).hidden=Ft),$t>=0&&(Yi.get($t).hidden=Ft),di>=0&&(Yi.get(di).hidden=Ft),Ri>=0&&(Yi.get(Ri).hidden=xt||nt?1:0);const Zi=this.variableOffsets[xe];Zi&&this.markUsedJustification(t,Zi.anchor,ee,Tt);const ui=this.placedOrientations[xe];ui&&(this.markUsedJustification(t,"left",ee,ui),this.markUsedOrientation(t,ui,ee))}if(dt){const Dt=kt?ml:_s(Pe.icon),{placedIconSymbolIndex:xt,verticalPlacedIconSymbolIndex:Et}=ee,$t=t.icon.placedSymbolArray,di=Pe.icon.isHidden()?1:0;xt>=0&&(ne(t.icon,De,ct?ml:Dt),$t.get(xt).hidden=di),Et>=0&&(ne(t.icon,ee.numVerticalIconVertices,nt?ml:Dt),$t.get(Et).hidden=di)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Dt=t.collisionArrays[re];if(Dt){let xt=new o.P(0,0),Et=!0;if(Dt.textBox||Dt.verticalTextBox){if(F){const di=this.variableOffsets[xe];di?(xt=rs(di.anchor,di.width,di.height,di.textOffset,di.textScale),H&&xt._rotate(G?this.transform.angle:-this.transform.angle)):Et=!1}L&&(Et=!Pe.clipped),Dt.textBox&&La(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!Et||ct,_e,Y,xt.x,xt.y),Dt.verticalTextBox&&La(t.textCollisionBox.collisionVertexArray,Pe.text.placed,!Et||nt,_e,Y,xt.x,xt.y)}const $t=Et&&!!(!nt&&Dt.verticalIconBox);Dt.iconBox&&La(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,$t,_e,Y,ee.hasIconTextFit?xt.x:0,ee.hasIconTextFit?xt.y:0),Dt.verticalIconBox&&La(t.iconCollisionBox.collisionVertexArray,Pe.icon.placed,!$t,_e,Y,ee.hasIconTextFit?xt.x:0,ee.hasIconTextFit?xt.y:0)}}}if(t.fullyClipped=ae===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const re=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=re.invProjMatrix,t.placementViewportMatrix=re.viewportMatrix,t.collisionCircleArray=re.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,n){const c=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*c>t}isStale(){return this.stale}setStale(){this.stale=!0}}function La(l,t,n,c,d,m,_){l.emplaceBack(t?1:0,n?1:0,m||0,_||0,c,d?1:0),l.emplaceBack(t?1:0,n?1:0,m||0,_||0,c,d?1:0),l.emplaceBack(t?1:0,n?1:0,m||0,_||0,c,d?1:0),l.emplaceBack(t?1:0,n?1:0,m||0,_||0,c,d?1:0)}const qd=Math.pow(2,25),Hc=Math.pow(2,24),Zu=Math.pow(2,17),$d=Math.pow(2,16),Xu=Math.pow(2,9),ms=Math.pow(2,8),ia=Math.pow(2,1);function _s(l){if(l.opacity===0&&!l.placed)return 0;if(l.opacity===1&&l.placed)return 4294967295;const t=l.placed?1:0,n=Math.floor(127*l.opacity);return n*qd+t*Hc+n*Zu+t*$d+n*Xu+t*ms+n*ia+t}const ml=0;class Hl{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,n,c,d,m,_){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(n.getBucketParts(x,d,t[this._currentTileIndex],this._sortAcrossTiles,_),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((b,E)=>b.sortKey-E.sortKey));this._currentPartIndex<x.length;){const b=x[this._currentPartIndex];if(n.placeLayerBucketPart(b,this._seenCrossTileIDs,c,b.symbolInstanceStart===0,_),this._currentPartIndex++,m())return!0}return!1}}class zn{constructor(t,n,c,d,m,_,x,b,E){this.placement=new iy(t,m,_,x,b,E),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=d,this._done=!1}isDone(){return this._done}continuePlacement(t,n,c,d,m){const _=o.o.now(),x=()=>{const b=o.o.now()-_;return!this._forceFullPlacement&&b>2};for(;this._currentPlacementIndex>=0;){const b=n[t[this._currentPlacementIndex]],E=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&b.visibility!=="none"&&(!b.minzoom||b.minzoom<=E)&&(!b.maxzoom||b.maxzoom>E)){const I=b,L=I.layout.get("symbol-z-elevate"),D=I.layout.get("symbol-sort-key").constantOr(1)!==void 0,z=I.layout.get("symbol-z-order"),B=z==="viewport-y"||z==="auto"&&!(z!=="viewport-y"&&D),F=I.layout.get("text-allow-overlap")||I.layout.get("icon-allow-overlap")||I.layout.get("text-ignore-placement")||I.layout.get("icon-ignore-placement"),H=B&&F,G=this._inProgressLayer=this._inProgressLayer||new Hl(I),Z=o.B(b.source,b.scope);if(G.continuePlacement(L||H?d[Z]:c[Z],this.placement,this._showCollisionBoxes,b,x,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const to=512/o.al/2;class ra{constructor(t,n,c){this.tileID=t,this.bucketInstanceId=c,this.index=new o.c4(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const d=t.canonical.x*o.al,m=t.canonical.y*o.al;for(let _=0;_<n.length;_++){const{key:x,crossTileID:b,tileAnchorX:E,tileAnchorY:I}=n.get(_),L=Math.floor((d+E)*to),D=Math.floor((m+I)*to);this.index.add(L,D),this.keys.push(x),this.crossTileIDs.push(b)}this.index.finish()}findMatches(t,n,c){const d=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),m=to/Math.pow(2,n.canonical.z-this.tileID.canonical.z),_=n.canonical.x*o.al,x=n.canonical.y*o.al;for(let b=0;b<t.length;b++){const E=t.get(b);if(E.crossTileID)continue;const{key:I,tileAnchorX:L,tileAnchorY:D}=E,z=Math.floor((_+L)*m),B=Math.floor((x+D)*m),F=this.index.range(z-d,B-d,z+d,B+d).sort((H,G)=>H-G);for(const H of F){const G=this.crossTileIDs[H];if(this.keys[H]===I&&!c.has(G)){c.add(G),E.crossTileID=G;break}}}}}class Cn{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Wd{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const n=Math.round((t-this.lng)/360);if(n!==0)for(const c in this.indexes){const d=this.indexes[c],m={};for(const _ in d){const x=d[_];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+n),m[x.tileID.key]=x}this.indexes[c]=m}this.lng=t}addBucket(t,n,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let m=0;m<n.symbolInstances.length;m++)n.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const d=this.usedCrossTileIDs[t.overscaledZ];for(const m in this.indexes){const _=this.indexes[m];if(Number(m)>t.overscaledZ)for(const x in _){const b=_[x];b.tileID.isChildOf(t)&&b.findMatches(n.symbolInstances,t,d)}else{const x=_[t.scaledTo(Number(m)).key];x&&x.findMatches(n.symbolInstances,t,d)}}for(let m=0;m<n.symbolInstances.length;m++){const _=n.symbolInstances.get(m);_.crossTileID||(_.crossTileID=c.generate(),d.add(_.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new ra(t,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(t,n){for(const c of n.crossTileIDs)this.usedCrossTileIDs[t].delete(c)}removeStaleBuckets(t){let n=!1;for(const c in this.indexes){const d=this.indexes[c];for(const m in d)t[d[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,d[m]),delete d[m],n=!0)}return n}}class bo{constructor(){this.layerIndexes={},this.crossTileIDs=new Cn,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,n,c,d){let m=this.layerIndexes[t.fqid];m===void 0&&(m=this.layerIndexes[t.fqid]=new Wd);let _=!1;const x={};d.name!=="globe"&&m.handleWrapJump(c);for(const b of n){const E=b.getBucket(t);E&&t.fqid===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(b.tileID,E,this.crossTileIDs)&&(_=!0),x[E.bucketInstanceId]=!0)}return m.removeStaleBuckets(x)&&(_=!0),_}pruneUnusedLayers(t){const n={};t.forEach(c=>{n[c]=!0});for(const c in this.layerIndexes)n[c]||delete this.layerIndexes[c]}}const Bo=771;class gi{constructor(t,n,c,d){this.blendFunction=t,this.blendColor=n.toNonPremultipliedRenderColor(null),this.mask=c,this.blendEquation=d}}gi.Replace=[1,0,1,0],gi.disabled=new gi(gi.Replace,o.ao.transparent,[!1,!1,!1,!1]),gi.unblended=new gi(gi.Replace,o.ao.transparent,[!0,!0,!0,!0]),gi.alphaBlended=new gi([1,Bo,1,Bo],o.ao.transparent,[!0,!0,!0,!0]),gi.alphaBlendedNonPremultiplied=new gi([770,Bo,770,Bo],o.ao.transparent,[!0,!0,!0,!0]),gi.multiply=new gi([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),gi.additive=new gi([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Bt{constructor(t,n,c){this.func=t,this.mask=n,this.range=c}}Bt.ReadOnly=!1,Bt.ReadWrite=!0,Bt.disabled=new Bt(519,Bt.ReadOnly,[0,1]);const Ku=7680;class oi{constructor(t,n,c,d,m,_){this.test=t,this.ref=n,this.mask=c,this.fail=d,this.depthFail=m,this.pass=_}}oi.disabled=new oi({func:519,mask:0},0,0,Ku,Ku,Ku);const ql=1029,Yu=2305;class si{constructor(t,n,c){this.enable=t,this.mode=n,this.frontFace=c}}function No(l,t){const n=o.ca(l,3);o.cc(l,t),o.cg(l,3,n)}function Zd(l,t){const n=o.c7([]);return o.c8(n,n,-t),o.c9(n,n,-l),n}function Ju(l,t){const n=[l[0],l[1],0],c=[t[0],t[1],0];if(o.ag(n)>=1e-15){const _=o.aw([],n);o.c5(c,_,o.bJ(c,_)),t[0]=c[0],t[1]=c[1]}const d=o.bI([],t,l);if(o.c6(d)<1e-15)return null;const m=Math.atan2(-d[1],d[0]);return Zd(Math.atan2(Math.sqrt(l[0]*l[0]+l[1]*l[1]),-l[2]),m)}si.disabled=new si(!1,ql,Yu),si.backCCW=new si(!0,ql,Yu),si.backCW=new si(!0,ql,2304),si.frontCW=new si(!0,1028,2304),si.frontCCW=new si(!0,1028,Yu);class gs{constructor(t,n){this.position=t,this.orientation=n}get position(){return this._position}set position(t){if(t){const n=t instanceof o.ae?t:new o.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(n.x=o.bT(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(t,n,c){if(this.orientation=null,!this.position)return;const d=this.position,m=c||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(t)):0),_=o.ae.fromLngLat(t,m),x=[_.x-d.x,_.y-d.y,_.z-d.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Ju(x,n)}setPitchBearing(t,n){this.orientation=Zd(o.an(t),o.an(-n))}}class Qu{constructor(t,n){this._transform=o.bA([]),this.orientation=n,this.position=t}get mercatorPosition(){const t=this.position;return new o.ae(t[0],t[1],t[2])}get position(){const t=o.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var n;t&&o.cg(this._transform,3,[(n=t)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.c7([]),t&&No(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,n){this._orientation=Zd(t,n),No(this._transform,this._orientation)}forward(){const t=o.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,n){const c=new Float64Array(16);return o.bl(c,this.getWorldToCamera(t,n)),c}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,n,c){const d=this.position;o.c5(d,d,-t);const m=new Float64Array(16);return o.bq(m,[c,c,c]),o.br(m,m,d),m[10]*=n,m}getWorldToCamera(t,n){const c=new Float64Array(16),d=new Float64Array(4),m=this.position;return o.cb(d,this._orientation),o.c5(m,m,-t),o.cc(c,d),o.br(c,c,m),c[1]*=-1,c[5]*=-1,c[9]*=-1,c[13]*=-1,c[8]*=n,c[9]*=n,c[10]*=n,c[11]*=n,c}getCameraToClipPerspective(t,n,c,d){const m=new Float64Array(16);return o.cd(m,t,n,c,d),m}getCameraToClipOrthographic(t,n,c,d,m,_){const x=new Float64Array(16);return o.ce(x,t,n,c,d,m,_),x}getDistanceToElevation(t,n=!1){const c=t===0?0:o.cf(t,n?o.a$(this.position[1]):this.position[1]),d=this.forward();return(c-this.position[2])/d[2]}clone(){return new Qu([...this.position],[...this.orientation])}}const Un={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class eh{constructor(t=0,n=0,c=0,d=0){if(isNaN(t)||t<0||isNaN(n)||n<0||isNaN(c)||c<0||isNaN(d)||d<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=c,this.right=d}interpolate(t,n,c){return n.top!=null&&t.top!=null&&(this.top=o.ak(t.top,n.top,c)),n.bottom!=null&&t.bottom!=null&&(this.bottom=o.ak(t.bottom,n.bottom,c)),n.left!=null&&t.left!=null&&(this.left=o.ak(t.left,n.left,c)),n.right!=null&&t.right!=null&&(this.right=o.ak(t.right,n.right,c)),this}getCenter(t,n){const c=o.aA((this.left+t-this.right)/2,0,t),d=o.aA((this.top+n-this.bottom)/2,0,n);return new o.P(c,d)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new eh(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const wo=15;class Xd{constructor(t,n,c,d,m,_,x){this.tileSize=512,this._renderWorldCopies=m===void 0||m,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=c??0,this._maxPitch=d??60,this.setProjection(_),this.setMaxBounds(x),this.width=0,this.height=0,this._center=new o.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new eh,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Qu,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new Xd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<wo}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,n=!1){const c=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||c)&&this._updateCameraOnTerrain(),(t||c)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const n=this.projection?this.getProjection():void 0;this.projection=o.cm(this.projectionOptions);const c=this.getProjection(),d=!o.by(n,c);return d&&this._calcMatrices(),this.mercatorFromTransition=!1,d}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cm({name:"mercator"});const n=t!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const n=-t*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=o.cn(),o.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const n=o.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const n=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const c=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&c.exaggeration()&&this._centerAltitudeValidForExaggeration!==c.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*c.exaggeration(),this._centerAltitudeValidForExaggeration=c.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=c.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],c=this.horizonLineFromTop();let d=0,m=0;for(let _=0;_<n.length;_++){const x=new o.P(n[_][0]*this.width,c+n[_][1]*(this.height-c)),b=t.pointCoordinate(x);if(!b)continue;const E=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);d+=b[3]*E,m+=E}return m===0?NaN:d/m}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),c=this.pixelsPerMeter/this.worldSize*n,d=this._mercatorZfromZoom(t),m=this._mercatorZfromZoom(this._maxZoom),_=Math.max(d-c,m);this._setZoom(this._zoomFromMercatorZ(_))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const n=this.elevation,c=t.elevation,d=n!=null!=(c!=null)||n&&c&&n.exaggeration()!==c.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!d}computeZoomRelativeTo(t){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let c;c=t.z<this._camera.position[2]?[n.x,n.y,n.z]:[t.x,t.y,t.z];const d=o.ag(o.av([],this._camera.position,c));return o.aA(this._zoomFromMercatorZ(d),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let n=!1;if(t.orientation&&!o.cp(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){const c=[t.position.x,t.position.y,t.position.z];o.cq(c,this._camera.position)||(this._setCameraPosition(c),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,n=new gs;return n.position=new o.ae(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(t){if(!o.cr(t))return!1;o.cs(t,t);const n=o.ct([],[0,0,-1],t),c=o.ct([],[0,-1,0],t);if(c[2]<0)return!1;const d=Ju(n,c);return!!d&&(this._camera.orientation=d,!0)}_setCameraPosition(t){const n=this.zoomScale(this.minZoom)*this.tileSize,c=this.zoomScale(this.maxZoom)*this.tileSize,d=this.cameraToCenterDistance;t[2]=o.aA(t[2],d/c,d/n),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,n,c){this._unmodified=!1,this._edgeInsets.interpolate(t,n,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const n=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(t){const n=[new o.cu(0,t)];if(this.renderWorldCopies){const c=this.pointCoordinate(new o.P(0,0)),d=this.pointCoordinate(new o.P(this.width,0)),m=this.pointCoordinate(new o.P(this.width,this.height)),_=this.pointCoordinate(new o.P(0,this.height)),x=Math.floor(Math.min(c.x,d.x,m.x,_.x)),b=Math.floor(Math.max(c.x,d.x,m.x,_.x)),E=1;for(let I=x-E;I<=b+E;I++)I!==0&&n.push(new o.cu(I,t))}return n}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,n,c,d){let m=[];const _=c!=null,x=!_;if(x&&this.zoom<n||_&&c[0]===0&&c[1]===0)return m;const b=new Set,E=(L,D,z,B,F)=>{const H=o.cY(D,L,z,B,F);b.has(H)||(m.push(new o.aQ(L,D,z,B,F)),b.add(H))};for(let L=0;L<t.length;L++){const D=t[L];if(x&&D.canonical.z!==n||_&&d!==void 0&&d>D.canonical.z)continue;const z=D.canonical,B=D.overscaledZ,F=D.wrap,H=1<<z.z,G=z.x+1<H,Z=z.x>0,Y=z.y+1<H,X=z.y>0,ce=D.wrap-(Z?0:1),ne=D.wrap+(G?0:1),ae=Z?z.x-1:H-1,re=G?z.x+1:0;if(_)c[0]<0?(E(B,ne,z.z,re,z.y),c[1]<0&&Y&&(E(B,F,z.z,z.x,z.y+1),E(B,ne,z.z,re,z.y+1)),c[1]>0&&X&&(E(B,F,z.z,z.x,z.y-1),E(B,ne,z.z,re,z.y-1))):c[0]>0?(E(B,ce,z.z,ae,z.y),c[1]<0&&Y&&(E(B,F,z.z,z.x,z.y+1),E(B,ce,z.z,ae,z.y+1)),c[1]>0&&X&&(E(B,F,z.z,z.x,z.y-1),E(B,ce,z.z,ae,z.y-1))):c[1]<0&&Y?E(B,F,z.z,z.x,z.y+1):X&&E(B,F,z.z,z.x,z.y-1);else{const ee=D.visibleQuadrants;1&ee&&(E(B,ce,z.z,ae,z.y),X&&(E(B,F,z.z,z.x,z.y-1),E(B,ce,z.z,ae,z.y-1))),2&ee&&(E(B,ne,z.z,re,z.y),X&&(E(B,F,z.z,z.x,z.y-1),E(B,ne,z.z,re,z.y-1))),4&ee&&(E(B,ce,z.z,ae,z.y),Y&&(E(B,F,z.z,z.x,z.y+1),E(B,ce,z.z,ae,z.y+1))),8&ee&&(E(B,ne,z.z,re,z.y),Y&&(E(B,F,z.z,z.x,z.y+1),E(B,ne,z.z,re,z.y+1)))}}const I=[];for(const L of m)m.some(D=>L.isChildOf(D))||I.push(L);if(m=I.filter(L=>!t.some(D=>!!(L.overscaledZ<n&&D.isChildOf(L))||L.equals(D)||L.isChildOf(D))),x){const L=1<<n,D=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),z=[L*D.x,L*D.y],B=4,F=B*B;m=m.filter(H=>{const G=H.canonical.x+.5-z[0],Z=H.canonical.y+.5-z[1];return G*G+Z*Z<F})}return m}extendTileCoverToNearPlane(t,n,c){const d=[],m=new Set;for(const Z of t)m.add(Z.key);const _=(Z,Y,X,ce,ne)=>{const ae=o.cY(Y,Z,X,ce,ne);m.has(ae)||(d.push(new o.aQ(Z,Y,X,ce,ne)),m.add(ae))},x=t.reduce((Z,Y)=>Math.max(Z,Y.overscaledZ),c),b=1<<c,E=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],I=new o.P(0,0),L=new o.P(0,0),D=(Z,Y)=>{const X=Math.floor(Z[0]),ce=Math.floor(Z[1]),ne=(Z[0]-X)*o.al,ae=(Z[1]-ce)*o.al,re=Math.floor(Y[0]),ee=Math.floor(Y[1]),ue=(Y[0]-re)*o.al,be=(Y[1]-ee)*o.al;for(let xe=-1;xe<=1;xe++){const De=X+xe;if(!(De<0||De>=b)){I.x=ne-xe*o.al,L.x=ue-(De-re)*o.al;for(let Le=-1;Le<=1;Le++){const Ue=ce+Le;I.y=ae-Le*o.al,L.y=be-(Ue-ee)*o.al,o.cZ(I,L,E)&&_(x,0,c,De,Ue)}}}},z=n.points,B=z[o.cv],F=z[o.cw],H=this._projectToGround(B,z[o.cx]),G=this._projectToGround(F,z[o.cy]);return D(B,H),D(F,G),d}_projectToGround(t,n){return o.cz(o.cA(),t,n,t[2]/(t[2]-n[2]))}coveringTiles(t){let n=this.coveringZoomLevel(t);const c=n,d=this.elevation&&this.elevation.exaggeration(),m=d&&!t.isTerrainDEM,_=this.projection.name==="mercator";if(t.minzoom!==void 0&&n<t.minzoom)return[];t.maxzoom!==void 0&&n>t.maxzoom&&(n=t.maxzoom);const x=this.locationCoordinate(this.center),b=this.center.lat,E=1<<n,I=[E*x.x,E*x.y,0],L=this.projection.name==="globe",D=!L,z=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,D),B=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),F=E*o.cf(1,this.center.lat),H=this._camera.position[2]/o.cf(1,this.center.lat),G=[E*B.x,E*B.y,H*(D?1:F)],Z=L||d,Y=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),X=this.isLODDisabled(!0)?n:0;let ce;if(this._elevation&&t.isTerrainDEM)ce=1e4*this._elevation.exaggeration();else if(this._elevation){const _e=this._elevation.getMinMaxForVisibleTiles();ce=_e?_e.max:this._centerAltitude}else ce=this._centerAltitude;const ne=t.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,ae=this.projection.isReprojectedInTileSpace?o.cC(this):1,re=_e=>{const Pe=new o.ae(_e.x+25e-6,_e.y,_e.z),We=new o.ae(_e.x,_e.y+25e-6,_e.z),dt=_e.toLngLat(),Tt=Pe.toLngLat(),ct=We.toLngLat(),nt=this.locationCoordinate(dt),kt=this.locationCoordinate(Tt),Dt=this.locationCoordinate(ct),xt=Math.hypot(kt.x-nt.x,kt.y-nt.y),Et=Math.hypot(Dt.x-nt.x,Dt.y-nt.y);return Math.sqrt(xt*Et)*ae/25e-6},ee=_e=>{const Fe=ce,Pe=ne;return{aabb:o.cF(this,E,0,0,0,_e,Pe,Fe,this.projection),zoom:0,x:0,y:0,minZ:Pe,maxZ:Fe,wrap:_e,fullyVisible:!1}},ue=[];let be=[];const xe=n,De=t.reparseOverscaled?c:n,Le=(H-this._centerAltitude)*F,Ue=_e=>{if(!this._elevation||!_e.tileID||!_)return;const Fe=this._elevation.getMinMaxForTile(_e.tileID),Pe=_e.aabb;Fe?(Pe.min[2]=Fe.min,Pe.max[2]=Fe.max,Pe.center[2]=(Pe.min[2]+Pe.max[2])/2):(_e.shouldSplit=Ce(_e),_e.shouldSplit||(Pe.min[2]=Pe.max[2]=Pe.center[2]=this._centerAltitude))},it=(_e,Fe)=>{if(.707*Fe<_e)return 1;const Pe=Fe/_e;return Pe/(1.4144271570014144+(Math.pow(1.1,Pe-1.4144271570014144+1)-1)/(1.1-1)-1)},Ce=_e=>{if(_e.zoom<X)return!0;if(_e.zoom===xe)return!1;if(_e.shouldSplit!=null)return _e.shouldSplit;const Fe=_e.aabb.distanceX(G),Pe=_e.aabb.distanceY(G);let We=Le,dt=1;if(L){We=_e.aabb.distanceZ(G);const Et=Math.pow(2,_e.zoom),$t=o.a$((_e.y+1)/Et),di=o.a$(_e.y/Et),Ri=Math.min(Math.max(b,$t),di),Yi=o.d1(Ri)/o.d1(b);if(dt=Ri===b?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Yi/this._mercatorScaleRatio),this.zoom<=o.c_&&_e.zoom===xe-1&&Yi>=.9)return!0}else if(m&&(We=_e.aabb.distanceZ(G)*F),this.projection.isReprojectedInTileSpace&&c<=5){const Et=Math.pow(2,_e.zoom),$t=re(new o.ae((_e.x+.5)/Et,(_e.y+.5)/Et));dt=$t>.85?1:$t}if(!_&&!L){const Et=Math.sqrt(Fe*Fe+Pe*Pe+We*We);let $t=(1<<xe-_e.zoom)*Y*dt;return $t*=it(Math.max(We,Le),Et),Et<$t}let Tt=Number.MAX_VALUE,ct=0;const nt=_e.aabb.getCorners(),kt=[];for(const Et of nt){o.av(kt,Et,G),L||(m?kt[2]*=F:kt[2]=Le);const $t=o.bJ(kt,this._camera.forward());$t<Tt&&(Tt=$t,ct=Math.abs(kt[2]))}let Dt=(1<<xe-_e.zoom)*Y*dt;if(Dt*=it(Math.max(ct,Le),Tt),Tt<Dt)return!0;const xt=_e.aabb.closestPoint(I);return xt[0]===I[0]&&xt[1]===I[1]};if(this.renderWorldCopies)for(let _e=1;_e<=3;_e++)ue.push(ee(-_e)),ue.push(ee(_e));for(ue.push(ee(0));ue.length>0;){const _e=ue.pop(),Fe=_e.x,Pe=_e.y;let We=_e.fullyVisible;const dt=()=>this.projection.name==="globe"&&(_e.y===0||_e.y===(1<<_e.zoom)-1);if(!We){let Tt=Z?_e.aabb.intersects(z):_e.aabb.intersectsFlat(z);if(Tt===0&&dt()){const ct=new o.cD(_e.zoom,Fe,Pe);Tt=o.cE(this,E,ct,!0).intersects(z)}if(Tt===0)continue;We=Tt===2}if(_e.zoom!==xe&&Ce(_e))for(let Tt=0;Tt<4;Tt++){const ct=(Fe<<1)+Tt%2,nt=(Pe<<1)+(Tt>>1),kt={aabb:_?_e.aabb.quadrant(Tt):o.cF(this,E,_e.zoom+1,ct,nt,_e.wrap,_e.minZ,_e.maxZ,this.projection),zoom:_e.zoom+1,x:ct,y:nt,wrap:_e.wrap,fullyVisible:We,tileID:void 0,shouldSplit:void 0,minZ:_e.minZ,maxZ:_e.maxZ};m&&!L&&(kt.tileID=new o.aQ(_e.zoom+1===xe?De:_e.zoom+1,_e.wrap,_e.zoom+1,ct,nt),Ue(kt)),ue.push(kt)}else{const Tt=_e.zoom===xe?De:_e.zoom;if(t.minzoom&&t.minzoom>Tt)continue;let ct=0;if(!We){let xt=Z?_e.aabb.intersectsPrecise(z):_e.aabb.intersectsPreciseFlat(z);if(xt===0&&dt()){const Et=new o.cD(_e.zoom,Fe,Pe);xt=o.cE(this,E,Et,!0).intersectsPrecise(z)}if(xt===0)continue;if(t.calculateQuadrantVisibility)if(z.containsPoint(_e.aabb.center))ct=15;else for(let Et=0;Et<4;Et++)_e.aabb.quadrant(Et).intersects(z)!==0&&(ct|=1<<Et)}const nt=I[0]-(.5+Fe+(_e.wrap<<_e.zoom))*(1<<n-_e.zoom),kt=I[1]-.5-Pe,Dt=_e.tileID?_e.tileID:new o.aQ(Tt,_e.wrap,_e.zoom,Fe,Pe);t.calculateQuadrantVisibility&&(Dt.visibleQuadrants=ct),be.push({tileID:Dt,distanceSq:nt*nt+kt*kt})}}if(this.fogCullDistSq){const _e=this.fogCullDistSq,Fe=this.horizonLineFromTop();be=be.filter(Pe=>{const We=[0,0,0,1],dt=[o.al,o.al,0,1],Tt=this.calculateFogTileMatrix(Pe.tileID.toUnwrapped());o.aC(We,We,Tt),o.aC(dt,dt,Tt);const ct=o.cG([],We,dt),nt=o.cH([],We,dt),kt=o.c$(ct,nt);if(kt===0)return!0;let Dt=!1;const xt=this._elevation;if(xt&&kt>_e&&Fe!==0){const Et=this.calculateProjMatrix(Pe.tileID.toUnwrapped());let $t;t.isTerrainDEM||($t=xt.getMinMaxForTile(Pe.tileID)),$t||($t={min:ne,max:ce});const di=o.cI(this.rotation),Ri=[di[0]*o.al,di[1]*o.al,$t.max];o.af(Ri,Ri,Et),Dt=(1-Ri[1])*this.height*.5<Fe}return kt<_e||Dt})}return be.sort((_e,Fe)=>_e.distanceSq-Fe.distanceSq).map(_e=>_e.tileID)}resize(t,n){this.width=t,this.height=n,this.pixelsToGLUnits=[2/t,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const n=o.aA(t.lat,-o.cJ,o.cJ),c=this.projection.project(t.lng,n);return new o.P(c.x*this.worldSize,c.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,n){let c,d;const m=this.centerPoint;if(this.projection.name==="globe"){const x=this.worldSize;c=(n.x-m.x)/x,d=(n.y-m.y)/x}else{const x=this.pointCoordinate(n),b=this.pointCoordinate(m);c=x.x-b.x,d=x.y-b.y}const _=this.locationCoordinate(t);this.setLocation(new o.ae(_.x-c,_.y-d))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,n){return this.projection.locationPoint(this,t,n)}locationPoint3D(t,n){return this.projection.locationPoint(this,t,n,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,n){return this.coordinateLocation(this.pointCoordinate3D(t,n))}locationCoordinate(t,n){const c=n?o.cf(n,t.lat):void 0,d=this.projection.project(t.lng,t.lat);return new o.ae(d.x,d.y,c)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,n){const c=n??this._centerAltitude,d=[t.x,t.y,0,1],m=[t.x,t.y,1,1];o.aC(d,d,this.pixelMatrixInverse),o.aC(m,m,this.pixelMatrixInverse);const _=m[3];o.cK(d,d,1/d[3]),o.cK(m,m,1/_);const x=d[2],b=m[2];return{p0:d,p1:m,t:x===b?0:(c-x)/(b-x)}}screenPointToMercatorRay(t){const n=[t.x,t.y,0,1],c=[t.x,t.y,1,1];return o.aC(n,n,this.pixelMatrixInverse),o.aC(c,c,this.pixelMatrixInverse),o.cK(n,n,1/n[3]),o.cK(c,c,1/c[3]),n[2]=o.cf(n[2],this._center.lat)*this.worldSize,c[2]=o.cf(c[2],this._center.lat)*this.worldSize,o.cK(n,n,1/this.worldSize),o.cK(c,c,1/this.worldSize),new o.ax([n[0],n[1],n[2]],o.aw([],o.av([],c,n)))}rayIntersectionCoordinate(t){const{p0:n,p1:c,t:d}=t,m=o.cf(n[2],this._center.lat),_=o.cf(c[2],this._center.lat);return new o.ae(o.ak(n[0],c[0],d)/this.worldSize,o.ak(n[1],c[1],d)/this.worldSize,o.ak(m,_,d))}pointCoordinate(t,n=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,n)}pointCoordinate3D(t,n){if(!this.elevation)return this.pointCoordinate(t,n);let c=this.projection.pointCoordinate3D(this,t.x,t.y);if(c)return new o.ae(c[0],c[1],c[2]);let d=0,m=this.horizonLineFromTop();if(t.y>m)return this.pointCoordinate(t,n);const _=.02*m,x=t.clone();for(let b=0;b<10&&m-d>_;b++){x.y=o.ak(d,m,.66);const E=this.projection.pointCoordinate3D(this,x.x,x.y);E?(m=x.y,c=E):d=x.y}return c?new o.ae(c[0],c[1],c[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cL)return!this.isPointAboveHorizon(t);const n=this.pointCoordinate(t);return n.y>=0&&n.y<=1}_coordinatePoint(t,n){const c=n&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,d=[t.x*this.worldSize,t.y*this.worldSize,c+t.toAltitude(),1];return o.aC(d,d,this.pixelMatrix),d[3]>0?new o.P(d[0]/d[3],d[1]/d[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:n}=this._edgeInsets,c=this.height-this._edgeInsets.bottom,d=this.width-this._edgeInsets.right,m=this.pointLocation3D(new o.P(n,t)),_=this.pointLocation3D(new o.P(d,t)),x=this.pointLocation3D(new o.P(d,c)),b=this.pointLocation3D(new o.P(n,c));let E=Math.min(m.lng,_.lng,x.lng,b.lng),I=Math.max(m.lng,_.lng,x.lng,b.lng),L=Math.min(m.lat,_.lat,x.lat,b.lat),D=Math.max(m.lat,_.lat,x.lat,b.lat);const z=Math.pow(2,-this.zoom)/16*270,B=this.projection.name==="globe"?1:4,F=(H,G,Z,Y,X)=>{const ce=(H+Z)/2,ne=(G+Y)/2,ae=new o.P(ce,ne),{lng:re,lat:ee}=this.pointLocation3D(ae),ue=Math.max(0,E-re,L-ee,re-I,ee-D);E=Math.min(E,re),I=Math.max(I,re),L=Math.min(L,ee),D=Math.max(D,ee),(X<B||ue>z)&&(F(H,G,ce,ne,X+1),F(ce,ne,Z,Y,X+1))};if(F(n,t,d,t,1),F(d,t,d,c,1),F(d,c,n,c,1),F(n,c,n,t,1),this.projection.name==="globe"){const[H,G]=o.cM(this);H?(D=90,I=180,E=-180):G&&(L=-90,I=180,E=-180)}return new o.aI(new o.aT(E,L),new o.aT(I,D))}_getBoundsRectangular(t,n){const{top:c,left:d}=this._edgeInsets,m=this.height-this._edgeInsets.bottom,_=this.width-this._edgeInsets.right,x=new o.P(d,c),b=new o.P(_,c),E=new o.P(_,m),I=new o.P(d,m);let L=this.pointCoordinate(x,t),D=this.pointCoordinate(b,t);const z=this.pointCoordinate(E,n),B=this.pointCoordinate(I,n),F=(H,G)=>(G.y-H.y)/(G.x-H.x);return L.y>1&&D.y>=0?L=new o.ae((1-B.y)/F(B,L)+B.x,1):L.y<0&&D.y<=1&&(L=new o.ae(-B.y/F(B,L)+B.x,0)),D.y>1&&L.y>=0?D=new o.ae((1-z.y)/F(z,D)+z.x,1):D.y<0&&L.y<=1&&(D=new o.ae(-z.y/F(z,D)+z.x,0)),new o.aI().extend(this.coordinateLocation(L)).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(B)).extend(this.coordinateLocation(z))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const n=t.visibleDemTiles.reduce((c,d)=>{if(d.dem){const m=d.dem.tree;c.min=Math.min(c.min,m.minimums[0]),c.max=Math.max(c.max,m.maximums[0])}return c},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*t.exaggeration(),n.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,c=this.height/2-n*(1-this._horizonShift);return t?Math.max(0,c):c}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.cJ,this.maxLat=o.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,n){return this.projection.createTileMatrix(this,n,t)}calculateDistanceTileData(t){const n=t.key,c=this._distanceTileDataCache;if(c[n])return c[n];const d=t.canonical,m=1/this.height,_=this.cameraWorldSize,x=_/this.zoomScale(d.z),b=(d.x+Math.pow(2,d.z)*t.wrap)*x,E=d.y*x,I=this.point;I.x*=_/this.worldSize,I.y*=_/this.worldSize;const L=this.angle,D=Math.sin(-L),z=-Math.cos(-L);return c[n]={bearing:[D,z],center:[(I.x-b)*m,(I.y-E)*m],scale:x/o.al*m},c[n]}calculateFogTileMatrix(t){const n=t.key,c=this._fogTileMatrixCache;if(c[n])return c[n];const d=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.aB(d,this.worldToFogMatrix,d),c[n]=new Float32Array(d),c[n]}calculateProjMatrix(t,n=!1,c=!1){const d=t.key;let m;if(m=c?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,m[d])return m[d];const _=this.calculatePosMatrix(t,this.worldSize);let x;return x=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,o.aB(_,x,_),m[d]=new Float32Array(_),m[d]}calculatePixelsToTileUnitsMatrix(t){const n=t.tileID.key,c=this._pixelsToTileUnitsCache;if(c[n])return c[n];const d=o.cN(t,this);return c[n]=d,c[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,n=o.bq([],[t,t,t]);return o.aB(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const n=o.cf(1,this._center.lat)*this.worldSize,c=this._computeCameraPosition(n),d=this._camera.forward(),m=o.cf(1,this._center.lat);c[2]/=m,d[2]/=m,o.aw(d,d);const _=t.raycast(c,d,t.exaggeration());if(_){const x=o.bH([],c,d,_),b=new o.ae(x[0],x[1],o.cf(x[2],o.a$(x[1]))),E=(b.z+o.ag([b.x-c[0],b.y-c[1],b.z-c[2]*m]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(E),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const n=this._elevation,c=o.cf(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(c),m=n.getAtPointOrZero(new o.ae(...d)),_=this.pixelsPerMeter/this.worldSize*m,x=this._minimumHeightOverTerrain(),b=d[2]-_;if(b<=x)if(b<0||t){const E=this.locationCoordinate(this._center,this._centerAltitude),I=[d[0],d[1],E.z-d[2]],L=o.ag(I);I[2]-=(x-b)/this._pixelsPerMercatorPixel;const D=o.ag(I);if(D===0)return;o.c5(I,I,L/D*this._pixelsPerMercatorPixel),this._camera.position=[d[0],d[1],E.z*this._pixelsPerMercatorPixel-I[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const D=this.center;return D.lat=o.aA(D.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(D.lng=o.aA(D.lng,this.minLng,this.maxLng)),this.center=D,void(this._constraining=!1)}const n=this._unmodified,{x:c,y:d}=this.point;let m=0,_=c,x=d;const b=this.width/2,E=this.height/2,I=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(d-E<I&&(x=I+E),d+E>L&&(x=L-E),L-I<this.height&&(m=Math.max(m,this.height/(L-I)),x=(L+I)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const D=this.worldMinX*this.scale,z=this.worldMaxX*this.scale,B=this.worldSize/2-(D+z)/2;_=(c+B+this.worldSize)%this.worldSize-B,_-b<D&&(_=D+b),_+b>z&&(_=z-b),z-D<this.width&&(m=Math.max(m,this.width/(z-D)),_=(z+D)/2)}_===c&&x===d||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(_,x))),m&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(m)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,n=this.projection.name==="globe",c=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cf(1,this.center.lat)/o.cf(1,o.d2));const d=o.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,d),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const m=this.projection.zAxisUnit==="meters"?c:1,_=this._camera.getWorldToCamera(this.worldSize,m);let x;const b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(b[8]=2*-t.x/this.width,b[9]=2*t.y/this.height,this.isOrthographic){let ee=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),ue=ee*this.aspect,be=-ue,xe=-ee;ue-=t.x,be-=t.x,ee+=t.y,xe+=t.y,x=this._camera.getCameraToClipOrthographic(be,ue,xe,ee,this._nearZ,this._farZ),((De,Le,Ue,it)=>{for(let Ce=0;Ce<16;Ce++)De[Ce]=o.ak(Le[Ce],Ue[Ce],it)})(x,x,b,o.d0(this.pitch>=wo?1:this.pitch/wo))}else x=b;const E=o.cP([],b,_);let I=o.cP([],x,_);if(this.projection.isReprojectedInTileSpace){const ee=this.locationCoordinate(this.center),ue=o.bA([]);o.br(ue,ue,[ee.x*this.worldSize,ee.y*this.worldSize,0]),o.aB(ue,ue,o.cQ(this)),o.br(ue,ue,[-ee.x*this.worldSize,-ee.y*this.worldSize,0]),o.aB(I,I,ue),o.aB(E,E,ue),this.inverseAdjustmentMatrix=o.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cS([],I,[this.worldSize,this.worldSize,this.worldSize/m,1]),this.projMatrix=I,this.invProjMatrix=o.bl(new Float64Array(16),this.projMatrix),n){const ee=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ee[8]=2*-t.x/this.width,ee[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cP([],ee,_)}else this.expandedFarZProjMatrix=this.projMatrix;const L=o.bl([],x);this.frustumCorners=o.cT.fromInvProjectionMatrix(L,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);const D=new Float32Array(16);o.bA(D),o.cS(D,D,[1,-1,1]),o.cU(D,D,this._pitch),o.bB(D,D,this.angle);const z=o.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bz(z);const B=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;z[8]=2*-t.x/this.width,z[9]=2*(t.y+B)/this.height,this.skyboxMatrix=o.aB(D,z,D);const F=this.point,H=F.x,G=F.y,Z=this.width%2/2,Y=this.height%2/2,X=Math.cos(this.angle),ce=Math.sin(this.angle),ne=H-Math.round(H)+X*Z+ce*Y,ae=G-Math.round(G)+X*Y+ce*Z,re=new Float64Array(I);if(o.br(re,re,[ne>.5?ne-1:ne,ae>.5?ae-1:ae,0]),this.alignedProjMatrix=re,I=o.bC(),o.cS(I,I,[this.width/2,-this.height/2,1]),o.br(I,I,[1,-1,0]),this.labelPlaneMatrix=I,I=o.bC(),o.cS(I,I,[1,-1,1]),o.br(I,I,[-1,-1,0]),o.cS(I,I,[2/this.width,2/this.height,1]),this.glCoordMatrix=I,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,E),this._calcFogMatrices(),this._distanceTileDataCache={},I=o.bl(new Float64Array(16),this.pixelMatrix),!I)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=I,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cV(this);const ee=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(ee,ee,_),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=I;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,c=this._camera.position,d=1/this.height/this._pixelsPerMercatorPixel,m=[t,t,n];o.c5(m,m,d),o.c5(c,c,-1),o.cW(c,c,m);const _=o.bC();o.br(_,_,c),o.cS(_,_,m),this.mercatorFogMatrix=_,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,n,d)}_computeCameraPosition(t){const n=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,c=this._camera.forward(),d=this.point,m=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-t/this.worldSize*this._centerAltitude;return[d.x/this.worldSize-c[0]*m,d.y/this.worldSize-c[1]*m,t/this.worldSize*this._centerAltitude-c[2]*m]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),c=this._camera.position[2],d=t[2];let m=1;this.projection.wrap&&(this.center=this.center.wrap()),d>0&&(m=Math.min((n-c)/d,1)),this._camera.position=o.bH([],this._camera.position,t,m),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,n=this._camera.forward(),{pitch:c,bearing:d}=this._camera.getPitchBearing(),m=o.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,_=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),x=Math.max((t[2]-m)/Math.cos(c),_),b=this._zoomFromMercatorZ(x);o.bH(t,t,n,x),this._pitch=o.aA(c,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bT(d,-Math.PI,Math.PI),this._setZoom(o.aA(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let n=0,c=o.cL,d=0,m=1/0;for(;c-n>1e-6&&c>n;){const _=n+.5*(c-n),x=this.tileSize*Math.pow(2,_),b=this.getCameraToCenterDistance(this.projection,_,x),E=this.scaleZoom(b/(Math.max(0,t)*this.tileSize)),I=Math.abs(_-E);I<m&&(m=I,d=_),_<E?n=_:c=_}return d}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,n){const c=Math.min(t.x,n.x),d=Math.max(t.x,n.x),m=Math.min(t.y,n.y),_=Math.max(t.y,n.y);if(m<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const x=[new o.P(c,m),new o.P(d,_),new o.P(c,_),new o.P(d,m)],b=this.renderWorldCopies?-3:0,E=this.renderWorldCopies?4:1;for(const I of x){const L=this.pointRayIntersection(I);if(L.t<0)return!0;const D=this.rayIntersectionCoordinate(L);if(D.x<b||D.y<0||D.x>E||D.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,n){const c=o.ag(o.av([],this._camera.position,t)),d=this._zoomFromMercatorZ(c)+n;return c-this._mercatorZfromZoom(d)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([n,c,d],m){const _=[n,c,d,1];o.aC(_,_,m);const x=_[3]=Math.max(_[3],1e-6);return _[0]/=x,_[1]/=x,_[2]/=x,_}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,n=this.zoom,c=this.worldSize){const d=o.cO(t,n,this.width,this.height,1024),m=t.pixelSpaceConversion(this.center.lat,c,d);let _=.5/Math.tan(.5*this._fov)*this.height*m;return this.isOrthographic&&(_=o.ak(1,_,o.d0(this.pitch>=wo?1:this.pitch/wo))),_}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(t,t,this.globeMatrix),t}getFrustum(t){return o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const za=(l,t)=>{if(t>0&&l.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||l.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=l.transform,c=Math.max(Math.abs(n._zoom-(l.minCutoffZoom-1)),1),d=n.isLODDisabled(!1)?o.ah(60,45,n.pitch):o.ah(30,15,n.pitch),m=n._farZ-n._nearZ,_=t*n.height,x=((1-(b=d))*n.cameraToCenterDistance+b*(n._farZ+_))*c;var b;return{shouldRenderCutoff:d<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(x-n._nearZ)/m,(x-_-n._nearZ)/m]}}},io=2048;class qc{constructor(t,n){this.aabb=t,this.lastCascade=n}}class ry{add(t,n){const c=this.receivers[t.key];c!==void 0?(c.aabb.min[0]=Math.min(c.aabb.min[0],n.min[0]),c.aabb.min[1]=Math.min(c.aabb.min[1],n.min[1]),c.aabb.min[2]=Math.min(c.aabb.min[2],n.min[2]),c.aabb.max[0]=Math.max(c.aabb.max[0],n.max[0]),c.aabb.max[1]=Math.max(c.aabb.max[1],n.max[1]),c.aabb.max[2]=Math.max(c.aabb.max[2],n.max[2])):this.receivers[t.key]=new qc(n,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,n,c){const d=o.d9.fromPoints(t.points);let m=0;for(const _ in this.receivers){const x=this.receivers[_];if(!x||!d.intersectsAabb(x.aabb))continue;x.aabb.min=d.closestPoint(x.aabb.min),x.aabb.max=d.closestPoint(x.aabb.max);const b=x.aabb.getCorners();for(let E=0;E<c.length;E++){let I=!0;for(const L of b){const D=[L[0]*n,L[1]*n,L[2]];if(o.af(D,D,c[E].matrix),D[0]<-1||D[0]>1||D[1]<-1||D[1]>1){I=!1;break}}if(x.lastCascade=E,m=Math.max(m,E),I)break}}return m+1}}class $l{constructor(t){this.painter=t,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new ry,this._depthMode=new Bt(t.context.gl.LEQUAL,Bt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,n){const c=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;const d=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||d<=0||(this._shadowLayerCount=c.style.order.reduce((B,F)=>{const H=c.style._mergedLayers[F];return B+(H.hasShadowPass()&&!H.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const m=c.context,_=io,x=io;if(this._cascades.length===0||io!==this._cascades[0].texture.size[0]){this._cascades=[];for(let B=0;B<2;++B){const F=c._shadowMapDebug,H=m.gl,G=m.createFramebuffer(_,x,F?1:0,"texture"),Z=new o.T(m,{width:_,height:x,data:null},H.DEPTH_COMPONENT16);if(G.depthAttachment.set(Z.texture),F){const Y=new o.T(m,{width:_,height:x,data:null},H.RGBA8);G.colorAttachment0.set(Y.texture)}this._cascades.push({framebuffer:G,texture:Z,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cB,scale:0})}}this.shadowDirection=Wc(n);let b=0;if(t.elevation){const B=t.elevation,F=[1e4,-1e4];B.visibleDemTiles.filter(H=>H.dem).forEach(H=>{const G=H.dem.tree;F[0]=Math.min(F[0],G.minimums[0]),F[1]=Math.max(F[1],G.maximums[0])}),F[0]!==1e4&&(b=(F[1]-F[0])*B.exaggeration())}const E=1.5*t.cameraToCenterDistance,I=3*E,L=new Float64Array(16);for(let B=0;B<this._cascades.length;++B){const F=this._cascades[B];let H=t.height/50,G=1;B===0?G=E:(H=E,G=I);const[Z,Y]=Oa(t,this.shadowDirection,H,G,io,b);F.scale=t.scale,F.matrix=Z,F.boundingSphereRadius=Y,o.bl(L,F.matrix),F.frustum=o.cB.fromInvProjectionMatrix(L,1,0,!0),F.far=G}const D=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[D].far,this._cascades[D].far],this._uniformValues.u_shadow_intensity=d,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=io,this._uniformValues.u_shadowmap_0=Un.ShadowMap0,this._uniformValues.u_shadowmap_1=Un.ShadowMap0+1,this._groundShadowTiles=c.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const z=c.transform.elevation;for(const B of this._groundShadowTiles){let F={min:0,max:0};if(z){const H=z.getMinMaxForTile(B);H&&(F=H)}this.addShadowReceiver(B.toUnwrapped(),F.min,F.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,n){if(!this.enabled)return;const c=this.painter,d=c.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(c.transform.getFrustum(0),c.transform.worldSize,this._cascades),d.viewport.set([0,0,io,io]);for(let m=0;m<this._numCascadesToRender;++m){c.currentShadowCascade=m,d.bindFramebuffer.set(this._cascades[m].framebuffer.framebuffer),d.clear({color:o.ao.white,depth:1});for(const _ of t.order){const x=t._mergedLayers[_];if(!x.hasShadowPass()||x.isHidden(c.transform.zoom))continue;const b=t.getLayerSourceCache(x),E=b?n[b.id]:void 0;(x.type==="model"||E&&E.length)&&c.renderLayer(c,b,x,E)}}c.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,n=t.style,c=t.context,d=c.gl,m=n.directionalLight,_=n.ambientLight;if(!m||!_)return;const x=[],b=za(t,t.longestCutoffRange);b.shouldRenderCutoff&&x.push("RENDER_CUTOFF"),x.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&x.push("NORMAL_OFFSET");const E=na(n,m,_),I=new Bt(d.LEQUAL,Bt.ReadOnly,t.depthRangeFor3D),L=new oi({func:d.EQUAL,mask:255},0,255,d.KEEP,d.KEEP,d.KEEP);for(const D of this._groundShadowTiles){const z=D.toUnwrapped(),B=t.isTileAffectedByFog(D),F=t.getOrCreateProgram("groundShadow",{defines:x,overrideFog:B});this.setupShadows(z,F),t.uploadCommonUniforms(c,F,z,null,b);const H={u_matrix:t.transform.calculateProjMatrix(z),u_ground_shadow_factor:E};F.draw(t,d.TRIANGLES,I,L,gi.multiply,si.disabled,H,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?gi.unblended:gi.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const n=this.painter.transform,c=n.calculatePosMatrix(t,n.worldSize);return o.aB(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}calculateShadowPassMatrixFromMatrix(t){const n=o.bz(t);return o.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,t),n}setupShadows(t,n,c){if(!this.enabled)return;const d=this.painter.transform,m=this.painter.context,_=m.gl,x=this._uniformValues,b=new Float64Array(16),E=d.calculatePosMatrix(t,d.worldSize);for(let I=0;I<this._cascades.length;I++)o.aB(b,this._cascades[I].matrix,E),x[I===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(b),m.activeTexture.set(_.TEXTURE0+Un.ShadowMap0+I),this._cascades[I].texture.bindExtraParam(_.LINEAR,_.LINEAR,_.CLAMP_TO_EDGE,_.CLAMP_TO_EDGE,_.GREATER);if(this.useNormalOffset=!!c,this.useNormalOffset){const I=o.d7(t.canonical),L=2/d.tileSize*o.al/io,D=L*this._cascades[0].boundingSphereRadius,z=L*this._cascades[this._cascades.length-1].boundingSphereRadius,B=(c==="vector-tile"?1:3)*function(F,H,G,Z,Y){const X=o.aA((F-22)/-22,0,1);return .125*(1-X)+4*X}(d.zoom);x.u_shadow_normal_offset=[I,D*B,z*B],x.u_shadow_bias=[1e-4,.0012,.012]}else x.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(m,x)}setupShadowsFromMatrix(t,n,c=!1){if(!this.enabled)return;const d=this.painter.context,m=d.gl,_=this._uniformValues,x=new Float64Array(16);for(let b=0;b<2;b++)o.aB(x,this._cascades[b].matrix,t),_[b===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(x),d.activeTexture.set(m.TEXTURE0+Un.ShadowMap0+b),this._cascades[b].texture.bindExtraParam(m.LINEAR,m.LINEAR,m.CLAMP_TO_EDGE,m.CLAMP_TO_EDGE,m.GREATER);this.useNormalOffset=c,c?(_.u_shadow_normal_offset=[1,3,3],_.u_shadow_bias=[6e-5,.0012,.012]):_.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(d,_)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,n,c,d){if(d[2]>=0)return{};const m=function(b,E,I){const L=I/(1<<b.canonical.z);return new o.d9([b.canonical.x*L+b.wrap*I,b.canonical.y*L+b.wrap*I,0],[(b.canonical.x+1)*L+b.wrap*I,(b.canonical.y+1)*L+b.wrap*I,E])}(t,n,c).getCorners(),_=n/-d[2];d[0]<0?(o.d8(m[0],m[0],[d[0]*_,0,0]),o.d8(m[3],m[3],[d[0]*_,0,0])):d[0]>0&&(o.d8(m[1],m[1],[d[0]*_,0,0]),o.d8(m[2],m[2],[d[0]*_,0,0])),d[1]<0?(o.d8(m[0],m[0],[0,d[1]*_,0]),o.d8(m[1],m[1],[0,d[1]*_,0])):d[1]>0&&(o.d8(m[2],m[2],[0,d[1]*_,0]),o.d8(m[3],m[3],[0,d[1]*_,0]));const x={};return x.vertices=m,x.planes=[$c(m[1],m[0],m[4]),$c(m[2],m[1],m[5]),$c(m[3],m[2],m[6]),$c(m[0],m[3],m[7])],x}addShadowReceiver(t,n,c){this._receivers.add(t,o.d9.fromTileIdAndHeight(t,n,c))}getMaxCascadeForTile(t){const n=this._receivers.get(t);return n&&n.lastCascade?n.lastCascade:0}}function $c(l,t,n){const c=o.av([],n,t),d=o.av([],l,t),m=o.bI([],c,d),_=o.ag(m);return _===0?[0,0,1,0]:(o.c5(m,m,1/_),[m[0],m[1],m[2],-o.bJ(m,t)])}function Wc(l){const t=l.properties.get("direction"),n=o.d4(t.x,t.y,t.z);n[2]=o.aA(n[2],0,75);const c=o.d6([n[0],n[1],n[2]]);return o.d5(c.x,c.y,c.z)}function na(l,t,n){const c=t.properties.get("color-use-theme")==="none",d=t.properties.get("color"),m=t.properties.get("intensity"),_=t.properties.get("direction"),x=[_.x,_.y,_.z],b=n.properties.get("color-use-theme")==="none",E=n.properties.get("color"),I=n.properties.get("intensity"),L=Math.max(o.bJ([0,0,1],x),0),D=[0,0,0];o.c5(D,E.toPremultipliedRenderColor(b?null:l.getLut(t.scope)).toArray01Linear().slice(0,3),I);const z=[0,0,0];return o.c5(z,d.toPremultipliedRenderColor(c?null:l.getLut(n.scope)).toArray01Linear().slice(0,3),L*m),o.db([D[0]>0?D[0]/(D[0]+z[0]):0,D[1]>0?D[1]/(D[1]+z[1]):0,D[2]>0?D[2]/(D[2]+z[2]):0])}function Oa(l,t,n,c,d,m){const _=l.zoom,x=l.scale,b=l.worldSize,E=1/b,I=l.aspect,L=Math.sqrt(1+I*I)*Math.tan(.5*l.fovX),D=L*L,z=c-n,B=c+n;let F,H;D>z/B?(F=c,H=c*L):(F=.5*B*(1+D),H=.5*Math.sqrt(z*z+2*(c*c+n*n)*D+B*B*D*D));const G=l.projection.pixelsPerMeter(l.center.lat,b),Z=l._camera.getCameraToWorldMercator(),Y=[0,0,-F*E];o.af(Y,Y,Z);let X=H*E;const ce=l._edgeInsets;if(!(ce.left===0&&ce.top===0&&ce.right===0&&ce.bottom===0||ce.left===ce.right&&ce.top===ce.bottom)){const We=l._camera.getWorldToCamera(l.worldSize,l.projection.zAxisUnit==="meters"?G:1),dt=l._camera.getCameraToClipPerspective(l._fov,l.width/l.height,n,c);dt[8]=2*-l.centerOffset.x/l.width,dt[9]=2*l.centerOffset.y/l.height;const Tt=new Float64Array(16);o.cP(Tt,dt,We);const ct=new Float64Array(16);o.bl(ct,Tt);const nt=o.cB.fromInvProjectionMatrix(ct,b,_,!0);for(const kt of nt.points){const Dt=((ne=kt)[0]/=x,ne[1]/=x,ne[2]=o.cf(ne[2],l._center.lat),ne);X=Math.max(X,o.c6(o.da([],Y,Dt)))}}var ne;X*=d/(d-1);const ae=Math.acos(t[2]),re=Math.atan2(-t[0],-t[1]),ee=new Qu;ee.position=Y,ee.setPitchBearing(ae,re);const ue=ee.getWorldToCamera(b,G),be=X*b,xe=Math.min(l._mercatorZfromZoom(17)*b*-2,-2*be),De=ee.getCameraToClipOrthographic(-be,be,-be,be,xe,(be+m*G)/t[2]),Le=new Float64Array(16);o.aB(Le,De,ue);const Ue=o.d5(Math.floor(1e6*Y[0])/1e6*b,Math.floor(1e6*Y[1])/1e6*b,0),it=.5*d,Ce=[0,0,0];o.af(Ce,Ue,Le),o.c5(Ce,Ce,it);const _e=[Math.floor(Ce[0]),Math.floor(Ce[1]),Math.floor(Ce[2])],Fe=[0,0,0];o.av(Fe,Ce,_e),o.c5(Fe,Fe,-1/it);const Pe=new Float64Array(16);return o.bA(Pe),o.br(Pe,Pe,Fe),o.aB(Le,Pe,Le),[Le,be]}class ny extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,n){return o.dc(this.requestManager.transformRequest(n,o.R.Model).url).then(c=>{if(!c)return;const d=o.dd(c),m=new o.de(t,n,void 0,void 0,d);return m.computeBoundsAndApplyParent(),m}).catch(c=>{if(c&&c.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${t} from ${n}: ${c.message}`)))})}load(t,n,c={forceReload:!1}){this.models[n]||(this.models[n]={});const d=Object.keys(t),m=[],_=[];for(const x of d){const b=t[x];this.hasURLBeenRequested(b)&&!c.forceReload||(this.modelByURL[b]={modelId:x,scope:n},m.push(this.loadModel(x,b)),_.push(x)),this.models[n][x]||(this.models[n][x]={model:null,numReferences:1})}this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+_.length,Promise.allSettled(m).then(x=>{for(let b=0;b<x.length;b++){const{status:E}=x[b];if(E==="rejected")continue;const{value:I}=x[b];this.models[n][_[b]]||(this.models[n][_[b]]={model:null,numReferences:1}),this.models[n][_[b]].model=I}this.numModelsLoading[n]-=_.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(x=>{this.fire(new o.y(new Error(`Could not load models: ${x.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,n,c={exactIdMatch:!1}){return!!(c.exactIdMatch?this.getModel(t,n):this.getModelByURL(this.modelUris[n][t]))}getModel(t,n){return this.models[n]||(this.models[n]={}),this.models[n][t]?this.models[n][t].model:void 0}getModelByURL(t){if(!t)return null;const n=this.modelByURL[t];return n?this.models[n.scope][n.modelId].model:null}hasModelBeenAdded(t,n){return this.models[n]&&this.models[n][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,n,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const d=this.requestManager.normalizeModelURL(n);if((this.hasModel(t,c,{exactIdMatch:!0})||this.hasModelBeenAdded(t,c))&&this.modelUris[c][t]===d)this.models[c][t].numReferences++;else if(this.hasURLBeenRequested(d)){const{scope:m,modelId:_}=this.modelByURL[d];this.models[m][_].numReferences++}else this.modelUris[c][t]=d,this.load({[t]:this.modelUris[c][t]},c)}addModelURLs(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const c=this.modelUris[n];for(const d in t)c[d]=this.requestManager.normalizeModelURL(t[d])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,n){this.models[n]||(this.models[n]={}),this.modelUris[n]||(this.modelUris[n]={});const c={};for(const d of t)this.hasModel(d,n,{exactIdMatch:!0})||this.hasURLBeenRequested(d)?this.models[n][d].numReferences++:this.modelUris[n][d]&&!this.hasURLBeenRequested(d)?c[d]=this.modelUris[n][d]:!this.hasURLBeenRequested(d)&&o.df(d,!1)&&(this.modelUris[n][d]=this.requestManager.normalizeModelURL(d),c[d]=this.modelUris[n][d]);this.load(c,n)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,n,c=!1,d=!1){if(this.models[n]&&this.models[n][t]&&(this.models[n][t].numReferences--,this.models[n][t].numReferences===0||d)){const m=this.modelUris[n][t];c||delete this.modelUris[n][t],delete this.modelByURL[m];const _=this.models[n][t].model;if(!_)return;delete this.models[n][t],_.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const n of Object.keys(this.models[t])){const c=this.models[t][n].model;delete this.models[t][n],c&&c.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,n){this.models[n]||(this.models[n]={});for(const c in this.models[n])this.models[n][c].model&&this.models[n][c].model.upload(t.context)}}const Kd=o.a6.colorTheme,sy=new o.a9({data:new o.aa(Kd.data)});function gm(l){if(!l.metadata||!l.metadata.content_area)return;const t=o.o.devicePixelRatio,{left:n,top:c,width:d,height:m}=l.metadata.content_area,_=n*t,x=c*t;return[_,x,_+d*t,x+m*t]}function ym(l){if(l)return l.map(([t,n])=>[t*o.o.devicePixelRatio,n*o.o.devicePixelRatio])}class Yd{constructor(t,n,c){this.id=t,this.scope=n,this.sourceCache=c,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const n=this.sourceCache.getVisibleCoordinates();if(n.length===0)return t;const c=this.sourceCache.getSource();if(!(c instanceof hs))return t;const d=n.map(_=>this.sourceCache.getTile(_)),m=c.getImages(d,Array.from(this.pendingRequests));for(const[_,x]of m)t.set(o.I.from({name:_,iconsetId:this.id}),x),this.pendingRequests.delete(_);for(const _ of this.pendingRequests)this.missingRequests.add(_);return this.pendingRequests.clear(),t}}const ka=(l,t)=>J(l,t&&t.filter(n=>n.identifier!=="source.canvas")),xm=o.aH(qi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),vm=o.aH(qi,["setCenter","setZoom","setBearing","setPitch"]),th=new Set(["background","sky","slot","custom"]),Fa={version:8,layers:[],sources:{}},Zc={duration:300,delay:0};class ro extends o.E{constructor(t,n={}){super(),this.map=t,this.scope=n.scope||"",this.globalId=null,this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=Object.assign({},Zc),this._buildingIndex=new ty(this),this.crossTileSymbolIndex=new bo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=n.styleChanges||new jt,this._hasDataDrivenEmissive=!1,this.dispatcher=n.dispatcher?n.dispatcher:new o.D(o.dh(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new Jt(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new o.di(t._requestManager,n.localFontFamily?o.dj.all:n.localIdeographFontFamily?o.dj.ideographs:o.dj.none,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new ny(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=n.configOptions?n.configOptions:new Map,this._configDependentLayers=n.configDependentLayers?n.configDependentLayers:new Set,this._indoorDependentLayers=n.indoorDependentLayers?n.indoorDependentLayers:new Set,this._config=n.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:n.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=n.initialConfig,this.dispatcher.broadcast("setReferrer",o.dk());const c=this;this._rtlTextPluginCallback=ro.registerForPluginStateChange(d=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:d.pluginStatus,pluginURL:d.pluginURL},(m,_)=>{if(o.dl(m),_&&_.every(x=>x))for(const x in c._sourceCaches){const b=c._sourceCaches[x],E=b.getSource().type;E!=="vector"&&E!=="geojson"||b.reload()}})}),this.on("data",d=>{if(d.dataType!=="source"||d.sourceDataType!=="metadata")return;const m=this.getOwnSource(d.sourceId);if(m&&m.vectorLayerIds)for(const _ in this._layers){const x=this._layers[_];x.source===m.id&&this._validateLayer(x)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.h(t))return t;const n=o.dm(t);if(!n.startsWith("http"))try{return new URL(n,location.href).toString()}catch{return n}return n}return`json://${o.dn(JSON.stringify(t))}`}_diffStyle(t,n,c){this.globalId=this._getGlobalId(t);const d=(m,_)=>{try{_(null,this.setState(m,c))}catch(x){_(x,!1)}};if(typeof t=="string"){const m=this.map._requestManager.normalizeStyleURL(t),_=this.map._requestManager.transformRequest(m,o.R.Style);o.m(_,(x,b)=>{x?this.fire(new o.y(x)):b&&d(b,n)})}else typeof t=="object"&&d(t,n)}loadURL(t,n={}){this.fire(new o.z("dataloading",{dataType:"style"}));const c=typeof n.validate=="boolean"?n.validate:!o.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,n.accessToken),this.resolvedImports.add(t);const d=this.importsCache.get(t);if(d)return this._load(d,c);const m=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.m(m,(_,x)=>{if(this._request=null,_)this.fire(new o.y(_));else if(x)return this.importsCache.set(t,x),this._load(x,c)})}loadJSON(t,n={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.o.frame(()=>{this._request=null,this._load(t,n.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(Fa,!1)}_loadImports(t,n,c){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const d=[];for(const m of t){const _=this._createFragmentStyle(m),x=new Promise(I=>{_.once("style.import.load",I),_.once("error",I)}).then(()=>this.mergeAll());if(d.push(x),this.resolvedImports.has(m.url)){_.loadEmpty();continue}const b=m.data||this.importsCache.get(m.url);b?(_.loadJSON(b,{validate:n}),this._isInternalStyle(b)&&(_.globalId=null)):m.url?_.loadURL(m.url,{validate:n}):_.loadEmpty();const E={style:_,id:m.id,config:m.config};if(c){const I=this.fragments.findIndex(({id:L})=>L===c);this.fragments=this.fragments.slice(0,I).concat(E).concat(this.fragments.slice(I))}else this.fragments.push(E)}return Promise.allSettled(d)}getImportGlobalIds(t=this,n=new Set){for(const c of t.fragments)c.style.globalId&&n.add(c.style.globalId),this.getImportGlobalIds(c.style,n);return[...n.values()]}_createFragmentStyle(t){const n=this.scope?o.B(t.id,this.scope):t.id;let c;const d=this._initialConfig&&this._initialConfig[n];(t.config||d)&&(c=Object.assign({},t.config,d));const m=new ro(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return m.setEventedParent(this.map,{style:m}),m}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,n){if(this._isInternalStyle(t)){const m=Object.assign({},Fa,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(m,n)}if(this.updateConfig(this._config,t.schema),n&&ka(this,go(t)))return;this._loaded=!0,this.stylesheet=o.dp(t);const c=()=>{for(const b in t.sources)this.addSource(b,t.sources[b],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const b in t.iconsets)this.addIconset(b,t.iconsets[b]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const m=kc(this.stylesheet.layers);if(this._order=m.map(b=>b.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const b=this.stylesheet.lights[0];this.light=new ve(b.properties,b.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new ve(this.stylesheet.light)),this._layers={};for(const b of m){const E=o.du(b,this.scope,this._styleColorTheme.lut,this.options);E.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(E.fqid),E.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(E.fqid),this._hasAppearances=this._hasAppearances||E.getAppearances().length!==0,E.setEventedParent(this,{layer:{id:E.id}}),this._layers[E.id]=E;const I=this.getOwnLayerSourceCache(E),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&E.canCastShadows()&&L&&(I.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const _=this.stylesheet.terrain;_&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(_,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const x=this.isRootStyle();t.imports?this._loadImports(t.imports,n).then(()=>{this._reloadImports(),this.fire(new o.z(x?"style.load":"style.import.load"))}).catch(b=>{this.fire(new o.y(new Error("Failed to load imports",b))),this.fire(new o.z(x?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(x?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const d=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(d){const m=this._evaluateColorThemeData(d);this._loadColorTheme(m).then(()=>{c()}).catch(_=>{o.w(`Couldn't load color theme from the stylesheet: ${_}`),c()})}else this._styleColorTheme.lut=null,c()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(t=>t.style.hasAppearances())}mergeAll(){let t,n,c,d,m,_,x,b,E,I;const L={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(D=>{if(D.stylesheet){if(D.light!=null&&(t=D.light),D.stylesheet.lights)for(const z of D.stylesheet.lights)z.type==="ambient"&&D.ambientLight!=null&&(n=D.ambientLight),z.type==="directional"&&D.directionalLight!=null&&(c=D.directionalLight);d=this._prioritizeTerrain(d,D.terrain,D.stylesheet.terrain),D.stylesheet.fog&&D.fog!=null&&(m=D.fog),D.stylesheet.snow&&D.snow!=null&&(_=D.snow),D.stylesheet.rain&&D.rain!=null&&(x=D.rain),D.stylesheet.camera!=null&&(I=D.stylesheet.camera),D.stylesheet.projection!=null&&(b=D.stylesheet.projection),D.stylesheet.transition!=null&&(E=D.stylesheet.transition),L[D.scope]=D._styleColorTheme}}),this.light=t,this.ambientLight=n,this.directionalLight=c,this.fog=m,this.snow=_,this.rain=x,this._styleColorThemeForScope=L,d===null?delete this.terrain:this.terrain=d,this.camera=I||{"camera-projection":"perspective"},this.projection=b||{name:"mercator"},this.transition=Object.assign({},Zc,E),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const n=c=>{for(const d of c.fragments)n(d.style);t(c)};n(this)}_prioritizeTerrain(t,n,c){const d=t&&t.drapeRenderMode===0;return c===null?n&&n.drapeRenderMode===0?n:d?t:null:n!=null&&(!t||d||n&&n.drapeRenderMode===1)?n:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{t=this._prioritizeTerrain(t,n.terrain,n.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(t=n.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},n={},c={};this.forEachFragmentStyle(d=>{for(const m in d._sourceCaches){const _=o.B(m,d.scope);t[_]=d._sourceCaches[m]}for(const m in d._otherSourceCaches){const _=o.B(m,d.scope);n[_]=d._otherSourceCaches[m]}for(const m in d._symbolSourceCaches){const _=o.B(m,d.scope);c[_]=d._symbolSourceCaches[m]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=c}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const n of Object.values(t.stylesheet.indoor)){const c=n,d=o.B(c.sourceId,t.scope);this._mergedIndoor[d]=new Set(c.sourceLayers||[])}})}mergeLayers(){const t={},n=[],c={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(_=>{for(const x of _._order){const b=_._layers[x];if(b.type==="slot"){const E=o.dq(x);if(t[E])continue;t[E]=[]}b.slot&&t[b.slot]?t[b.slot].push(b):n.push(b)}}),this._mergedOrder=[];let d=-1;const m=(_=[])=>{for(const x of _)if(x.type==="slot"){const b=o.dq(x.id);t[b]&&m(t[b]),this._mergedSlots.push(b)}else{const b=o.B(x.id,x.scope);this._mergedOrder.push(b),c[b]=x,x.is3D(!!this.terrain)&&(this._has3DLayers=!0,d=this._mergedOrder.length-1),x.type==="circle"&&(this._hasCircleLayers=!0),x.type==="symbol"&&(this._hasSymbolLayers=!0),x.type==="clip"&&(this._clipLayerPresent=!0)}};if(m(n),this._has3DLayers){const _={};for(let x=0;x<this._mergedOrder.length;++x){const b=this._mergedOrder[x];_[b]=x===d?1:x<d?c[b].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((x,b)=>_[x]-_[b])}this._mergedLayers=c,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(n,c,d,m){const _=Object.assign({},c);for(const b of Object.keys(Kd))_[b]===void 0&&(_[b]=Kd[b].default);const x=new o.a8(sy,n,new Map(d));return x.setTransitionOrValue(_,d),x.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const n=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((c,d)=>{const m="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void c();let _=t;_.startsWith(m)||(_=m+_);const x=o.I.from("mapbox-reserved-lut"),b=new Image;b.src=_,b.onerror=()=>{this._styleColorTheme.lutLoading=!1,d(new Error("Failed to load image data"))},b.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==n)return void c();this._styleColorTheme.lutLoading=!1;const{width:E,height:I,data:L}=o.o.getImageData(b);if(I>32)return void d(new Error("The height of the image must be less than or equal to 32 pixels."));if(E!==I*I)return void d(new Error("The width of the image must be equal to the height squared."));this.getImage(x)&&this.removeImage(x),this.addImage(x,{data:new o.q({width:E,height:I},L),pixelRatio:1,sdf:!1,usvg:!1,version:0});const D=this.imageManager.getImage(x,this.scope);D?(this._styleColorTheme.lut={image:D.data,data:t},c()):d(new Error("Missing LUT image."))}})}getLut(t){const n=this._styleColorThemeForScope[t];return n?n.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(n,c,d){let m,_,x;const b=o.o.devicePixelRatio>1?"@2x":"";let E=o.m(c.transformRequest(c.normalizeSpriteURL(n,b,".json"),o.R.SpriteJSON),(D,z)=>{E=null,x||(x=D,m=z,L())}),I=o.n(c.transformRequest(c.normalizeSpriteURL(n,b,".png"),o.R.SpriteImage),(D,z)=>{I=null,x||(x=D,_=z,L())});function L(){if(x)d(x);else if(m&&_){const D=o.o.getImageData(_),z={};for(const B in m){const{width:F,height:H,x:G,y:Z,sdf:Y,pixelRatio:X,stretchX:ce,stretchY:ne,content:ae}=m[B],re=new o.q({width:F,height:H});o.q.copy(D,re,{x:G,y:Z},{x:0,y:0},{width:F,height:H},null),z[B]={data:re,pixelRatio:X!==void 0?X:1,sdf:Y!==void 0&&Y,stretchX:ce,stretchY:ne,content:ae,usvg:!1,version:0}}d(null,z)}}return{cancel(){E&&(E.cancel(),E=null),I&&(I.cancel(),I=null)}}}(t,this.map._requestManager,(n,c)=>{if(this._spriteRequest=null,n)this.fire(new o.y(n));else if(c){const d=new Map;for(const m in c)d.set(o.I.from(m),c[m]);this.addImages(d)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(t,n){if(n.type==="sprite")return void this._loadSprite(n.url);const c=this.getOwnSourceCache(n.source);if(!c)return void this.fire(new o.y(new Error(`Source "${n.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const d=c.getSource();if(d.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${n.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));d.partial=!1;const m=new Yd(t,this.scope,c);this.imageManager.addImageProvider(m,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const n=this.map._spriteFormat==="auto";var c,d;this._spriteRequest=(d=(m,_)=>{if(this._spriteRequest=null,m)n?this._loadSprite(t):this.fire(new o.y(m));else if(_){const x=new Map;for(const b in _)x.set(o.I.from(b),_[b]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bu((c=this.map._requestManager).transformRequest(c.normalizeIconsetURL(t),o.R.Iconset),(m,_)=>{if(m)return void d(m);const x={},b=o.dg(new o.bt(_));for(const E of b.icons){const I={version:1,pixelRatio:o.o.devicePixelRatio,content:gm(E),stretchX:E.metadata?ym(E.metadata.stretch_x_areas):void 0,stretchY:E.metadata?ym(E.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:E};x[E.name]=I}d(null,x)}))}_validateLayer(t){const n=this.getOwnSource(t.source);if(!n)return;const c=t.sourceLayer;c&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(c)===-1)&&this.fire(new o.y(new Error(`Source layer "${c}" does not exist on source "${n.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,n)=>{const c=this.fragments[n];return c&&c.style&&(t.data=c.style.serialize()),t})}_serializeSources(){const t={};for(const n in this._sourceCaches){const c=this._sourceCaches[n].getSource();t[c.id]||(t[c.id]=c.serialize())}return t}_serializeLayers(t){const n=[];for(const c of t){const d=this._layers[c];d&&d.type!=="custom"&&n.push(d.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const n=this._mergedLayers[t];if(n._transitionablePaint&&n._transitionablePaint._values){const c=n._transitionablePaint._values["line-emissive-strength"];if(c&&c.value&&c.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const n=this.getOwnLayer(t);if(n)return n;this.fire(new o.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const n=this.getOwnSource(t);if(n)return n;this.fire(new o.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,n){const c=this.map.painter;if(c)for(let d=t.minzoom||0;d<(t.maxzoom||25.5);d++){const m=t.getProgramIds();if(m)for(const _ of m){const x=t.getDefaultProgramParams(_,n.zoom,this._styleColorTheme.lut);x&&(c.style=this,this.fog&&(c._fogVisible=!0,x.overrideFog=!0,c.getOrCreateProgram(_,x)),c._fogVisible=!1,x.overrideFog=!1,c.getOrCreateProgram(_,x),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(x.overrideRtt=!0,c.getOrCreateProgram(_,x)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const n=this.calculateLightsBrightness();t.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const c=this._changes.isDirty();let d=!1;if(this._changes.isDirty()){const x=this._changes.getLayerUpdatesByScope();for(const b in x){const{updatedIds:E,removedIds:I}=x[b];(E||I)&&(this._updateWorkerLayers(b,E,I),d=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const m={};for(const x in this._mergedSourceCaches){const b=this._mergedSourceCaches[x];m[x]=b.used,b.used=!1,b.tileCoverLift=0}for(const x of this._mergedOrder){const b=this._mergedLayers[x];if(b.visibility!=="none"&&b.recalculate(t,this._availableImages),!b.isHidden(t.zoom)){const E=this.getLayerSourceCache(b);E&&(E.used=!0,E.tileCoverLift=Math.max(E.tileCoverLift,b.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(b,t)}):this.precompilePrograms(b,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&d&&this.mergeLayers();const _=this.imageManager.getPendingImageProviders();for(const x of _)x.sourceCache.used=!0;for(const x in m){const b=this._mergedSourceCaches[x];m[x]!==b.used&&b.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),c&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const n of t){const c=n.resolvePendingRequests(),d=this.getFragmentStyle(n.scope);d&&d.addImages(c)}}_updateTilesForChangedImages(){const t={};for(const n in this._mergedSourceCaches){const c=this._mergedSourceCaches[n].getSource().scope;t[c]=t[c]||this._changes.getUpdatedImages(c),t[c].length!==0&&this._mergedSourceCaches[n].reloadTilesForDependencies(["icons","patterns"],t[c])}for(const n in t)this._changes.resetUpdatedImages(n)}_updateWorkerLayers(t,n,c){const d=this.getFragmentStyle(t);d&&this.dispatcher.broadcast("updateLayers",{layers:n?d._serializeLayers(n):[],scope:t,removedIds:c||[],options:d.options})}setState(t,n){if(this._checkLoaded(),ka(this,go(t)))return!1;(t=o.dp(t)).layers=kc(t.layers);const c=function(_,x){if(!_)return[{command:qi.setStyle,args:[x]}];let b=[];try{if(!o.by(_.version,x.version))return[{command:qi.setStyle,args:[x]}];if(o.by(_.center,x.center)||b.push({command:qi.setCenter,args:[x.center]}),o.by(_.zoom,x.zoom)||b.push({command:qi.setZoom,args:[x.zoom]}),o.by(_.bearing,x.bearing)||b.push({command:qi.setBearing,args:[x.bearing]}),o.by(_.pitch,x.pitch)||b.push({command:qi.setPitch,args:[x.pitch]}),o.by(_.sprite,x.sprite)||b.push({command:qi.setSprite,args:[x.sprite]}),o.by(_.glyphs,x.glyphs)||b.push({command:qi.setGlyphs,args:[x.glyphs]}),o.by(_.imports,x.imports)||function(z=[],B=[],F){B=B||[];const H=(z=z||[]).map(Fc),G=B.map(Fc),Z=z.reduce(Bc,{}),Y=B.reduce(Bc,{}),X=H.slice();let ce,ne,ae,re;for(ce=0,ne=0;ce<H.length;ce++)ae=H[ce],Y.hasOwnProperty(ae)?ne++:(F.push({command:qi.removeImport,args:[ae]}),X.splice(X.indexOf(ae,ne),1));for(ce=0,ne=0;ce<G.length;ce++)ae=G[G.length-1-ce],X[X.length-1-ce]!==ae&&(Z.hasOwnProperty(ae)?(F.push({command:qi.removeImport,args:[ae]}),X.splice(X.lastIndexOf(ae,X.length-ne),1)):ne++,re=X[X.length-ce],F.push({command:qi.addImport,args:[Y[ae],re]}),X.splice(X.length-ce,0,ae));for(const ee of B){const ue=Z[ee.id];ue&&(delete ue.data,o.by(ue,ee)||F.push({command:qi.updateImport,args:[ee.id,ee]}))}}(_.imports,x.imports,b),o.by(_.transition,x.transition)||b.push({command:qi.setTransition,args:[x.transition]}),o.by(_.light,x.light)||b.push({command:qi.setLight,args:[x.light]}),o.by(_.fog,x.fog)||b.push({command:qi.setFog,args:[x.fog]}),o.by(_.snow,x.snow)||b.push({command:qi.setSnow,args:[x.snow]}),o.by(_.rain,x.rain)||b.push({command:qi.setRain,args:[x.rain]}),o.by(_.projection,x.projection)||b.push({command:qi.setProjection,args:[x.projection]}),o.by(_.lights,x.lights)||b.push({command:qi.setLights,args:[x.lights]}),o.by(_.camera,x.camera)||b.push({command:qi.setCamera,args:[x.camera]}),o.by(_.iconsets,x.iconsets)||function(z,B,F){let H;for(H in B=B||{},z=z||{})z.hasOwnProperty(H)&&(B.hasOwnProperty(H)||F.push({command:qi.removeIconset,args:[H]}));for(H in B){if(!B.hasOwnProperty(H))continue;const G=B[H];z.hasOwnProperty(H)?o.by(z[H],G)||(F.push({command:qi.removeIconset,args:[H]}),F.push({command:qi.addIconset,args:[H,G]})):F.push({command:qi.addIconset,args:[H,G]})}}(_.iconsets,x.iconsets,b),!o.by(_["color-theme"],x["color-theme"]))return[{command:qi.setStyle,args:[x]}];const E={},I=[];(function(z,B,F,H){let G;for(G in B=B||{},z=z||{})z.hasOwnProperty(G)&&(B.hasOwnProperty(G)||Ud(G,F,H));for(G in B){if(!B.hasOwnProperty(G))continue;const Z=B[G];z.hasOwnProperty(G)?o.by(z[G],Z)||(z[G].type==="geojson"&&Z.type==="geojson"&&fm(z,B,G)?F.push({command:qi.setGeoJSONSourceData,args:[G,Z.data]}):dm(G,B,F,H)):Hu(G,B,F)}})(_.sources,x.sources,I,E);const L=[];_.layers&&_.layers.forEach(z=>{z.source&&E[z.source]?b.push({command:qi.removeLayer,args:[z.id]}):L.push(z)});let D=_.terrain;D&&E[D.source]&&(b.push({command:qi.setTerrain,args:[void 0]}),D=void 0),b=b.concat(I),o.by(D,x.terrain)||b.push({command:qi.setTerrain,args:[x.terrain]}),function(z,B,F){B=B||[];const H=(z=z||[]).map(Fc),G=B.map(Fc),Z=z.reduce(Bc,{}),Y=B.reduce(Bc,{}),X=H.slice(),ce=Object.create(null);let ne,ae,re,ee,ue,be,xe;for(ne=0,ae=0;ne<H.length;ne++)re=H[ne],Y.hasOwnProperty(re)?ae++:(F.push({command:qi.removeLayer,args:[re]}),X.splice(X.indexOf(re,ae),1));for(ne=0,ae=0;ne<G.length;ne++)re=G[G.length-1-ne],X[X.length-1-ne]!==re&&(Z.hasOwnProperty(re)?(F.push({command:qi.removeLayer,args:[re]}),X.splice(X.lastIndexOf(re,X.length-ae),1)):ae++,be=X[X.length-ne],F.push({command:qi.addLayer,args:[Y[re],be]}),X.splice(X.length-ne,0,re),ce[re]=!0);for(ne=0;ne<G.length;ne++)if(re=G[ne],ee=Z[re],ue=Y[re],!ce[re]&&!o.by(ee,ue))if(o.by(ee.source,ue.source)&&o.by(ee["source-layer"],ue["source-layer"])&&o.by(ee.type,ue.type)){for(xe in Ra(ee.layout,ue.layout,F,re,null,qi.setLayoutProperty),Ra(ee.paint,ue.paint,F,re,null,qi.setPaintProperty),o.by(ee.slot,ue.slot)||F.push({command:qi.setSlot,args:[re,ue.slot]}),o.by(ee.filter,ue.filter)||F.push({command:qi.setFilter,args:[re,ue.filter]}),o.by(ee.minzoom,ue.minzoom)&&o.by(ee.maxzoom,ue.maxzoom)||F.push({command:qi.setLayerZoomRange,args:[re,ue.minzoom,ue.maxzoom]}),ee)ee.hasOwnProperty(xe)&&xe!=="layout"&&xe!=="paint"&&xe!=="filter"&&xe!=="metadata"&&xe!=="minzoom"&&xe!=="maxzoom"&&xe!=="slot"&&(xe.indexOf("paint.")===0?Ra(ee[xe],ue[xe],F,re,xe.slice(6),qi.setPaintProperty):o.by(ee[xe],ue[xe])||F.push({command:qi.setLayerProperty,args:[re,xe,ue[xe]]}));for(xe in ue)ue.hasOwnProperty(xe)&&!ee.hasOwnProperty(xe)&&xe!=="layout"&&xe!=="paint"&&xe!=="filter"&&xe!=="metadata"&&xe!=="minzoom"&&xe!=="maxzoom"&&xe!=="slot"&&(xe.indexOf("paint.")===0?Ra(ee[xe],ue[xe],F,re,xe.slice(6),qi.setPaintProperty):o.by(ee[xe],ue[xe])||F.push({command:qi.setLayerProperty,args:[re,xe,ue[xe]]}))}else F.push({command:qi.removeLayer,args:[re]}),be=X[X.lastIndexOf(re)+1],F.push({command:qi.addLayer,args:[ue,be]})}(L,x.layers,b)}catch(E){console.warn("Unable to compute style diff:",E),b=[{command:qi.setStyle,args:[x]}]}return b}(this.serialize(),t).filter(_=>!(_.command in vm));if(c.length===0)return!1;const d=c.filter(_=>!(_.command in xm));if(d.length>0)throw new Error(`Unimplemented: ${d.map(_=>_.command).join(", ")}.`);const m=[];return c.forEach(_=>{m.push(this[_.command](..._.args))}),n&&Promise.all(m).then(n).catch(n),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[n,c]of t.entries()){if(this.getImage(n))return this.fire(new o.y(new Error(`An image with the name "${n.name}" already exists.`)));this.imageManager.addImage(n,this.scope,c),this._changes.updateImage(n,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(t,n){return this.getImage(t)?this.fire(new o.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,n),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(t,n,c=!1){this.imageManager.updateImage(t,this.scope,n),c&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(t,n,c={}){return this._checkLoaded(),this._validate(U,`models.${t}`,n,null,c)||(this.modelManager.addModel(t,n,this.getActualScope()),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,n,c={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(Fu,`sources.${t}`,n,null,c))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const d=Ln(t,n,this.dispatcher,this);d.scope=this.scope,d.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(d.id),source:d.serialize(),sourceId:d.id}));const m=_=>{const x=(_?"symbol:":"other:")+d.id,b=o.B(x,this.scope),E=this._sourceCaches[x]=new Ds(b,d,_);(_?this._symbolSourceCaches:this._otherSourceCaches)[d.id]=E,E.onAdd(this.map)};m(!1),n.type!=="vector"&&n.type!=="geojson"||m(!0),d.onAdd&&d.onAdd(this.map),c.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const n=this.getOwnSource(t);if(!n)throw new Error("There is no source with this ID");for(const d in this._layers)if(this._layers[d].source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while layer "${d}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const d=Object.entries(this.stylesheet.iconsets).find(([m,_])=>_.type==="source"&&_.source===t);if(d)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while iconset "${d[0]}" is using it.`)))}const c=this.getOwnSourceCaches(t);for(const d of c){const m=o.dq(d.id);delete this._sourceCaches[m],this._changes.discardSourceCacheUpdate(d.id),d.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:d.getSource().id})),d.setEventedParent(null),d.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,n){this._checkLoaded(),this.getOwnSource(t).setData(n),this._changes.setDirty()}getOwnSource(t){const n=this.getOwnSourceCache(t);return n&&n.getSource()}getOwnSources(){const t=[];for(const n in this._otherSourceCaches){const c=this.getOwnSourceCache(n);c&&t.push(c.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const n in t){const c=t[n]._tiles;for(const d in c){const m=c[d];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const n=this._getTransitionParameters();for(const m of t){if(this._validate(ea,"lights",m))return;switch(m.type){case"ambient":if(this.ambientLight){const _=this.ambientLight;_.set(m),_.updateTransitions(n)}else this.ambientLight=new Hi(m,pn||(pn=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const _=this.directionalLight;_.set(m),_.updateTransitions(n)}else this.directionalLight=new Hi(m,Jr||(Jr=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const c=Object.assign(n,{worldview:this.map.getWorldview()}),d=new o.ac(this.z||0,c);this.ambientLight&&this.ambientLight.recalculate(d),this.directionalLight&&this.directionalLight.recalculate(d),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,n=this.ambientLight;if(!t||!n)return;const c=D=>.2126*(D[0]<=.03928?D[0]/12.92:Math.pow((D[0]+.055)/1.055,2.4))+.7152*(D[1]<=.03928?D[1]/12.92:Math.pow((D[1]+.055)/1.055,2.4))+.0722*(D[2]<=.03928?D[2]/12.92:Math.pow((D[2]+.055)/1.055,2.4)),d=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),m=t.properties.get("intensity"),_=t.properties.get("direction"),x=1-o.d4(_.x,_.y,_.z)[2]/90,b=c(d)*m*x,E=n.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),I=n.properties.get("intensity"),L=c(E)*I;return Number(((b+L)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.dr(t)){const n=o.ds(t),c=this.fragments.find(({id:m})=>m===n);if(!c)return;const d=o.dq(t);return c.style.getFragmentStyle(d)}{const n=this.fragments.find(({id:c})=>c===t);return n?n.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const n={},c=(d,m="")=>`${d}::${m}`;this._featuresetSelectors={};for(const d in t){const m=this._featuresetSelectors[d]=[];for(const _ of t[d].selectors){if(_.featureNamespace){const b=this.getOwnLayer(_.layer);if(!b){o.w(`Layer is undefined for selector: ${_.layer}`);continue}const E=c(b.source,b.sourceLayer);if(E in n&&n[E]!==_.featureNamespace){o.w(`"featureNamespace ${_.featureNamespace} of featureset ${d}'s selector is not associated to the same source, skip this selector`);continue}n[E]=_.featureNamespace}let x;if(_.properties)for(const b in _.properties){const E=o.U(_.properties[b]);E.result==="success"&&(x=x||{},x[b]=E.value)}m.push({layerId:_.layer,namespace:_.featureNamespace,properties:x,uniqueFeatureID:_._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const n=this.getFragmentStyle(t);if(!n||!n.stylesheet.featuresets)return[];const c=[];for(const d in n.stylesheet.featuresets)c.push({featuresetId:d,importId:n.scope?n.scope:void 0});return c}getFeaturesetLayers(t,n){const c=this.getFragmentStyle(n),d=c.stylesheet.featuresets;if(!d||!d[t])return this.fire(new o.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const m=[];for(const _ of d[t].selectors){const x=c.getOwnLayer(_.layer);x&&m.push(x)}return m}getConfigProperty(t,n){const c=this.getFragmentStyle(t);if(!c)return null;const d=o.B(n,c.scope),m=c.options.get(d),_=m?m.value||m.default:null;return _?_.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,n){const c=o.B(t,n);return this._mergedIndoor[c]}setIndoorData(t,n){this.map.indoor.setIndoorData(n)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,n,c){const d=this.getFragmentStyle(t);if(!d)return;const m=d.stylesheet.schema;if(!m||!m[n])return;const _=o.U(c);if(_.result!=="success")return void ka(this,_.value);const x=_.value.expression,b=o.B(n,d.scope),E=d.options.get(b);if(!E)return;let I;const{minValue:L,maxValue:D,stepValue:z,type:B,values:F}=m[n],H=o.U(m[n].default);H.result==="success"&&(I=H.value.expression),I?(this.options.set(b,Object.assign({},E,{value:x,default:I,minValue:L,maxValue:D,stepValue:z,type:B,values:F})),this.updateConfigDependencies(n)):this.fire(new o.y(new Error(`No schema defined for the config option "${n}" in the "${t}" fragment.`)))}getConfig(t){const n=this.getFragmentStyle(t);if(!n)return null;const c=n.stylesheet.schema;if(!c)return null;const d={};for(const m in c){const _=o.B(m,n.scope),x=n.options.get(_),b=x?x.value||x.default:null;d[m]=b?b.serialize():null}return d}setConfig(t,n){const c=this.getFragmentStyle(t);c&&(c.updateConfig(n,c.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const n=this.getFragmentStyle(t);return n?n.stylesheet.schema:null}setSchema(t,n){const c=this.getFragmentStyle(t);c&&(c.stylesheet.schema=n,c.updateConfig(c._config,n),this.updateConfigDependencies())}updateConfig(t,n){if(this._config=t,t||n)if(n)for(const c in n){let d,m;const _=o.U(n[c].default);if(_.result==="success"&&(d=_.value.expression),t&&t[c]!==void 0){const D=o.U(t[c]);D.result==="success"&&(m=D.value.expression)}const{minValue:x,maxValue:b,stepValue:E,type:I,values:L}=n[c];if(d){const D=o.B(c,this.scope);this.options.set(D,{default:d,value:m,minValue:x,maxValue:b,stepValue:E,type:I,values:L})}else this.fire(new o.y(new Error(`No schema defined for config option "${c}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,n=()=>!0){for(const c of t){const d=this.getLayer(c);d&&n(d)&&(d.possiblyEvaluateVisibility(),this._updateLayer(d),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,n=>!t||n.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(n=>{const c=n._styleColorTheme.colorThemeOverride?n._styleColorTheme.colorThemeOverride:n._styleColorTheme.colorTheme;if(c){const d=n._evaluateColorThemeData(c);(!n._styleColorTheme.lut&&d!==""||n._styleColorTheme.lut&&d!==n._styleColorTheme.lut.data)&&n.setColorTheme(c)}}),this._changes.setDirty()}addLayer(t,n,c={}){this._checkLoaded();const d=t.id;if(this._layers[d])return void this.fire(new o.y(new Error(`Layer with id "${d}" already exists on this map`)));let m;if(t.type==="custom"){if(ka(this,o.dt(t)))return;m=o.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(d,t.source),t=o.dp(t),t=Object.assign(t,{source:d})),this._validate(Vd,`layers.${d}`,t,{arrayIndex:-1},c))return;m=o.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(m),m.setEventedParent(this,{layer:{id:d}})}const _=o.B(m.source,m.scope);m.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(_),m.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(_);let x=this._order.length;if(n){const L=this._order.indexOf(n);if(L===-1)return void this.fire(new o.y(new Error(`Layer with id "${n}" does not exist on this map.`)));m.slot===this._layers[n].slot?x=L:o.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(x,0,d),this._layerOrderChanged=!0,this._layers[d]=m;const b=this.getOwnLayerSourceCache(m),E=!!this.directionalLight&&this.directionalLight.shadowsEnabled();b&&m.canCastShadows()&&E&&(b.castsShadows=!0);const I=this._changes.getRemovedLayer(m);if(I&&m.source&&b&&m.type!=="custom"){this._changes.discardLayerRemoval(m);const L=o.B(m.source,m.scope);I.type!==m.type?this._changes.updateSourceCache(L,"clear"):(this._changes.updateSourceCache(L,"reload"),b.pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map),m.scope=this.scope,this.mergeLayers()}moveLayer(t,n){this._checkLoaded();const c=this._checkLayer(t);if(!c||t===n)return;const d=this._order.indexOf(t);this._order.splice(d,1);let m=this._order.length;if(n){const _=this._order.indexOf(n);if(_===-1)return void this.fire(new o.y(new Error(`Layer with id "${n}" does not exist on this map.`)));c.slot===this._layers[n].slot?m=_:o.w(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(m,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(t){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;n.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),delete this._layers[t],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._indoorDependentLayers.delete(n.fqid),this._changes.removeLayer(n);const d=this.getOwnLayerSourceCache(n);if(d&&d.castsShadows){let m=!1;for(const _ in this._layers)if(this._layers[_].source===n.source&&this._layers[_].canCastShadows()){m=!0;break}d.castsShadows=m}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const n in this._layers)if(this._layers[n].type===t)return!0;return!1}setLayerZoomRange(t,n,c){this._checkLoaded();const d=this._checkLayer(t);d&&(d.minzoom===n&&d.maxzoom===c||(n!=null&&(d.minzoom=n),c!=null&&(d.maxzoom=c),this._updateLayer(d)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,n){this._checkLoaded();const c=this._checkLayer(t);c&&c.slot!==n&&(c.slot=n,this._updateLayer(c))}setFilter(t,n,c={}){this._checkLoaded();const d=this._checkLayer(t);if(d&&!o.by(d.filter,n))return n==null?(d.filter=void 0,void this._updateLayer(d)):void(this._validate(ll,`layers.${d.id}.filter`,n,{layerType:d.type},c)||(d.filter=o.dp(n),this._updateLayer(d)))}getFilter(t){const n=this._checkLayer(t);if(n)return o.dp(n.filter)}setLayoutProperty(t,n,c,d={}){this._checkLoaded();const m=this._checkLayer(t);if(m&&!o.by(m.getLayoutProperty(n),c)){if(c!=null&&(!d||d.validate!==!1)&&ka(m,Ee.call(go,{key:`layers.${t}.layout.${n}`,layerType:m.type,objectKey:n,value:c,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;m.setLayoutProperty(n,c),m.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),m.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(m.fqid),this._updateLayer(m)}}setLayerProperty(t,n,c,d={}){this._checkLoaded();const m=this._checkLayer(t);m&&(n==="appearances"?(m.setAppearances(c),this._changes.setDirty()):m.isPaintProperty(n)?this.setPaintProperty(t,n,c,d):this.setLayoutProperty(t,n,c,d))}getLayoutProperty(t,n){const c=this._checkLayer(t);if(c)return c.getLayoutProperty(n)}setPaintProperty(t,n,c,d={}){this._checkLoaded();const m=this._checkLayer(t);if(!m||o.by(m.getPaintProperty(n),c)||c!=null&&(!d||d.validate!==!1)&&ka(m,Lc.call(go,{key:`layers.${t}.paint.${n}`,layerType:m.type,objectKey:n,value:c,styleSpec:o.a6})))return;const _=m.setPaintProperty(n,c);m.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(m.fqid),m.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(m.fqid),_&&this._updateLayer(m),this._changes.updatePaintProperties(m)}getPaintProperty(t,n){const c=this._checkLayer(t);if(c)return c.getPaintProperty(n)}setFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:b,importId:E}=t.target,I=this.getFragmentStyle(E),L=I.getFeaturesetLayers(b);for(const{source:D,sourceLayer:z}of L)I.setFeatureState({id:t.id,source:D,sourceLayer:z},n)}else if("layerId"in t.target){const{layerId:b}=t.target,E=this.getLayer(b);this.setFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer},n)}return}const c=t.source,d=t.sourceLayer,m=this._checkSource(c);if(!m)return;const _=m.type;if(_==="geojson"&&d)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(_==="vector"&&!d)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const x=this.getOwnSourceCaches(c);for(const b of x)b.setFeatureState(d,t.id,n)}removeFeatureState(t,n){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:b,importId:E}=t.target,I=this.getFragmentStyle(E),L=I.getFeaturesetLayers(b);for(const{source:D,sourceLayer:z}of L)I.removeFeatureState({id:t.id,source:D,sourceLayer:z},n)}else if("layerId"in t.target){const{layerId:b}=t.target,E=this.getLayer(b);this.removeFeatureState({id:t.id,source:E.source,sourceLayer:E.sourceLayer},n)}return}const c=t.source,d=this._checkSource(c);if(!d)return;const m=d.type,_=m==="vector"?t.sourceLayer:void 0;if(m==="vector"&&!_)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const x=this.getOwnSourceCaches(c);for(const b of x)b.removeFeatureState(_,t.id,n)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let m;if("featuresetId"in t.target){const{featuresetId:_,importId:x}=t.target,b=this.getFragmentStyle(x),E=b.getFeaturesetLayers(_);for(const{source:I,sourceLayer:L}of E){const D=b.getFeatureState({id:t.id,source:I,sourceLayer:L});if(D&&!m)m=D;else if(!o.by(m,D))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:_}=t.target,x=this.getLayer(_);m=this.getFeatureState({id:t.id,source:x.source,sourceLayer:x.sourceLayer})}return m}const n=t.source,c=t.sourceLayer,d=this._checkSource(n);if(d){if(d.type!=="vector"||c)return t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(c,t.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),n=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},c=>c!==void 0)}_updateFilteredLayers(t){for(const n of Object.values(this._mergedLayers))t(n)&&this._updateLayer(n)}_updateLayer(t){this._changes.updateLayer(t);const n=this.getLayerSourceCache(t),c=o.B(t.source,t.scope),d=this._changes.getUpdatedSourceCaches();t.source&&!d[c]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(c,"reload"),n.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const n=x=>this._mergedLayers[x].is3D(!!this.terrain),c=this.order,d={},m=[];for(let x=c.length-1;x>=0;x--){const b=c[x];if(n(b)){d[b]=x;for(const E of t){const I=E[b];if(I)for(const L of I)m.push(L)}}}m.sort((x,b)=>b.intersectionZ-x.intersectionZ);const _=[];for(let x=c.length-1;x>=0;x--){const b=c[x];if(n(b))for(let E=m.length-1;E>=0;E--){const I=m[E].feature;if(I.layer&&d[I.layer.id]<x)break;_.push(I),m.pop()}else for(const E of t){const I=E[b];if(I)for(const L of I)_.push(L.feature)}}return _}queryRasterValue(t,n,c){const d=this.getOwnSource(t);return d?d.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):d.queryRasterArrayValue(n,c):(this.fire(new o.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,n,c){let d;n&&!Array.isArray(n)&&n.filter&&(this._validate(ll,"queryRenderedFeatures.filter",n.filter,null,n),d=o.b6(n.filter));const m={},_=I=>{if(th.has(I.type))return;const L=this.getOwnLayerSourceCache(I),D=m[L.id]=m[L.id]||{sourceCache:L,layers:{},has3DLayers:!1};I.is3D(!!this.terrain)&&(D.has3DLayers=!0),D.layers[I.fqid]=D.layers[I.fqid]||{styleLayer:I,targets:[]},D.layers[I.fqid].targets.push({filter:d})};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const I of n.layers){const L=this._layers[I];if(!L)return this.fire(new o.y(new Error(`The layer '${I}' does not exist in the map's style and cannot be queried for features.`))),[];_(L)}}else for(const I in this._layers)_(this._layers[I]);const x=this._queryRenderedFeatures(t,m,c),b=this._flattenAndSortRenderedFeatures(x),E=[];for(const I of b)o.dw(I.layer.id)===this.scope&&E.push(I);return E}queryRenderedFeatureset(t,n,c){let d;n&&!Array.isArray(n)&&n.filter&&(this._validate(ll,"queryRenderedFeatures.filter",n.filter,null,n),d=o.b6(n.filter));const m="mock",_=[];if(n&&n.target)_.push(Object.assign({},n,{targetId:m,filter:d}));else{const I=this.getFeaturesetDescriptors();for(const L of I)_.push({targetId:m,filter:d,target:L});for(const{style:L}of this.fragments){const D=L.getFeaturesetDescriptors();for(const z of D)_.push({targetId:m,filter:d,target:z})}}const x=this.queryRenderedTargets(t,_,c),b=[],E=new Set;for(const I of x)for(const L of I.variants[m])jl(L,I,E)||b.push(new o.dx(I,L));return b}queryRenderedTargets(t,n,c){const d={},m=(x,b,E,I)=>{const L=d[b.id]=d[b.id]||{sourceCache:b,layers:{},has3DLayers:!1};if(L.layers[x.fqid]=L.layers[x.fqid]||{styleLayer:x,targets:[]},x.is3D(!!this.terrain)&&(L.has3DLayers=!0),!I)return E.uniqueFeatureID=!1,void L.layers[x.fqid].targets.push(E);L.layers[x.fqid].targets.push(Object.assign({},E,{namespace:I.namespace,properties:I.properties,uniqueFeatureID:I.uniqueFeatureID}))};for(const x of n)if("featuresetId"in x.target){const{featuresetId:b,importId:E}=x.target,I=this.getFragmentStyle(E);if(!I||!I._featuresetSelectors)continue;const L=I._featuresetSelectors[b];if(!L){this.fire(new o.y(new Error(`The featureset '${b}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const D of L){const z=I.getOwnLayer(D.layerId);z&&!th.has(z.type)&&m(z,I.getOwnLayerSourceCache(z),x,D)}}else if("layerId"in x.target){const{layerId:b}=x.target,E=this.getLayer(b);if(!E||th.has(E.type))continue;m(E,this.getLayerSourceCache(E),x)}const _=this._queryRenderedFeatures(t,d,c);return this._flattenAndSortRenderedFeatures(_)}_queryRenderedFeatures(t,n,c){const d=[],m=!!this.map._showQueryGeometry,_=qr.createFromScreenPoints(t,c);for(const x in n){const b=Bu(_,n[x],this._availableImages,c,m);Object.keys(b).length&&d.push(b)}if(this.placement)for(const x in n){if(!n[x].sourceCache._onlySymbols)continue;const b=Nu(_.screenGeometry,n[x],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(b).length&&d.push(b)}return d}querySourceFeatures(t,n){const c=n&&n.filter;c&&this._validate(ll,"querySourceFeatures.filter",c,null,n);let d=[];const m=this.getOwnSourceCaches(t);for(const _ of m)d=d.concat(Vu(_,n));return d}addSourceType(t,n,c){return ro.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(ro.setSourceType(t,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:n.workerSourceURL},c):c(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,n,c={}){this._checkLoaded();const d=this.light.getLight();let m=!1;for(const x in t)if(!o.by(t[x],d[x])){m=!0;break}if(!m)return;const _=this._getTransitionParameters();this.light.setLight(t,n,c),this.light.updateTransitions(_)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,n=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),n===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let c=t;const d=!("source"in t)||t.source==null;if(n===1){if(this.disableElevatedTerrain)return;if("source"in c&&typeof c.source=="object"){const x="terrain-dem-src";this.addSource(x,c.source),c=o.dp(c),c=Object.assign(c,{source:x})}const m=Object.assign({},c),_={};if(this.terrain&&d){m.source=this.terrain.get().source;const x=this.terrain?this.getFragmentStyle(this.terrain.scope):null;x&&(_.style=x.serialize())}if(this._validate(Nd,"terrain",m,_))return}if(!this.terrain||this.terrain.scope!==this.scope&&!d||this.terrain&&n!==this.terrain.drapeRenderMode){if(!c)return;this._createTerrain(c,n),this.fire(new o.z("data",{dataType:"style"}))}else{const m=this.terrain,_=m.get();for(const x of Object.keys(o.a6.terrain))!c.hasOwnProperty(x)&&o.a6.terrain[x].default&&(c[x]=o.a6.terrain[x].default);for(const x in t)if(!o.by(t[x],_[x])){m.set(t,this.options),this.stylesheet.terrain=t;const b=this._getTransitionParameters({duration:0});m.updateTransitions(b),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const n=this.fog=new pi(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_createSnow(t){const n=this.snow=new yn(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_createRain(t){const n=this.rain=new Hr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog;if(!o.by(n.get(),t)){n.set(t,this.options),this.stylesheet.fog=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const n=this.snow;if(!o.by(n.get(),t)){n.set(t,this.options),this.stylesheet.snow=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const n=this.rain;if(!o.by(n.get(),t)){n.set(t,this.options),this.stylesheet.rain=n.get();const c=this._getTransitionParameters({duration:0});n.updateTransitions(c)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const d in this._layers)this._layers[d].lut=this._styleColorTheme.lut;for(const d in this._sourceCaches)this._sourceCaches[d].clearTiles()},n=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!n)return this._styleColorTheme.lut=null,void t();const c=this._evaluateColorThemeData(n);this._loadColorTheme(c).then(()=>{this.fire(new o.z("colorthemeset")),t()}).catch(d=>{o.w(`Couldn't set color theme: ${d}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,n){const c=this.getFragmentStyle(t);c&&(c._styleColorTheme.colorThemeOverride=n,c._reloadColorTheme())}_getTransitionParameters(t){return{now:o.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],n=[];for(const c of this._mergedOrder)this.isLayerDraped(this._mergedLayers[c])?t.push(c):n.push(c);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...n)}_createTerrain(t,n){const c=this.terrain=new Te(t,n,this.scope,this.options,this.map.getWorldview());n===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const d=this._getTransitionParameters({duration:0});c.updateTransitions(d)}_force3DLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const n=this._layers[t];n.type==="symbol"&&this._updateLayer(n)}}_validate(t,n,c,d,m={}){if(m&&m.validate===!1)return!1;const _=Object.assign({},this.serialize());return ka(this,t.call(go,Object.assign({key:n,style:_,value:c,styleSpec:o.a6},d)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const n=this.getSourceCaches(t);for(const c of n)c.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const n=this._mergedLayers[t];n._clear&&n._clear()}}reloadSource(t){const n=this.getSourceCaches(t);for(const c of n)c.resume(),c.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let n;this.directionalLight&&(n=Wc(this.directionalLight));const c=new Set,d=new Set;for(const m in this._mergedLayers){const _=this._mergedLayers[m];_.type==="building"&&c.add(_.source),_.hasElevation()&&!d.has(_.source)&&d.add(_.source)}for(const m in this._mergedSourceCaches){const _=this._mergedSourceCaches[m],x=d.has(_._source.id);c.has(_._source.id)&&(_._source.reparseOverscaled=!1),_.update(t,void 0,void 0,n,x)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const n=this._sourceCaches[t];n.resume(),n.reload()}}_updatePlacement(t,n,c,d,m,_,x=!1){let b=!1,E=!1;const I={},L={};for(const F of this._mergedOrder){const H=this._mergedLayers[F];if(H.type!=="symbol")continue;const G=o.B(H.source,H.scope);let Z=I[G];if(!Z){const X=this.getLayerSourceCache(H);if(!X)continue;const ce=X.getRenderableIds(!0).map(ne=>X.getTileByID(ne));L[G]=ce.slice(),Z=I[G]=ce.sort((ne,ae)=>ae.tileID.overscaledZ-ne.tileID.overscaledZ||(ne.tileID.isLessThan(ae.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(H,Z,n.center.lng,n.projection);b=b||Y}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),x=x||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new o.z("neworder"));const D=!!(this.placement&&!n.equals(this.placement.transform)),z=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!_||this.placement.lastReplacementSourceUpdateTime!==_.updateTime)),B=(D||z||b||this.placement&&this.placement.isStale())&&d===0;if((x||!this.pauseablePlacement||B||d!==0&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),n.zoom))&&(this.pauseablePlacement=new zn(n,this._mergedOrder,x||d===0,c,d,m,this.placement,this.fog&&n.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,I,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),E=!0),b&&this.pauseablePlacement.placement.setStale()),E||b){this._buildingIndex.onNewFrame(n.zoom);for(let F=0;F<this._mergedOrder.length;F++){const H=this._mergedLayers[this._mergedOrder[F]];if(H.type!=="symbol"||H.visibility==="none")continue;const G=this.isLayerClipped(H);this.placement.updateLayerOpacities(H,I[o.B(H.source,H.scope)],F,G?_:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.o.now())}}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,n){this._checkLoaded();const c=this.stylesheet.imports=this.stylesheet.imports||[];if(c.findIndex(({id:m})=>m===t.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!n)return c.push(t),this._loadImports([t],!0);const d=c.findIndex(({id:m})=>m===n);return d===-1&&this.fire(new o.y(new Error(`Import with id "${n}" does not exist on this map.`))),this.stylesheet.imports=c.slice(0,d).concat(t).concat(c.slice(d)),this._loadImports([t],!0,n)}updateImport(t,n){this._checkLoaded();const c=this.stylesheet.imports||[],d=this.getImportIndex(t);return d===-1?this:typeof n=="string"?(this.setImportUrl(t,n),this):(n.url&&n.url!==c[d].url&&this.setImportUrl(t,n.url),o.by(n.config,c[d].config)||this.setImportConfig(t,n.config,n.data.schema),o.by(n.data,c[d].data)||this.setImportData(t,n.data),this)}moveImport(t,n){this._checkLoaded();let c=this.stylesheet.imports||[];const d=this.getImportIndex(t);if(d===-1)return this;const m=this.getImportIndex(n);if(m===-1)return this;const _=c[d],x=this.fragments[d];return c=c.filter(({id:b})=>b!==t),this.fragments=this.fragments.filter(({id:b})=>b!==t),this.stylesheet.imports=c.slice(0,m).concat(_).concat(c.slice(m)),this.fragments=this.fragments.slice(0,m).concat(x).concat(this.fragments.slice(m)),this.mergeLayers(),this}setImportUrl(t,n){this._checkLoaded();const c=this.stylesheet.imports||[],d=this.getImportIndex(t);if(d===-1)return this;c[d].url=n;const m=this.fragments[d];return m.style=this._createFragmentStyle(c[d]),m.style.on("style.import.load",()=>this.mergeAll()),m.style.loadURL(n),this}setImportData(t,n){this._checkLoaded();const c=this.getImportIndex(t),d=this.stylesheet.imports||[];return c===-1?this:n?(this.fragments[c].style.setState(n),this._reloadImports(),this):(delete d[c].data,this.setImportUrl(t,d[c].url))}setImportConfig(t,n,c){this._checkLoaded();const d=this.getImportIndex(t),m=this.stylesheet.imports||[];if(d===-1)return this;n?m[d].config=n:delete m[d].config;const _=this.fragments[d];c&&_.style.stylesheet&&(_.style.stylesheet.schema=c);const x=_.style.stylesheet&&_.style.stylesheet.schema;return _.config=n,_.style.updateConfig(n,x),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const n=this.stylesheet.imports||[],c=this.getImportIndex(t);c!==-1&&(n.splice(c,1),this.fragments[c].style._remove(),this.fragments.splice(c,1),this._reloadImports())}getImportIndex(t){const n=(this.stylesheet.imports||[]).findIndex(c=>c.id===t);return n===-1&&this.fire(new o.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),n}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const n in this._mergedOtherSourceCaches){const c=this._mergedOtherSourceCaches[n];c&&t.push(c.getSource())}return t}getSource(t,n){const c=this.getSourceCache(t,n);return c&&c.getSource()}getLayerSource(t){const n=this.getLayerSourceCache(t);return n&&n.getSource()}getSourceCache(t,n){const c=o.B(t,n);return this._mergedOtherSourceCaches[c]}getLayerSourceCache(t){const n=o.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const n=[];return this._mergedOtherSourceCaches[t]&&n.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&n.push(this._mergedSymbolSourceCaches[t]),n}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const n in t){const c=t[n];c==="reload"?this.reloadSource(n):c==="clear"&&this.clearSource(n)}}updateLayers(t){const n=this._changes.getUpdatedPaintProperties();for(const c of n){const d=this.getLayer(c);d&&d.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,n,c){this.imageManager.getImages(n.images,n.scope,c),this._updateTilesForChangedImages();const d=_=>{if(_){const x=n.images.map(b=>o.I.toString(b));_.setDependencies(n.tileID.key,n.type,x)}},m=o.B(n.source,n.scope);d(this._mergedOtherSourceCaches[m]),d(this._mergedSymbolSourceCaches[m]),n.images.some(_=>_.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(t,n,c){this.imageManager.rasterizeImages(n,c)}getGlyphs(t,n,c){this.glyphManager.getGlyphs(n.stacks,c)}getResource(t,n,c){return o.dz(n,c)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const n=[];return this._otherSourceCaches[t]&&n.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&n.push(this._symbolSourceCaches[t]),n}_isSourceCacheLoaded(t){const n=this.getOwnSourceCaches(t);return n.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${t}'`))),!1):n.every(c=>c.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,n){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const c=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),d=t.type==="building";if(t.is3D(!!this.terrain)){if(c||d||n&&n.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ro.getSourceType=function(l){return Lo[l]},ro.setSourceType=function(l,t){Lo[l]=t},ro.registerForPluginStateChange=o.dA;class bm extends o.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[n,c]of Object.entries(t.buildings))if(this._buildings[n])for(const d of c.floorIds)this._buildings[n].floors[d]||(this._buildings[n].floors[d]=c.floors[d]);else this._buildings[n]=c;for(const n of t.activeFloors)this._activeFloors.add(n);this._updateIndoorSelector()}getIndoorTileOptions(t,n){const c=this._style.getIndoorSourceLayers(t,n);return c&&this._indoorState?{sourceLayers:c,indoorState:this._indoorState}:null}_updateUI(t,n,c){const d=function(m,_,x,b){let E=null,I=Number.MAX_SAFE_INTEGER;if(b<16)return null;for(const[L,D]of Object.entries(m)){const z=D.center;if(z){const B=_.distanceTo(o.aT.convert(z));B<I&&x.contains(z)&&(I=B,E=L)}}return E}(this._buildings,n,c,t);d!==this._closestBuildingId&&(this._closestBuildingId=d,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,n=this._closestBuildingId,c=n&&t?t[n]:void 0;if(!c)return void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let d=null;for(const _ of c.floorIds)if(this._activeFloors&&this._activeFloors.has(_)){d=_;break}const m=Array.from(c.floorIds).map(_=>({id:_,name:c.floors[_].name,zIndex:c.floors[_].zIndex})).sort((_,x)=>x.zIndex-_.zIndex);this.fire(new o.z("selector-update",{selectedFloorId:d,activeFloorsVisible:this._activeFloorsVisible,floors:m}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Wl=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zl=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Jd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,ih="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Us=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,rh=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,ut=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Qd=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,nh=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,sh=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,ef=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Xc=/#include\s+"([^"]+)"/g,Vo=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,tf=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,_l=new Set(["ifdef","ifndef","elif","if","defined"]),gl=new Set;Na(Wl,gl),Na(Jd,gl),Na(Zl,gl);const Ba={"_prelude_fog.vertex.glsl":rh,"_prelude_terrain.vertex.glsl":Us,"_prelude_shadow.vertex.glsl":sh,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":ut,"_prelude_shadow.fragment.glsl":ef,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":Qd,"_prelude_raster_particle.glsl":nh},oh={};Ui("",Us),Ui(ut,rh),Ui(ef,sh),Ui(Qd,""),Ui(nh,"");const wm=Ui(Zl,Jd),ah=Wl,oy=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",ah,wm.fragmentSource].join(`
`),Tm=["precision highp float;",ah,wm.vertexSource].join(`
`);var rf={background:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Ui(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ui("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ui(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ui(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ui("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ui("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ui(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ui(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ui(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ui(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ui(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#ifdef MULTIPLY_LINE_GRADIENT_COLOR
out_color*=color;
#endif
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ui("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ui("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ui(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ui(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define APPEARANCE_ICON 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ui("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ui(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ih),skyboxGradient:Ui(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,ih),skyboxCapture:Ui(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ui(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ui(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ui(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ui(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ui("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ui("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ui("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ui("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Na(l,t){const n=l.split(`
`);for(let c of n){if(c=c.trimStart(),c[0]!=="#"||!c.includes("if")||c.startsWith("#endif"))continue;const d=c.match(tf);if(d)for(const m of d)_l.has(m)||t.add(m)}}function Ui(l,t){const n=new Set,c=[],d=[];l=l.replace(Xc,(_,x)=>(d.push(x),"")),t=t.replace(Xc,(_,x)=>(c.push(x),""));let m=new Set(gl);Na(l,m),Na(t,m);for(const _ of[...c,...d])oh[_]||(oh[_]=new Set,Na(Ba[_],oh[_])),m=new Set([...m,...oh[_]]);return{fragmentSource:l=l.replace(Vo,(_,x,b,E,I)=>(n.add(I),x==="define"?`
#ifndef HAS_UNIFORM_u_${I}
in ${b} ${E} ${I};
#else
uniform ${b} ${E} u_${I};
#endif
`:x==="initialize"?`
#ifdef HAS_UNIFORM_u_${I}
    ${b} ${E} ${I} = u_${I};
#endif
`:x==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${I}
    in ${b} ${E} ${I};
#endif
`:x==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(Vo,(_,x,b,E,I)=>{const L=`MATERIAL_ATTRIBUTE_OFFSET_${I}`,D=E==="float"?"vec2":E,z=`GET_ATTRIBUTE_${D}(a_${I}, materialInfo, ${L})`,B=I.match(/color/)?"color":D;return x==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${I}
in ${b} ${E} a_${I};
#endif
`:n.has(I)?x==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
    #if !defined(${L})
        in ${b} ${D} a_${I};
    #endif
out ${b} ${E} ${I};
#else
uniform ${b} ${E} u_${I};
#endif
`:x==="initialize"?B==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    ${I} = a_${I};
#else
    ${b} ${E} ${I} = u_${I};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${I})
    #ifdef ${L}
        ${I} = unpack_mix_${B}(${z}, u_${I}_t);
    #else
        ${I} = unpack_mix_${B}(a_${I}, u_${I}_t);
    #endif
#else
    ${b} ${E} ${I} = u_${I};
#endif
`:x==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${I}
    in ${b} ${E} a_${I};
    out ${b} ${E} ${I};
#endif
`:x==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${I}
    ${I} = a_${I};
#endif
`:void 0:x==="define"?`
#ifndef HAS_UNIFORM_u_${I}
uniform lowp float u_${I}_t;
    #if !defined(${L})
        in ${b} ${D} a_${I};
    #endif
#else
uniform ${b} ${E} u_${I};
#endif
`:x==="define-instanced"?B==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${I}0;
in vec4 a_${I}1;
in vec4 a_${I}2;
in vec4 a_${I}3;
#else
uniform ${b} ${E} u_${I};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${b} ${D} a_${I};
#else
uniform ${b} ${E} u_${I};
#endif
`:x==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${I}
    ${b} ${E} ${I} = a_${I};
#endif
`:B==="vec4"?`
#ifndef HAS_UNIFORM_u_${I}
    #ifdef ${L}
        ${b} ${E} ${I} = ${z};
    #else
        ${b} ${E} ${I} = a_${I};
    #endif
#else
    ${b} ${E} ${I} = u_${I};
#endif
`:`
#ifndef HAS_UNIFORM_u_${I}
    #ifdef ${L}
        ${b} ${E} ${I} = unpack_mix_${B}(${z}, u_${I}_t);
    #else
        ${b} ${E} ${I} = unpack_mix_${B}(a_${I}, u_${I}_t);
    #endif
#else
    ${b} ${E} ${I} = u_${I};
#endif
`}),usedDefines:m,vertexIncludes:c,fragmentIncludes:d}}class ay{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,n,c,d,m,_,x,b){this.context=t;let E=this.boundPaintVertexBuffers.length!==d.length;for(let L=0;!E&&L<d.length;L++)this.boundPaintVertexBuffers[L]!==d[L]&&(E=!0);let I=this.boundDynamicVertexBuffers.length!==x.length;for(let L=0;!I&&L<x.length;L++)this.boundDynamicVertexBuffers[L]!==x[L]&&(I=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==c||E||I||this.boundIndexBuffer!==m||this.boundVertexOffset!==_)this.freshBind(n,c,d,m,_,x,b);else{t.bindVertexArrayOES.set(this.vao);for(const L of x)L&&(L.bind(),b&&L.instanceCount&&L.setVertexAttribDivisor(t.gl,n,b));m&&m.dynamicDraw&&m.bind()}}freshBind(t,n,c,d,m,_,x){const b=this.context,E=b.gl;this.vao&&this.destroy(),this.vao=b.gl.createVertexArray(),b.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=d,this.boundVertexOffset=m,this.boundDynamicVertexBuffers=_,n.enableAttributes(E,t),n.bind(),n.setVertexAttribPointers(E,t,m);for(const I of c)I.enableAttributes(E,t),I.bind(),I.setVertexAttribPointers(E,t,m);for(const I of _)I&&(I.enableAttributes(E,t),I.bind(),I.setVertexAttribPointers(E,t,m),x&&I.instanceCount&&I.setVertexAttribDivisor(E,t,x));d&&d.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ly(l,t){const n=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new o.ae(0,c/n).toLngLat().lat,new o.ae(0,(c+1)/n).toLngLat().lat]}function cy(l,t,n,c,d,m,_){const x=l.context,b=x.gl,E=n.hillshadeFBO;if(!E)return;l.prepareDrawTile();const I=l.isTileAffectedByFog(t),L=[];l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback"&&L.push("USE_MRT1");const D=l.getOrCreateProgram("hillshade",{overrideFog:I,defines:L});x.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,E.colorAttachment0.get());const z=((G,Z,Y,X)=>{const ce=Y.paint.get("hillshade-shadow-color"),ne=Y.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ae=Y.paint.get("hillshade-highlight-color"),re=Y.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ee=Y.paint.get("hillshade-accent-color"),ue=Y.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",be=Y.paint.get("hillshade-emissive-strength");let xe=o.an(Y.paint.get("hillshade-illumination-direction"));if(Y.paint.get("hillshade-illumination-anchor")==="viewport")xe-=G.transform.angle;else if(G.style&&G.style.enable3dLights()&&G.style.directionalLight){const Le=G.style.directionalLight.properties.get("direction"),Ue=o.d4(Le.x,Le.y,Le.z);xe=o.an(Ue[1])}const De=!G.options.moving;return{u_matrix:X||G.transform.calculateProjMatrix(Z.tileID.toUnwrapped(),De),u_image:0,u_latrange:ly(0,Z.tileID),u_light:[Y.paint.get("hillshade-exaggeration"),xe],u_shadow:ce.toPremultipliedRenderColor(ne?null:Y.lut),u_highlight:ae.toPremultipliedRenderColor(re?null:Y.lut),u_emissive_strength:be,u_accent:ee.toPremultipliedRenderColor(ue?null:Y.lut)}})(l,n,c,l.terrain?t.projMatrix:null);l.uploadCommonUniforms(x,D,t.toUnwrapped());const{tileBoundsBuffer:B,tileBoundsIndexBuffer:F,tileBoundsSegments:H}=l.getTileBoundsBuffers(n);D.draw(l,b.TRIANGLES,d,m,_,si.disabled,z,c.id,B,F,H)}function nf(l,t,n){if(!t.needsDEMTextureUpload)return;const c=l.context,d=c.gl;c.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||l.getTileTexture(n.stride);const m=n.getPixels();t.demTexture?t.demTexture.update(m,{premultiply:!1}):t.demTexture=new o.T(c,m,d.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function uy(l,t,n){const c=l.context,d=c.gl;if(!t.dem)return;const m=t.dem;if(c.activeTexture.set(d.TEXTURE1),nf(l,t,m),!t.demTexture)return;t.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE);const _=m.dim;c.activeTexture.set(d.TEXTURE0);let x=t.hillshadeFBO;if(!x){const D=new o.T(c,{width:_,height:_,data:null},d.RGBA8);D.bind(d.LINEAR,d.CLAMP_TO_EDGE),x=t.hillshadeFBO=c.createFramebuffer(_,_,1,"renderbuffer"),x.colorAttachment0.set(D.texture)}c.bindFramebuffer.set(x.framebuffer),c.viewport.set([0,0,_,_]);const{tileBoundsBuffer:b,tileBoundsIndexBuffer:E,tileBoundsSegments:I}=l.getMercatorTileBoundsBuffers(),L=[];l.linearFloatFilteringSupported()&&L.push("TERRAIN_DEM_FLOAT_FORMAT"),l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback"&&L.push("USE_MRT1"),l.getOrCreateProgram("hillshadePrepare",{defines:L}).draw(l,d.TRIANGLES,Bt.disabled,oi.disabled,gi.unblended,si.disabled,((D,z)=>{const B=z.stride,F=o.bC();return o.ce(F,0,o.al,-o.al,0,0,1),o.br(F,F,[0,-o.al,0]),{u_matrix:F,u_image:1,u_dimension:[B,B],u_zoom:D.overscaledZ}})(t.tileID,m),n.id,b,E,I),t.needsHillshadePrepare=!1}class Fr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class hy extends Fr{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Sm extends Fr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class sf extends Fr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class lh extends Fr{getDefault(){return[!0,!0,!0,!0]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class of extends Fr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class yl extends Fr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Xl extends Fr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const n=this.current;(t.func!==n.func||t.ref!==n.ref||t.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Kc extends Fr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Kl extends Fr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=t,this.dirty=!1}}class Em extends Fr{getDefault(){return[0,1]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class af extends Fr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=t,this.dirty=!1}}class Am extends Fr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class Yl extends Fr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.BLEND):n.disable(n.BLEND),this.current=t,this.dirty=!1}}class ch extends Fr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class uh extends Fr{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const n=this.current;(t.r!==n.r||t.g!==n.g||t.b!==n.b||t.a!==n.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class lf extends Fr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class hh extends Fr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;t?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=t,this.dirty=!1}}class Yc extends Fr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Im extends Fr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let Cm=class extends Fr{getDefault(){return null}set(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)}};class Pm extends Fr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Jl extends Fr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const n=this.current;(t[0]!==n[0]||t[1]!==n[1]||t[2]!==n[2]||t[3]!==n[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Mm extends Fr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class dy extends Fr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class fy extends Fr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindTexture(n.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class py extends Fr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class cf extends Fr{getDefault(){return null}set(t){const n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class uf extends Fr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class hf extends Fr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class df extends Fr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Rm extends Fr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class dh extends Fr{constructor(t,n){super(t),this.context=t,this.parent=n}getDefault(){return null}}class fh extends dh{constructor(t,n,c=0){super(t,n),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+c}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachmentPoint,n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Ql extends dh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Jc extends dh{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Dm extends Ql{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const js=(l,t,n,c)=>({u_matrix:l,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:n,u_emissive_texture_available:c}),ph=(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H)=>({u_proj_matrix:Float32Array.from(l),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(c),u_merc_matrix:n,u_zoom_transition:d,u_merc_center:m,u_image0:0,u_image1:1,u_frustum_tl:_,u_frustum_tr:x,u_frustum_br:b,u_frustum_bl:E,u_globe_pos:I,u_globe_radius:L,u_viewport:D,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9),u_skirt_height:z,u_far_z_cutoff:B,u_emissive_texture_available:F});function Qc(l,t){return l!=null&&t!=null&&!(!l.hasData()||!t.hasData())&&l.demTexture!=null&&t.demTexture!=null&&l.tileID.key!==t.tileID.key}const sa=new class{constructor(){this.operations={}}newMorphing(l,t,n,c,d){if(l in this.operations){const m=this.operations[l];m.to.tileID.key!==n.tileID.key&&(m.queued=n)}else this.operations[l]={startTime:c,phase:0,duration:d,from:t,to:n,queued:null}}getMorphValuesForProxy(l){if(!(l in this.operations))return null;const t=this.operations[l];return{from:t.from,to:t.to,phase:t.phase}}update(l){for(const t in this.operations){const n=this.operations[t];for(n.phase=(l-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,l)){delete this.operations[t];break}}}_nextOp(l,t){return!!l.queued&&(l.from=l.to,l.to=l.queued,l.queued=null,l.phase=0,l.startTime=t,!0)}_validOp(l){return l.from.hasData()&&l.to.hasData()}},mh={0:null,1:"TERRAIN_VERTEX_MORPHING"};function _h(l,t,n){if(t===0)return 0;const c=t<1&&n===514?.25/t:1;return 6*Math.pow(1.5,22-l)*Math.max(t,1)*c}function ff(l,t){const n=1<<l.z;return!t&&(l.x===0||l.x===n-1)||l.y===0||l.y===n-1}function ec(l,t){if(!l.style||!l.style.enable3dLights())return;const n=l.context,c=n.gl;n.activeTexture.set(c.TEXTURE1),t?t.bind(c.LINEAR,c.CLAMP_TO_EDGE):l.emptyTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}const eu=l=>({u_matrix:l});function tu(l,t,n,c,d){if(d>0){const m=o.o.now(),_=(m-l.timeAdded)/d,x=t?(m-t.timeAdded)/d:-1,b=n.getSource(),E=c.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),I=!t||Math.abs(t.tileID.overscaledZ-E)>Math.abs(l.tileID.overscaledZ-E),L=I&&l.refreshedUponExpiration?1:o.aA(I?_:1-x,0,1);return t?{opacity:1,mix:1-L,isFading:_<1}:{opacity:L,mix:0,isFading:_<1}}return{opacity:1,mix:0,isFading:!1}}class gh extends Ds{constructor(t){const n=Ln("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",n,!1),n.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,n){t.state="loaded",n(null)}}class pf extends Ds{constructor(t){const n=Ln("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,n,c){if(t.freezeTileCoverage)return;this.transform=t;const d=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((m,_)=>{if(m[_.key]="",!this._tiles[_.key]){const x=new dl(_,this._source.tileSize*_.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);x.state="loaded",this._tiles[_.key]=x}return m},{});for(const m in this._tiles)m in d||(this.freeFBO(m),this._tiles[m].unloadVectorData(),delete this._tiles[m])}freeFBO(t){const n=this.proxyCachedFBO[t];if(n!==void 0){const c=Object.values(n);this.renderCachePool.push(...c),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class mf extends o.aQ{constructor(t,n,c){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=n,this.projMatrix=c}}class _f extends o.bV{constructor(t,n){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[c,d,m]=function(b){const E=new o.bd,I=new o.b0,L=131;E.reserve(17161),I.reserve(33800);const D=o.al/128,z=o.al+D/2,B=z+D;for(let H=-D;H<B;H+=D)for(let G=-D;G<B;G+=D){const Z=G<0||G>z||H<0||H>z?24575:0,Y=o.aA(Math.round(G),0,o.al),X=o.aA(Math.round(H),0,o.al);E.emplaceBack(Y+Z,X)}const F=(H,G)=>{const Z=G*L+H;I.emplaceBack(Z+1,Z,Z+L),I.emplaceBack(Z+L,Z+L+1,Z+1)};for(let H=1;H<129;H++)for(let G=1;G<129;G++)F(G,H);return[0,129].forEach(H=>{for(let G=0;G<130;G++)F(G,H),F(H,G)}),[E,I,32768]}(),_=t.context;this.gridBuffer=_.createVertexBuffer(c,o.bf.members),this.gridIndexBuffer=_.createIndexBuffer(d),this.gridSegments=o.bg.simpleSegment(0,0,c.length,d.length),this.gridNoSkirtSegments=o.bg.simpleSegment(0,0,c.length,m),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new pf(n.map),this.orthoMatrix=o.bC(),o.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const x=_.gl;this._overlapStencilMode=new oi({func:x.GEQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new gh(n.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,n,c){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const d=t.terrain.properties,m=t.terrain.drapeRenderMode===0,_=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const x=t.terrain&&t.terrain.scope,b=d.get("source"),E=m?this._mockSourceCache:t.getSourceCache(b,x);if(!E)return void o.w(`Couldn't find terrain source "${b}".`);if(this.sourceCache=E,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=_?this.calculateExaggeration(n):d.get("exaggeration"),!n.projection.requiresDraping&&_&&this._exaggeration===0)return void this._disable();this.enabled=!0;const I=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const L=this.getScaledDemTileSize();this.sourceCache.update(n,L,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,I(),this._initializing=!0),I(),n.updateElevation(!0,c),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const n=this._previousCameraAltitude,c=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=c;const d=n!=null?c-n:Number.MAX_VALUE;if(Math.abs(d)<2)return this._exaggeration;const m=t.zoom,_=this._style.terrain;if(!this._previousUpdateTimestamp)return _.getExaggeration(m);let x=m-this._previousZoom;const b=this._previousUpdateTimestamp;let E=m;this._evaluationZoom!=null&&(E=this._evaluationZoom,Math.abs(m-E)>.5&&(x=.5*(m-E+x)),x*d<0&&(E+=x)),this._evaluationZoom=E;const I=_.getExaggeration(E),L=I===_.getExaggeration(Math.max(0,E-.1));if(L&&Math.abs(I-this._exaggeration)<.01)return I;let D=Math.min(.1,.00375*(this._updateTimestamp-b));return(L||I<.1||Math.abs(x)<1e-4)&&(D=Math.min(.2,4*D)),o.ak(this._exaggeration,I,D)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,c=this.painter.transform;this._initializing&&(this._initializing=c._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(c.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const d=this.proxyCoords=n.getIds().map(b=>{const E=n.getTileByID(b).tileID;return E.projMatrix=c.calculateProjMatrix(E.toUnwrapped()),E});(function(b,E){const I=E.transform.pointCoordinate(E.transform.getCameraPoint()),L=new o.P(I.x,I.y);b.sort((D,z)=>{if(z.overscaledZ-D.overscaledZ)return z.overscaledZ-D.overscaledZ;const B=new o.P(D.canonical.x+(1<<D.canonical.z)*D.wrap,D.canonical.y),F=new o.P(z.canonical.x+(1<<z.canonical.z)*z.wrap,z.canonical.y),H=L.mult(1<<D.canonical.z);return H.x-=.5,H.y-=.5,H.distSqr(B)-H.distSqr(F)})})(d,this.painter);const m=this.proxyToSource||{};this.proxyToSource={},d.forEach(b=>{this.proxyToSource[b.key]={}}),this.terrainTileForTile={};const _=this._style._mergedSourceCaches;for(const b in _){const E=_[b];if(!E.used||(E!==this.sourceCache&&this.resetTileLookupCache(E.id),this._setupProxiedCoordsForOrtho(E,t[b],m),E.usedForTerrain))continue;const I=t[b];E.getSource().reparseOverscaled&&this._assignTerrainTiles(I)}this.proxiedCoords[n.id]=d.map(b=>new mf(b,b.key,this.orthoMatrix)),this._assignTerrainTiles(d),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(m),this.renderingToTexture=!1;const x={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const E=this.terrainTileForTile[b.key];if(!E)continue;const I=E.tileID.key;I in x||(this._visibleDemTiles.push(E),x[I]=I)}}_assignTerrainTiles(t){this._initializing||t.forEach(n=>{if(this.terrainTileForTile[n.key])return;const c=this._findTileCoveringTileID(n,this.sourceCache);c&&(this.terrainTileForTile[n.key]=c)})}_prepareDEMTextures(){const t=this.painter.context,n=t.gl;for(const c in this.terrainTileForTile){const d=this.terrainTileForTile[c],m=d.dem;!m||d.demTexture&&!d.needsDEMTextureUpload||(t.activeTexture.set(n.TEXTURE1),nf(this.painter,d,m))}}_prepareDemTileUniforms(t,n,c,d){if(!n||n.demTexture==null)return!1;const m=t.tileID.canonical,_=Math.pow(2,n.tileID.canonical.z-m.z),x=d||"";return c[`u_dem_tl${x}`]=[m.x*_%1,m.y*_%1],c[`u_dem_scale${x}`]=_,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const n=this._visibleDemTiles.reduce((c,d)=>{if(!d.dem)return c;const m=d.dem.tree.minimums[0];return m>0&&t++,c+m},0);return t?n/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);const c=this._getLoadedAreaMinimum(),d=new o.dL({width:1,height:1},new Float32Array([c]));this._emptyDEMTextureDirty=!1;let m=this._emptyDEMTexture;return m?m.update(d,{premultiply:!1}):m=this._emptyDEMTexture=new o.T(t,d,n.R32F,{premultiply:!1}),m}setupElevationDraw(t,n,c){const d=this.painter.context,m=d.gl,_={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};_.u_exaggeration=this.exaggeration();let x=null,b=null,E=1;if(c&&c.morphing&&this._useVertexMorphing){const z=c.morphing.srcDemTile,B=c.morphing.dstDemTile;E=c.morphing.phase,z&&B&&(this._prepareDemTileUniforms(t,z,_,"_prev")&&(b=z),this._prepareDemTileUniforms(t,B,_)&&(x=B))}const I=z=>z&&z.demTexture&&this.painter.linearFloatFilteringSupported()?m.LINEAR:m.NEAREST;let L=null;var D;if(this.enabled?b&&x?(L=x.demTexture,d.activeTexture.set(m.TEXTURE4),b.demTexture.bind(I(b),m.CLAMP_TO_EDGE),_.u_dem_lerp=E):(x=this.terrainTileForTile[t.tileID.key],L=this._prepareDemTileUniforms(t,x,_)?x.demTexture:this.emptyDEMTexture):L=this.emptyDEMTexture,d.activeTexture.set(m.TEXTURE2),L&&(_.u_dem_size=(D=L).size[0]===1?1:D.size[0]-2,L.bind(I(x),m.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(c&&c.useDepthForOcclusion,n,_),c&&c.useMeterToDem&&x){const z=(1<<x.tileID.canonical.z)*o.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;_.u_meter_to_dem=z}if(c&&c.labelPlaneMatrixInv&&(_.u_label_plane_matrix_inv=c.labelPlaneMatrixInv),n.setTerrainUniformValues(d,_),this.painter.transform.projection.name==="globe"){const z=this.globeUniformValues(this.painter.transform,t.tileID.canonical,c&&c.useDenormalizedUpVectorScale);n.setGlobeUniformValues(d,z)}}globeUniformValues(t,n,c){const d=t.projection;return{u_tile_tl_up:d.upVector(n,0,0),u_tile_tr_up:d.upVector(n,o.al,0),u_tile_br_up:d.upVector(n,o.al,o.al),u_tile_bl_up:d.upVector(n,0,o.al),u_tile_up_scale:c?o.dM(1):d.upVectorScale(n,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const n=this.painter,c=this.painter.context;t.length!==0&&(c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(d,m,_,x,b){if(d.transform.projection.name==="globe")(function(E,I,L,D,z){const B=E.context,F=B.gl;let H,G;const Z=E.transform,Y=o.dE(E,B,Z),X=(De,Le)=>{if(G===Le)return;const Ue=[mh[Le],"PROJECTION_GLOBE_VIEW"];Y&&Ue.push("CUSTOM_ANTIALIASING");const it=E.isTileAffectedByFog(De);H=E.getOrCreateProgram("globeRaster",{defines:Ue,overrideFog:it}),G=Le},ce=E.colorModeForRenderPass(),ne=new Bt(F.LEQUAL,Bt.ReadWrite,E.depthRangeFor3D);sa.update(z);const ae=o.dF(Z),re=[o.aF(Z.center.lng),o.aJ(Z.center.lat)],ee=E.globeSharedBuffers,ue=[Z.width*o.o.devicePixelRatio,Z.height*o.o.devicePixelRatio],be=Float32Array.from(Z.globeMatrix),xe={useDenormalizedUpVectorScale:!0};{const De=E.transform,Le=_h(De.zoom,I.exaggeration(),I.sourceCache._source.tileSize);G=-1;const Ue=F.TRIANGLES;for(const it of D){const Ce=L.getTile(it),_e=oi.disabled,Fe=I.prevTerrainTileForTile[it.key],Pe=I.terrainTileForTile[it.key];Qc(Fe,Pe)&&sa.newMorphing(it.key,Fe,Pe,z,250),ec(E,Ce.emissiveTexture),B.activeTexture.set(F.TEXTURE0),Ce.texture&&Ce.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);const We=sa.getMorphValuesForProxy(it.key),dt=We?1:0;We&&Object.assign(xe,{morphing:{srcDemTile:We.from,dstDemTile:We.to,phase:o.dD(We.phase)}});const Tt=o.dG(it.canonical),ct=o.dH(Tt.getCenter().lat),nt=o.dI(it.canonical,Tt,ct,De.worldSize/De._pixelsPerMercatorPixel),kt=o.bk(o.dJ(it.canonical)),Dt=E.emissiveMode==="mrt-fallback"?1:0,xt=ph(De.expandedFarZProjMatrix,be,ae,kt,o.aj(De.zoom),re,De.frustumCorners.TL,De.frustumCorners.TR,De.frustumCorners.BR,De.frustumCorners.BL,De.globeCenterInViewSpace,De.globeRadius,ue,Le,De._farZ,Dt,nt);if(X(it,dt),H&&(I.setupElevationDraw(Ce,H,xe),E.uploadCommonUniforms(B,H,it.toUnwrapped()),ee)){const[Et,$t,di]=ee.getGridBuffers(ct,Le!==0);H.draw(E,Ue,ne,_e,ce,si.backCCW,xt,"globe_raster",Et,$t,di)}}}if(ee&&(E.renderDefaultNorthPole||E.renderDefaultSouthPole)){const De=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];Y&&De.push("CUSTOM_ANTIALIASING"),H=E.getOrCreateProgram("globeRaster",{defines:De});for(const Le of D){const{x:Ue,y:it,z:Ce}=Le.canonical,_e=it===0,Fe=it===(1<<Ce)-1,[Pe,We,dt,Tt]=ee.getPoleBuffers(Ce,!1);if(Tt&&(_e||Fe)){const ct=L.getTile(Le);ec(E,ct.emissiveTexture),B.activeTexture.set(F.TEXTURE0),ct.texture&&ct.texture.bind(F.LINEAR,F.CLAMP_TO_EDGE);let nt=o.dK(Ce,Ue,Z);const kt=o.bk(o.dJ(Le.canonical)),Dt=E.emissiveMode==="mrt-fallback"?1:0,xt=(Et,$t)=>Et.draw(E,F.TRIANGLES,ne,oi.disabled,ce,si.disabled,ph(Z.expandedFarZProjMatrix,nt,nt,kt,0,re,Z.frustumCorners.TL,Z.frustumCorners.TR,Z.frustumCorners.BR,Z.frustumCorners.BL,Z.globeCenterInViewSpace,Z.globeRadius,ue,0,Z._farZ,Dt),"globe_pole_raster",$t,dt,Tt);I.setupElevationDraw(ct,H,xe),E.uploadCommonUniforms(B,H,Le.toUnwrapped()),_e&&E.renderDefaultNorthPole&&xt(H,Pe),Fe&&E.renderDefaultSouthPole&&(nt=o.cS(o.bC(),nt,[1,-1,1]),xt(H,We))}}}})(d,m,_,x,b);else{const E=d.context,I=E.gl;let L,D;const z=d.shadowRenderer,B=za(d,d.longestCutoffRange),F=ce=>{if(D===ce)return;const ne=[];ne.push(mh[ce]),B.shouldRenderCutoff&&ne.push("RENDER_CUTOFF"),z&&(ne.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&ne.push("NORMAL_OFFSET")),L=d.getOrCreateProgram("terrainRaster",{defines:ne}),D=ce},H=d.colorModeForRenderPass(),G=new Bt(I.LEQUAL,Bt.ReadWrite,d.depthRangeFor3D);sa.update(b);const Z=d.transform,Y=_h(Z.zoom,m.exaggeration(),m.sourceCache._source.tileSize);let X=[0,0,0];if(z){const ce=d.style.directionalLight,ne=d.style.ambientLight;ce&&ne&&(X=na(d.style,ce,ne))}{D=-1;const ce=I.TRIANGLES,[ne,ae]=[m.gridIndexBuffer,m.gridSegments];for(const re of x){const ee=_.getTile(re),ue=oi.disabled,be=m.prevTerrainTileForTile[re.key],xe=m.terrainTileForTile[re.key];Qc(be,xe)&&sa.newMorphing(re.key,be,xe,b,250),ec(d,ee.emissiveTexture),E.activeTexture.set(I.TEXTURE0),ee.texture&&ee.texture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const De=sa.getMorphValuesForProxy(re.key),Le=De?1:0;let Ue;De&&(Ue={morphing:{srcDemTile:De.from,dstDemTile:De.to,phase:o.dD(De.phase)}});const it=d.emissiveMode==="mrt-fallback"?1:0,Ce=js(re.projMatrix,ff(re.canonical,Z.renderWorldCopies)?Y/10:Y,X,it);if(F(Le),!L)continue;m.setupElevationDraw(ee,L,Ue);const _e=re.toUnwrapped();z&&z.setupShadows(_e,L),d.uploadCommonUniforms(E,L,_e,null,B),L.draw(d,ce,G,ue,H,si.backCCW,Ce,"terrain_raster",m.gridBuffer,ne,ae)}}}}(n,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const n=this.painter,c=this.painter.context,d=this.proxySourceCache,m=this.proxiedCoords[d.id],_=this._drapedRenderBatches.shift(),x=n.style.order,b=[];this._updateFBOs(n.emissiveMode==="mrt-fallback");let E=0;for(const I of m){const L=d.getTileByID(I.proxyTileKey),D=d.proxyCachedFBO[I.key]?d.proxyCachedFBO[I.key][t]:void 0,z=D!==void 0?d.renderCache[D]:this.pool[E++],B=D!==void 0;if(L.texture=z.tex,L.emissiveTexture=z.emissiveTex,B&&!z.dirty){b.push(L.tileID);continue}c.bindFramebuffer.set(z.fb.framebuffer);const F=c.gl;let H;F.drawBuffers(n.emissiveMode==="mrt-fallback"?[F.COLOR_ATTACHMENT0,F.COLOR_ATTACHMENT1]:[F.COLOR_ATTACHMENT0]),this.renderedToTile=!1,z.dirty&&(c.clear({color:o.ao.transparent,stencil:0}),z.dirty=!1);for(let G=_.start;G<=_.end;++G){const Z=n.style._mergedLayers[x[G]];if(Z.isHidden(n.transform.zoom))continue;const Y=n.style.getLayerSourceCache(Z),X=Y?this.proxyToSource[I.key][Y.id]:[I];if(!X)continue;const ce=X;c.viewport.set([0,0,z.fb.width,z.fb.height]),H!==(Y?Y.id:null)&&(this._setupStencil(z,X,Z,Y),H=Y?Y.id:null),n.renderLayer(n,Y,Z,ce)}if(F.drawBuffers([F.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const G of this._pendingGroundEffectLayers){const Z=n.style._mergedLayers[x[G]];if(Z.isHidden(n.transform.zoom))continue;const Y=n.style.getLayerSourceCache(Z),X=Y?this.proxyToSource[I.key][Y.id]:[I];if(!X)continue;const ce=X;c.viewport.set([0,0,z.fb.width,z.fb.height]),H!==(Y?Y.id:null)&&(this._setupStencil(z,X,Z,Y),H=Y?Y.id:null),n.renderLayer(n,Y,Z,ce)}this.renderedToTile?(z.dirty=!0,b.push(L.tileID)):B||--E,E===5&&(E=0,this.renderToBackBuffer(b))}return this.renderToBackBuffer(b),this.renderingToTexture=!1,c.bindFramebuffer.set(null),c.viewport.set([0,0,n.width,n.height]),_.end+1}postRender(){}isLayerOrderingCorrect(t){const n=t.order.length;let c=-1,d=n;for(let m=0;m<n;++m)this._style.isLayerDraped(t._mergedLayers[t.order[m]])?c=Math.max(c,m):d=Math.min(d,m);return d>c}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{t=Math.min(t,n.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,n,c){if(!this._visibleDemTiles)return null;const d=this._visibleDemTiles.filter(m=>m.dem).map(m=>{const _=m.tileID,x=1<<_.overscaledZ,{x:b,y:E}=_.canonical,I=b/x,L=(b+1)/x,D=E/x,z=(E+1)/x;return{minx:I,miny:D,maxx:L,maxy:z,t:m.dem.tree.raycastRoot(I,D,L,z,t,n,c),tile:m}});d.sort((m,_)=>(m.t!==null?m.t:Number.MAX_VALUE)-(_.t!==null?_.t:Number.MAX_VALUE));for(const m of d){if(m.t==null)return null;const _=m.tile.dem.tree.raycast(m.minx,m.miny,m.maxx,m.maxy,t,n,c);if(_!=null)return _}return null}_createFBO(){const t=this.painter.context,n=t.gl,c=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);const d=new o.T(t,{width:c[0],height:c[1],data:null},n.RGBA8);d.bind(n.LINEAR,n.CLAMP_TO_EDGE);const m=t.createFramebuffer(c[0],c[1],1,null);let _;return m.colorAttachment0.set(d.texture),this._emissiveTexture&&(_=new o.T(t,{width:c[0],height:c[1],data:null},n.R8),_.bind(n.LINEAR,n.CLAMP_TO_EDGE),m.createColorAttachment(t,1),m.colorAttachment1.set(_.texture)),m.depthAttachment=new Dm(t,m.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,c[0],c[1]),this._stencilRef=0,m.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):m.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:m,tex:d,emissiveTex:_,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const n of this.pool)this._updateFBO(n,t);for(const n of this.proxySourceCache.renderCache)this._updateFBO(n,t);this._emissiveTexture=t}}_updateFBO(t,n){const c=t.fb,d=this.painter.context,m=d.gl,_=this.drapeBufferSize;if(n){const x=new o.T(d,{width:_[0],height:_[1],data:null},m.R8);x.bind(m.LINEAR,m.CLAMP_TO_EDGE),t.emissiveTex=x,c.createColorAttachment(d,1),c.colorAttachment1.set(x.texture)}else t.emissiveTex=void 0,c.removeColorAttachment(d,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const n=this._style._mergedLayers[t],c=n.isHidden(this.painter.transform.zoom);return n.type==="hillshade"||n.type==="custom"?!c&&n.shouldRedrape():!c&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const c of this._style.getSources())if(c instanceof cl){t=!0;break}if(!t)return;const n={};for(let c=0;c<this._style.order.length;++c){const d=this._style._mergedLayers[this._style.order[c]],m=this._style.getLayerSourceCache(d);if(!m||n[m.id]||d.isHidden(this.painter.transform.zoom)||d.type!=="line")continue;const _=d.widthExpression(),x=d.emissiveStrengthExpression();if(_ instanceof o.ad||x instanceof o.ad){n[m.id]=!0;for(const b of this.proxyCoords){const E=this.proxyToSource[b.key][m.id];if(E)for(const I of E)this._clearRenderCacheForTile(m.id,I)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c]._source instanceof Vn){t=!0;break}if(!t)return;const n={};for(let c=0;c<this._style.order.length;++c){const d=this._style._mergedLayers[this._style.order[c]],m=this._style.getLayerSourceCache(d);if(!m||n[m.id]||d.isHidden(this.painter.transform.zoom)||d.type!=="raster")continue;const _=d.paint.get("raster-fade-duration");for(const x of this.proxyCoords){const b=this.proxyToSource[x.key][m.id];if(b)for(const E of b){const I=tu(m.getTile(E),m.findLoadedParent(E,0),m,this.painter.transform,_);(I.opacity!==1||I.mix!==0)&&this._clearRenderCacheForTile(m.id,E)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,n=t.length;if(n===0)return;const c=[];this._pendingGroundEffectLayers=[];let d,m=0,_=this._style._mergedLayers[t[m]];for(;!this._style.isLayerDraped(_)&&_.isHidden(this.painter.transform.zoom)&&++m<n;)_=this._style._mergedLayers[t[m]];for(;m<n;++m){const x=this._style._mergedLayers[t[m]];x.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(x)?d===void 0&&(d=m):(x.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(m),d!==void 0&&(c.push({start:d,end:m-1}),d=void 0)))}if(d!==void 0&&c.push({start:d,end:m-1}),c.length!==0){const x=c[c.length-1];this._pendingGroundEffectLayers.every(b=>b>x.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=c}_setupRenderCache(t){const n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){const _=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let x=0;x<_.length;++x){const b=Object.values(_[x]);n.renderCachePool.push(...b)}}return}this._clearRasterLayersFromRenderCache();const c=this.proxyCoords,d=this._tilesDirty;for(let _=c.length-1;_>=0;_--){const x=c[_];if(n.getTileByID(x.key),n.proxyCachedFBO[x.key]!==void 0){const b=t[x.key],E=this.proxyToSource[x.key];let I=0;for(const L in E){const D=E[L],z=b[L];if(!z||z.length!==D.length||D.some((B,F)=>B!==z[F]||d[L]&&d[L].hasOwnProperty(B.key))){I=-1;break}++I}for(const L in n.proxyCachedFBO[x.key])n.renderCache[n.proxyCachedFBO[x.key][L]].dirty=I<0||I!==Object.values(b).length}}const m=[...this._drapedRenderBatches];m.sort((_,x)=>x.end-x.start-(_.end-_.start));for(const _ of m)for(const x of c){if(n.proxyCachedFBO[x.key])continue;let b=n.renderCachePool.pop();b===void 0&&n.renderCache.length<50&&(b=n.renderCache.length,n.renderCache.push(this._createFBO())),b!==void 0&&(n.proxyCachedFBO[x.key]={},n.proxyCachedFBO[x.key][_.start]=b,n.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(t,n,c,d){if(!d||!this._sourceTilesOverlap[d.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const m=this.painter.context,_=m.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let x;if(c.isTileClipped())x=n.length,this._overlapStencilMode.test={func:_.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);x=1,this._overlapStencilMode.test={func:_.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+x>255&&(m.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=x,this._overlapStencilMode.ref=this._stencilRef,c.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):oi.disabled}_renderTileClippingMasks(t,n){const c=this.painter,d=this.painter.context,m=d.gl;c._tileClippingMaskIDs={},d.setColorMode(gi.disabled),d.setDepthMode(Bt.disabled);const _=c.getOrCreateProgram("clippingMask");for(const x of t){const b=c._tileClippingMaskIDs[x.key]=--n;_.draw(c,m.TRIANGLES,Bt.disabled,new oi({func:m.ALWAYS,mask:0},b,255,m.KEEP,m.KEEP,m.REPLACE),gi.disabled,si.disabled,eu(x.projMatrix),"$clipping",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments)}}pointCoordinate(t){const n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;const c=[t.x,t.y,1,1];o.aC(c,c,n.pixelMatrixInverse),o.cK(c,c,1/c[3]),c[0]/=n.worldSize,c[1]/=n.worldSize;const d=n._camera.position,m=o.cf(1,n.center.lat),_=[d[0],d[1],d[2]/m,0],x=o.da([],c.slice(0,3),_);o.aw(x,x);const b=this.raycast(_,x,this._exaggeration);return b!==null&&b?(o.bH(_,_,x,b),_[3]=_[2],_[2]*=m,_):null}_setupProxiedCoordsForOrtho(t,n,c){if(t.getSource()instanceof o.aU)return this._setupProxiedCoordsForImageSource(t,n,c);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const d=this.proxiedCoords[t.id]=[],m=this.proxyCoords;for(let b=0;b<m.length;b++){const E=m[b],I=this._findTileCoveringTileID(E,t);if(I){const L=this._createProxiedId(E,I,c[E.key]&&c[E.key][t.id]);d.push(L),this.proxyToSource[E.key][t.id]=[L]}}let _=!1;const x=new Set;for(let b=0;b<n.length;b++){const E=t.getTile(n[b]);if(!E||!E.hasData())continue;const I=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(I&&I.tileID.canonical.z!==E.tileID.canonical.z){const L=this.proxyToSource[I.tileID.key][t.id],D=this._createProxiedId(I.tileID,E,c[I.tileID.key]&&c[I.tileID.key][t.id]);L?L.splice(L.length-1,0,D):this.proxyToSource[I.tileID.key][t.id]=[D];const z=this.proxyToSource[I.tileID.key][t.id];x.has(z)||x.add(z),d.push(D),_=!0}}if(this._sourceTilesOverlap[t.id]=_,_&&this._debugParams.sortTilesHiZFirst)for(const b of x)b.sort((E,I)=>I.overscaledZ-E.overscaledZ)}_setupProxiedCoordsForImageSource(t,n,c){if(!t.getSource().loaded())return;const d=this.proxiedCoords[t.id]=[],m=this.proxyCoords,_=t.getSource(),x=_.tileID;if(!x)return;const b=new o.P(x.x,x.y)._div(1<<x.z),E=_.coordinates.map(o.ae.fromLngLat).reduce((L,D)=>(L.min.x=Math.min(L.min.x,D.x-b.x),L.min.y=Math.min(L.min.y,D.y-b.y),L.max.x=Math.max(L.max.x,D.x-b.x),L.max.y=Math.max(L.max.y,D.y-b.y),L),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),I=(L,D)=>{const z=L.wrap+L.canonical.x/(1<<L.canonical.z),B=L.canonical.y/(1<<L.canonical.z),F=o.al/(1<<L.canonical.z),H=D.wrap+D.canonical.x/(1<<D.canonical.z),G=D.canonical.y/(1<<D.canonical.z);return z+F<H+E.min.x||z>H+E.max.x||B+F<G+E.min.y||B>G+E.max.y};for(let L=0;L<m.length;L++){const D=m[L];for(let z=0;z<n.length;z++){const B=t.getTile(n[z]);if(!B||!B.hasData()||I(D,B.tileID))continue;const F=this._createProxiedId(D,B,c[D.key]&&c[D.key][t.id]),H=this.proxyToSource[D.key][t.id];H?H.push(F):this.proxyToSource[D.key][t.id]=[F],d.push(F)}}}_createProxiedId(t,n,c){let d=this.orthoMatrix;if(c){const m=c.find(_=>_.key===n.tileID.key);if(m)return m}if(n.tileID.key!==t.key){const m=t.canonical.z-n.tileID.canonical.z;let _,x,b;d=o.bC();const E=n.tileID.wrap-t.wrap<<t.overscaledZ;m>0?(_=o.al>>m,x=_*((n.tileID.canonical.x<<m)-t.canonical.x+E),b=_*((n.tileID.canonical.y<<m)-t.canonical.y)):(_=o.al<<-m,x=o.al*(n.tileID.canonical.x-(t.canonical.x+E<<-m)),b=o.al*(n.tileID.canonical.y-(t.canonical.y<<-m))),o.ce(d,0,_,0,_,0,1),o.br(d,d,[x,b,0])}return new mf(n.tileID,t.key,d)}_findTileCoveringTileID(t,n){let c=n.getTile(t);if(c&&c.hasData())return c;const d=this._findCoveringTileCache[n.id],m=d[t.key];if(c=m?n.getTileByID(m):null,c&&c.hasData()||m===null)return c;let _=c?c.tileID:t,x=_.overscaledZ;const b=n.getSource().minzoom,E=[];if(!m){const L=n.getSource().maxzoom;if(t.canonical.z>=L){const D=t.canonical.z-L;n.getSource().reparseOverscaled?(x=Math.max(t.canonical.z+2,n.transform.tileZoom),_=new o.aQ(x,t.wrap,L,t.canonical.x>>D,t.canonical.y>>D)):D!==0&&(x=L,_=new o.aQ(x,t.wrap,L,t.canonical.x>>D,t.canonical.y>>D))}_.key!==t.key&&(E.push(_.key),c=n.getTile(_))}const I=L=>{E.forEach(D=>{d[D]=L}),E.length=0};for(x-=1;x>=b&&(!c||!c.hasData());x--){c&&I(c.tileID.key);const L=_.calculateScaledKey(x);if(c=n.getTileByID(L),c&&c.hasData())break;const D=d[L];if(D===null)break;D===void 0?E.push(L):c=n.getTileByID(D)}return I(c?c.tileID.key:null),c&&c.hasData()?c:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,n){let c=this._tilesDirty[t];c||(c=this._tilesDirty[t]={}),c[n.key]=!0}}function tc(l,t,n){const c=function(x,b,E){const I=o.bJ(b,x),L=o.bJ(E,[.2126,.7152,.0722]),D=(B,F,H)=>(1-H)*B+H*F,z=D(1-.3*Math.min(L,1),1,Math.min(I+1,1));return D(.92,1,Math.asin(o.aA(b[2],-1,1))/Math.PI+.5)*z}(l,[0,0,1],t),d=[0,0,0];o.c5(d,n.slice(0,3),c);const m=[0,0,0];o.c5(m,t.slice(0,3),l[2]);const _=[0,0,0];return o.d8(_,d,m),o.db(_)}const my=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],_y=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class Lm{static cacheKey(t,n,c,d){const m=[n];d&&m.push(d.cacheKey);for(const _ of c)t.usedDefines.has(_)&&m.push(_);return m.join("/")}constructor(t,n,c,d,m,_){const x=t.gl;this.program=x.createProgram(),this.configuration=d,this.name=n,this.fixedDefines=[..._];const b=`#version 300 es
${(d?d.defines():[]).concat(_.map(F=>`#define ${F}`)).join(`
`)}`,E=[b,oy];for(const F of c.fragmentIncludes)E.push(Ba[F]);E.push(c.fragmentSource);const I=E.join(`
`),L=[b,Tm];for(const F of c.vertexIncludes)L.push(Ba[F]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&c.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&L.push("uniform int u_instanceID;"),L.push(c.vertexSource);let D=L.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(D=D.replaceAll("gl_InstanceID","u_instanceID"));const z=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(z,I),x.compileShader(z),x.attachShader(this.program,z);const B=x.createShader(x.VERTEX_SHADER);x.isContextLost()?this.failedToCreate=!0:(x.shaderSource(B,D),x.compileShader(B),x.attachShader(this.program,B),this.attributes={},x.linkProgram(this.program),x.deleteShader(B),x.deleteShader(z),this.fixedUniforms=m(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=d?d.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(F=>({u_instanceID:new o.ch(F)}))(t)),(_.includes("TERRAIN")||n.includes("symbol")||n.includes("circle"))&&(this.terrainUniforms=(F=>({u_dem:new o.ch(F),u_dem_prev:new o.ch(F),u_dem_tl:new o.ck(F),u_dem_scale:new o.cj(F),u_dem_tl_prev:new o.ck(F),u_dem_scale_prev:new o.cj(F),u_dem_size:new o.cj(F),u_dem_lerp:new o.cj(F),u_exaggeration:new o.cj(F),u_depth:new o.ch(F),u_depth_size_inv:new o.ck(F),u_depth_range_unpack:new o.ck(F),u_occluder_half_size:new o.cj(F),u_occlusion_depth_offset:new o.cj(F),u_meter_to_dem:new o.cj(F),u_label_plane_matrix_inv:new o.cl(F)}))(t)),_.includes("GLOBE")&&(this.globeUniforms=(F=>({u_tile_tl_up:new o.ci(F),u_tile_tr_up:new o.ci(F),u_tile_br_up:new o.ci(F),u_tile_bl_up:new o.ci(F),u_tile_up_scale:new o.cj(F)}))(t)),_.includes("FOG")&&(this.fogUniforms=(F=>({u_fog_matrix:new o.cl(F),u_fog_range:new o.ck(F),u_fog_color:new o.d3(F),u_fog_horizon_blend:new o.cj(F),u_fog_vertical_limit:new o.ck(F),u_fog_temporal_offset:new o.cj(F),u_frustum_tl:new o.ci(F),u_frustum_tr:new o.ci(F),u_frustum_br:new o.ci(F),u_frustum_bl:new o.ci(F),u_globe_pos:new o.ci(F),u_globe_radius:new o.cj(F),u_globe_transition:new o.cj(F),u_is_globe:new o.ch(F),u_viewport:new o.ck(F)}))(t)),_.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(F=>({u_cutoff_params:new o.d3(F)}))(t)),_.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(F=>({u_lighting_ambient_color:new o.ci(F),u_lighting_directional_dir:new o.ci(F),u_lighting_directional_color:new o.ci(F),u_ground_radiance:new o.ci(F)}))(t)),_.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(F=>({u_light_matrix_0:new o.cl(F),u_light_matrix_1:new o.cl(F),u_fade_range:new o.ck(F),u_shadow_normal_offset:new o.ci(F),u_shadow_intensity:new o.cj(F),u_shadow_texel_size:new o.cj(F),u_shadow_map_resolution:new o.cj(F),u_shadow_direction:new o.ci(F),u_shadow_bias:new o.ci(F),u_shadowmap_0:new o.ch(F),u_shadowmap_1:new o.ch(F)}))(t)))}getAttributeLocation(t,n){let c=this.attributes[n];return c===void 0&&(c=this.attributes[n]=t.getAttribLocation(this.program,n)),c}setTerrainUniformValues(t,n){if(!this.terrainUniforms)return;const c=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in n)c[d]&&c[d].set(this.program,d,n[d])}}setGlobeUniformValues(t,n){if(!this.globeUniforms)return;const c=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in n)c[d]&&c[d].set(this.program,d,n[d])}}setFogUniformValues(t,n){if(!this.fogUniforms)return;const c=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in n)c[d].set(this.program,d,n[d])}}setCutoffUniformValues(t,n){if(!this.cutoffUniforms)return;const c=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in n)c[d].set(this.program,d,n[d])}}setLightsUniformValues(t,n){if(!this.lightsUniforms)return;const c=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const d in n)c[d].set(this.program,d,n[d])}}setShadowUniformValues(t,n){if(this.failedToCreate||!this.shadowUniforms)return;const c=this.shadowUniforms;t.program.set(this.program);for(const d in n)c[d].set(this.program,d,n[d])}_drawDebugWireframe(t,n,c,d,m,_,x,b,E,I){const L=t.options.wireframe;if(L.terrain===!1&&L.layers2D===!1&&L.layers3D===!1)return;const D=t.context;if(!(!(!L.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!L.layers2D||t._terrain&&t._terrain.renderingToTexture||!my.includes(this.name))||!(!L.layers3D||!_y.includes(this.name))))return;const z=D.gl,B=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,m,D);if(!B)return;const F=[...this.fixedDefines,"DEBUG_WIREFRAME"],H=t.getOrCreateProgram(this.name,{config:this.configuration,defines:F});D.program.set(H.program);const G=(X,ce,ne)=>{if(ce[X]&&ne[X])for(const ae in ce[X])ne[X][ae]&&ne[X][ae].set(ne.program,ae,ce[X][ae].current)};E&&E.setUniforms(H.program,D,H.binderUniforms,x,{zoom:b}),G("fixedUniforms",this,H),G("terrainUniforms",this,H),G("globeUniforms",this,H),G("fogUniforms",this,H),G("lightsUniforms",this,H),G("shadowUniforms",this,H),B.bind(),D.setColorMode(new gi([z.ONE,z.ONE_MINUS_SRC_ALPHA,z.ZERO,z.ONE],o.ao.transparent,[!0,!0,!0,!1])),D.setDepthMode(new Bt(n.func===z.LESS?z.LEQUAL:n.func,Bt.ReadOnly,n.range)),D.setStencilMode(oi.disabled);const Z=3*_.primitiveLength*2,Y=3*_.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const X=I||1;for(let ce=0;ce<X;++ce)H.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ce),z.drawElements(z.LINES,Z,z.UNSIGNED_SHORT,Y)}else I&&I>1?z.drawElementsInstanced(z.LINES,Z,z.UNSIGNED_SHORT,Y,I):z.drawElements(z.LINES,Z,z.UNSIGNED_SHORT,Y);m.bind(),D.program.set(this.program),D.setDepthMode(n),D.setStencilMode(c),D.setColorMode(d)}checkUniforms(t,n,c){if(this.fixedDefines.includes(n)){for(const d of Object.keys(c))if(!c[d].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${d} not set but required by ${n} being defined`)}}draw(t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H){const G=t.context,Z=G.gl;if(this.failedToCreate)return;G.program.set(this.program),G.setDepthMode(c),G.setStencilMode(d),G.setColorMode(m),G.setCullFace(_);for(const[re,ee]of this.fixedUniformsEntries)ee.set(this.program,re,x[re]);B&&B.setUniforms(this.program,G,this.binderUniforms,D,{zoom:z});const Y={[Z.POINTS]:1,[Z.LINES]:2,[Z.TRIANGLES]:3,[Z.LINE_STRIP]:1}[n];this.checkUniforms(b,"RENDER_SHADOWS",this.shadowUniforms);const X=F||[],ce=B?B.getPaintVertexBuffers():[],ne=n===Z.TRIANGLES&&I,ae=H&&H>0?1:void 0;for(const re of L.get()){const ee=re.vaos||(re.vaos={});if((ee[b]||(ee[b]=new ay)).bind(G,this,E,ce,I,re.vertexOffset,X,ae),this.forceManualRenderingForInstanceIDShaders){const ue=H||1;for(let be=0;be<ue;++be)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",be),I?Z.drawElements(n,re.primitiveLength*Y,Z.UNSIGNED_SHORT,re.primitiveOffset*Y*2):Z.drawArrays(n,re.vertexOffset,re.vertexLength)}else H&&H>1?Z.drawElementsInstanced(n,re.primitiveLength*Y,Z.UNSIGNED_SHORT,re.primitiveOffset*Y*2,H):I?Z.drawElements(n,re.primitiveLength*Y,Z.UNSIGNED_SHORT,re.primitiveOffset*Y*2):Z.drawArrays(n,re.vertexOffset,re.vertexLength);ne&&this._drawDebugWireframe(t,c,d,m,I,re,D,z,B,H)}}}function zm(l,t,n=0){const c=Math.pow(2,t.tileID.overscaledZ),d=t.tileSize*Math.pow(2,l.transform.tileZoom)/c,m=d*(t.tileID.canonical.x+t.tileID.wrap*c),_=d*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(t,1,l.transform.tileZoom),u_pixel_coord_upper:[m>>16,_>>16],u_pixel_coord_lower:[65535&m,65535&_],u_pattern_transition:n}}const yh={terrain:0,flat:1},gy=o.bC(),xh=(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G)=>{const Z=t.style.light,Y=Z.properties.get("position"),X=[Y.x,Y.y,Y.z],ce=o.dO();Z.properties.get("anchor")==="viewport"&&(o.dP(ce,-t.transform.angle),o.dQ(X,X,ce));const ne=Z.properties.get("color").toPremultipliedRenderColor(null),ae=t.transform,re={u_matrix:l,u_lightpos:X,u_lightintensity:Z.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_vertical_gradient:+n,u_opacity:c,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gy,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:yh[E],u_base_type:yh[I],u_ao:d,u_edge_radius:m,u_width_scale:_,u_flood_light_color:B,u_vertical_scale:F,u_flood_light_intensity:H,u_ground_shadow_factor:G};return ae.projection.name==="globe"&&(re.u_tile_id=[x.canonical.x,x.canonical.y,1<<x.canonical.z],re.u_zoom_transition=L,re.u_inv_rot_matrix=z,re.u_merc_center=D,re.u_up_dir=ae.projection.upVector(new o.cD(0,0,0),D[0]*o.al,D[1]*o.al),re.u_height_lift=b),re},gf=(l,t,n,c,d,m)=>({u_matrix:l,u_edge_radius:t,u_width_scale:n,u_vertical_scale:c,u_height_type:yh[d],u_base_type:yh[m]}),Om=(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G)=>{const Z=xh(l,t,n,c,d,m,_,x,E,I,L,D,z,B,F,H,1,[0,0,0]),Y={u_height_factor:-Math.pow(2,x.overscaledZ)/b.tileSize/8};return Object.assign(Z,zm(t,b,G),Y)},ic=(l,t,n,c,d,m,_,x,b,E,I)=>({u_matrix:t,u_opacity:n,u_ao_pass:c?1:0,u_meter_to_tile:d,u_ao:m,u_flood_light_intensity:_,u_flood_light_color:x,u_attenuation:b,u_edge_radius:E,u_fb:0,u_fb_size:I,u_dynamic_offset:1}),yf=(l,t,n)=>({u_matrix:l,u_emissive_strength:t,u_ground_shadow_factor:n}),xf=(l,t,n,c,d,m=0)=>Object.assign(yf(l,t,d),zm(n,c,m)),km=(l,t,n,c)=>({u_matrix:l,u_world:n,u_emissive_strength:t,u_ground_shadow_factor:c}),vf=(l,t,n,c,d,m,_=0)=>Object.assign(xf(l,t,n,c,m,_),{u_world:d}),Va=(l,t)=>({u_matrix:l,u_ground_shadow_factor:t}),xl=(l,t,n,c,d)=>({u_matrix:l,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:n,u_height_scale:c,u_reset_depth:d}),vh=(l,t,n,c,d,m,_,x,b)=>({u_matrix:l,u_normal_matrix:t,u_opacity:n,u_faux_facade_ao_intensity:c,u_camera_pos:d,u_tile_to_meter:m,u_facade_emissive_chance:_,u_flood_light_color:x,u_flood_light_intensity:b}),Fm=l=>({u_matrix:l}),Ua=l=>({u_matrix:l}),bf=(l,t,n,c,d,m,_,x)=>{const b=o.al/m.tileSize;return{u_matrix:l,u_inv_rot_matrix:t,u_camera_to_center_distance:n.getCameraToCenterDistance(x),u_extrude_scale:[n.pixelsToGLUnits[0]/b,n.pixelsToGLUnits[1]/b],u_zoom_transition:c,u_tile_id:_,u_merc_center:d}},iu=(l,t,n=1)=>({u_matrix:l,u_color:t,u_overlay:0,u_overlay_scale:n}),Bm=o.bC(),Nm=(l,t,n,c,d,m,_)=>{const x=l.transform,b=x.projection.name==="globe",E=b?o.dR(x.zoom,t.canonical)*x._pixelsPerMercatorPixel:o.ay(n,1,m),I={u_matrix:t.projMatrix,u_extrude_scale:E,u_intensity:_,u_inv_rot_matrix:Bm,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){I.u_inv_rot_matrix=c,I.u_merc_center=d,I.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],I.u_zoom_transition=o.aj(x.zoom);const L=d[0]*o.al,D=d[1]*o.al;I.u_up_dir=x.projection.upVector(new o.cD(0,0,0),L,D)}return I};function bh(l,[t,n,c,d],[m,_]){if(m===_)return[0,0,0,0];const x=255*(l-1)/(l*(_-m));return[t*x,n*x,c*x,d*x]}function wh(l,t,[n,c]){return n===c?0:.5/l+(t-n)*(l-1)/(l*(c-n))}const Vm=(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G,Z,Y,X)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:d,u_tl_parent:m,u_scale_parent:E,u_fade_t:I.mix,u_opacity:I.opacity*L.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:L.paint.get("raster-brightness-min"),u_brightness_high:L.paint.get("raster-brightness-max"),u_saturation_factor:o.dT(L.paint.get("raster-saturation")),u_contrast_factor:o.dS(L.paint.get("raster-contrast")),u_spin_weights:Um(L.paint.get("raster-hue-rotate")),u_perspective_transform:D,u_raster_elevation:z,u_zoom_transition:_,u_merc_center:x,u_cutoff_params:b,u_colorization_mix:bh(o.dU,F,G),u_colorization_offset:wh(o.dU,H,G),u_color_ramp:B,u_texture_offset:[Y/(Z+2*Y),Z/(Z+2*Y)],u_texture_res:[Z+2*Y,Z+2*Y],u_emissive_strength:X});function Um(l){l*=Math.PI/180;const t=Math.sin(l),n=Math.cos(l);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}const Uo=.05,yy=(l,t,n,c,d,m,_,x,b,E,I,L)=>({u_matrix:l,u_normalize_matrix:t,u_globe_matrix:n,u_merc_matrix:c,u_grid_matrix:d,u_tl_parent:m,u_scale_parent:E,u_fade_t:I.mix,u_opacity:I.opacity,u_image0:0,u_image1:1,u_raster_elevation:L,u_zoom_transition:_,u_merc_center:x,u_cutoff_params:b}),xy=(l,t,n,c,d,m,_,x,b,E)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_tile_offset:n,u_velocity:c,u_color_ramp:m,u_velocity_res:d,u_max_speed:_,u_uv_offset:x,u_data_scale:[255*b[0],255*b[1]],u_data_offset:E,u_particle_pos_scale:1.1,u_particle_pos_offset:[Uo,Uo]}),jm=(l,t,n,c,d,m,_,x,b,E)=>({u_particle_texture:l,u_particle_texture_side_len:t,u_velocity:n,u_velocity_res:c,u_max_speed:d,u_speed_factor:m,u_reset_rate:_,u_rand_seed:Math.random(),u_uv_offset:x,u_data_scale:[255*b[0],255*b[1]],u_data_offset:E,u_particle_pos_scale:1.1,u_particle_pos_offset:[Uo,Uo]}),Gm=o.bC(),Th=(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G,Z,Y,X,ce,ne,ae)=>{const re=d.transform,ee={u_is_size_zoom_constant:+(l==="constant"||l==="source"),u_is_size_feature_constant:+(l==="constant"||l==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:re.getCameraToCenterDistance(Z),u_rotate_symbol:+n,u_aspect_ratio:re.width/re.height,u_fade_change:d.options.fadeDuration?d.symbolFadeChange:1,u_matrix:m,u_label_plane_matrix:_,u_coord_matrix:x,u_is_text:+E,u_elevation_from_sea:b?1:0,u_pitch_with_map:+c,u_texsize:I,u_texsize_icon:L,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Gm,u_up_vector:[0,-1,0],u_color_adj_mat:ce,u_icon_transition:ne||0,u_gamma_scale:c?d.transform.getCameraToCenterDistance(Z)*Math.cos(d.terrain?0:d.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:ae||1,u_ground_shadow_factor:Y,u_inv_matrix:o.bl(o.bC(),_),u_normal_scale:X,u_lutTexture:Un.LUT};return Z.name==="globe"&&(ee.u_tile_id=[z.canonical.x,z.canonical.y,1<<z.canonical.z],ee.u_zoom_transition=B,ee.u_inv_rot_matrix=H,ee.u_merc_center=F,ee.u_camera_forward=re._camera.forward(),ee.u_ecef_origin=o.dV(re.globeMatrix,z.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(re.globeMatrix),ee.u_up_vector=G),ee},ru=(l,t,n,c)=>({u_matrix:l,u_emissive_strength:t,u_opacity:n,u_color:c}),ja=(l,t,n,c,d,m,_,x,b)=>Object.assign(function(E,I,L,D,z,B){const{width:F,height:H}=D.imageManager.getPixelSize(I),G=Math.pow(2,B.tileID.overscaledZ),Z=B.tileSize*Math.pow(2,D.transform.tileZoom)/G,Y=Z*(B.tileID.canonical.x+B.tileID.wrap*G),X=Z*B.tileID.canonical.y;return{u_image:0,u_pattern_tl:L.tl,u_pattern_br:L.br,u_texsize:[F,H],u_pattern_size:L.displaySize,u_pattern_units_to_pixels:z?[D.transform.width,-1*D.transform.height]:[1/o.ay(B,1,D.transform.tileZoom),1/o.ay(B,1,D.transform.tileZoom)],u_pixel_coord_upper:[Y>>16,X>>16],u_pixel_coord_lower:[65535&Y,65535&X]}}(0,m,_,c,x,b),{u_matrix:l,u_emissive_strength:t,u_opacity:n}),rc=new Float32Array(o.bA([])),vl=(l,t,n,c,d,m,_,x,b,E,I,L,D,z=[0,0,0],B,F,H)=>{const G=d.style.light,Z=G.properties.get("position"),Y=[-Z.x,-Z.y,Z.z],X=o.dO();G.properties.get("anchor")==="viewport"&&(o.dP(X,-d.transform.angle),o.dQ(Y,Y,X));const ce=I.alphaMode==="MASK",ne=G.properties.get("color").toNonPremultipliedRenderColor(null),ae=D.paint.get("model-ambient-occlusion-intensity"),re=D.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return re.a=D.paint.get("model-color-mix-intensity").constantOr(0),H&&(re.r=H[0],re.g=H[1],re.b=H[2],re.a=H[3]),F&&(re.r=F.color.r,re.g=F.color.g,re.b=F.color.b,re.a=F.colorMix,L=F.emissionStrength,m*=F.opacity),{u_matrix:l,u_lighting_matrix:t,u_normal_matrix:n,u_node_matrix:c||rc,u_lightpos:Y,u_lightintensity:G.properties.get("intensity"),u_lightcolor:[ne.r,ne.g,ne.b],u_camera_pos:z,u_opacity:m,u_baseTextureIsAlpha:0,u_alphaMask:+ce,u_alphaCutoff:I.alphaCutoff,u_baseColorFactor:_.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:b,u_roughnessFactor:E,u_baseColorTexture:Un.BaseColor,u_metallicRoughnessTexture:Un.MetallicRoughness,u_normalTexture:Un.Normal,u_occlusionTexture:Un.Occlusion,u_emissionTexture:Un.Emission,u_lutTexture:Un.LUT,u_color_mix:re.toArray01(),u_aoIntensity:ae,u_emissive_strength:L,u_occlusionTextureTransform:B||[0,0,0,0]}},wf=(l,t=rc,n=rc)=>({u_matrix:l,u_instance:t,u_node_matrix:n}),Sh={fillExtrusion:l=>({u_matrix:new o.cl(l),u_lightpos:new o.ci(l),u_lightintensity:new o.cj(l),u_lightcolor:new o.ci(l),u_vertical_gradient:new o.cj(l),u_opacity:new o.cj(l),u_edge_radius:new o.cj(l),u_width_scale:new o.cj(l),u_ao:new o.ck(l),u_height_type:new o.ch(l),u_base_type:new o.ch(l),u_tile_id:new o.ci(l),u_zoom_transition:new o.cj(l),u_inv_rot_matrix:new o.cl(l),u_merc_center:new o.ck(l),u_up_dir:new o.ci(l),u_height_lift:new o.cj(l),u_flood_light_color:new o.ci(l),u_vertical_scale:new o.cj(l),u_flood_light_intensity:new o.cj(l),u_ground_shadow_factor:new o.ci(l)}),fillExtrusionDepth:l=>({u_matrix:new o.cl(l),u_edge_radius:new o.cj(l),u_width_scale:new o.cj(l),u_vertical_scale:new o.cj(l),u_height_type:new o.ch(l),u_base_type:new o.ch(l)}),fillExtrusionPattern:l=>({u_matrix:new o.cl(l),u_lightpos:new o.ci(l),u_lightintensity:new o.cj(l),u_lightcolor:new o.ci(l),u_vertical_gradient:new o.cj(l),u_height_factor:new o.cj(l),u_edge_radius:new o.cj(l),u_width_scale:new o.cj(l),u_ao:new o.ck(l),u_height_type:new o.ch(l),u_base_type:new o.ch(l),u_tile_id:new o.ci(l),u_zoom_transition:new o.cj(l),u_inv_rot_matrix:new o.cl(l),u_merc_center:new o.ck(l),u_up_dir:new o.ci(l),u_height_lift:new o.cj(l),u_image:new o.ch(l),u_texsize:new o.ck(l),u_pixel_coord_upper:new o.ck(l),u_pixel_coord_lower:new o.ck(l),u_tile_units_to_pixels:new o.cj(l),u_opacity:new o.cj(l),u_pattern_transition:new o.cj(l)}),fillExtrusionGroundEffect:l=>({u_matrix:new o.cl(l),u_opacity:new o.cj(l),u_ao_pass:new o.cj(l),u_meter_to_tile:new o.cj(l),u_ao:new o.ck(l),u_flood_light_intensity:new o.cj(l),u_flood_light_color:new o.ci(l),u_attenuation:new o.cj(l),u_edge_radius:new o.cj(l),u_fb:new o.ch(l),u_fb_size:new o.cj(l),u_dynamic_offset:new o.cj(l)}),fill:l=>({u_matrix:new o.cl(l),u_emissive_strength:new o.cj(l),u_ground_shadow_factor:new o.ci(l)}),fillPattern:l=>({u_matrix:new o.cl(l),u_emissive_strength:new o.cj(l),u_image:new o.ch(l),u_texsize:new o.ck(l),u_pixel_coord_upper:new o.ck(l),u_pixel_coord_lower:new o.ck(l),u_tile_units_to_pixels:new o.cj(l),u_ground_shadow_factor:new o.ci(l),u_pattern_transition:new o.cj(l)}),fillOutline:l=>({u_matrix:new o.cl(l),u_emissive_strength:new o.cj(l),u_world:new o.ck(l),u_ground_shadow_factor:new o.ci(l)}),fillOutlinePattern:l=>({u_matrix:new o.cl(l),u_emissive_strength:new o.cj(l),u_world:new o.ck(l),u_image:new o.ch(l),u_texsize:new o.ck(l),u_pixel_coord_upper:new o.ck(l),u_pixel_coord_lower:new o.ck(l),u_tile_units_to_pixels:new o.cj(l),u_ground_shadow_factor:new o.ci(l),u_pattern_transition:new o.cj(l)}),building:l=>({u_matrix:new o.cl(l),u_normal_matrix:new o.cl(l),u_opacity:new o.cj(l),u_faux_facade_ao_intensity:new o.cj(l),u_camera_pos:new o.ci(l),u_tile_to_meter:new o.cj(l),u_facade_emissive_chance:new o.cj(l),u_flood_light_color:new o.ci(l),u_flood_light_intensity:new o.cj(l)}),buildingBloom:l=>({u_matrix:new o.cl(l)}),buildingDepth:l=>({u_matrix:new o.cl(l)}),elevatedStructuresDepth:l=>({u_matrix:new o.cl(l),u_depth_bias:new o.cj(l)}),elevatedStructures:l=>({u_matrix:new o.cl(l),u_ground_shadow_factor:new o.ci(l)}),elevatedStructuresDepthReconstruct:l=>({u_matrix:new o.cl(l),u_camera_pos:new o.ci(l),u_depth_bias:new o.cj(l),u_height_scale:new o.cj(l),u_reset_depth:new o.cj(l)}),circle:o.dY,collisionBox:l=>({u_matrix:new o.cl(l),u_inv_rot_matrix:new o.cl(l),u_camera_to_center_distance:new o.cj(l),u_extrude_scale:new o.ck(l),u_zoom_transition:new o.cj(l),u_merc_center:new o.ck(l),u_tile_id:new o.ci(l)}),collisionCircle:l=>({u_matrix:new o.cl(l),u_inv_matrix:new o.cl(l),u_camera_to_center_distance:new o.cj(l),u_viewport_size:new o.ck(l)}),debug:l=>({u_color:new o.dB(l),u_matrix:new o.cl(l),u_overlay:new o.ch(l),u_overlay_scale:new o.cj(l)}),clippingMask:l=>({u_matrix:new o.cl(l)}),heatmap:l=>({u_extrude_scale:new o.cj(l),u_intensity:new o.cj(l),u_matrix:new o.cl(l),u_inv_rot_matrix:new o.cl(l),u_merc_center:new o.ck(l),u_tile_id:new o.ci(l),u_zoom_transition:new o.cj(l),u_up_dir:new o.ci(l)}),heatmapTexture:l=>({u_image:new o.ch(l),u_color_ramp:new o.ch(l),u_opacity:new o.cj(l)}),hillshade:l=>({u_matrix:new o.cl(l),u_image:new o.ch(l),u_latrange:new o.ck(l),u_light:new o.ck(l),u_shadow:new o.dB(l),u_highlight:new o.dB(l),u_emissive_strength:new o.cj(l),u_accent:new o.dB(l)}),hillshadePrepare:l=>({u_matrix:new o.cl(l),u_image:new o.ch(l),u_dimension:new o.ck(l),u_zoom:new o.cj(l)}),line:o.dX,linePattern:o.dW,raster:l=>({u_matrix:new o.cl(l),u_normalize_matrix:new o.cl(l),u_globe_matrix:new o.cl(l),u_merc_matrix:new o.cl(l),u_grid_matrix:new o.dC(l),u_tl_parent:new o.ck(l),u_scale_parent:new o.cj(l),u_fade_t:new o.cj(l),u_opacity:new o.cj(l),u_image0:new o.ch(l),u_image1:new o.ch(l),u_brightness_low:new o.cj(l),u_brightness_high:new o.cj(l),u_saturation_factor:new o.cj(l),u_contrast_factor:new o.cj(l),u_spin_weights:new o.ci(l),u_perspective_transform:new o.ck(l),u_raster_elevation:new o.cj(l),u_zoom_transition:new o.cj(l),u_merc_center:new o.ck(l),u_cutoff_params:new o.d3(l),u_colorization_mix:new o.d3(l),u_colorization_offset:new o.cj(l),u_color_ramp:new o.ch(l),u_texture_offset:new o.ck(l),u_texture_res:new o.ck(l),u_emissive_strength:new o.cj(l)}),rasterParticle:l=>({u_matrix:new o.cl(l),u_normalize_matrix:new o.cl(l),u_globe_matrix:new o.cl(l),u_merc_matrix:new o.cl(l),u_grid_matrix:new o.dC(l),u_tl_parent:new o.ck(l),u_scale_parent:new o.cj(l),u_fade_t:new o.cj(l),u_opacity:new o.cj(l),u_image0:new o.ch(l),u_image1:new o.ch(l),u_raster_elevation:new o.cj(l),u_zoom_transition:new o.cj(l),u_merc_center:new o.ck(l),u_cutoff_params:new o.d3(l)}),rasterParticleTexture:l=>({u_texture:new o.ch(l),u_opacity:new o.cj(l)}),rasterParticleDraw:l=>({u_particle_texture:new o.ch(l),u_particle_texture_side_len:new o.cj(l),u_tile_offset:new o.ck(l),u_velocity:new o.ch(l),u_color_ramp:new o.ch(l),u_velocity_res:new o.ck(l),u_max_speed:new o.cj(l),u_uv_offset:new o.ck(l),u_data_scale:new o.ck(l),u_data_offset:new o.cj(l),u_particle_pos_scale:new o.cj(l),u_particle_pos_offset:new o.ck(l)}),rasterParticleUpdate:l=>({u_particle_texture:new o.ch(l),u_particle_texture_side_len:new o.cj(l),u_velocity:new o.ch(l),u_velocity_res:new o.ck(l),u_max_speed:new o.cj(l),u_speed_factor:new o.cj(l),u_reset_rate:new o.cj(l),u_rand_seed:new o.cj(l),u_uv_offset:new o.ck(l),u_data_scale:new o.ck(l),u_data_offset:new o.cj(l),u_particle_pos_scale:new o.cj(l),u_particle_pos_offset:new o.ck(l)}),symbol:l=>({u_is_size_zoom_constant:new o.ch(l),u_is_size_feature_constant:new o.ch(l),u_size_t:new o.cj(l),u_size:new o.cj(l),u_camera_to_center_distance:new o.cj(l),u_rotate_symbol:new o.ch(l),u_aspect_ratio:new o.cj(l),u_fade_change:new o.cj(l),u_matrix:new o.cl(l),u_label_plane_matrix:new o.cl(l),u_coord_matrix:new o.cl(l),u_is_text:new o.ch(l),u_elevation_from_sea:new o.ch(l),u_pitch_with_map:new o.ch(l),u_texsize:new o.ck(l),u_texsize_icon:new o.ck(l),u_texture:new o.ch(l),u_texture_icon:new o.ch(l),u_gamma_scale:new o.cj(l),u_device_pixel_ratio:new o.cj(l),u_tile_id:new o.ci(l),u_zoom_transition:new o.cj(l),u_inv_rot_matrix:new o.cl(l),u_merc_center:new o.ck(l),u_camera_forward:new o.ci(l),u_tile_matrix:new o.cl(l),u_up_vector:new o.ci(l),u_ecef_origin:new o.ci(l),u_is_halo:new o.ch(l),u_icon_transition:new o.cj(l),u_color_adj_mat:new o.cl(l),u_scale_factor:new o.cj(l),u_ground_shadow_factor:new o.ci(l),u_inv_matrix:new o.cl(l),u_normal_scale:new o.cj(l),u_lutTexture:new o.ch(l)}),background:l=>({u_matrix:new o.cl(l),u_emissive_strength:new o.cj(l),u_opacity:new o.cj(l),u_color:new o.dB(l)}),backgroundPattern:l=>({u_matrix:new o.cl(l),u_emissive_strength:new o.cj(l),u_opacity:new o.cj(l),u_image:new o.ch(l),u_pattern_tl:new o.ck(l),u_pattern_br:new o.ck(l),u_texsize:new o.ck(l),u_pattern_size:new o.ck(l),u_pixel_coord_upper:new o.ck(l),u_pixel_coord_lower:new o.ck(l),u_pattern_units_to_pixels:new o.ck(l)}),terrainRaster:l=>({u_matrix:new o.cl(l),u_image0:new o.ch(l),u_image1:new o.ch(l),u_skirt_height:new o.cj(l),u_ground_shadow_factor:new o.ci(l),u_emissive_texture_available:new o.cj(l)}),skybox:l=>({u_matrix:new o.cl(l),u_sun_direction:new o.ci(l),u_cubemap:new o.ch(l),u_opacity:new o.cj(l),u_temporal_offset:new o.cj(l)}),skyboxGradient:l=>({u_matrix:new o.cl(l),u_color_ramp:new o.ch(l),u_center_direction:new o.ci(l),u_radius:new o.cj(l),u_opacity:new o.cj(l),u_temporal_offset:new o.cj(l)}),skyboxCapture:l=>({u_matrix_3f:new o.dC(l),u_sun_direction:new o.ci(l),u_sun_intensity:new o.cj(l),u_color_tint_r:new o.d3(l),u_color_tint_m:new o.d3(l),u_luminance:new o.cj(l)}),globeRaster:l=>({u_proj_matrix:new o.cl(l),u_globe_matrix:new o.cl(l),u_normalize_matrix:new o.cl(l),u_merc_matrix:new o.cl(l),u_zoom_transition:new o.cj(l),u_merc_center:new o.ck(l),u_image0:new o.ch(l),u_image1:new o.ch(l),u_grid_matrix:new o.dC(l),u_skirt_height:new o.cj(l),u_far_z_cutoff:new o.cj(l),u_frustum_tl:new o.ci(l),u_frustum_tr:new o.ci(l),u_frustum_br:new o.ci(l),u_frustum_bl:new o.ci(l),u_globe_pos:new o.ci(l),u_globe_radius:new o.cj(l),u_viewport:new o.ck(l),u_emissive_texture_available:new o.cj(l)}),globeAtmosphere:l=>({u_frustum_tl:new o.ci(l),u_frustum_tr:new o.ci(l),u_frustum_br:new o.ci(l),u_frustum_bl:new o.ci(l),u_horizon:new o.cj(l),u_transition:new o.cj(l),u_fadeout_range:new o.cj(l),u_atmosphere_fog_color:new o.d3(l),u_high_color:new o.d3(l),u_space_color:new o.d3(l),u_temporal_offset:new o.cj(l),u_horizon_angle:new o.cj(l)}),model:l=>({u_matrix:new o.cl(l),u_lighting_matrix:new o.cl(l),u_normal_matrix:new o.cl(l),u_node_matrix:new o.cl(l),u_lightpos:new o.ci(l),u_lightintensity:new o.cj(l),u_lightcolor:new o.ci(l),u_camera_pos:new o.ci(l),u_opacity:new o.cj(l),u_baseColorFactor:new o.d3(l),u_emissiveFactor:new o.d3(l),u_metallicFactor:new o.cj(l),u_roughnessFactor:new o.cj(l),u_baseTextureIsAlpha:new o.ch(l),u_alphaMask:new o.ch(l),u_alphaCutoff:new o.cj(l),u_baseColorTexture:new o.ch(l),u_metallicRoughnessTexture:new o.ch(l),u_normalTexture:new o.ch(l),u_occlusionTexture:new o.ch(l),u_emissionTexture:new o.ch(l),u_lutTexture:new o.ch(l),u_color_mix:new o.d3(l),u_aoIntensity:new o.cj(l),u_emissive_strength:new o.cj(l),u_occlusionTextureTransform:new o.d3(l)}),modelDepth:l=>({u_matrix:new o.cl(l),u_instance:new o.cl(l),u_node_matrix:new o.cl(l)}),groundShadow:l=>({u_matrix:new o.cl(l),u_ground_shadow_factor:new o.ci(l)}),stars:l=>({u_matrix:new o.cl(l),u_up:new o.ci(l),u_right:new o.ci(l),u_intensity_multiplier:new o.cj(l)}),snowParticle:l=>({u_modelview:new o.cl(l),u_projection:new o.cl(l),u_time:new o.cj(l),u_cam_pos:new o.ci(l),u_velocityConeAperture:new o.cj(l),u_velocity:new o.cj(l),u_horizontalOscillationRadius:new o.cj(l),u_horizontalOscillationRate:new o.cj(l),u_boxSize:new o.cj(l),u_billboardSize:new o.cj(l),u_simpleShapeParameters:new o.ck(l),u_screenSize:new o.ck(l),u_thinningCenterPos:new o.ck(l),u_thinningShape:new o.ci(l),u_thinningAffectedRatio:new o.cj(l),u_thinningParticleOffset:new o.cj(l),u_particleColor:new o.d3(l),u_direction:new o.ci(l)}),rainParticle:l=>({u_modelview:new o.cl(l),u_projection:new o.cl(l),u_time:new o.cj(l),u_cam_pos:new o.ci(l),u_texScreen:new o.ch(l),u_velocityConeAperture:new o.cj(l),u_velocity:new o.cj(l),u_boxSize:new o.cj(l),u_rainDropletSize:new o.ck(l),u_distortionStrength:new o.cj(l),u_rainDirection:new o.ci(l),u_color:new o.d3(l),u_screenSize:new o.ck(l),u_thinningCenterPos:new o.ck(l),u_thinningShape:new o.ci(l),u_thinningAffectedRatio:new o.cj(l),u_thinningParticleOffset:new o.cj(l),u_shapeDirectionalPower:new o.cj(l),u_shapeNormalPower:new o.cj(l),u_mode:new o.cj(l)}),vignette:l=>({u_vignetteShape:new o.ci(l),u_vignetteColor:new o.d3(l)}),occlusion:l=>({u_matrix:new o.cl(l),u_anchorPos:new o.ci(l),u_screenSizePx:new o.ck(l),u_occluderSizePx:new o.ck(l),u_color:new o.d3(l)})};class To{constructor(t,n,c,d){this.id=To.uniqueIdxCounter,To.uniqueIdxCounter++,this.context=t;const m=t.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!c,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||d||n.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=To.uniqueIdxCounter,To.uniqueIdxCounter++;const n=this.context.gl;this.context.unbindVAO(),this.bind(),n.bufferSubData(n.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}To.uniqueIdxCounter=0;const Tf={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Hm{constructor(t,n,c,d,m,_){this.length=n.length,this.attributes=c,this.itemSize=n.bytesPerElement,this.dynamicDraw=d,this.instanceCount=_,this.context=t;const x=t.gl;this.buffer=x.createBuffer(),t.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||m||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,n){for(let c=0;c<this.attributes.length;c++){const d=n.getAttributeLocation(t,this.attributes[c].name);d!==-1&&t.enableVertexAttribArray(d)}}setVertexAttribPointers(t,n,c){for(let d=0;d<this.attributes.length;d++){const m=this.attributes[d],_=n.getAttributeLocation(t,m.name);_!==-1&&t.vertexAttribPointer(_,m.components,t[Tf[m.type]],!1,this.itemSize,m.offset+this.itemSize*(c||0))}}setVertexAttribDivisor(t,n,c){for(let d=0;d<this.attributes.length;d++){const m=n.getAttributeLocation(t,this.attributes[d].name);m!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(m,c)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class qm{constructor(t,n,c,d,m){this.context=t,this.width=n,this.height=c;const _=this.framebuffer=t.gl.createFramebuffer();d>0&&(this.colorAttachment0=new fh(t,_,0)),d>1&&(this.colorAttachment1=new fh(t,_,1)),m&&(this.depthAttachmentType=m,this.depthAttachment=m==="renderbuffer"?new Ql(t,_):new Jc(t,_))}createColorAttachment(t,n){n===0?this.colorAttachment0=new fh(t,this.framebuffer,0):n===1&&(this.colorAttachment1=new fh(t,this.framebuffer,1))}removeColorAttachment(t,n){const c=this.context.gl;let d;n===0?(d=this.colorAttachment0.get(),this.colorAttachment0=void 0):n===1&&(d=this.colorAttachment1.get(),this.colorAttachment1=void 0),d&&c.deleteTexture(d)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const n=this.colorAttachment0.get();n&&t.deleteTexture(n)}if(this.colorAttachment1){const n=this.colorAttachment1.get();n&&t.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}else{const n=this.depthAttachment.get();n&&t.deleteTexture(n)}t.deleteFramebuffer(this.framebuffer)}}class nc{constructor(t,n){this.gl=t,this.clearColor=new hy(this),this.clearDepth=new Sm(this),this.clearStencil=new sf(this),this.colorMask=new lh(this),this.depthMask=new of(this),this.stencilMask=new yl(this),this.stencilFunc=new Xl(this),this.stencilOp=new Kc(this),this.stencilTest=new Kl(this),this.depthRange=new Em(this),this.depthTest=new af(this),this.depthFunc=new Am(this),this.blend=new Yl(this),this.blendFunc=new ch(this),this.blendColor=new uh(this),this.blendEquation=new lf(this),this.cullFace=new hh(this),this.cullFaceSide=new Yc(this),this.frontFace=new Im(this),this.program=new Cm(this),this.activeTexture=new Pm(this),this.viewport=new Jl(this),this.bindFramebuffer=new Mm(this),this.bindRenderbuffer=new dy(this),this.bindTexture=new fy(this),this.bindVertexBuffer=new py(this),this.bindElementBuffer=new cf(this),this.bindVertexArrayOES=new uf(this),this.pixelStoreUnpack=new hf(this),this.pixelStoreUnpackPremultiplyAlpha=new df(this),this.pixelStoreUnpackFlipY=new Rm(this),this.options=n?Object.assign({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=n&&!!n.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,n,c){return new To(this,t,n,c)}createVertexBuffer(t,n,c,d,m){return new Hm(this,t,n,c,d,m)}createRenderbuffer(t,n,c){const d=this.gl,m=d.createRenderbuffer();return this.bindRenderbuffer.set(m),d.renderbufferStorage(d.RENDERBUFFER,t,n,c),this.bindRenderbuffer.set(null),m}createFramebuffer(t,n,c,d){return new qm(this,t,n,c,d)}clear({color:t,depth:n,stencil:c,colorMask:d}){const m=this.gl;let _=0;t&&(_|=m.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(d||[!0,!0,!0,!0])),n!==void 0&&(_|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),c!==void 0&&(_|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(c),this.stencilMask.set(255)),m.clear(_)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.by(t.blendFunction,gi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let bl;function Mt(l,t,n,c,d,m,_){const x=l.context,b=x.gl,E=l.transform,I=[o.aF(E.center.lng),o.aJ(E.center.lat)],L=n.layout.get("symbol-placement"),D=n.layout.get("text-variable-anchor"),z=n.layout.get("icon-rotation-alignment")==="map",B=n.layout.get("text-rotation-alignment")==="map",F=L!=="point",H=[];let G=0,Z=0;for(let ee=0;ee<c.length;ee++){const ue=c[ee],be=t.getTile(ue),xe=be.getBucket(n);if(!xe)continue;const De=xe.getProjection().createInversionMatrix(E,ue.canonical),Le=[],Ue=qu(ue,xe,E),it=!_&&z&&F,Ce=_&&B&&F,_e=D&&xe.hasTextData(),Fe=xe.hasIconTextFit()&&_e&&xe.hasIconData(),Pe=it||Ce||_&&_e||Fe,We=xe.projection.name==="globe",dt=We?o.aj(E.zoom):0;We&&(Le.push("PROJECTION_GLOBE_VIEW"),Pe&&Le.push("PROJECTED_POS_ON_VIEWPORT"));const Tt=l.getOrCreateProgram("collisionBox",{defines:Le});let ct=Ue;d[0]===0&&d[1]===0||(ct=l.translatePosMatrix(Ue,be,d,m));const nt=_?xe.textCollisionBox:xe.iconCollisionBox,kt=xe.collisionCircleArray;if(kt.length>0){const xt=o.bC(),Et=ct;o.cP(xt,xe.placementInvProjMatrix,E.glCoordMatrix),o.cP(xt,xt,xe.placementViewportMatrix),H.push({circleArray:kt,circleOffset:Z,transform:Et,invTransform:xt,projection:xe.getProjection()}),G+=kt.length/4,Z=G}if(!nt)continue;l.terrain&&l.terrain.setupElevationDraw(be,Tt);const Dt=We?[ue.canonical.x,ue.canonical.y,1<<ue.canonical.z]:[0,0,0];Tt.draw(l,b.LINES,Bt.disabled,oi.disabled,l.colorModeForRenderPass(),si.disabled,bf(ct,De,E,dt,I,be,Dt,xe.getProjection()),n.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,E.zoom,null,[nt.collisionVertexBuffer,nt.collisionVertexBufferExt])}if(!_||!H.length)return;const Y=l.getOrCreateProgram("collisionCircle"),X=new o.dZ;X.resize(4*G),X._trim();let ce=0;for(const ee of H)for(let ue=0;ue<ee.circleArray.length/4;ue++){const be=4*ue,xe=ee.circleArray[be+0],De=ee.circleArray[be+1],Le=ee.circleArray[be+2],Ue=ee.circleArray[be+3];X.emplace(ce++,xe,De,Le,Ue,0),X.emplace(ce++,xe,De,Le,Ue,1),X.emplace(ce++,xe,De,Le,Ue,2),X.emplace(ce++,xe,De,Le,Ue,3)}(!bl||bl.length<2*G)&&(bl=function(ee){const ue=2*ee,be=new o.b0;be.resize(ue),be._trim();for(let xe=0;xe<ue;xe++){const De=6*xe;be.uint16[De+0]=4*xe+0,be.uint16[De+1]=4*xe+1,be.uint16[De+2]=4*xe+2,be.uint16[De+3]=4*xe+2,be.uint16[De+4]=4*xe+3,be.uint16[De+5]=4*xe+0}return be}(G));const ne=x.createIndexBuffer(bl,!0),ae=x.createVertexBuffer(X,o.d_.members,!0);for(const ee of H){const ue={u_matrix:ee.transform,u_inv_matrix:ee.invTransform,u_camera_to_center_distance:(re=E).getCameraToCenterDistance(ee.projection),u_viewport_size:[re.width,re.height]};Y.draw(l,b.TRIANGLES,Bt.disabled,oi.disabled,l.colorModeForRenderPass(),si.disabled,ue,n.id,ae,ne,o.bg.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,E.zoom)}var re;ae.destroy(),ne.destroy()}const nu=o.bC();function oa(l){const t=l._camera.getWorldToCamera(l.worldSize,1),n=o.aB([],t,l.globeMatrix);o.bl(n,n);const c=[0,0,0],d=[0,1,0,0];return o.aC(d,d,n),c[0]=d[0],c[1]=d[1],c[2]=d[2],o.aw(c,c),c}function Ga({width:l,height:t,anchor:n,textOffset:c,textScale:d},m){const{horizontalAlign:_,verticalAlign:x}=o.c1(n),b=-(_-.5)*l,E=-(x-.5)*t,I=o.c2(n,c);return new o.P((b/d+I[0])*m,(E/d+I[1])*m)}function Kt(l,t,n,c,d,m,_,x,b,E){const I=l.text.placedSymbolArray,L=l.text.dynamicLayoutVertexArray,D=l.icon.dynamicLayoutVertexArray,z={},B=l.getProjection(),F=ko(_,B,d),H=d.elevation,G=B.upVectorScale(_.canonical,d.center.lat,d.worldSize).metersToTile;L.clear();for(let Z=0;Z<I.length;Z++){const Y=I.get(Z),{tileAnchorX:X,tileAnchorY:ce,numGlyphs:ne}=Y,ae=Y.hidden||!Y.crossTileID||l.allowVerticalPlacement&&!Y.placedOrientation?null:c[Y.crossTileID];if(ae){let re=0,ee=0,ue=0;const be=l.elevationType==="road";if(H||be){const Pe=be?l.getElevationFeatureForText(Z):null,We=o.bV.getAtTileOffset(_,new o.P(X,ce),H,Pe),[dt,Tt,ct]=B.upVector(_.canonical,X,ce);re=We*dt*G,ee=We*Tt*G,ue=We*ct*G}let[xe,De,Le,Ue]=Qs(Y.projectedAnchorX+re,Y.projectedAnchorY+ee,Y.projectedAnchorZ+ue,n?F:m);const it=or(d.getCameraToCenterDistance(B),Ue);let Ce=o.bM(l.textSizeData,b,Y)*it/o.bY;n&&(Ce*=l.tilePixelRatio/x);const _e=Ga(ae,Ce);n?({x:xe,y:De,z:Le}=B.projectTilePoint(X+_e.x,ce+_e.y,_.canonical),[xe,De,Le]=Qs(xe+re,De+ee,Le+ue,m)):(t&&_e._rotate(-d.angle),xe+=_e.x,De+=_e.y,Le=0);const Fe=l.allowVerticalPlacement&&Y.placedOrientation===o.bL.vertical?Math.PI/2:0;for(let Pe=0;Pe<ne;Pe++)o.bO(L,xe,De,Le,Fe);E&&Y.associatedIconIndex>=0&&(z[Y.associatedIconIndex]={x:xe,y:De,z:Le,angle:Fe})}else vo(ne,L)}if(E){D.clear();const Z=l.icon.placedSymbolArray;for(let Y=0;Y<Z.length;Y++){const X=Z.get(Y),{numGlyphs:ce}=X,ne=z[Y];if(X.hidden||!ne)vo(ce,D);else{const{x:ae,y:re,z:ee,angle:ue}=ne;for(let be=0;be<ce;be++)o.bO(D,ae,re,ee,ue)}}l.icon.dynamicLayoutVertexBuffer.updateData(D)}l.text.dynamicLayoutVertexBuffer.updateData(L)}function su(l,t,n,c,d,m,_={}){const x=n.paint.get("icon-translate"),b=n.paint.get("text-translate"),E=n.paint.get("icon-translate-anchor"),I=n.paint.get("text-translate-anchor"),L=n.layout.get("icon-rotation-alignment"),D=n.layout.get("text-rotation-alignment"),z=n.layout.get("icon-pitch-alignment"),B=n.layout.get("text-pitch-alignment"),F=n.layout.get("icon-keep-upright"),H=n.layout.get("text-keep-upright"),G=n.paint.get("icon-color-saturation"),Z=n.paint.get("icon-color-contrast"),Y=n.paint.get("icon-color-brightness-min"),X=n.paint.get("icon-color-brightness-max"),ce=n.layout.get("symbol-elevation-reference")==="sea",ne=n.layout.get("icon-image-use-theme")==="none",ae=l.context,re=ae.gl,ee=l.transform,ue=L==="map",be=D==="map",xe=z==="map",De=B==="map",Le=n.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ue=!1;const it=l.depthModeForSublayer(0,Bt.ReadOnly),Ce=new Bt(l.context.gl.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D),_e=[o.aF(ee.center.lng),o.aJ(ee.center.lat)],Fe=n.layout.get("text-variable-anchor"),Pe=ee.projection.name==="globe",We=[],dt=[0,-1,0];for(const Tt of c){const ct=t.getTile(Tt),nt=ct.getBucket(n);if(!nt||nt.projection.name==="mercator"&&Pe||nt.fullyClipped)continue;const kt=nt.projection.name==="globe",Dt=kt?o.aj(ee.zoom):0,xt=ko(Tt,nt.getProjection(),ee),Et=ee.calculatePixelsToTileUnitsMatrix(ct),$t=Fe&&nt.hasTextData(),di=nt.hasIconTextFit()&&$t&&nt.hasIconData(),Ri=nt.getProjection().createInversionMatrix(ee,Tt.canonical),Yi=(1<<ct.tileID.canonical.z)*o.al/l.transform.worldSize,Ft=ir=>{let ji=[0,0,0];if(ir){const vi=l.style.directionalLight,Lr=l.style.ambientLight;vi&&Lr&&(ji=na(l.style,vi,Lr))}return ji},Zi=ir=>{ee.depthOcclusionForSymbolsAndCircles&&(n.hasOcclusionOpacityProperties||l.terrain)&&(ir.push("DEPTH_D24"),ir.push("DEPTH_OCCLUSION"))},ui=ir=>{n.lut&&!ne&&(n.lut.texture||(n.lut.texture=new o.d$(l.context,n.lut.image,[n.lut.image.height,n.lut.image.height,n.lut.image.height],ae.gl.RGBA8)),ae.activeTexture.set(ae.gl.TEXTURE0+Un.LUT),n.lut.texture&&n.lut.texture.bind(ae.gl.LINEAR,ae.gl.CLAMP_TO_EDGE),ir.push("APPLY_LUT_ON_GPU"))},tr=()=>{const ir=ue&&n.layout.get("symbol-placement")!=="point",ji=[];Zi(ji),ui(ji);const vi=ir||di,Lr=nt.elevationType==="road",en=l.shadowRenderer,Vr=Lr&&xe&&!!en&&en.enabled,gr=Ft(Vr),vs=Lr&&xe&&!l.terrain?Ce:it,Kn=n.paint.get("icon-image-cross-fade");l.terrainRenderModeElevated()&&xe&&ji.push("PITCH_WITH_MAP_TERRAIN"),kt&&(ji.push("PROJECTION_GLOBE_VIEW"),vi&&ji.push("PROJECTED_POS_ON_VIEWPORT")),Kn>0&&nt.hasAnySecondaryIcon&&ji.push("ICON_TRANSITION"),!nt.icon.zOffsetVertexBuffer||Lr&&l.terrain||ji.push("Z_OFFSET"),G===0&&Z===0&&Y===0&&X===1||ji.push("COLOR_ADJUSTMENT"),nt.sdfIcons&&ji.push("RENDER_SDF"),Vr&&ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Lr&&xe&&!l.terrain&&nt.icon.orientationVertexBuffer&&ji.push("ELEVATED_ROADS");const Sn=nt.icon.programConfigurations.get(n.id),ss=l.getOrCreateProgram("symbol",{config:Sn,defines:ji}),os=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],Wn=nt.iconSizeData,qs=o.bK(Wn,ee.zoom),ao=xe||!ee.isOrthographic,Is=ds(xt,ct.tileID.canonical,xe,ue,ee,nt.getProjection(),Et),Kr=Vc(xt,ct.tileID.canonical,xe,ue,ee,nt.getProjection(),Et),nn=l.translatePosMatrix(Kr,ct,x,E,!0),yr=l.translatePosMatrix(xt,ct,x,E),dn=vi?nu:Is,Wr=ue&&!xe&&!ir;let Ur=dt;!Pe&&!ee.mercatorFromTransition||ue||(Ur=oa(ee));const lo=kt?Ur:dt,gu=n.getColorAdjustmentMatrix(G,Z,Y,X),Ao=Th(Wn.kind,qs,Wr,xe,l,yr,dn,nn,ce,!1,os,[0,0],0,Tt,Dt,_e,Ri,lo,nt.getProjection(),gr,Yi,gu,Kn,null),yu=ct.imageAtlasTexture?ct.imageAtlasTexture:null,fc=n.layout.get("icon-size").constantOr(0)!==1||nt.iconsNeedLinear,$o=nt.sdfIcons||l.options.rotating||l.options.zooming||fc||ao?re.LINEAR:re.NEAREST,ma=nt.sdfIcons&&n.paint.get("icon-halo-width").constantOr(1)!==0,pc=l.terrain&&xe&&ir?o.bl(o.bC(),Is):nu;if(ir&&nt.icon){const Za=o.bV.getAtTileOffsetFunc(Tt,ee.center.lat,ee.worldSize,nt.getProjection()),_a=$u(xt,ct.tileID.canonical,xe,ue,ee,nt.getProjection(),Et),Io=n.layout.get("icon-size-scale-range"),ga=o.aA(l.scaleFactor,Io[0],Io[1]);mm(nt,xt,l,!1,_a,Kr,xe,F,Za,Tt,ga)}return{program:ss,buffers:nt.icon,uniformValues:Ao,atlasTexture:yu,atlasTextureIcon:null,atlasInterpolation:$o,atlasInterpolationIcon:null,isSDF:nt.sdfIcons,hasHalo:ma,depthMode:vs,tile:ct,renderWithShadows:Vr,labelPlaneMatrixInv:pc}},hr=()=>{const ir=be&&n.layout.get("symbol-placement")!=="point",ji=[],vi=ir||Fe||di,Lr=nt.elevationType==="road",en=l.shadowRenderer,Vr=Lr&&De&&!!en&&en.enabled,gr=Ft(Vr),vs=Lr&&De&&!l.terrain?Ce:it;l.terrainRenderModeElevated()&&De&&ji.push("PITCH_WITH_MAP_TERRAIN"),kt&&(ji.push("PROJECTION_GLOBE_VIEW"),vi&&ji.push("PROJECTED_POS_ON_VIEWPORT")),!nt.text.zOffsetVertexBuffer||Lr&&l.terrain||ji.push("Z_OFFSET"),nt.iconsInText&&ji.push("RENDER_TEXT_AND_SYMBOL"),ji.push("RENDER_SDF"),Vr&&ji.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Lr&&De&&!l.terrain&&nt.text.orientationVertexBuffer&&ji.push("ELEVATED_ROADS"),Zi(ji);const Kn=nt.text.programConfigurations.get(n.id),Sn=l.getOrCreateProgram("symbol",{config:Kn,defines:ji});let ss,os=[0,0],Wn=null;const qs=nt.textSizeData;nt.iconsInText&&(os=ct.imageAtlasTexture?ct.imageAtlasTexture.size:[0,0],Wn=ct.imageAtlasTexture?ct.imageAtlasTexture:null,ss=De||!ee.isOrthographic||l.options.rotating||l.options.zooming||qs.kind==="composite"||qs.kind==="camera"?re.LINEAR:re.NEAREST);const ao=ct.glyphAtlasTexture?ct.glyphAtlasTexture.size:[0,0],Is=n.layout.get("text-size-scale-range"),Kr=o.aA(l.scaleFactor,Is[0],Is[1]),nn=o.bK(qs,ee.zoom,Kr),yr=ds(xt,ct.tileID.canonical,De,be,ee,nt.getProjection(),Et),dn=Vc(xt,ct.tileID.canonical,De,be,ee,nt.getProjection(),Et),Wr=l.translatePosMatrix(dn,ct,b,I,!0),Ur=l.translatePosMatrix(xt,ct,b,I),lo=vi?nu:yr,gu=be&&!De&&!ir;let Ao=dt;!Pe&&!ee.mercatorFromTransition||be||(Ao=oa(ee));const yu=Th(qs.kind,nn,gu,De,l,Ur,lo,Wr,ce,!0,ao,os,0,Tt,Dt,_e,Ri,kt?Ao:dt,nt.getProjection(),gr,Yi,null,null,Kr),fc=ct.glyphAtlasTexture?ct.glyphAtlasTexture:null,$o=re.LINEAR,ma=n.paint.get("text-halo-width").constantOr(1)!==0,pc=l.terrain&&De&&ir?o.bl(o.bC(),yr):nu;if(ir&&nt.text){const Za=o.bV.getAtTileOffsetFunc(Tt,ee.center.lat,ee.worldSize,nt.getProjection()),_a=$u(xt,ct.tileID.canonical,De,be,ee,nt.getProjection(),Et);mm(nt,xt,l,!0,_a,dn,De,H,Za,Tt,Kr)}return{program:Sn,buffers:nt.text,uniformValues:yu,atlasTexture:fc,atlasTextureIcon:Wn,atlasInterpolation:$o,atlasInterpolationIcon:ss,isSDF:!0,hasHalo:ma,depthMode:vs,tile:ct,renderWithShadows:Vr,labelPlaneMatrixInv:pc}},ar=nt.icon.segments.get().length,$i=nt.text.segments.get().length,xi=ar&&!_.onlyText?tr():null,er=$i&&!_.onlyIcons?hr():null,$r=n.paint.get("icon-opacity").constantOr(1),Or=n.paint.get("text-opacity").constantOr(1);if(Le&&nt.canOverlap){Ue=!0;const ir=$r&&!_.onlyText?nt.icon.segments.get():[],ji=Or&&!_.onlyIcons?nt.text.segments.get():[];for(const vi of ir)We.push({segments:new o.bg([vi]),sortKey:vi.sortKey,state:xi});for(const vi of ji)We.push({segments:new o.bg([vi]),sortKey:vi.sortKey,state:er})}else _.onlyText||We.push({segments:$r?nt.icon.segments:new o.bg([]),sortKey:0,state:xi}),_.onlyIcons||We.push({segments:Or?nt.text.segments:new o.bg([]),sortKey:0,state:er})}Ue&&We.sort((Tt,ct)=>Tt.sortKey-ct.sortKey);for(const Tt of We){const ct=Tt.state;if(ct)if(l.terrain?l.terrain.setupElevationDraw(ct.tile,ct.program,{useDepthForOcclusion:ee.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ct.labelPlaneMatrixInv}):l.setupDepthForOcclusion(ee.depthOcclusionForSymbolsAndCircles,ct.program),ae.activeTexture.set(re.TEXTURE0),ct.atlasTexture&&ct.atlasTexture.bind(ct.atlasInterpolation,re.CLAMP_TO_EDGE,!0),ct.atlasTextureIcon&&(ae.activeTexture.set(re.TEXTURE1),ct.atlasTextureIcon&&ct.atlasTextureIcon.bind(ct.atlasInterpolationIcon,re.CLAMP_TO_EDGE,!0)),ct.renderWithShadows&&l.shadowRenderer.setupShadows(ct.tile.tileID.toUnwrapped(),ct.program,"vector-tile"),l.uploadCommonLightUniforms(l.context,ct.program),ct.hasHalo){const nt=ct.uniformValues;nt.u_is_halo=1,Sf(ct.buffers,Tt.segments,n,l,ct.program,ct.depthMode,d,m,nt,2),nt.u_is_halo=0}else{if(ct.isSDF){const nt=ct.uniformValues;ct.hasHalo&&(nt.u_is_halo=1,Sf(ct.buffers,Tt.segments,n,l,ct.program,ct.depthMode,d,m,nt,1)),nt.u_is_halo=0}Sf(ct.buffers,Tt.segments,n,l,ct.program,ct.depthMode,d,m,ct.uniformValues,1)}}}function Sf(l,t,n,c,d,m,_,x,b,E){const I=[l.dynamicLayoutVertexBuffer,l.opacityVertexBuffer,l.iconTransitioningVertexBuffer,l.globeExtVertexBuffer,l.zOffsetVertexBuffer,l.orientationVertexBuffer];d.draw(c,c.context.gl.TRIANGLES,m,_,x,si.disabled,b,n.id,l.layoutVertexBuffer,l.indexBuffer,t,n.paint,c.transform.zoom,l.programConfigurations.get(n.id),I,E)}function $m(l,t){const n=1<<l.canonical.z,c=(t.x*n-l.canonical.x-l.wrap*n)*o.al,d=(t.y*n-l.canonical.y)*o.al,m=o.e8(t.z,t.y);return o.d5(c,d,m)}function Eh(l,t,n,c,d){if(!n.layout||n.layout.get("fill-elevation-reference")==="none"||n.paint.get("fill-opacity").constantOr(1)===0)return;const m=l.context.gl,_=new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D),x=new Bt(l.context.gl.GREATER,Bt.ReadWrite,l.depthRangeFor3D),b=function(z){let B=.01;return z.isOrthographic&&(B=o.ak(1e-4,B,o.d0(z.pitch>=wo?1:z.pitch/wo))),2*B}(l.transform),E=l.transform.getFreeCameraOptions().position,I="elevatedStructuresDepthReconstruct",L=l.getOrCreateProgram(I,{defines:["DEPTH_RECONSTRUCTION"]}),D=l.getOrCreateProgram(I);for(const z of c){const B=t.getTile(z),F=B.getBucket(n);if(!F)continue;const H=F.elevatedStructures;if(!H)continue;const G=F.elevationBufferData.heightRange,Z=$m(z.toUnwrapped(),E),Y=l.translatePosMatrix(z.projMatrix,B,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let X,ce,ne,ae;if(d==="initialize"){if(!G||G.min>=1||H.depthSegments.segments[0].primitiveLength===0)continue;X=xl(Y,Z,b,1,0),ce=_,ne=H.depthSegments,ae=L}else if(d==="reset"){if(!G||G.min>=0||H.maskSegments.segments[0].primitiveLength===0)continue;X=xl(Y,Z,0,0,1),ce=x,ne=H.maskSegments,ae=L}else if(d==="geometry"){if(H.depthSegments.segments[0].primitiveLength===0)continue;X=xl(Y,Z,b,1,0),ce=_,ne=H.depthSegments,ae=D}ae.draw(l,m.TRIANGLES,ce,oi.disabled,gi.disabled,si.disabled,X,n.id,H.vertexBuffer,H.indexBuffer,ne,n.paint,l.transform.zoom)}}function Ah(l,t,n,c){const{painter:d,sourceCache:m,layer:_,coords:x,colorMode:b,elevationType:E,terrainEnabled:I,pass:L}=l,D=d.context.gl,z=_.paint.get("fill-pattern"),B=_.paint.get("fill-pattern-cross-fade"),F=z.constantOr(null);let H=E;E!=="road"||t&&!I||(H="none");const G=H==="road",Z=l.painter.shadowRenderer,Y=G&&!!Z&&Z.enabled,X=new Bt(d.context.gl.LEQUAL,Bt.ReadOnly,d.depthRangeFor3D);let ce=[0,0,0];if(Y){const ee=d.style.directionalLight,ue=d.style.ambientLight;ee&&ue&&(ce=na(d.style,ee,ue))}const ne=z&&z.constantOr(1),ae=d.terrain&&d.terrain.renderingToTexture,re=(ee,ue)=>{let be,xe,De,Le,Ue;ue?(be=ne&&!_.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",De=D.LINES):(be=ne?"fillPattern":"fill",De=D.TRIANGLES);for(const it of x){const Ce=m.getTile(it);if(ne&&!Ce.patternsLoaded())continue;const _e=Ce.getBucket(_);if(!_e)continue;const Fe=t?_e.elevationBufferData:_e.bufferData;if(Fe.isEmpty())continue;d.prepareDrawTile();const Pe=Fe.programConfigurations.get(_.id),We=d.isTileAffectedByFog(it),dt=[],Tt=[];G&&(dt.push("ELEVATED_ROADS"),Tt.push(Fe.elevatedLayoutVertexBuffer)),Y&&dt.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ae&&n&&dt.push("USE_MRT1"),ne&&(d.context.activeTexture.set(D.TEXTURE0),Ce.imageAtlasTexture&&Ce.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Pe.updatePaintBuffers());let ct=!1;if(F&&Ce.imageAtlas){const Et=Ce.imageAtlas,$t=o.e3.from(F),di=$t.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),Ri=$t.getSecondary(),Yi=Et.patternPositions.get(di),Ft=Ri?Et.patternPositions.get(Ri.scaleSelf(o.o.devicePixelRatio).toString()):null;ct=!!Yi&&!!Ft,Yi&&Pe.setConstantPatternPositions(Yi,Ft)}B>0&&(ct||Pe.getPatternTransitionVertexBuffer("fill-pattern"))&&dt.push("FILL_PATTERN_TRANSITION");const nt=d.getOrCreateProgram(be,{config:Pe,overrideFog:We,defines:dt}),kt=d.translatePosMatrix(it.projMatrix,Ce,_.paint.get("fill-translate"),_.paint.get("fill-translate-anchor"));Y&&Z.setupShadows(Ce.tileID.toUnwrapped(),nt,"vector-tile");const Dt=_.paint.get("fill-emissive-strength");if(ue){Le=Fe.lineIndexBuffer,Ue=Fe.lineSegments;const Et=d.terrain&&d.terrain.renderingToTexture?d.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];xe=be==="fillOutlinePattern"&&ne?vf(kt,Dt,d,Ce,Et,ce,B):km(kt,Dt,Et,ce)}else Le=Fe.indexBuffer,Ue=Fe.triangleSegments,xe=ne?xf(kt,Dt,d,Ce,ce,B):yf(kt,Dt,ce);d.uploadCommonUniforms(d.context,nt,it.toUnwrapped());let xt=ee;(E==="road"&&!I||E==="offset")&&(xt=X),nt.draw(d,De,xt,c||d.stencilModeForClipping(it),b,si.disabled,xe,_.id,Fe.layoutVertexBuffer,Le,Ue,_.paint,d.transform.zoom,Pe,Tt)}};d.renderPass===L&&re(d.depthModeForSublayer(1,d.renderPass==="opaque"?Bt.ReadWrite:Bt.ReadOnly),!1),H==="none"&&d.renderPass==="translucent"&&_.paint.get("fill-antialias")&&re(d.depthModeForSublayer(_.getPaintProperty("fill-outline-color")?2:0,Bt.ReadOnly),!0)}function Ih(l,t,n,c,d,m,_,x){n.resetLayerRenderingStats(l);const b=l.context,E=b.gl,I=l.transform,L=n.paint.get("fill-extrusion-pattern"),D=n.paint.get("fill-extrusion-pattern-cross-fade"),z=L.constantOr(null),B=L.constantOr(1),F=n.paint.get("fill-extrusion-opacity"),H=l.style.enable3dLights(),G=n.paint.get(H&&!B?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),Z=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),G],Y=n.layout.get("fill-extrusion-edge-radius"),X=Y>0&&!n.paint.get("fill-extrusion-rounded-roof"),ce=X?0:Y,ne=I.projection.name==="globe"?o.eb():0,ae=I.projection.name==="globe",re=ae?o.aj(I.zoom):0,ee=[o.aF(I.center.lng),o.aJ(I.center.lat)],ue=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",be=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(ue?null:n.lut).toArray01().slice(0,3),xe=n.paint.get("fill-extrusion-flood-light-intensity"),De=n.paint.get("fill-extrusion-vertical-scale"),Le=n.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ue=n.paint.get("fill-extrusion-height-alignment"),it=n.paint.get("fill-extrusion-base-alignment"),Ce=za(l,n.paint.get("fill-extrusion-cutoff-fade-range")),_e=[];let Fe;ae&&_e.push("PROJECTION_GLOBE_VIEW"),Z[0]>0&&_e.push("FAUX_AO"),X&&_e.push("ZERO_ROOF_RADIUS"),x&&_e.push("HAS_CENTROID"),xe>0&&_e.push("FLOOD_LIGHT"),Ce.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),Le&&_e.push("RENDER_WALL_MODE");const Pe=l.renderPass==="shadow",We=l.shadowRenderer,dt=Pe&&!!We,Tt=Pe?si.disabled:si.backCCW;l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0);let ct=[0,0,0];if(We){const Dt=l.style.directionalLight,xt=l.style.ambientLight;Dt&&xt&&(ct=na(l.style,Dt,xt)),Pe||(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),We.useNormalOffset&&_e.push("NORMAL_OFFSET")),Fe=_e.concat(["SHADOWS_SINGLE_CASCADE"])}const nt=dt?"fillExtrusionDepth":B?"fillExtrusionPattern":"fillExtrusion",kt=n.getLayerRenderingStats();for(const Dt of c){const xt=t.getTile(Dt),Et=xt.getBucket(n);if(!Et||Et.projection.name!==I.projection.name)continue;let $t=!1;We&&($t=We.getMaxCascadeForTile(Dt.toUnwrapped())===0);const di=l.isTileAffectedByFog(Dt),Ri=Et.programConfigurations.get(n.id);let Yi=!1;if(z&&xt.imageAtlas){const $i=xt.imageAtlas,xi=o.e3.from(z),er=xi.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),$r=xi.getSecondary(),Or=$i.patternPositions.get(er),ir=$r?$i.patternPositions.get($r.scaleSelf(o.o.devicePixelRatio).toString()):null;Yi=!!Or&&!!ir,Or&&Ri.setConstantPatternPositions(Or,ir)}D>0&&(Yi||Ri.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&_e.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Ft=l.getOrCreateProgram(nt,{config:Ri,defines:$t?Fe:_e,overrideFog:di});if(l.terrain&&l.terrain.setupElevationDraw(xt,Ft,{useMeterToDem:!0}),!Et.centroidVertexBuffer){const $i=Ft.getAttributeLocation(E,"a_centroid_pos");$i!==-1&&E.vertexAttrib2f($i,0,0)}!Pe&&We&&We.setupShadows(xt.tileID.toUnwrapped(),Ft,"vector-tile"),B&&(l.context.activeTexture.set(E.TEXTURE0),xt.imageAtlasTexture&&xt.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Ri.updatePaintBuffers());const Zi=n.paint.get("fill-extrusion-vertical-gradient"),ui=1/Et.tileToMeter;let tr;if(Pe&&We){if(la(xt.tileID,Et.maxHeight,l))continue;const $i=We.calculateShadowPassMatrixFromTile(xt.tileID.toUnwrapped());tr=gf($i,ce,ui,De,Ue,it)}else{const $i=l.translatePosMatrix(Dt.expandedProjMatrix,xt,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),xi=I.projection.createInversionMatrix(I,Dt.canonical);tr=B?Om($i,l,Zi,F,Z,ce,ui,Dt,xt,ne,Ue,it,re,ee,xi,be,De,D):xh($i,l,Zi,F,Z,ce,ui,Dt,ne,Ue,it,re,ee,xi,be,De,xe,ct)}l.uploadCommonUniforms(b,Ft,Dt.toUnwrapped(),null,Ce);let hr=Et.segments;if(I.projection.name==="mercator"&&!Pe&&(hr=Et.getVisibleSegments(xt.tileID,l.terrain,l.transform.getFrustum(0)),!hr.get().length))continue;if(kt)if(Pe)for(const $i of hr.get())kt.numRenderedVerticesInShadowPass+=$i.primitiveLength;else for(const $i of hr.get())kt.numRenderedVerticesInTransparentPass+=$i.primitiveLength;const ar=[];(l.terrain||x)&&ar.push(Et.centroidVertexBuffer),ae&&ar.push(Et.layoutVertexExtBuffer),Le&&ar.push(Et.wallVertexBuffer),Ft.draw(l,b.gl.TRIANGLES,d,m,_,Tt,tr,n.id,Et.layoutVertexBuffer,Et.indexBuffer,hr,n.paint,l.transform.zoom,Ri,ar)}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1)}class Ef{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function aa(l,t,n,c,d,m,_,x,b,E,I,L,D,z,B,F,H,G,Z,Y){const X=t.context,ce=X.gl,ne=t.transform,ae=t.transform.zoom,re=[],ee=l.translate,ue=l.translateAnchor,be=l.edgeRadius,xe=za(t,l.cutoffFadeRange);I==="clear"?(re.push("CLEAR_SUBPASS"),Y&&(re.push("CLEAR_FROM_TEXTURE"),X.activeTexture.set(ce.TEXTURE0),Y.bind(ce.LINEAR,ce.CLAMP_TO_EDGE))):I==="sdf"?re.push("SDF_SUBPASS"):I==="emissive"&&(re.push("USE_MRT1"),X.activeTexture.set(ce.TEXTURE0),Y.bind(ce.LINEAR,ce.CLAMP_TO_EDGE)),G&&re.push("HAS_CENTROID"),xe.shouldRenderCutoff&&re.push("RENDER_CUTOFF");const De=(Le,Ue,it,Ce,_e)=>{let Fe=re;Ue.groundRadiusBuffer!=null&&(Fe=re.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const Pe=Ue.programConfigurations.get(c.id),We=t.isTileAffectedByFog(Le),dt=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Pe,defines:Fe,overrideFog:We}),Tt=ic(t,Ce,L,E,_e,[D,z*_e],B,F,H,ae>=17?0:be*_e,Y?Y.size[0]:0),ct=[];G&&ct.push(Ue.hiddenByLandmarkVertexBuffer),Ue.groundRadiusBuffer!=null&&ct.push(Ue.groundRadiusBuffer),t.uploadCommonUniforms(X,dt,Le.toUnwrapped(),null,xe),dt.draw(t,X.gl.TRIANGLES,m,_,x,b,Tt,c.id,Ue.vertexBuffer,Ue.indexBuffer,it,c.paint,ae,Pe,ct)};for(const Le of d){const Ue=n.getTile(Le),it=Ue.getBucket(c);if(!it||it.projection.name!==ne.projection.name||!it.groundEffect||it.groundEffect&&!it.groundEffect.hasData())continue;const Ce=it.groundEffect,_e=1/it.tileToMeter;{const Fe=t.translatePosMatrix(Le.projMatrix,Ue,ee,ue),Pe=Ce.getDefaultSegment();De(Le,Ce,Pe,Fe,_e)}if(Z)for(let Fe=0;Fe<4;Fe++){const Pe=o.e9[Fe](Le),We=n.getTile(Pe);if(!We)continue;const dt=We.getBucket(c);if(!dt||dt.projection.name!==ne.projection.name||!dt.groundEffect||dt.groundEffect&&!dt.groundEffect.hasData())continue;const Tt=dt.groundEffect;let ct,nt;Fe===0?(ct=[-o.al,0,0],nt=1):Fe===1?(ct=[o.al,0,0],nt=0):Fe===2?(ct=[0,-o.al,0],nt=3):(ct=[0,o.al,0],nt=2);const kt=Tt.regionSegments[nt];if(!kt)continue;const Dt=new Float32Array(16);o.br(Dt,Le.projMatrix,ct),De(Le,Tt,kt,t.translatePosMatrix(Dt,Ue,ee,ue),_e)}}}function vy(l,t,n,c,d,m,_){c.centroidVertexArray.length===0&&c.createCentroidsBuffer();const x=m?m.findDEMTileFor(n):null;if(!(x&&x.dem||_))return;m&&x&&x.dem&&c.selfDEMTileTimestamp!==x.dem._timestamp&&(c.borderDoneWithNeighborZ=[-1,-1,-1,-1],c.selfDEMTileTimestamp=x.dem._timestamp);const b=G=>new o.P(Math.ceil((G+o.ed)*o.ee),0),E=G=>{const Z=t.getSource().minzoom,Y=ce=>{const ne=t.getTileByID(ce);if(ne&&ne.hasData())return ne.getBucket(d)},X=[0,-1,1];for(const ce of X){if(G.overscaledZ+ce<Z)continue;const ne=Y(G.calculateScaledKey(G.overscaledZ+ce));if(ne)return ne}},I=[0,0,0],L=(G,Z)=>(I[0]=Math.min(G.min.y,Z.min.y),I[1]=Math.max(G.max.y,Z.max.y),I[2]=o.al-Z.min.x>G.max.x?Z.min.x-o.al:G.max.x,I),D=(G,Z)=>(I[0]=Math.min(G.min.x,Z.min.x),I[1]=Math.max(G.max.x,Z.max.x),I[2]=o.al-Z.min.y>G.max.y?Z.min.y-o.al:G.max.y,I),z=[(G,Z)=>L(G,Z),(G,Z)=>L(Z,G),(G,Z)=>D(G,Z),(G,Z)=>D(Z,G)],B=(G,Z,Y,X,ce,ne,ae)=>{if(!m)return 0;const re=[[ne?Y:G,ne?G:Y,0],[ne?Y:Z,ne?Z:Y,0]],ee=ae<0?o.al+ae:ae,ue=[ne?ee:(G+Z)/2,ne?(G+Z)/2:ee,0];return Y===0&&ae<0||Y!==0&&ae>0?m.getForTilePoints(ce,[ue],!0,X):re.push(ue),m.getForTilePoints(n,re,!0,x),Math.max(re[0][2],re[1][2],ue[2])/m.exaggeration()};for(let G=0;G<4;G++){const Z=c.borderFeatureIndices[G];if(Z.length===0)continue;const Y=o.e9[G](n),X=E(Y);if(!(X&&X instanceof o.ea))continue;const ce=m?m.findDEMTileFor(Y):null;if(!(ce&&ce.dem||_)||(m&&ce&&ce.dem&&c.borderDEMTileTimestamp[G]!==ce.dem._timestamp&&(c.borderDoneWithNeighborZ[G]=-1,c.borderDEMTileTimestamp[G]=ce.dem._timestamp),c.borderDoneWithNeighborZ[G]===X.canonical.z))continue;X.centroidVertexArray.length===0&&X.createCentroidsBuffer();const ne=(G<2?1:5)-G,ae=X.borderDoneWithNeighborZ[ne]!==c.canonical.z,re=X.borderFeatureIndices[ne];let ee=0;if(c.canonical.z!==X.canonical.z){for(const ue of Z)c.showCentroid(c.featuresOnBorder[ue]);if(ae)for(const ue of re)X.showCentroid(X.featuresOnBorder[ue]);c.borderDoneWithNeighborZ[G]=X.canonical.z,X.borderDoneWithNeighborZ[ne]=c.canonical.z}for(const ue of Z){const be=c.featuresOnBorder[ue],xe=c.centroidData[be.centroidDataIndex],De=be.borders[G];let Le;for(;ee<re.length;){Le=X.featuresOnBorder[re[ee]];const Ue=Le.borders[ne];if(Ue[1]>De[0]+3||Ue[0]>De[0]-3)break;X.showCentroid(Le),ee++}if(Le&&ee<re.length){const Ue=ee;let it=0;for(;!(Le.borders[ne][0]>De[1]-3)&&(it++,++ee!==re.length);)Le=X.featuresOnBorder[re[ee]];Le=X.featuresOnBorder[re[Ue]];let Ce=!1;if(it>=1){const Pe=Le.borders[ne];Math.abs(De[0]-Pe[0])<3&&Math.abs(De[1]-Pe[1])<3&&(it=1,Ce=!0,ee=Ue+1)}else if(it===0){c.showCentroid(be);continue}const _e=X.centroidData[Le.centroidDataIndex];_&&Ce&&(((F=xe).flags|(H=_e).flags)&o.ec?(F.flags|=o.ec,H.flags|=o.ec):(F.flags&=~o.ec,H.flags&=~o.ec));const Fe=be.intersectsCount()>1||Le.intersectsCount()>1;if(it>1)ee=Ue,xe.centroidXY=_e.centroidXY=new o.P(0,0);else if(ce&&ce.dem&&!Fe){const Pe=z[G](xe,_e),We=G%2?o.al-1:0,dt=B(Pe[0],Math.min(o.al-1,Pe[1]),We,ce,Y,G<2,Pe[2]);xe.centroidXY=_e.centroidXY=b(dt)}else Fe?xe.centroidXY=_e.centroidXY=new o.P(0,0):(xe.centroidXY=c.encodeBorderCentroid(be),_e.centroidXY=X.encodeBorderCentroid(Le));c.writeCentroidToBuffer(xe),X.writeCentroidToBuffer(_e)}else c.showCentroid(be)}c.borderDoneWithNeighborZ[G]=X.canonical.z,X.borderDoneWithNeighborZ[ne]=c.canonical.z}var F,H;(c.needsCentroidUpdate||!c.centroidVertexBuffer&&c.centroidVertexArray.length!==0)&&c.uploadCentroid(l)}const Ls=[1,0,0],Af=[0,1,0],ys=[0,0,1];function la(l,t,n){const c=n.transform,d=n.shadowRenderer;if(!d)return!0;const m=l.toUnwrapped(),_=c.tileSize*d._cascades[n.currentShadowCascade].scale;let x=t;if(c.elevation){const F=c.elevation.getMinMaxForTile(l);F&&(x+=F.max)}const b=[...d.shadowDirection];b[2]=-b[2];const E=d.computeSimplifiedTileShadowVolume(m,x,_,b);if(!E)return!1;const I=[Ls,Af,ys,b,[b[0],0,b[2]],[0,b[1],b[2]]],L=c.projection.name==="globe",D=c.scaleZoom(_),z=o.cB.fromInvProjectionMatrix(c.invProjMatrix,c.worldSize,D,!L),B=d.getCurrentCascadeFrustum();return z.intersectsPrecise(E.vertices,E.planes,I)===0||B.intersectsPrecise(E.vertices,E.planes,I)===0}function ou(l){const{painter:t,source:n,layer:c,coords:d}=l;let m=l.defines;const _=t.context,x=t.renderPass==="shadow",b=t.renderPass==="light-beam",E=t.shadowRenderer,I=o.ef(t.transform.center.lat,t.transform.zoom),L=za(t,c.paint.get("building-cutoff-fade-range"));L.shouldRenderCutoff&&(m=m.concat("RENDER_CUTOFF")),l.floodLightIntensity>0&&(m=m.concat("FLOOD_LIGHT"));for(const D of d){const z=n.getTile(D),B=z.getBucket(c);if(!B)continue;E&&E.getMaxCascadeForTile(D.toUnwrapped())===0&&(m=m.concat("SHADOWS_SINGLE_CASCADE"));const F=B.programConfigurations.get(c.id);let H,G,Z,Y=t.translatePosMatrix(D.expandedProjMatrix,z,[0,0],"map");if(Y=o.cS(o.bC(),Y,[1,1,l.verticalScale]),x&&E){if(la(z.tileID,B.maxHeight*I,t))continue;let ce=E.calculateShadowPassMatrixFromTile(z.tileID.toUnwrapped());ce=o.cS(o.bC(),ce,[1,1,l.verticalScale]),Z=Ua(ce),H=G=t.getOrCreateProgram("buildingDepth",{config:F,defines:m,overrideFog:!1})}else if(b)H=G=t.getOrCreateProgram("buildingBloom",{config:F,defines:m,overrideFog:!1}),Z=Fm(Y);else{const ce=t.transform.calculatePosMatrix(D.toUnwrapped(),t.transform.worldSize);o.cS(ce,ce,[1,1,l.verticalScale]);const ne=o.bC();o.cS(ne,ce,[1,-1,1/I]),o.bl(ne,ne),o.eg(ne,ne);const ae=t.transform.getFreeCameraOptions().position,re=1<<D.canonical.z;if(Z=vh(Y,ne,l.opacity,l.facadeAOIntensity,[((ae.x-D.wrap)*re-D.canonical.x)*o.al,(ae.y*re-D.canonical.y)*o.al,ae.z*re*o.al],B.tileToMeter,l.facadeEmissiveChance,l.floodLightColor,l.floodLightIntensity),G=t.getOrCreateProgram("building",{config:F,defines:m,overrideFog:!1}),l.depthOnly===!0)H=G;else{const ee=m.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);H=t.getOrCreateProgram("building",{config:F,defines:ee,overrideFog:!1})}E&&(E.setupShadowsFromMatrix(ce,G,!0),H!==G&&E.setupShadowsFromMatrix(ce,H,!0))}const X=(ce,ne)=>{if(b){const ae=ce.entranceBloom;ne.draw(t,_.gl.TRIANGLES,l.depthMode,oi.disabled,l.blendMode,si.disabled,Z,c.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segmentsBucket,c.paint,t.transform.zoom,F,[ae.layoutAttenuationBuffer,ae.layoutColorBuffer])}else{const ae=ce.segmentsBucket;let re=[ce.layoutNormalBuffer,ce.layoutCentroidBuffer,ce.layoutColorBuffer,ce.layoutFloodLightDataBuffer];ce.layoutFacadePaintBuffer&&(re=re.concat([ce.layoutFacadeDataBuffer,ce.layoutFacadeVerticalRangeBuffer,ce.layoutFacadePaintBuffer])),ne.draw(t,_.gl.TRIANGLES,l.depthMode,oi.disabled,l.blendMode,x?si.disabled:si.backCW,Z,c.id,ce.layoutVertexBuffer,ce.indexBuffer,ae,c.paint,t.transform.zoom,F,re)}};t.uploadCommonUniforms(_,G,D.toUnwrapped(),null,L),B.buildingWithoutFacade&&X(B.buildingWithoutFacade,G),B.buildingWithFacade&&(H!==G&&t.uploadCommonUniforms(_,H,D.toUnwrapped(),null,L),X(B.buildingWithFacade,H))}}function Ch(l,t,n,c,d,m,_,x,b,E,I,L,D){const z=l.context.gl,B=l.depthModeForSublayer(1,Bt.ReadOnly,z.LEQUAL,!0),F=.1*(1-(H=I))+3*H;var H;const G=l._showOverdrawInspector,Z=L,Y=new Ef;G||aa(Y,l,t,n,c,B,new oi({func:z.ALWAYS,mask:255},255,255,z.KEEP,z.KEEP,z.REPLACE),new gi([z.ONE,z.ONE,z.ONE,z.ONE],o.ao.transparent,[!1,!1,!1,!0],z.MIN),si.disabled,d,"sdf",m,_,x,b,E,F,Z,!1);{const X=G?oi.disabled:new oi({func:z.EQUAL,mask:255},255,255,z.KEEP,z.DECR,z.DECR),ce=G?l.colorModeForRenderPass():new gi([z.ONE_MINUS_DST_ALPHA,z.DST_ALPHA,z.ONE,z.ONE],o.ao.transparent,[!0,!0,!0,!0]);aa(Y,l,t,n,c,B,X,ce,si.disabled,d,"color",m,_,x,b,E,F,Z,!1)}}function Ph(l){return[l[0]*o.eh,l[1]*o.eh,l[2]*o.eh,0]}function au(l,t,n,c,d,m,_,x,b){const E=c.getSource(),I=n.globeSharedBuffers;if(!I)return;let L,D,z;if(t&&(L=c.getTile(t)),E instanceof o.aU?(D=E.texture,z=o.dK(0,0,n.transform)):L&&t&&(D=L.texture,z=o.dK(t.canonical.z,t.canonical.x,n.transform)),!D||!z)return;l||(z=o.cS(o.bC(),z,[1,-1,1]));const B=n.context,F=B.gl,H=d.paint.get("raster-resampling")==="nearest"?F.NEAREST:F.LINEAR,G=n.colorModeForDrapableLayerRenderPass(m),Z=_.defines;Z.push("GLOBE_POLES");const Y=new Bt(F.LEQUAL,Bt.ReadWrite,n.depthRangeFor3D),X=Float32Array.from(n.transform.expandedFarZProjMatrix),ce=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),B.activeTexture.set(F.TEXTURE0),D.bind(H,F.CLAMP_TO_EDGE),B.activeTexture.set(F.TEXTURE1),D.bind(H,F.CLAMP_TO_EDGE),"useMipmap"in D&&B.extTextureFilterAnisotropic&&n.transform.pitch>20&&F.texParameterf(F.TEXTURE_2D,B.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,B.extTextureFilterAnisotropicMax);const[ne,ae,re,ee]=t?I.getPoleBuffers(t.canonical.z,!1):I.getPoleBuffers(0,!0),ue=d.paint.get("raster-elevation");let be;l?(be=ne,n.renderDefaultNorthPole=ue!==0):(be=ae,n.renderDefaultSouthPole=ue!==0);const xe=Ph(_.mix),De=((Ue,it,Ce,_e,Fe,Pe,We,dt,Tt,ct,nt,kt,Dt)=>Vm(Ue,it,Ce,new Float32Array(16),new Float32Array(9),[0,0],_e,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Pe,[0,0],dt,2,ct,nt,kt,1,0,Dt))(X,ce,z,o.aj(n.transform.zoom),0,d,0,ue,0,xe,_.offset,_.range,m),Le=n.getOrCreateProgram("raster",{defines:Z});n.uploadCommonUniforms(B,Le,null),Le.draw(n,F.TRIANGLES,Y,b,G,x,De,d.id,be,re,ee)}function Wm(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),c=n-t,d=.2*l.height,m=t+d;return[t,n,(m-d-t)/c,(m-t)/c]}function ca(l,t,n,c){if(l)return t instanceof hs&&l instanceof ju?t.getTextureDescriptor(l,n,!0):{texture:l.texture,mix:Ph(c.mix),offset:c.offset,buffer:0,tileSize:1}}var Mr=o.ei([{name:"a_index",type:"Int16",components:1}]);class Mh{constructor(t,n,c,d){const m={width:c[0],height:c[1],data:null},_=t.gl;this.targetColorTexture=new o.T(t,m,_.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,m,_.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(n,d),this.lastInvalidatedAt=0}updateParticleTexture(t,n){if(this.particleTextureDimension===n.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const c=this.context.gl,d=n.width*n.height;this.particleTexture0=new o.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,n,c.RGBA8,{premultiply:!1,useMipmap:!1});const m=new o.ej;m.reserve(d);for(let _=0;_<d;_++)m.emplaceBack(_);this.particleIndexBuffer=this.context.createVertexBuffer(m,Mr.members,!0),this.particleSegment=o.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=n.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function If(l,t,n){if(!l)return null;const c=t.getTextureDescriptor(l,n,!0);if(!c)return null;let{texture:d,mix:m,offset:_,tileSize:x,buffer:b,format:E}=c;if(!d||!E)return null;let I=!1;return E==="uint32"&&(I=!0,m[3]=0,m=bh(o.ek,m,[0,n.paint.get("raster-particle-max-speed")]),_=wh(o.ek,_,[0,n.paint.get("raster-particle-max-speed")])),{texture:d,textureOffset:[b/(x+2*b),x/(x+2*b)],tileSize:x,scalarData:I,scale:m,offset:_,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[E]]}}function Zm(l){const t=l._nearZ,n=l.projection.farthestPixelDistance(l),c=n-t,d=.2*l.height,m=t+d;return[t,n,(m-d-t)/c,(m-t)/c]}const Xm=new o.ao(1,0,0,1),Km=new o.ao(0,1,0,1),Ym=new o.ao(0,0,1,1),wl=new o.ao(1,0,1,1),Tl=new o.ao(0,1,1,1);function lt(l,t,n,c,d,m){for(let _=0;_<n.length;_++)if(d){const E=new o.ao(c.r*.8,c.g*.8,c.b*.8,1);pt(l,t,n[_],c,-1,-1,m),pt(l,t,n[_],c,-1,1,m),pt(l,t,n[_],c,1,1,m),pt(l,t,n[_],c,1,-1,m),pt(l,t,n[_],E,0,0,m)}else pt(l,t,n[_],c,0,0,m)}function pt(l,t,n,c,d,m,_){const x=l.context,b=l.transform,E=x.gl,I=b.projection.name==="globe",L=I?["PROJECTION_GLOBE_VIEW"]:[];let D=o.bz(n.projMatrix);if(I&&o.aj(b.zoom)>0){const xe=o.bj(n.canonical,b),De=o.el(xe);D=o.aB(new Float32Array(16),b.globeMatrix,De),o.aB(D,b.projMatrix,D)}const z=o.bC();z[12]+=2*d/(o.o.devicePixelRatio*b.width),z[13]+=2*m/(o.o.devicePixelRatio*b.height),o.aB(D,z,D);const B=l.getOrCreateProgram("debug",{defines:L}),F=t.getTileByID(n.key);l.terrain&&l.terrain.setupElevationDraw(F,B);const H=Bt.disabled,G=oi.disabled,Z=l.colorModeForRenderPass(),Y="$debug";x.activeTexture.set(E.TEXTURE0),l.emptyTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),I?F._makeGlobeTileDebugBuffers(l.context,b):F._makeDebugTileBoundsBuffers(l.context,b.projection);const X=F._tileDebugBuffer||l.debugBuffer,ce=F._tileDebugIndexBuffer||l.debugIndexBuffer,ne=F._tileDebugSegments||l.debugSegments;if(B.draw(l,E.LINE_STRIP,H,G,Z,si.disabled,iu(D,c.toPremultipliedRenderColor(null)),Y,X,ce,ne,null,null,null,[F._globeTileDebugBorderBuffer]),_){const xe=F.latestRawTileData,De=Math.floor((xe&&xe.byteLength||0)/1024);let Le=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(Le+=` => ${n.overscaledZ}`),Le+=` ${F.state}`,Le+=` ${De}kb`,function(Ue,it){Ue.initDebugOverlayCanvas();const Ce=Ue.debugOverlayCanvas,_e=Ue.context.gl,Fe=Ue.debugOverlayCanvas.getContext("2d");Fe.clearRect(0,0,Ce.width,Ce.height),Fe.shadowColor="white",Fe.shadowBlur=2,Fe.lineWidth=1.5,Fe.strokeStyle="white",Fe.textBaseline="top",Fe.font="bold 36px Open Sans, sans-serif",Fe.fillText(it,5,5),Fe.strokeText(it,5,5),Ue.debugOverlayTexture.update(Ce),Ue.debugOverlayTexture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}(l,Le)}const ae=t.getTile(n).tileSize,re=512/Math.min(ae,512)*(n.overscaledZ/b.zoom)*.5,ee=F._tileDebugTextBuffer||l.debugBuffer,ue=F._tileDebugTextIndexBuffer||l.quadTriangleIndexBuffer,be=F._tileDebugTextSegments||l.debugSegments;B.draw(l,E.TRIANGLES,H,G,gi.alphaBlended,si.disabled,iu(D,o.ao.transparent.toPremultipliedRenderColor(null),re),Y,ee,ue,be,null,null,null,[F._globeTileDebugTextBuffer])}function Sl(l,t,n,c){Se(l,0,t+n/2,l.transform.width,n,c)}function Xr(l,t,n,c){Se(l,t-n/2,0,n,l.transform.height,c)}function Se(l,t,n,c,d,m){const _=l.context,x=_.gl;x.enable(x.SCISSOR_TEST),x.scissor(t*o.o.devicePixelRatio,n*o.o.devicePixelRatio,c*o.o.devicePixelRatio,d*o.o.devicePixelRatio),_.clear({color:m}),x.disable(x.SCISSOR_TEST)}const Jm=o.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Rh}=Jm;function jo(l,t,n,c){l.emplaceBack(t,n,c)}class Dh{constructor(t){this.vertexArray=new o.em,this.indices=new o.b0,jo(this.vertexArray,-1,-1,1),jo(this.vertexArray,1,-1,1),jo(this.vertexArray,-1,1,1),jo(this.vertexArray,1,1,1),jo(this.vertexArray,-1,-1,-1),jo(this.vertexArray,1,-1,-1),jo(this.vertexArray,-1,1,-1),jo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Rh),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bg.simpleSegment(0,0,36,12)}}function El(l,t,n,c,d,m){const _=l.context.gl,x=t.paint.get("sky-atmosphere-color"),b=t.paint.get("sky-atmosphere-halo-color"),E=t.paint.get("sky-atmosphere-sun-intensity"),I=((L,D,z,B,F)=>({u_matrix_3f:L,u_sun_direction:D,u_sun_intensity:z,u_color_tint_r:[B.r,B.g,B.b,B.a],u_color_tint_m:[F.r,F.g,F.b,F.a],u_luminance:5e-5}))(o.eo(o.dO(),c),d,E,x.toPremultipliedRenderColor(null),b.toPremultipliedRenderColor(null));_.framebufferTexture2D(_.FRAMEBUFFER,_.COLOR_ATTACHMENT0,_.TEXTURE_CUBE_MAP_POSITIVE_X+m,t.skyboxTexture,0),n.draw(l,_.TRIANGLES,Bt.disabled,oi.disabled,gi.unblended,si.frontCW,I,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const Qm=o.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class sc{constructor(t){const n=new o.ep;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);const c=new o.b0;c.emplaceBack(0,1,2),c.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(n,Qm.members),this.indexBuffer=t.createIndexBuffer(c),this.segments=o.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const by=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class wy{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class e_{constructor(t){this.colorModeAlphaBlendedWriteRGB=new gi([1,Bo,1,Bo],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new gi([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new wy,this.updateNeeded=!0}update(t){const n=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new sc(n);const c=this.params.sizeRange,d=this.params.intensityRange,m=function(I){const L=o.eq(30),D=[];for(let z=0;z<I;++z){const B=2*Math.PI*L(),F=Math.acos(1-2*L())-.5*Math.PI;D.push(o.d5(Math.cos(F)*Math.cos(B),Math.cos(F)*Math.sin(B),Math.sin(F)))}return D}(this.params.starsCount),_=o.eq(300),x=new o.er,b=new o.b0;let E=0;for(let I=0;I<m.length;++I){const L=o.c5([],m[I],200),D=Math.max(0,1+.01*c*(1*_()-.5)),z=Math.max(0,1+.01*d*(1*_()-.5));x.emplaceBack(L[0],L[1],L[2],-1,-1,D,z),x.emplaceBack(L[0],L[1],L[2],1,-1,D,z),x.emplaceBack(L[0],L[1],L[2],1,1,D,z),x.emplaceBack(L[0],L[1],L[2],-1,1,D,z),b.emplaceBack(E+0,E+1,E+2),b.emplaceBack(E+0,E+2,E+3),E+=4}this.starsVx=n.createVertexBuffer(x,by.members),this.starsIdx=n.createIndexBuffer(b),this.starsSegments=o.bg.simpleSegment(0,0,x.length,b.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,n){const c=t.context,d=c.gl,m=t.transform,_=new Bt(d.LEQUAL,Bt.ReadOnly,[0,1]),x=o.aj(m.zoom),b=t.style.getLut(n.scope),E=n.properties.get("color-use-theme")==="none",I=n.properties.get("color").toNonPremultipliedRenderColor(E?null:b),L=n.properties.get("high-color-use-theme")==="none",D=n.properties.get("high-color").toNonPremultipliedRenderColor(L?null:b),z=n.properties.get("space-color-use-theme")==="none",B=n.properties.get("space-color").toNonPremultipliedRenderColor(z?null:b),F=5e-4,H=o.es(n.properties.get("horizon-blend"),0,1,F,.25),G=o.dE(t,c,m)&&H===F?m.worldSize/(2*Math.PI*1.025)-1:m.globeRadius,Z=t.frameCounter/1e3%1,Y=o.ag(m.globeCenterInViewSpace),X=Math.sqrt(Math.pow(Y,2)-Math.pow(G,2)),ce=Math.acos(X/Y),ne=ae=>{const re=m.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];ae&&re.push("ALPHA_PASS");const ee=t.getOrCreateProgram("globeAtmosphere",{defines:re}),ue=((xe,De,Le,Ue,it,Ce,_e,Fe,Pe,We,dt,Tt)=>({u_frustum_tl:xe,u_frustum_tr:De,u_frustum_br:Le,u_frustum_bl:Ue,u_horizon:it,u_transition:Ce,u_fadeout_range:_e,u_atmosphere_fog_color:Fe.toArray01(),u_high_color:Pe.toArray01(),u_space_color:We.toArray01(),u_temporal_offset:dt,u_horizon_angle:Tt}))(m.frustumCorners.TL,m.frustumCorners.TR,m.frustumCorners.BR,m.frustumCorners.BL,m.frustumCorners.horizon,x,H,I,D,B,Z,ce);t.uploadCommonUniforms(c,ee);const be=this.atmosphereBuffer;be&&ee.draw(t,d.TRIANGLES,_,oi.disabled,ae?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,si.backCW,ue,ae?"atmosphere_glow_alpha":"atmosphere_glow",be.vertexBuffer,be.indexBuffer,be.segments)};ne(!1),ne(!0)}drawStars(t,n){const c=o.aA(n.properties.get("star-intensity"),0,1);if(c===0)return;const d=t.context,m=d.gl,_=t.transform,x=t.getOrCreateProgram("stars"),b=o.c7([]);o.c9(b,b,-_._pitch),o.c8(b,b,-_.angle),o.c9(b,b,o.an(_._center.lat)),o.et(b,b,-o.an(_._center.lng));const E=o.cc(new Float32Array(16),b),I=o.aB([],_.starsProjMatrix,E),L=o.eo([],E),D=o.eu([],L),z=[0,1,0];o.dQ(z,z,D),o.c5(z,z,this.params.sizeMultiplier);const B=[1,0,0];o.dQ(B,B,D),o.c5(B,B,this.params.sizeMultiplier);const F=(H=z,G=B,Z=c,{u_matrix:Float32Array.from(I),u_up:H,u_right:G,u_intensity_multiplier:Z});var H,G,Z;t.uploadCommonUniforms(d,x),this.starsVx&&this.starsIdx&&x.draw(t,m.TRIANGLES,Bt.disabled,oi.disabled,this.colorModeAlphaBlendedWriteRGB,si.disabled,F,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Lh{constructor(){this.visibleTiles=[]}updateBorders(t,n){const c=[],d=[],m=t._getRenderableCoordinates(!1,!0);for(const b of m){const E=t.getTile(b);if(!E.hasData())continue;const I=E.getBucket(n);I&&(I.isEmpty()||(c.push(b.key),d.push({bucket:I,tileID:b.canonical})))}let _=c.length!==this.visibleTiles.length;if(!_){c.sort();for(let b=0;b<c.length;b++)if(c[b]!==this.visibleTiles[b]){_=!0;break}}if(!_)return;const x=new Set;this.visibleTiles=c,d.sort((b,E)=>b.tileID.z-E.tileID.z||b.tileID.x-E.tileID.x||b.tileID.y-E.tileID.y);for(const b of d){const E=new Array,I=new Array,L=b.bucket;for(const D of L.featuresOnBorder)x.has(D.featureId)?I.push(D.footprintIndex):(x.add(D.featureId),E.push(D.footprintIndex));L.updateFootprintHiddenFlags(E,o.ev,!1),L.updateFootprintHiddenFlags(I,o.ev,!0)}}}function zh(l,t){const n=[...l],c=t.cameraWorldSizeForFog/t.worldSize,d=o.bA([]);return o.cS(d,d,[c,c,1]),o.aB(n,d,n),o.aB(n,t.worldToFogMatrix,n),n}function Oh(l,t,n,c,d){const m=n.material,_=c.context,{baseColorTexture:x,metallicRoughnessTexture:b}=m.pbrMetallicRoughness,{normalTexture:E,occlusionTexture:I,emissionTexture:L}=m;function D(B,F,H){if(B&&(l.push(F),_.activeTexture.set(_.gl.TEXTURE0+H),B.gfxTexture)){const{minFilter:G,magFilter:Z,wrapS:Y,wrapT:X}=B.sampler;B.gfxTexture.bindExtraParam(G,Z,Y,X)}}D(x,"HAS_TEXTURE_u_baseColorTexture",Un.BaseColor),D(b,"HAS_TEXTURE_u_metallicRoughnessTexture",Un.MetallicRoughness),D(E,"HAS_TEXTURE_u_normalTexture",Un.Normal),D(I,"HAS_TEXTURE_u_occlusionTexture",Un.Occlusion),D(L,"HAS_TEXTURE_u_emissionTexture",Un.Emission),d&&(d.texture||(d.texture=new o.d$(c.context,d.image,[d.image.height,d.image.height,d.image.height],_.gl.RGBA8)),_.activeTexture.set(_.gl.TEXTURE0+Un.LUT),d.texture&&d.texture.bind(_.gl.LINEAR,_.gl.CLAMP_TO_EDGE),l.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(l.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(n.texcoordBuffer)),n.colorBuffer&&(l.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(n.colorBuffer)),n.normalBuffer&&(l.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(n.normalBuffer)),n.pbrBuffer&&(l.push("HAS_ATTRIBUTE_a_pbr"),l.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(n.pbrBuffer)),m.alphaMode!=="OPAQUE"&&m.alphaMode!=="MASK"||l.push("UNPREMULT_TEXTURE_IN_SHADER"),m.defined||l.push("DIFFUSE_SHADED");const z=c.shadowRenderer;z&&(l.push("RENDER_SHADOWS","DEPTH_TEXTURE"),z.useNormalOffset&&l.push("NORMAL_OFFSET"))}function kh(l,t,n,c,d,m){const _=l.modelOpacity,x=t.context,b=new Bt(t.context.gl.LEQUAL,l.isLightMesh?Bt.ReadOnly:Bt.ReadWrite,t.depthRangeFor3D),E=t.transform,I=l.mesh,L=I.material,D=L.pbrMetallicRoughness,z=t.style.fog;let B;B=t.transform.projection.zAxisUnit==="pixels"?[...l.nodeModelMatrix]:o.aB([],c.zScaleMatrix,l.nodeModelMatrix),o.aB(B,c.negCameraPosMatrix,B);const F=o.bl([],B);o.eg(F,F);const H=n.paint.get("model-color-use-theme").constantOr("default")==="none",G=n.paint.get("model-emissive-strength").constantOr(0),Z=vl(new Float32Array(l.worldViewProjection),new Float32Array(B),new Float32Array(F),null,t,_,D.baseColorFactor,L.emissiveFactor,D.metallicFactor,D.roughnessFactor,L,G,n,void 0,void 0,l.materialOverride,l.modelColor),Y={defines:[]},X=[],ce=t.shadowRenderer;ce&&(ce.useNormalOffset=!1),Oh(Y.defines,X,I,t,H?null:n.lut);let ne=null;if(z){const ee=zh(l.nodeModelMatrix,t.transform);if(ne=new Float32Array(ee),E.projection.name!=="globe"){const ue=I.aabb.min,be=I.aabb.max,[xe,De]=z.getOpacityForBounds(ee,ue[0],ue[1],be[0],be[1]);Y.overrideFog=xe>=Ge||De>=Ge}}const ae=za(t,n.paint.get("model-cutoff-fade-range"));ae.shouldRenderCutoff&&Y.defines.push("RENDER_CUTOFF");const re=t.getOrCreateProgram("model",Y);t.uploadCommonUniforms(x,re,null,ne,ae),t.renderPass!=="shadow"&&ce&&ce.setupShadowsFromMatrix(l.nodeModelMatrix,re),re.draw(t,x.gl.TRIANGLES,b,d,m,I.material.doubleSided?si.disabled:si.backCCW,Z,n.id,I.vertexBuffer,I.indexBuffer,I.segments,n.paint,t.transform.zoom,void 0,X)}function lu(l,t){return l.style._importedAsBasemap?"basemap":t.scope}function Al(l,t,n,c,d,m,_,x,b,E){const I=l.transform,L=!!t.isGeometryBloom&&t.isGeometryBloom;if(L&&l.renderPass==="shadow")return;const D=I.projection.name==="globe"?o.eD(n,I):[...n];o.aB(D,D,t.globalMatrix);const z=o.aB([],c,D);if(t.meshes)for(const B of t.meshes){const F=x.get(B.material.name);if(F&&F.opacity<=0)continue;if(B.material.alphaMode!=="BLEND"){_.push({mesh:B,depth:0,modelIndex:d,worldViewProjection:z,nodeModelMatrix:D,isLightMesh:L,materialOverride:F,modelOpacity:b,modelColor:E});continue}const H=o.af([],B.centroid,z);!I.isOrthographic&&H[2]<=0||m.push({mesh:B,depth:H[2],modelIndex:d,worldViewProjection:z,nodeModelMatrix:D,isLightMesh:L,materialOverride:F,modelOpacity:b,modelColor:E})}if(t.children)for(const B of t.children)Al(l,B,n,c,d,m,_,x,b,E)}function So(l,t,n,c){const d=n.shadowRenderer;if(!d)return;const m=d.getShadowPassDepthMode(),_=d.getShadowPassColorMode(),x=d.calculateShadowPassMatrixFromMatrix(t),b=wf(x);n.getOrCreateProgram("modelDepth",{defines:n._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,m,oi.disabled,_,si.disabled,b,c.id,l.vertexBuffer,l.indexBuffer,l.segments,c.paint,n.transform.zoom,void 0,void 0)}function t_(l,t,n,c,d,m){for(const _ of d){const x=Object.assign({},c);x.part=_;const b={type:"Unknown",id:t,properties:x},E={orientation:l.paint.get("model-rotation").evaluate(b,n)};m.set(_,E)}}function i_(l,t,n,c,d,m){for(const _ of d){const x=Object.assign({},c);x.part=_;const b={type:"Unknown",id:t,properties:x},E={color:l.paint.get("model-color").evaluate(b,n),colorMix:l.paint.get("model-color-mix-intensity").evaluate(b,n),opacity:l.paint.get("model-opacity").evaluate(b,n),emissionStrength:l.paint.get("model-emissive-strength").evaluate(b,n)};m.set(_,E)}}function r_(l,t,n,c,d){let m=!1;for(const x of c)x.modelOpacity!==1&&(kh(x,l,t,d[x.modelIndex],oi.disabled,gi.disabled),m=!0);for(const x of c)kh(x,l,t,d[x.modelIndex],x.modelOpacity!==1?l.stencilModeFor3D():oi.disabled,l.colorModeForRenderPass());m&&l.resetStencilClippingMasks();const _=gi.additive;for(const x of n)kh(x,l,t,d[x.modelIndex],oi.disabled,x.isLightMesh?_:l.colorModeForRenderPass())}function n_(l,t,n){const c=t.updateZoomBasedPaintProperties(),d=function(m,_,x){let b,E,I,L=m.terrain?m.terrain.exaggeration():0;if(m.terrain&&L>0){const D=m.terrain,z=D.findDEMTileFor(x);z&&z.dem?b=o.eF.create(D,x,z):L=0}if(L===0&&(_.terrainElevationMin=0,_.terrainElevationMax=0),L===_.validForExaggeration&&(L===0||b&&b._demTile&&b._demTile.tileID===_.validForDEMTile.id&&b._dem._timestamp===_.validForDEMTile.timestamp))return!1;for(const D in _.instancesPerModel){const z=_.instancesPerModel[D];for(let B=0;B<z.instancedDataArray.length;++B){const F=(b?L*b.getElevationAt(0|z.instancedDataArray.float32[16*B],0|z.instancedDataArray.float32[16*B+1],!0,!0):0)+z.instancesEvaluatedElevation[B];z.instancedDataArray.float32[16*B+6]=F,E=E?Math.min(_.terrainElevationMin,F):F,I=I?Math.max(_.terrainElevationMax,F):F}}return _.terrainElevationMin=E||0,_.terrainElevationMax=I||0,_.validForExaggeration=L,_.validForDEMTile=b&&b._demTile?{id:b._demTile.tileID,timestamp:b._dem._timestamp}:{id:void 0,timestamp:0},!0}(l,t,n);(c||d)&&(t.uploaded=!1,t.upload(l.context))}const Go={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d9([0,0,0],[o.al,o.al,0])};function xs(l,t){const n=1<<l.canonical.z,c=t.getFreeCameraOptions().position,d=t.elevation,m=l.canonical.x/n,_=(l.canonical.x+1)/n,x=l.canonical.y/n,b=(l.canonical.y+1)/n;let E=t._centerAltitude;if(d){const z=d.getMinMaxForTile(l);z&&z.max>E&&(E=z.max)}const I=o.aA(c.x,m,_)-c.x,L=o.aA(c.y,x,b)-c.y,D=o.cf(E,t.center.lat)-c.z;return t._zoomFromMercatorZ(Math.sqrt(I*I+L*L+D*D))}function s_(l,t,n,c,d,m,_){const x=l.context,b=l.renderPass==="shadow",E=l.shadowRenderer,I=b&&E?E.getShadowPassDepthMode():new Bt(x.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D),L=l.isTileAffectedByFog(m),D=l.transform.projection.name==="globe";if(n.meshes)for(const z of n.meshes){const B=D?[]:["MODEL_POSITION_ON_GPU"],F=[];let H,G,Z;const Y=!D&&c.instancedDataArray.length>20;Y&&B.push("INSTANCED_ARRAYS");const X=za(l,t.paint.get("model-cutoff-fade-range"));if(X.shouldRenderCutoff&&B.push("RENDER_CUTOFF"),b&&E)H=l.getOrCreateProgram("modelDepth",{defines:B}),G=wf(_.shadowTileMatrix,_.shadowTileMatrix,Float32Array.from(n.globalMatrix)),Z=E.getShadowPassColorMode();else{Oh(B,F,z,l,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),H=l.getOrCreateProgram("model",{defines:B,overrideFog:L});const ne=z.material,ae=ne.pbrMetallicRoughness,re=t.paint.get("model-opacity").constantOr(1),ee=t.paint.get("model-emissive-strength").constantOr(0);G=vl(m.expandedProjMatrix,Float32Array.from(n.globalMatrix),new Float32Array(16),null,l,re,ae.baseColorFactor,ne.emissiveFactor,ae.metallicFactor,ae.roughnessFactor,ne,ee,t,d),E&&(_.shadowUniformsInitialized?H.setShadowUniformValues(x,E.getShadowUniformValues()):(E.setupShadows(m.toUnwrapped(),H,"model-tile"),_.shadowUniformsInitialized=!0)),Z=X.shouldRenderCutoff||re<1||ne.alphaMode!=="OPAQUE"?gi.alphaBlended:gi.unblended}l.uploadCommonUniforms(x,H,m.toUnwrapped(),null,X);const ce=z.material.doubleSided?si.disabled:si.backCCW;if(Y)F.push(c.instancedDataBuffer),H.draw(l,x.gl.TRIANGLES,I,oi.disabled,Z,ce,G,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,l.transform.zoom,void 0,F,c.instancedDataArray.length);else{const ne=b?"u_instance":"u_normal_matrix";for(let ae=0;ae<c.instancedDataArray.length;++ae)G[ne]=new Float32Array(c.instancedDataArray.arrayBuffer,64*ae,16),H.draw(l,x.gl.TRIANGLES,I,oi.disabled,Z,ce,G,t.id,z.vertexBuffer,z.indexBuffer,z.segments,t.paint,l.transform.zoom,void 0,F)}}if(n.children)for(const z of n.children)s_(l,t,z,c,d,m,_)}const cu=[1,-1,1];function Ty(l,t,n,c){if(!n.modelManager)return!0;const d=n.modelManager;if(!n.shadowRenderer)return!0;const m=n.shadowRenderer,_=t.aabb;let x=!0,b=l.maxHeight;if(b===0){let I=0;for(const L in l.instancesPerModel){const D=d.getModel(L,c);D?I=Math.max(I,Math.max(Math.max(D.aabb.max[0],D.aabb.max[1]),D.aabb.max[2])):x=!1}b=l.maxScale*I*1.41+l.maxVerticalOffset,x&&(l.maxHeight=b)}_.max[2]=b,_.min[2]+=l.terrainElevationMin,_.max[2]+=l.terrainElevationMax,o.af(_.min,_.min,t.tileMatrix),o.af(_.max,_.max,t.tileMatrix);const E=_.intersects(m.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(l.isInsideFirstShadowMapFrustum=E===2),E===0}function zr(l,t){const n=l.uniformValues.u_cutoff_params[0],c=l.uniformValues.u_cutoff_params[1],d=l.uniformValues.u_cutoff_params[2],m=l.uniformValues.u_cutoff_params[3];return c===n||m===d?1:o.aA(((t-n)/(c-n)-d)/(m-d),0,1)}function Ii(l,t,n,c){if(t.pitch<20)return 1;const d=t.getWorldToCameraMatrix();o.aB(d,d,l);const m=o.bU(n.min[0],n.min[1],n.min[2],1);let _=o.aC(o.eG(),m,d),x=_,b=_;m[1]=n.max[1],_=o.aC(o.eG(),m,d),x=_[1]<x[1]?_:x,b=_[1]>b[1]?_:b,m[0]=n.max[0],_=o.aC(o.eG(),m,d),x=_[1]<x[1]?_:x,b=_[1]>b[1]?_:b,m[1]=n.min[1],_=o.aC(o.eG(),m,d),x=_[1]<x[1]?_:x,b=_[1]>b[1]?_:b;const E=o.aA(c[0],0,1),I=100*t.pixelsPerMeter*o.aA(c[1],0,1),L=o.aA(c[2],0,1),D=o.eH(o.eG(),x,b,E),z=Math.tan(.5*t.fovX),B=-D[2]*z;if(I===0)return D[1]<-Math.abs(B)?L:1;const F=(-Math.abs(B)-D[1])/I,H=(Z,Y,X)=>(1-X)*Z+X*Y,G=o.aA(H(1,L,F),L,1);return H(1,G,o.aA((t.pitch-20)/20,0,1))}class o_{}class Ha{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,n,c){{const L=this._storage.get(n.id);if(L)return L.lastUsedFrameIdx=t,L.buf}const d=c.gl,m=d.getBufferParameter(d.ELEMENT_ARRAY_BUFFER,d.BUFFER_SIZE),_=new ArrayBuffer(m),x=new Int16Array(_);d.getBufferSubData(d.ELEMENT_ARRAY_BUFFER,0,new Int16Array(_));const b=new o.eJ;for(let L=0;L<m/2;L+=3){const D=x[L],z=x[L+1],B=x[L+2];b.emplaceBack(D,z),b.emplaceBack(z,B),b.emplaceBack(B,D)}const E=c.bindVertexArrayOES.current,I=new o_;return I.buf=new To(c,b),I.lastUsedFrameIdx=t,this._storage.set(n.id,I),c.bindVertexArrayOES.set(E),I.buf}update(t){for(const[n,c]of this._storage)t-c.lastUsedFrameIdx>30&&(c.buf.destroy(),this._storage.delete(n))}destroy(){for(const[t,n]of this._storage)n.buf.destroy(),this._storage.delete(t)}}class oc{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const ac=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class ua{constructor(t){this.revealStart=11,this.revealRange=2}}const Cf=o.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class Pf{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,n){const c=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const _=new o.eK,x=new o.b0;_.emplaceBack(-1,-1),_.emplaceBack(1,-1),_.emplaceBack(1,1),_.emplaceBack(-1,1),x.emplaceBack(0,1,2),x.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(_,Cf.members),this.vignetteIdx=t.context.createIndexBuffer(x)}const d=o.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,c);const _={u_vignetteShape:(m={vignetteShape:[n.start,n.range,Math.pow(10,n.fadePower)],vignetteColor:[n.color.r,n.color.g,n.color.b,n.color.a*n.strength]}).vignetteShape,u_vignetteColor:m.vignetteColor};c.draw(t,t.context.gl.TRIANGLES,Bt.disabled,oi.disabled,gi.alphaBlended,si.disabled,_,"vignette",this.vignetteVx,this.vignetteIdx,d)}var m}}class Mf{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,n){const c=t.getFreeCameraOptions().position,d=c.toAltitude(),m=c.toLngLat(),_=o.an(m.lng),x=o.an(m.lat),b=t.pixelsPerMeter/n,E=_*o.eM,I=o.eM*Math.log(Math.tan(Math.PI/4+x/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const L=-this._offsetYPrev+I,D=-this._elevationPrev+d;this._accumulatedOffsetX+=(-this._offsetXPrev+E)*b,this._accumulatedOffsetY+=L*b,this._accumulatedElevation+=D*b,this._offsetXPrev=E,this._offsetYPrev=I,this._elevationPrev=d}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Fh(l,t){return[-(l[0]-Math.floor(l[0]/t)*t),-(l[1]-Math.floor(l[1]/t)*t),-(l[2]-Math.floor(l[2]/t)*t)]}function Gs(l){const t=o.eq(1323123451230),n=[];for(let c=0;c<l;++c){const d=2*t()-1,m=2*t()-1,_=2*t()-1;n.push(o.d5(d,m,_))}return n}function Es(l,t,n,c,d){const m=o.aA((d-n)/(c-n),0,1);return(1-m)*l+m*t}class Il{constructor(t){this._movement=new Mf,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Pf,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,n){const c=t.transform;this._movement.update(c,this._ppmScaleFactor);const d=c.starsProjMatrix,m=o.c7([]);o.c9(m,m,o.an(90)-c._pitch),o.c8(m,m,-c.angle);const _=o.cc(new Float32Array(16),m),x=o.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),b=o.eg([],x),E=o.aB([],b,_),I=Date.now()/1e3;return this._accumulatedTimeFromStart+=(I-this._prevTime)*n,this._prevTime=I,{projectionMatrix:d,modelviewMatrix:E}}}class Bh extends Il{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new ua("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const c=Gs(this.particlesCount),d=new o.eN,m=new o.b0;let _=0;const x=o.eq(1323123451230);for(let b=0;b<c.length;++b){const E=c[b],I=[2*x()-1,x(),x(),x()];d.emplaceBack(E[0],E[1],E[2],-1,-1,...I),d.emplaceBack(E[0],E[1],E[2],1,-1,...I),d.emplaceBack(E[0],E[1],E[2],1,1,...I),d.emplaceBack(E[0],E[1],E[2],-1,1,...I),m.emplaceBack(_+0,_+1,_+2),m.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=n.createVertexBuffer(d,ac.members),this.particlesIdx=n.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const n=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},c=t.transform.zoom;if(n.revealStart>c)return;const d=Es(0,1,n.revealStart,n.revealStart+n.revealRange,c);if(!this.particlesVx||!this.particlesIdx)return;const m=structuredClone(this._params);let _=[-m.direction.x,m.direction.y,-100];o.aw(_,_);const x=structuredClone(this._vignetteParams);x.strength*=d,m.overrideStyleParameters||(m.intensity=t.style.rain.state.density,m.timeFactor=t.style.rain.state.intensity,m.color=structuredClone(t.style.rain.state.color),_=structuredClone(t.style.rain.state.direction),m.screenThinning.intensity=t.style.rain.state.centerThinning,m.dropletSizeX=t.style.rain.state.dropletSize[0],m.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],m.distortionStrength=100*t.style.rain.state.distortionStrength,x.strength=1,x.color=structuredClone(t.style.rain.state.vignetteColor));const b=this.updateOnRender(t,m.timeFactor),E=t.context,I=E.gl,L=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(E,{width:t.width,height:t.height,data:null},I.RGBA8)),m.distortionStrength>0&&(E.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),I.copyTexSubImage2D(I.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const D=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(E,D),E.activeTexture.set(I.TEXTURE0),this.screenTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE);const z=[m.color.r,m.color.g,m.color.b,m.color.a],B=(F,H)=>{const G=Fh(this._movement.getPosition(),F),Z=m.dropletSizeX,Y=m.dropletSizeX*m.dropletSizeYScale,X=t.width/2,ce=t.height/2,ne=Es(0,m.screenThinning.start,0,1,m.screenThinning.intensity),ae=Es(.001,m.screenThinning.range,0,1,m.screenThinning.intensity),re=Es(0,m.screenThinning.particleOffset,0,1,m.screenThinning.intensity),ee=(ue={modelview:b.modelviewMatrix,projection:b.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:G,velocityConeAperture:m.velocityConeAperture,velocity:m.velocity,boxSize:F,rainDropletSize:[Z,Y],distortionStrength:m.distortionStrength,rainDirection:_,color:z,screenSize:[L.width,L.height],thinningCenterPos:[X,ce],thinningShape:[ne,ae,Math.pow(10,m.screenThinning.fadePower)],thinningAffectedRatio:m.screenThinning.affectedRatio,thinningParticleOffset:re,shapeDirectionalPower:m.shapeDirPower,shapeNormalPower:m.shapeNormalPower,mode:H?0:1},{u_modelview:Float32Array.from(ue.modelview),u_projection:Float32Array.from(ue.projection),u_time:ue.time,u_cam_pos:ue.camPos,u_texScreen:0,u_velocityConeAperture:ue.velocityConeAperture,u_velocity:ue.velocity,u_boxSize:ue.boxSize,u_rainDropletSize:ue.rainDropletSize,u_distortionStrength:ue.distortionStrength,u_rainDirection:ue.rainDirection,u_color:ue.color,u_screenSize:ue.screenSize,u_thinningCenterPos:ue.thinningCenterPos,u_thinningShape:ue.thinningShape,u_thinningAffectedRatio:ue.thinningAffectedRatio,u_thinningParticleOffset:ue.thinningParticleOffset,u_shapeDirectionalPower:ue.shapeDirectionalPower,u_shapeNormalPower:ue.shapeNormalPower,u_mode:ue.mode});var ue;const be=Math.round(m.intensity*this.particlesCount),xe=o.bg.simpleSegment(0,0,4*be,2*be);D.draw(t,I.TRIANGLES,Bt.disabled,oi.disabled,gi.alphaBlended,si.disabled,ee,"rain_particles",this.particlesVx,this.particlesIdx,xe)};m.distortionStrength>0&&B(m.boxSize,!0),B(m.boxSize,!1),this._vignette.draw(t,x)}}const Rf=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Df extends Il{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new ua("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const n=t.context;if(!this.particlesVx){const c=Gs(this.particlesCount),d=new o.eO,m=new o.b0;let _=0;const x=o.eq(1323123451230);for(let b=0;b<c.length;++b){const E=c[b],I=x(),L=x(),D=x(),z=[b/c.length,I,L,D],B=[x(),x()];d.emplaceBack(E[0],E[1],E[2],-1,-1,...z,...B),d.emplaceBack(E[0],E[1],E[2],1,-1,...z,...B),d.emplaceBack(E[0],E[1],E[2],1,1,...z,...B),d.emplaceBack(E[0],E[1],E[2],-1,1,...z,...B),m.emplaceBack(_+0,_+1,_+2),m.emplaceBack(_+0,_+2,_+3),_+=4}this.particlesVx=n.createVertexBuffer(d,Rf.members),this.particlesIdx=n.createIndexBuffer(m)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const n=structuredClone(this._params);let c=[-n.direction.x,n.direction.y,-100];o.aw(c,c);const d=structuredClone(this._vignetteParams),m=n.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},_=t.transform.zoom;if(m.revealStart>_)return;const x=Es(0,1,m.revealStart,m.revealStart+m.revealRange,_);d.strength*=x,n.overrideStyleParameters||(n.intensity=t.style.snow.state.density,n.timeFactor=t.style.snow.state.intensity,n.color=structuredClone(t.style.snow.state.color),c=structuredClone(t.style.snow.state.direction),n.screenThinning.intensity=t.style.snow.state.centerThinning,n.billboardSize=2.79*t.style.snow.state.flakeSize,d.strength=1,d.color=structuredClone(t.style.snow.state.vignetteColor));const b=this.updateOnRender(t,n.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const E=t.context,I=E.gl,L=t.transform,D=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(E,D),((z,B,F)=>{const H=Fh(this._movement.getPosition(),z),G=L.width/2,Z=L.height/2,Y=Es(0,F.screenThinning.start,0,1,F.screenThinning.intensity),X=Es(.001,F.screenThinning.range,0,1,F.screenThinning.intensity),ce=Es(0,F.screenThinning.particleOffset,0,1,F.screenThinning.intensity),ne=(ae={modelview:b.modelviewMatrix,projection:b.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:H,velocityConeAperture:F.velocityConeAperture,velocity:F.velocity,horizontalOscillationRadius:F.horizontalOscillationRadius,horizontalOscillationRate:F.horizontalOscillationRate,boxSize:z,billboardSize:1*F.billboardSize,simpleShapeParameters:[F.shapeFadeStart,F.shapeFadePower],screenSize:[L.width,L.height],thinningCenterPos:[G,Z],thinningShape:[Y,X,Math.pow(10,F.screenThinning.fadePower)],thinningAffectedRatio:F.screenThinning.affectedRatio,thinningParticleOffset:ce,color:[F.color.r,F.color.g,F.color.b,F.color.a],direction:c},{u_modelview:Float32Array.from(ae.modelview),u_projection:Float32Array.from(ae.projection),u_time:ae.time,u_cam_pos:ae.camPos,u_velocityConeAperture:ae.velocityConeAperture,u_velocity:ae.velocity,u_horizontalOscillationRadius:ae.horizontalOscillationRadius,u_horizontalOscillationRate:ae.horizontalOscillationRate,u_boxSize:ae.boxSize,u_billboardSize:ae.billboardSize,u_simpleShapeParameters:ae.simpleShapeParameters,u_screenSize:ae.screenSize,u_thinningCenterPos:ae.thinningCenterPos,u_thinningShape:ae.thinningShape,u_thinningAffectedRatio:ae.thinningAffectedRatio,u_thinningParticleOffset:ae.thinningParticleOffset,u_particleColor:ae.color,u_direction:ae.direction});var ae;const re=Math.round(F.intensity*this.particlesCount),ee=o.bg.simpleSegment(0,0,4*re,2*re);this.particlesVx&&this.particlesIdx&&D.draw(t,I.TRIANGLES,Bt.disabled,oi.disabled,gi.alphaBlended,si.disabled,ne,"snow_particles",this.particlesVx,this.particlesIdx,ee)})(n.boxSize,0,n),this._vignette.draw(t,d)}}const qa={symbol:function(l,t,n,c,d){if(l.renderPass!=="translucent")return;const m=oi.disabled,_=l.colorModeForRenderPass(),x=n.layout.get("text-variable-anchor"),b=n.layout.get("text-size-scale-range"),E=o.aA(l.scaleFactor,b[0],b[1]);x&&function(D,z,B,F,H,G,Z,Y){const X=z.transform,ce=H==="map",ne=G==="map";for(const ae of D){const re=F.getTile(ae),ee=re.getBucket(B);if(!ee||!ee.text||!ee.text.segments.get().length)continue;const ue=o.bK(ee.textSizeData,X.zoom,Y),be=ko(ae,ee.getProjection(),X),xe=X.calculatePixelsToTileUnitsMatrix(re),De=ds(be,re.tileID.canonical,ne,ce,X,ee.getProjection(),xe),Le=ee.hasIconTextFit()&&ee.hasIconData();ue&&Kt(ee,ce,ne,Z,X,De,ae,Math.pow(2,X.zoom-re.tileID.overscaledZ),ue,Le)}}(c,l,n,t,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),d,E);const I=n.paint.get("icon-opacity").constantOr(1)!==0,L=n.paint.get("text-opacity").constantOr(1)!==0;n.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(I||L)?su(l,t,n,c,m,_):(I&&su(l,t,n,c,m,_,{onlyIcons:!0}),L&&su(l,t,n,c,m,_,{onlyText:!0})),t.map.showCollisionBoxes&&(Mt(l,t,n,c,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),Mt(l,t,n,c,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(l,t,n,c){if(l.renderPass!=="translucent")return;const d=n.paint.get("circle-opacity"),m=n.paint.get("circle-stroke-width"),_=n.paint.get("circle-stroke-opacity"),x=n.layout.get("circle-sort-key").constantOr(1)!==void 0,b=n.paint.get("circle-emissive-strength");if(d.constantOr(1)===0&&(m.constantOr(1)===0||_.constantOr(1)===0))return;const E=l.context,I=E.gl,L=l.transform,D=!(!l.terrain||!l.terrain.enabled),z=n.layout.get("circle-elevation-reference"),B=l.depthModeForSublayer(0,Bt.ReadOnly),F=new Bt(l.context.gl.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D),H=z==="none"||D?B:F,G=oi.disabled,Z=l.colorModeForDrapableLayerRenderPass(b),Y=L.projection.name==="globe",X=[o.aF(L.center.lng),o.aJ(L.center.lat)],ce=[];for(let ae=0;ae<c.length;ae++){const re=c[ae],ee=t.getTile(re),ue=ee.getBucket(n);if(!ue||ue.projection.name!==L.projection.name)continue;const be=ue.programConfigurations.get(n.id),xe=ue.layoutVertexBuffer,De=ue.globeExtVertexBuffer,Le=ue.indexBuffer,Ue=o.e0(n),it=[De],Ce=l.isTileAffectedByFog(re);Y&&Ue.push("PROJECTION_GLOBE_VIEW"),Ue.push("DEPTH_D24"),l.terrain&&L.depthOcclusionForSymbolsAndCircles&&Ue.push("DEPTH_OCCLUSION"),ue.hasElevation&&!l.terrain&&(Ue.push("ELEVATED_ROADS"),it.push(ue.elevatedLayoutVertexBuffer));const _e=l.getOrCreateProgram("circle",{config:be,defines:Ue,overrideFog:Ce}),Fe=L.projection.createInversionMatrix(L,re.canonical),Pe={programConfiguration:be,program:_e,layoutVertexBuffer:xe,dynamicBuffers:it,indexBuffer:Le,uniformValues:o.e1(l,re,ee,Fe,X,n),tile:ee};if(x){const We=ue.segments.get();for(const dt of We)ce.push({segments:new o.bg([dt]),sortKey:dt.sortKey,state:Pe})}else ce.push({segments:ue.segments,sortKey:0,state:Pe})}x&&ce.sort((ae,re)=>ae.sortKey-re.sortKey);const ne={useDepthForOcclusion:L.depthOcclusionForSymbolsAndCircles};for(const ae of ce){const{programConfiguration:re,program:ee,layoutVertexBuffer:ue,dynamicBuffers:be,indexBuffer:xe,uniformValues:De,tile:Le}=ae.state,Ue=ae.segments;l.terrain&&l.terrain.setupElevationDraw(Le,ee,ne),l.uploadCommonUniforms(E,ee,Le.tileID.toUnwrapped()),ee.draw(l,I.TRIANGLES,H,G,Z,si.disabled,De,n.id,ue,xe,Ue,n.paint,L.zoom,re,be)}},heatmap:function(l,t,n,c){if(n.paint.get("heatmap-opacity")!==0)if(l.renderPass==="offscreen"){const d=l.context,m=d.gl,_=oi.disabled,x=new gi([m.ONE,m.ONE,m.ONE,m.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(z,B,F,H){const G=z.gl,Z=B.width*H,Y=B.height*H;z.activeTexture.set(G.TEXTURE1),z.viewport.set([0,0,Z,Y]);let X=F.heatmapFbo;if(!X||X&&(X.width!==Z||X.height!==Y)){X&&X.destroy();const ce=G.createTexture();G.bindTexture(G.TEXTURE_2D,ce),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_2D,G.TEXTURE_MAG_FILTER,G.LINEAR),X=F.heatmapFbo=z.createFramebuffer(Z,Y,1,null),function(ne,ae,re,ee,ue,be){const xe=ne.gl;xe.texImage2D(xe.TEXTURE_2D,0,ne.extRenderToTextureHalfFloat?xe.RGBA16F:xe.RGBA,ue,be,0,xe.RGBA,ne.extRenderToTextureHalfFloat?xe.HALF_FLOAT:xe.UNSIGNED_BYTE,null),ee.colorAttachment0.set(re)}(z,0,ce,X,Z,Y)}else G.bindTexture(G.TEXTURE_2D,X.colorAttachment0.get()),z.bindFramebuffer.set(X.framebuffer)})(d,l,n,l.transform.projection.name==="globe"?.5:.25),d.clear({color:o.ao.transparent});const b=l.transform,E=b.projection.name==="globe",I=E?["PROJECTION_GLOBE_VIEW"]:[],L=E?si.frontCCW:si.disabled,D=[o.aF(b.center.lng),o.aJ(b.center.lat)];for(let z=0;z<c.length;z++){const B=c[z];if(t.hasRenderableParent(B))continue;const F=t.getTile(B),H=F.getBucket(n);if(!H||H.projection.name!==b.projection.name)continue;const G=l.isTileAffectedByFog(B),Z=H.programConfigurations.get(n.id),Y=l.getOrCreateProgram("heatmap",{config:Z,defines:I,overrideFog:G}),{zoom:X}=l.transform;l.terrain&&l.terrain.setupElevationDraw(F,Y),l.uploadCommonUniforms(d,Y,B.toUnwrapped());const ce=b.projection.createInversionMatrix(b,B.canonical);Y.draw(l,m.TRIANGLES,Bt.disabled,_,x,L,Nm(l,B,F,ce,D,X,n.paint.get("heatmap-intensity")),n.id,H.layoutVertexBuffer,H.indexBuffer,H.segments,n.paint,l.transform.zoom,Z,E?[H.globeExtVertexBuffer]:null)}d.viewport.set([0,0,l.width,l.height])}else l.renderPass==="translucent"&&(l.context.setColorMode(l.colorModeForRenderPass()),function(d,m){const _=d.context,x=_.gl,b=m.heatmapFbo;if(!b)return;_.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,b.colorAttachment0.get()),_.activeTexture.set(x.TEXTURE1);let E=m.colorRampTexture;E||(E=m.colorRampTexture=new o.T(_,m.colorRamp,x.RGBA8)),E.bind(x.LINEAR,x.CLAMP_TO_EDGE),d.getOrCreateProgram("heatmapTexture").draw(d,x.TRIANGLES,Bt.disabled,oi.disabled,d.colorModeForRenderPass(),si.disabled,((I,L,D,z)=>({u_image:0,u_color_ramp:1,u_opacity:L.paint.get("heatmap-opacity")}))(0,m),m.id,d.viewportBuffer,d.quadTriangleIndexBuffer,d.viewportSegments,m.paint,d.transform.zoom)}(l,n))},line:function(l,t,n,c){if(l.renderPass!=="translucent")return;const d=n.paint.get("line-opacity"),m=n.paint.get("line-width");if(d.constantOr(1)===0||m.constantOr(1)===0)return;const _=n.paint.get("line-emissive-strength").isConstant(),x=n.paint.get("line-emissive-strength").constantOr(0),b=n.paint.get("line-occlusion-opacity"),E=n.layout.get("line-elevation-reference"),I=n.layout.get("line-width-unit")==="meters",L=E==="sea",D=!(!l.terrain||!l.terrain.enabled),z=l.context,B=z.gl;if(n.hasElevatedBuckets&&l.transform.projection.name==="globe")return;const F=n.layout.get("line-cross-slope"),H=F!==void 0,G=F<1,Z=l.colorModeForDrapableLayerRenderPass(_?x:null),Y=l.terrain&&l.terrain.renderingToTexture,X=Y?1:o.o.devicePixelRatio,ce=n.paint.get("line-dasharray"),ne=ce.constantOr(1),ae=n.layout.get("line-cap"),re=ce.constantOr(null),ee=ae.constantOr(null),ue=n.paint.get("line-pattern"),be=ue.constantOr(1),xe=n.paint.get("line-pattern-cross-fade"),De=ue.constantOr(null),Le=n.paint.get("line-opacity").constantOr(1);let Ue=!be&&Le!==1||l.depthOcclusion&&b>0&&b<1;const it=n.paint.get("line-gradient"),Ce=be?"linePattern":"line",_e=o.e2(n);let Fe;if(Y&&l.terrain&&l.terrain.clipOrMaskOverlapStencilType()&&(Ue=!1),b!==0&&l.depthOcclusion){const Tt=n.paint._values["line-opacity"];Tt&&Tt.value&&Tt.value.kind==="constant"?Fe=Tt.value:o.w(`Occlusion opacity for layer ${n.id} is supported only when line-opacity isn't data-driven.`)}m.value.kind!=="constant"&&m.value.isLineProgressConstant===!1&&_e.push("VARIABLE_LINE_WIDTH"),Y&&(l.emissiveMode!=="dual-source-blending"||_?l.emissiveMode==="mrt-fallback"&&_e.push("USE_MRT1"):_e.push("DUAL_SOURCE_BLENDING"));const Pe=(Tt,ct,nt,kt,Dt,xt)=>{for(const Et of Tt){const $t=t.getTile(Et);if(be&&!$t.patternsLoaded())continue;const di=$t.getBucket(n);if(!di||di.elevationType!=="none"&&!Dt||di.elevationType==="none"&&Dt)continue;l.prepareDrawTile();const Ri=[...ct],Yi=l.shadowRenderer,Ft=di.elevationType==="road"&&!!Yi&&Yi.enabled;let Zi=[0,0,0];if(Ft){const vi=l.style.directionalLight,Lr=l.style.ambientLight;vi&&Lr&&(Zi=na(l.style,vi,Lr)),Ri.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const ui=di.programConfigurations.get(n.id);let tr=!1;if(De&&$t.imageAtlas){const vi=o.e3.from(De),Lr=vi.getPrimary().scaleSelf(X).toString(),en=$t.imageAtlas.patternPositions.get(Lr),Vr=vi.getSecondary(),gr=Vr?$t.imageAtlas.patternPositions.get(Vr.scaleSelf(X).toString()):null;tr=!!en&&!!gr,en&&ui.setConstantPatternPositions(en,gr)}xe>0&&(tr||ui.getPatternTransitionVertexBuffer("line-pattern"))&&Ri.push("LINE_PATTERN_TRANSITION");const hr=l.isTileAffectedByFog(Et),ar=l.getOrCreateProgram(Ce,{config:ui,defines:Ri,overrideFog:hr});if(!be&&re&&ee&&$t.lineAtlas){const vi=$t.lineAtlas.getDash(re,ee);vi&&ui.setConstantPatternPositions(vi)}Ft&&Yi.setupShadows($t.tileID.toUnwrapped(),ar,"vector-tile");let[$i,xi]=n.paint.get("line-trim-offset");(ee==="round"||ee==="square")&&$i!==xi&&($i===0&&($i-=1),xi===1&&(xi+=1));const er=Y?Et.projMatrix:null,$r=I?1/di.tileToMeter/o.ay($t,1,l.transform.zoom):1,Or=I?1/di.tileToMeter/o.ay($t,1,Math.floor(l.transform.zoom)):1,ir=be?o.e4(l,$t,n,er,X,$r,Or,[$i,xi],Zi,xe):o.e5(l,$t,n,er,di.lineClipsArray.length,X,$r,Or,[$i,xi],Zi);if(it){const vi=di.gradients[n.id];let Lr=vi.texture;if(n.gradientVersion!==vi.version){let en=256;if(n.stepInterpolant){const Vr=t.getSource().maxzoom,gr=Et.canonical.z===Vr?Math.ceil(1<<l.transform.maxZoom-Et.canonical.z):1;en=o.aA(o.e6(di.maxLineLength/o.al*1024*gr),256,z.maxTextureSize)}vi.gradient=o.e7({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:en,image:vi.gradient||void 0,clips:di.lineClipsArray}),vi.texture?vi.texture.update(vi.gradient):vi.texture=new o.T(z,vi.gradient,B.RGBA8),vi.version=n.gradientVersion,Lr=vi.texture}z.activeTexture.set(B.TEXTURE1),Lr.bind(n.stepInterpolant?B.NEAREST:B.LINEAR,B.CLAMP_TO_EDGE)}ne&&(z.activeTexture.set(B.TEXTURE0),$t.lineAtlasTexture&&$t.lineAtlasTexture.bind(B.LINEAR,B.REPEAT),ui.updatePaintBuffers()),be&&(z.activeTexture.set(B.TEXTURE0),$t.imageAtlasTexture&&$t.imageAtlasTexture.bind(B.LINEAR,B.CLAMP_TO_EDGE),ui.updatePaintBuffers()),Dt&&!L&&l.terrain.setupElevationDraw($t,ar),l.uploadCommonUniforms(z,ar,Et.toUnwrapped());const ji=vi=>{Fe!=null&&(Fe.value=Le*b),ar.draw(l,B.TRIANGLES,nt,vi,Z,si.disabled,ir,n.id,di.layoutVertexBuffer,di.indexBuffer,di.segments,n.paint,l.transform.zoom,ui,[di.layoutVertexBuffer2,di.patternVertexBuffer,di.zOffsetVertexBuffer]),Fe!=null&&(Fe.value=Le)};if(Ue&&!Dt){const vi=l.stencilModeForClipping(Et).ref;vi===0&&Y&&z.clear({stencil:0});const Lr={func:B.EQUAL,mask:255};ir.u_alpha_discard_threshold=.8,ji(new oi(Lr,vi,255,B.KEEP,B.KEEP,B.INVERT)),ir.u_alpha_discard_threshold=0,ji(new oi(Lr,vi,255,B.KEEP,B.KEEP,B.KEEP))}else ir.u_alpha_discard_threshold=Ue&&Dt&&xt?.8:0,ji(Dt?kt:l.stencilModeForClipping(Et))}};let We=l.depthModeForSublayer(0,Bt.ReadOnly);const dt=new Bt(l.depthOcclusion?B.GREATER:B.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D);if(n.hasNonElevatedBuckets){const Tt=!Y&&l.terrain;b!==0&&Tt?o.w(`Occlusion opacity for layer ${n.id} is supported on terrain only if the layer has line-z-offset enabled.`):Tt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${n.id}.`):Pe(c,_e,We,oi.disabled,!1,!0)}if(n.hasElevatedBuckets){E==="hd-road-markup"?D||(We=dt,_e.push("ELEVATED_ROADS")):(_e.push("ELEVATED"),We=dt,H&&_e.push(G?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),L&&_e.push("ELEVATION_REFERENCE_SEA"));const Tt=Ue?l.stencilModeFor3D():oi.disabled;l.forceTerrainMode=!0,Pe(c,_e,We,Tt,!0,!0),Ue&&Pe(c,_e,We,Tt,!0,!1),l.forceTerrainMode=!1}Ue&&(l.resetStencilClippingMasks(),Y&&z.clear({stencil:0})),b===0||l.depthOcclusion||Y||l.layersWithOcclusionOpacity.push(l.currentLayer)},fill:function(l,t,n,c){const d=n.paint.get("fill-color"),m=n.paint.get("fill-opacity");if(m.constantOr(1)===0)return;const _=n.paint.get("fill-emissive-strength"),x=l.colorModeForDrapableLayerRenderPass(_),b=n.paint.get("fill-pattern"),E=l.opaquePassEnabledForLayer()&&!b.constantOr(1)&&d.constantOr(o.ao.transparent).a===1&&m.constantOr(0)===1?"opaque":"translucent";let I="none";n.layout.get("fill-elevation-reference")!=="none"?I="road":n.paint.get("fill-z-offset").constantOr(1)!==0&&(I="offset");const L=!(!l.terrain||!l.terrain.enabled),D={painter:l,sourceCache:t,layer:n,coords:c,colorMode:x,elevationType:I,terrainEnabled:L,pass:E};if(l.renderPass==="shadow")return void(l.shadowRenderer&&I==="road"&&!L&&function(B){const{painter:F,sourceCache:H,layer:G,coords:Z}=B,Y=F.context.gl,X=B.painter.shadowRenderer;for(const ce of Z){const ne=H.getTile(ce),ae=ne.getBucket(G);if(!ae)continue;const re=ae.elevatedStructures;if(!re||!re.shadowCasterSegments||re.shadowCasterSegments.segments[0].primitiveLength===0)continue;F.prepareDrawTile();const ee=ae.bufferData.programConfigurations.get(G.id),ue=F.isTileAffectedByFog(ce),be=F.getOrCreateProgram("elevatedStructuresDepth",{config:ee,overrideFog:ue}),xe=X.calculateShadowPassMatrixFromTile(ne.tileID.toUnwrapped());F.uploadCommonUniforms(F.context,be,ce.toUnwrapped());const De={u_matrix:xe,u_depth_bias:0};be.draw(F,Y.TRIANGLES,X.getShadowPassDepthMode(),oi.disabled,X.getShadowPassColorMode(),si.disabled,De,G.id,re.vertexBuffer,re.indexBuffer,re.shadowCasterSegments,G.paint,F.transform.zoom,ee)}}(D));const z=l.emissiveMode==="mrt-fallback";if(I!=="offset"){if(Ah(D,!1,z),I==="road"){const B=!L&&l.renderPass==="translucent";B&&Eh(l,t,n,c,"geometry"),Ah(D,!0,z,oi.disabled),B&&function(F){const{painter:H,sourceCache:G,layer:Z,coords:Y,colorMode:X}=F,ce=H.context.gl,ne=F.painter.shadowRenderer,ae=!!ne&&ne.enabled,re=new Bt(H.context.gl.LEQUAL,Bt.ReadOnly,H.depthRangeFor3D);let ee=[0,0,0];if(ae){const be=H.style.directionalLight,xe=H.style.ambientLight;be&&xe&&(ee=na(H.style,be,xe))}const ue=be=>{for(const xe of Y){const De=G.getTile(xe),Le=De.getBucket(Z);if(!Le)continue;const Ue=Le.elevatedStructures;if(!Ue)continue;let it,Ce;if(be?(it=Ue.renderableBridgeSegments,Ce=Ue.bridgeProgramConfigurations.get(Z.id)):(it=Ue.renderableTunnelSegments,Ce=Ue.tunnelProgramConfigurations.get(Z.id)),!it||it.segments[0].primitiveLength===0)continue;Ce.updatePaintBuffers(),H.prepareDrawTile();const _e=H.isTileAffectedByFog(xe),Fe=[];ae&&Fe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Pe=H.getOrCreateProgram("elevatedStructures",{config:Ce,overrideFog:_e,defines:Fe}),We=H.translatePosMatrix(xe.projMatrix,De,Z.paint.get("fill-translate"),Z.paint.get("fill-translate-anchor"));ae&&ne.setupShadows(De.tileID.toUnwrapped(),Pe,"vector-tile");const dt=Va(We,ee);H.uploadCommonUniforms(H.context,Pe,xe.toUnwrapped()),Pe.draw(H,ce.TRIANGLES,re,oi.disabled,X,si.backCCW,dt,Z.id,Ue.vertexBuffer,Ue.indexBuffer,it,Z.paint,H.transform.zoom,Ce,[Ue.vertexBufferNormal])}};ue(!0),ue(!1)}(D)}}else Ah(D,!1,z,l.stencilModeFor3D())},"fill-extrusion":function(l,t,n,c){const d=n.paint.get("fill-extrusion-opacity"),m=l.context,_=m.gl,x=l.terrain,b=x&&x.renderingToTexture;if(d===0)return;const E=l.emissiveMode==="mrt-fallback",I=l.conflationActive&&l.style.isLayerClipped(n,t.getSource()),L=l.style.order.indexOf(n.fqid);if(I&&function(D,z,B,F,H){for(const G of F){const Z=z.getTile(G).getBucket(B);Z&&(Z.updateReplacement(G,D.replacementSource,H),Z.uploadCentroid(D.context))}}(l,t,n,c,L),x||I)for(const D of c){const z=t.getTile(D).getBucket(n);z&&vy(l.context,t,D,z,n,x,I)}if(l.renderPass==="shadow"&&l.shadowRenderer){const D=l.shadowRenderer;if(x&&d<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const z=D.getShadowPassDepthMode(),B=D.getShadowPassColorMode();Ih(l,t,n,c,z,oi.disabled,B,I)}else if(l.renderPass==="translucent"){const D=!n.paint.get("fill-extrusion-pattern").constantOr(1),z=n.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!b&&z.a!==0){const B=new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D);d===1&&D?Ih(l,t,n,c,B,oi.disabled,gi.unblended,I):(Ih(l,t,n,c,B,oi.disabled,gi.disabled,I),Ih(l,t,n,c,B,l.stencilModeFor3D(),l.colorModeForRenderPass(),I),l.resetStencilClippingMasks())}if(l.style.enable3dLights()&&D&&(!x&&l.transform.projection.name!=="globe"||b)){const B=n.paint.get("fill-extrusion-opacity"),F=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),H=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),G=n.paint.get("fill-extrusion-flood-light-intensity"),Z=n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Y=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Z?null:n.lut).toArray01().slice(0,3),X=F>0&&H>0,ce=G>0,ne=(ee,ue,be)=>(1-be)*ee+be*ue,ae=new Ef;ae.translate=n.paint.get("fill-extrusion-translate"),ae.translateAnchor=n.paint.get("fill-extrusion-translate-anchor"),ae.edgeRadius=n.layout.get("fill-extrusion-edge-radius"),ae.cutoffFadeRange=n.paint.get("fill-extrusion-cutoff-fade-range");const re=ee=>{const ue=l.depthModeForSublayer(1,Bt.ReadOnly,_.LEQUAL,!0),be=n.paint.get(ee?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),xe=ne(.1,3,be),De=l._showOverdrawInspector;if(!De){const Le=new oi({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),Ue=new gi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!1,!1,!1,!0],_.MIN);aa(ae,l,t,n,c,ue,Le,Ue,si.disabled,ee,"sdf",B,F,H,G,Y,xe,I,!1)}{const Le=De?oi.disabled:new oi({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),Ue=De?l.colorModeForRenderPass():new gi([_.ONE_MINUS_DST_ALPHA,_.DST_ALPHA,_.ONE,_.ONE],o.ao.transparent,[!0,!0,!0,!0]);aa(ae,l,t,n,c,ue,Le,Ue,si.disabled,ee,"color",B,F,H,G,Y,xe,I,!1)}};if(b){const ee=()=>{const be=x.drapeBufferSize[0],xe=x.drapeBufferSize[1];let De=x.framebufferCopyTexture;return De&&(!De||De.size[0]===be&&De.size[1]===xe)||(De&&De.destroy(),De=x.framebufferCopyTexture=new o.T(m,new o.q({width:be,height:xe}),_.RGBA8)),De.bind(_.LINEAR,_.CLAMP_TO_EDGE),_.copyTexSubImage2D(_.TEXTURE_2D,0,0,0,0,0,be,xe),De},ue=(be,xe,De)=>{const Le=l.depthModeForSublayer(1,Bt.ReadOnly,_.LEQUAL,!1),Ue=n.paint.get(be?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),it=ne(.1,3,Ue);{const Ce=new gi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!1,!1,!1,!0]);aa(ae,l,t,n,c,Le,oi.disabled,Ce,si.disabled,be,"clear",B,F,H,G,Y,it,I,xe)}{const Ce=new oi({func:_.ALWAYS,mask:255},255,255,_.KEEP,_.KEEP,_.REPLACE),_e=new gi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!1,!1,!1,!0],_.MIN);aa(ae,l,t,n,c,Le,Ce,_e,si.disabled,be,"sdf",B,F,H,G,Y,it,I,xe)}E&&!be&&(De=ee());{const Ce=be?_.ZERO:_.ONE_MINUS_DST_ALPHA,_e=new oi({func:_.EQUAL,mask:255},255,255,_.KEEP,_.DECR,_.DECR),Fe=new gi([Ce,_.DST_ALPHA,_.ONE_MINUS_DST_ALPHA,_.ZERO],o.ao.transparent,[!0,!0,!0,!0]);aa(ae,l,t,n,c,Le,_e,Fe,si.disabled,be,"color",B,F,H,G,Y,it,I,xe)}if(!E||be){const Ce=new gi([_.ONE,_.ONE,_.ONE,be?_.ZERO:_.ONE],o.ao.transparent,[!1,!1,!1,!0],be?_.FUNC_ADD:_.MAX);aa(ae,l,t,n,c,Le,oi.disabled,Ce,si.disabled,be,"clear",B,F,H,G,Y,it,I,xe,De)}else{_.drawBuffers([_.NONE,_.COLOR_ATTACHMENT1]);const Ce=new oi({func:_.EQUAL,mask:255},254,255,_.KEEP,_.DECR,_.DECR),_e=new gi([_.ONE,_.ONE,_.ONE,_.ONE],o.ao.transparent,[!0,!1,!1,!1],_.MAX);aa(ae,l,t,n,c,Le,Ce,_e,si.disabled,be,"emissive",B,F,H,G,Y,it,I,xe,De),_.drawBuffers([_.COLOR_ATTACHMENT0])}};if(X||ce){let be;l.prepareDrawTile(),E&&!X||(be=ee()),X&&ue(!0,!1,be),ce&&ue(!1,!0,be)}}else X&&re(!0),ce&&re(!1),(X||ce)&&l.resetStencilClippingMasks()}}},building:function(l,t,n,c){l.currentLayer<l.firstLightBeamLayer&&(l.firstLightBeamLayer=l.currentLayer);const d=n.paint.get("building-ambient-occlusion-ground-intensity"),m=n.paint.get("building-ambient-occlusion-ground-radius"),_=n.paint.get("building-ambient-occlusion-ground-attenuation"),x=n.paint.get("building-opacity");if(x<=0)return;let b=d>0&&m>0,E=!0;const I=n.paint.get("building-vertical-scale");if(I<=0)return;l.shadowRenderer||(E=!1);const L=l.conflationActive&&l.style.isLayerClipped(n,t.getSource()),D=l.style.order.indexOf(n.fqid);if(function(z,B,F,H,G,Z){for(const Y of Z){const X=B.getTile(Y).getBucket(F);X&&(G&&X.updateReplacement(Y,z.replacementSource,H),X.uploadUpdatedIndexBuffer(z.context))}}(l,t,n,D,L,c),function(z,B,F,H){for(const G of H){const Z=B.getTile(G).getBucket(F);Z&&Z.needsEvaluation()&&Z.uploadUpdatedColorBuffer(z.context)}}(l,t,n,c),n.resetLayerRenderingStats(l),l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!0),l.renderPass==="shadow"&&l.shadowRenderer){const z=l.shadowRenderer,B=[],F=z.getShadowPassDepthMode();ou({painter:l,source:t,layer:n,coords:c,defines:B,blendMode:z.getShadowPassColorMode(),depthMode:F,opacity:x,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(l.renderPass==="translucent"){let z=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];E&&(z=z.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),l.shadowRenderer&&l.shadowRenderer.useNormalOffset&&(z=z.concat("NORMAL_OFFSET"));const B=n.paint.get("building-facade-emissive-chance"),F=n.paint.get("building-ambient-occlusion-intensity"),H=n.paint.get("building-flood-light-intensity"),G=n.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",Z=n.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(G?null:n.lut).toArray01().slice(0,3),Y=n.paint.get("building-flood-light-ground-attenuation"),X=H>0,ce=new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D);x<1&&ou({painter:l,source:t,layer:n,coords:c,defines:z,blendMode:gi.disabled,depthMode:ce,opacity:x,verticalScale:I,facadeEmissiveChance:B,facadeAOIntensity:F,floodLightIntensity:H,floodLightColor:Z,depthOnly:!0});const ne=l.colorModeForRenderPass();ou({painter:l,source:t,layer:n,coords:c,defines:z,blendMode:ne,depthMode:ce,opacity:x,verticalScale:I,facadeEmissiveChance:B,facadeAOIntensity:F,floodLightIntensity:H,floodLightColor:Z}),b&&Ch(l,t,n,c,!0,x,d,m,H,Z,_,L),X&&Ch(l,t,n,c,!1,x,d,m,H,Z,Y,L)}else if(l.renderPass==="light-beam"){const z=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],B=new Bt(l.context.gl.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D);ou({painter:l,source:t,layer:n,coords:c,defines:z,blendMode:gi.alphaBlended,depthMode:B,opacity:x,verticalScale:I,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}l.shadowRenderer&&(l.shadowRenderer.useNormalOffset=!1),l.resetStencilClippingMasks()},hillshade:function(l,t,n,c){if(l.renderPass!=="offscreen"&&l.renderPass!=="translucent"||l.style.disableElevatedTerrain)return;const d=l.context,m=l.terrain&&l.terrain.renderingToTexture,[_,x]=l.renderPass!=="translucent"||m?[{},c]:l.stencilConfigForOverlap(c);for(const b of x){const E=t.getTile(b);if(E.needsHillshadePrepare&&l.renderPass==="offscreen")uy(l,E,n);else if(l.renderPass==="translucent"){const I=l.depthModeForSublayer(0,Bt.ReadOnly),L=n.paint.get("hillshade-emissive-strength"),D=l.colorModeForDrapableLayerRenderPass(L),z=m&&l.terrain?l.terrain.stencilModeForRTTOverlap(b):_[b.overscaledZ];cy(l,b,E,n,I,z,D)}}d.viewport.set([0,0,l.width,l.height]),l.resetStencilClippingMasks()},raster:function(l,t,n,c,d,m){if(l.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;const _=l.transform.projection.name==="globe",x=n.paint.get("raster-elevation")!==0,b=x&&_;if(l.renderElevatedRasterBackface&&!b)return;const E=l.context,I=E.gl,L=t.getSource(),D=function(ne,ae,re,ee,ue){const be=ae.paint.get("raster-color"),xe=ne.type==="raster-array",De=[],Le=ae.paint.get("raster-resampling"),Ue=ae.paint.get("raster-color-mix");let it=ae.paint.get("raster-color-range");const Ce=[Ue[0],Ue[1],Ue[2],0],_e=Ue[3];let Fe=Le==="nearest"?ee.NEAREST:ee.LINEAR;if(xe&&(De.push("RASTER_ARRAY"),be||De.push("RASTER_COLOR"),Le==="linear"&&De.push("RASTER_ARRAY_LINEAR"),Fe=ee.NEAREST,!it&&ne.rasterLayers)){const Pe=ne.rasterLayers.find(({id:We})=>We===ae.sourceLayer);Pe&&Pe.fields&&Pe.fields.range&&(it=Pe.fields.range)}if(it=it||[0,1],be){De.push("RASTER_COLOR"),re.activeTexture.set(ee.TEXTURE2),ae.updateColorRamp(it);let Pe=ae.colorRampTexture;Pe||(Pe=ae.colorRampTexture=new o.T(re,ae.colorRamp,ee.RGBA8)),Pe.bind(ee.LINEAR,ee.CLAMP_TO_EDGE)}return ue&&De.push("USE_MRT1"),{mix:Ce,range:it,offset:_e,defines:De,resampling:Fe}}(L,n,E,I,l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback");if(L instanceof o.aU&&!c.length&&!_)return;const z=n.paint.get("raster-emissive-strength"),B=l.colorModeForDrapableLayerRenderPass(z),F=l.terrain&&l.terrain.renderingToTexture,H=!l.options.moving,G=n.paint.get("raster-resampling")==="nearest"?I.NEAREST:I.LINEAR;if(L instanceof o.aU&&!c.length&&(L.onNorthPole||L.onSouthPole)){const ne=x?l.stencilModeFor3D():oi.disabled;return void au(!!L.onNorthPole,null,l,t,n,z,D,si.disabled,ne)}if(!c.length)return;const[Z,Y]=L instanceof o.aU||F?[{},c]:l.stencilConfigForOverlap(c),X=Y[Y.length-1].overscaledZ;b&&D.defines.push("PROJECTION_GLOBE_VIEW"),x&&D.defines.push("RENDER_CUTOFF");const ce=(ne,ae,re)=>{for(const ee of ne){const ue=ee.toUnwrapped(),be=t.getTile(ee);if(F&&(!be||!be.hasData()))continue;E.activeTexture.set(I.TEXTURE0);const xe=ca(be,L,n,D);if(!xe||!xe.texture)continue;const{texture:De,mix:Le,offset:Ue,tileSize:it,buffer:Ce}=xe;let _e,Fe;F?(_e=Bt.disabled,Fe=ee.projMatrix):x?(_e=new Bt(I.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D),Fe=_?Float32Array.from(l.transform.expandedFarZProjMatrix):l.transform.calculateProjMatrix(ue,H)):(_e=l.depthModeForSublayer(ee.overscaledZ-X,n.paint.get("raster-opacity")===1?Bt.ReadWrite:Bt.ReadOnly,I.LESS),Fe=l.transform.calculateProjMatrix(ue,H));const Pe=l.terrain&&F?l.terrain.stencilModeForRTTOverlap(ee):Z[ee.overscaledZ],We=m?0:n.paint.get("raster-fade-duration");be.registerFadeDuration(We);const dt=t.findLoadedParent(ee,0),Tt=tu(be,dt,t,l.transform,We);let ct,nt;!Tt.isFading&&be.refreshedUponExpiration&&(be.refreshedUponExpiration=!1),l.terrain&&l.terrain.prepareDrawTile(),E.activeTexture.set(I.TEXTURE0),De.bind(G,I.CLAMP_TO_EDGE),E.activeTexture.set(I.TEXTURE1),dt?(dt.texture&&dt.texture.bind(G,I.CLAMP_TO_EDGE),ct=Math.pow(2,dt.tileID.overscaledZ-be.tileID.overscaledZ),nt=[be.tileID.canonical.x*ct%1,be.tileID.canonical.y*ct%1]):De.bind(G,I.CLAMP_TO_EDGE),"useMipmap"in De&&E.extTextureFilterAnisotropic&&l.transform.pitch>20&&I.texParameterf(I.TEXTURE_2D,E.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,E.extTextureFilterAnisotropicMax);const kt=l.transform;let Dt;const xt=x?Wm(kt):[0,0,0,0];let Et,$t,di,Ri,Yi,Ft=0;if(b&&L instanceof o.aU&&L.coordinates.length>3)Et=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0)))),$t=Float32Array.from(kt.globeMatrix),di=Float32Array.from(o.dF(kt)),Ri=[o.aF(kt.center.lng),o.aJ(kt.center.lat)],Dt=L.elevatedGlobePerspectiveTransform,Yi=L.elevatedGlobeGridMatrix||new Float32Array(9);else if(b){const hr=o.dG(ee.canonical);Ft=o.dH(hr.getCenter().lat),Et=Float32Array.from(o.bk(o.dJ(ee.canonical))),$t=Float32Array.from(kt.globeMatrix),di=Float32Array.from(o.dF(kt)),Ri=[o.aF(kt.center.lng),o.aJ(kt.center.lat)],Dt=[0,0],Yi=Float32Array.from(o.dI(ee.canonical,hr,Ft,kt.worldSize/kt._pixelsPerMercatorPixel))}else Dt=L instanceof o.aU?L.perspectiveTransform:[0,0],Et=new Float32Array(16),$t=new Float32Array(9),di=new Float32Array(16),Ri=[0,0],Yi=new Float32Array(9);const Zi=Vm(Fe,Et,$t,di,Yi,nt||[0,0],o.aj(l.transform.zoom),Ri,xt,ct||1,Tt,n,Dt,x?n.paint.get("raster-elevation"):0,2,Le,Ue,D.range,it,Ce,z),ui=l.isTileAffectedByFog(ee),tr=l.getOrCreateProgram("raster",{defines:D.defines,overrideFog:ui});if(l.uploadCommonUniforms(E,tr,ue),L instanceof o.aU){const hr=L.elevatedGlobeVertexBuffer,ar=L.elevatedGlobeIndexBuffer;if(F||!_)L.boundsBuffer&&L.boundsSegments&&tr.draw(l,I.TRIANGLES,_e,oi.disabled,B,si.disabled,Zi,n.id,L.boundsBuffer,l.quadTriangleIndexBuffer,L.boundsSegments);else if(hr&&ar){const $i=kt.zoom<=o.c_?L.elevatedGlobeSegments:L.getSegmentsForLongitude(kt.center.lng);$i&&tr.draw(l,I.TRIANGLES,_e,oi.disabled,B,ae,Zi,n.id,hr,ar,$i)}}else if(b){_e=new Bt(I.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D);const hr=l.globeSharedBuffers;if(hr){const[ar,$i,xi]=hr.getGridBuffers(Ft,!1);tr.draw(l,I.TRIANGLES,_e,re||Pe,l.colorModeForRenderPass(),ae,Zi,n.id,ar,$i,xi)}}else{const{tileBoundsBuffer:hr,tileBoundsIndexBuffer:ar,tileBoundsSegments:$i}=l.getTileBoundsBuffers(be);tr.draw(l,I.TRIANGLES,_e,Pe,B,si.disabled,Zi,n.id,hr,ar,$i)}}if(!(L instanceof o.aU)&&b)for(const ee of ne){const ue=ee.canonical.y===(1<<ee.canonical.z)-1;ee.canonical.y===0&&au(!0,ee,l,t,n,z,D,ae,re||oi.disabled),ue&&au(!1,ee,l,t,n,z,D,ae===si.frontCW?si.backCW:si.frontCW,re||oi.disabled)}};b?ce(Y,l.renderElevatedRasterBackface?si.backCW:si.frontCW,l.stencilModeFor3D()):ce(Y,si.disabled,void 0),l.resetStencilClippingMasks()},"raster-particle":function(l,t,n,c,d,m){l.renderPass==="offscreen"&&function(_,x,b,E){if(!E.length)return;const I=_.context,L=I.gl,D=x.getSource();if(!(D instanceof hs))return;const z=Math.ceil(Math.sqrt(b.paint.get("raster-particle-count")));let B=b.particlePositionRGBAImage;if(!B||B.width!==z){const Y=function(X){const ce=X*X,ne=new Uint8Array(4*ce),ae=function(ee){return ee|=0,ee=Math.imul(2747636419^ee,2654435769),ee=Math.imul(ee^ee>>>16,2654435769),((ee=Math.imul(ee^ee>>>16,2654435769))>>>0)/4294967296},re=1/1.1;for(let ee=0;ee<ce;ee++){const ue=re*(ae(2*ee+0)+Uo),be=re*(ae(2*ee+1)+Uo),xe=255*ue%1,De=255*be%1,Le=xe,Ue=be-De/255,it=De;ne[4*ee+0]=255*(ue-xe/255),ne[4*ee+1]=255*Le,ne[4*ee+2]=255*Ue,ne[4*ee+3]=255*it}return ne}(z);B=b.particlePositionRGBAImage=new o.q({width:z,height:z},Y)}let F=b.particleFramebuffer;F?F.width!==z&&(F.destroy(),F=b.particleFramebuffer=I.createFramebuffer(z,z,1,null)):F=b.particleFramebuffer=I.createFramebuffer(z,z,1,null);const H=[];for(const Y of E){const X=x.getTile(Y);if(!(X instanceof ju))continue;const ce=If(X,D,b);if(!ce)continue;const ne=[X.tileSize,X.tileSize];let ae=b.tileFramebuffer;ae||(ae=b.tileFramebuffer=I.createFramebuffer(ne[0],ne[1],1,null));let re=X.rasterParticleState;re||(re=X.rasterParticleState=new Mh(I,Y,ne,B));const ee=re.update(b.lastInvalidatedAt);re.particleTextureDimension!==z&&re.updateParticleTexture(Y,B);const ue=re.targetColorTexture;re.targetColorTexture=re.backgroundColorTexture,re.backgroundColorTexture=ue;const be=re.particleTexture0;re.particleTexture0=re.particleTexture1,re.particleTexture1=be,H.push([Y,ce,re,ee])}if(H.length===0)return;const G=o.o.now(),Z=b.previousDrawTimestamp?.001*(G-b.previousDrawTimestamp):.0167;if(b.previousDrawTimestamp=G,b.hasColorMap()){I.activeTexture.set(L.TEXTURE0+2);let Y=b.colorRampTexture;Y||(Y=b.colorRampTexture=new o.T(I,b.colorRamp,L.RGBA8)),Y.bind(L.LINEAR,L.CLAMP_TO_EDGE)}I.bindFramebuffer.set(b.tileFramebuffer.framebuffer),function(Y,X,ce){const ne=Y.context,ae=ne.gl,re=X.tileFramebuffer;ne.activeTexture.set(ae.TEXTURE0);const ee={u_texture:0,u_opacity:1.05*(be=X.paint.get("raster-particle-fade-opacity-factor"))/(be+.05)},ue=Y.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var be;for(const xe of ce){const[,,De,Le]=xe;re.colorAttachment0.set(De.targetColorTexture.texture),ne.viewport.set([0,0,re.width,re.height]),ne.clear({color:o.ao.transparent}),Le&&(De.backgroundColorTexture.bind(ae.NEAREST,ae.CLAMP_TO_EDGE),ue.draw(Y,ae.TRIANGLES,Bt.disabled,oi.disabled,gi.alphaBlended,si.disabled,ee,X.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments))}}(_,b,H),function(Y,X,ce,ne){const ae=Y.context,re=ae.gl,ee=ce.tileFramebuffer,ue=Y.transform.projection.name==="globe",be=ce.paint.get("raster-particle-max-speed");for(const xe of ne){const[De,Le,Ue]=xe;ae.activeTexture.set(re.TEXTURE0+0),Le.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE),ee.colorAttachment0.set(Ue.targetColorTexture.texture);const it=Y.getOrCreateProgram("rasterParticleDraw",{defines:Le.defines,overrideFog:!1});ae.activeTexture.set(re.TEXTURE0+1);const Ce=Le.scalarData?[]:[0,1,2,3].map(Pe=>o.e9[Pe](De));Ce.push(De);const _e=De.canonical.x,Fe=De.canonical.y;for(const Pe of Ce){const We=X.getTile(ue?Pe.wrapped():Pe);if(!We)continue;const dt=We.rasterParticleState;if(!dt)continue;const Tt=Pe.canonical.x+(1<<Pe.canonical.z)*(Pe.wrap-De.wrap),ct=Pe.canonical.y;dt.particleTexture0.bind(re.NEAREST,re.CLAMP_TO_EDGE);const nt=xy(1,dt.particleTexture0.size[0],[Tt-_e,ct-Fe],0,Le.texture.size,2,be,Le.textureOffset,Le.scale,Le.offset);it.draw(Y,re.POINTS,Bt.disabled,oi.disabled,gi.alphaBlended,si.disabled,nt,ce.id,dt.particleIndexBuffer,void 0,dt.particleSegment)}}}(_,x,b,H),I.bindFramebuffer.set(b.particleFramebuffer.framebuffer),function(Y,X,ce,ne){const ae=Y.context,re=ae.gl,ee=X.paint.get("raster-particle-max-speed"),ue=ne*X.paint.get("raster-particle-speed-factor")*.15,be=function(De){return Math.pow(De,6)}(.01+1*X.paint.get("raster-particle-reset-rate-factor")),xe=X.particleFramebuffer;ae.viewport.set([0,0,xe.width,xe.height]);for(const De of ce){const[,Le,Ue]=De;ae.activeTexture.set(re.TEXTURE0+0),Le.texture.bind(re.LINEAR,re.CLAMP_TO_EDGE),ae.activeTexture.set(re.TEXTURE0+1);const it=Ue.particleTexture0;it.bind(re.NEAREST,re.CLAMP_TO_EDGE);const Ce=jm(1,it.size[0],0,Le.texture.size,ee,ue,be,Le.textureOffset,Le.scale,Le.offset);xe.colorAttachment0.set(Ue.particleTexture1.texture),ae.clear({color:o.ao.transparent}),Y.getOrCreateProgram("rasterParticleUpdate",{defines:Le.defines}).draw(Y,re.TRIANGLES,Bt.disabled,oi.disabled,gi.unblended,si.disabled,Ce,X.id,Y.viewportBuffer,Y.quadTriangleIndexBuffer,Y.viewportSegments)}}(_,b,H,Z)}(l,t,n,c),l.renderPass==="translucent"&&(function(_,x,b,E,I){const L=_.context,D=L.gl,z=x.getSource().tileSize,B=5*(1-o.ah(o.cL,o.cL+1,_.transform.zoom))*z+b.paint.get("raster-particle-elevation"),F=!_.options.moving,H=_.transform.projection.name==="globe";if(!E.length)return;const[G,Z]=_.stencilConfigForOverlap(E),Y=[];H&&Y.push("PROJECTION_GLOBE_VIEW");const X=_.stencilModeFor3D();for(const ce of Z){const ne=ce.toUnwrapped(),ae=x.getTile(ce);if(!ae.rasterParticleState)continue;const re=ae.rasterParticleState,ee=100;ae.registerFadeDuration(ee);const ue=x.findLoadedParent(ce,0),be=tu(ae,ue,x,_.transform,ee);let xe,De;_.terrain&&_.terrain.prepareDrawTile(),L.activeTexture.set(D.TEXTURE0),re.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),L.activeTexture.set(D.TEXTURE1),ue&&ue.rasterParticleState?(ue.rasterParticleState.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),xe=Math.pow(2,ue.tileID.overscaledZ-ae.tileID.overscaledZ),De=[ae.tileID.canonical.x*xe%1,ae.tileID.canonical.y*xe%1]):re.targetColorTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const Le=H?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(ne,F),Ue=_.transform,it=Zm(Ue),Ce=o.dG(ce.canonical),_e=o.dH(Ce.getCenter().lat);let Fe,Pe,We,dt,Tt;H?(Fe=Float32Array.from(o.bk(o.dJ(ce.canonical))),Pe=Float32Array.from(Ue.globeMatrix),We=Float32Array.from(o.dF(Ue)),dt=[o.aF(Ue.center.lng),o.aJ(Ue.center.lat)],Tt=Float32Array.from(o.dI(ce.canonical,Ce,_e,Ue.worldSize/Ue._pixelsPerMercatorPixel))):(Fe=new Float32Array(16),Pe=new Float32Array(9),We=new Float32Array(16),dt=[0,0],Tt=new Float32Array(9));const ct=yy(Le,Fe,Pe,We,Tt,De||[0,0],o.aj(_.transform.zoom),dt,it,xe||1,be,B),nt=_.isTileAffectedByFog(ce),kt=_.getOrCreateProgram("rasterParticle",{defines:Y,overrideFog:nt});if(_.uploadCommonUniforms(L,kt,ne),H){const Dt=new Bt(D.LEQUAL,Bt.ReadOnly,_.depthRangeFor3D),xt=0,Et=_.globeSharedBuffers;if(Et){const[$t,di,Ri]=Et.getGridBuffers(_e,xt!==0);kt.draw(_,D.TRIANGLES,Dt,X,gi.alphaBlended,_.renderElevatedRasterBackface?si.frontCCW:si.backCCW,ct,b.id,$t,di,Ri)}}else{const Dt=_.depthModeForSublayer(0,Bt.ReadOnly),xt=G[ce.overscaledZ],{tileBoundsBuffer:Et,tileBoundsIndexBuffer:$t,tileBoundsSegments:di}=_.getTileBoundsBuffers(ae);kt.draw(_,D.TRIANGLES,Dt,xt,gi.alphaBlended,si.disabled,ct,b.id,Et,$t,di)}}_.resetStencilClippingMasks()}(l,t,n,c),l.style.map.triggerRepaint())},background:function(l,t,n,c){const d=n.paint.get("background-color"),m=n.paint.get("background-color-use-theme").constantOr("default")==="none",_=n.paint.get("background-opacity"),x=n.paint.get("background-emissive-strength"),b=n.paint.get("background-pitch-alignment")==="viewport";if(_===0)return;const E=l.context,I=E.gl,L=l.transform,D=L.tileSize,z=n.paint.get("background-pattern");let B;if(z!==void 0&&(z===null||(B=l.imageManager.getPattern(o.I.from(z.toString()),n.scope,l.style.getLut(n.scope)),!B)))return;const F=!z&&d.a===1&&_===1&&l.opaquePassEnabledForLayer()?"opaque":"translucent";if(l.renderPass!==F)return;const H=oi.disabled,G=l.depthModeForSublayer(0,F==="opaque"?Bt.ReadWrite:Bt.ReadOnly),Z=l.colorModeForDrapableLayerRenderPass(x),Y=z?"backgroundPattern":"background";let X,ce=c;ce||(X=l.getBackgroundTiles(),ce=Object.values(X).map(ae=>ae.tileID)),z&&(E.activeTexture.set(I.TEXTURE0),l.imageManager.bind(l.context,n.scope));const ne=[];if(l.terrain&&l.terrain.renderingToTexture&&l.emissiveMode==="mrt-fallback"&&ne.push("USE_MRT1"),b){const ae=l.getOrCreateProgram(Y,{overrideFog:!1,overrideRtt:!0,defines:ne}),re=new Float32Array(o.bA([])),ee=new o.aQ(0,0,0,0,0),ue=z?ja(re,x,_,l,0,n.scope,B,b,{tileID:ee,tileSize:D}):ru(re,x,_,d.toPremultipliedRenderColor(m?null:n.lut));ae.draw(l,I.TRIANGLES,G,H,Z,si.disabled,ue,n.id,l.viewportBuffer,l.quadTriangleIndexBuffer,l.viewportSegments)}else for(const ae of ce){const re=l.isTileAffectedByFog(ae),ee=l.getOrCreateProgram(Y,{overrideFog:re,defines:ne}),ue=ae.toUnwrapped(),be=c?ae.projMatrix:l.transform.calculateProjMatrix(ue);l.prepareDrawTile();const xe=t?t.getTile(ae):X?X[ae.key]:new dl(ae,D,L.zoom,l),De=z?ja(be,x,_,l,0,n.scope,B,b,{tileID:ae,tileSize:D}):ru(be,x,_,d.toPremultipliedRenderColor(m?null:n.lut));l.uploadCommonUniforms(E,ee,ue);const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:Ue,tileBoundsSegments:it}=l.getTileBoundsBuffers(xe);ee.draw(l,I.TRIANGLES,G,H,Z,si.disabled,De,n.id,Le,Ue,it)}},sky:function(l,t,n){const c=l._atmosphere?o.aj(l.transform.zoom):1,d=n.paint.get("sky-opacity")*c;if(d===0)return;const m=l.context,_=n.paint.get("sky-type"),x=new Bt(m.gl.LEQUAL,Bt.ReadOnly,[0,1]),b=l.frameCounter/1e3%1;_==="atmosphere"?l.renderPass==="offscreen"?n.needsSkyboxCapture(l)&&(function(E,I,L,D){const z=E.context,B=z.gl;let F=I.skyboxFbo;if(!F){F=I.skyboxFbo=z.createFramebuffer(32,32,1,null),I.skyboxGeometry=new Dh(z),I.skyboxTexture=z.gl.createTexture(),B.bindTexture(B.TEXTURE_CUBE_MAP,I.skyboxTexture),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_S,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_WRAP_T,B.CLAMP_TO_EDGE),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MIN_FILTER,B.LINEAR),B.texParameteri(B.TEXTURE_CUBE_MAP,B.TEXTURE_MAG_FILTER,B.LINEAR);for(let Y=0;Y<6;++Y)B.texImage2D(B.TEXTURE_CUBE_MAP_POSITIVE_X+Y,0,B.RGBA,32,32,0,B.RGBA,B.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(F.framebuffer),z.viewport.set([0,0,32,32]);const H=I.getCenter(E,!0),G=E.getOrCreateProgram("skyboxCapture"),Z=new Float64Array(16);o.bA(Z),o.en(Z,Z,.5*-Math.PI),El(E,I,G,Z,H,0),o.bA(Z),o.en(Z,Z,.5*Math.PI),El(E,I,G,Z,H,1),o.bA(Z),o.cU(Z,Z,.5*-Math.PI),El(E,I,G,Z,H,2),o.bA(Z),o.cU(Z,Z,.5*Math.PI),El(E,I,G,Z,H,3),o.bA(Z),El(E,I,G,Z,H,4),o.bA(Z),o.en(Z,Z,Math.PI),El(E,I,G,Z,H,5),z.viewport.set([0,0,E.width,E.height])}(l,n),n.markSkyboxValid(l)):l.renderPass==="sky"&&function(E,I,L,D,z){const B=E.context,F=B.gl,H=E.transform,G=E.getOrCreateProgram("skybox");B.activeTexture.set(F.TEXTURE0),F.bindTexture(F.TEXTURE_CUBE_MAP,I.skyboxTexture);const Z=((Y,X,ce,ne,ae)=>({u_matrix:Y,u_sun_direction:X,u_cubemap:0,u_opacity:ne,u_temporal_offset:ae}))(H.skyboxMatrix,I.getCenter(E,!1),0,D,z);E.uploadCommonUniforms(B,G),G.draw(E,F.TRIANGLES,L,oi.disabled,E.colorModeForRenderPass(),si.backCW,Z,"skybox",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(l,n,x,d,b):_==="gradient"&&l.renderPass==="sky"&&function(E,I,L,D,z){const B=E.context,F=B.gl,H=E.transform,G=E.getOrCreateProgram("skyboxGradient");I.skyboxGeometry||(I.skyboxGeometry=new Dh(B)),B.activeTexture.set(F.TEXTURE0);let Z=I.colorRampTexture;Z||(Z=I.colorRampTexture=new o.T(B,I.colorRamp,F.RGBA8)),Z.bind(F.LINEAR,F.CLAMP_TO_EDGE);const Y=((X,ce,ne,ae,re)=>({u_matrix:X,u_color_ramp:0,u_center_direction:ce,u_radius:o.an(ne),u_opacity:ae,u_temporal_offset:re}))(H.skyboxMatrix,I.getCenter(E,!1),I.paint.get("sky-gradient-radius"),D,z);E.uploadCommonUniforms(B,G),G.draw(E,F.TRIANGLES,L,oi.disabled,E.colorModeForRenderPass(),si.backCW,Y,"skyboxGradient",I.skyboxGeometry.vertexBuffer,I.skyboxGeometry.indexBuffer,I.skyboxGeometry.segment)}(l,n,x,d,b)},custom:function(l,t,n,c){const d=l.context,m=n.implementation;if(!l.transform.projection.unsupportedLayers||!l.transform.projection.unsupportedLayers.includes("custom")||l.terrain&&(l.terrain.renderingToTexture||l.renderPass==="offscreen")&&n.isDraped(t)){if(l.renderPass==="offscreen"){const _=m.prerender;if(_){if(l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),l.transform.projection.name==="globe"){const x=l.transform.pointMerc;_.call(m,d.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.aj(l.transform.zoom),[x.x,x.y],l.transform.pixelsPerMeterRatio)}else _.call(m,d.gl,l.transform.customLayerMatrix());d.setDirty(),l.setBaseState()}}else if(l.renderPass==="translucent"){if(l.terrain&&l.terrain.renderingToTexture){const x=m.renderToTile;if(x){const b=c[0].canonical,E={x:b.x+c[0].wrap*(m.wrapTileId?0:1<<b.z),y:b.y,z:b.z};d.setDepthMode(Bt.disabled),d.setStencilMode(oi.disabled),d.setColorMode(l.colorModeForRenderPass()),l.setCustomLayerDefaults(),x.call(m,d.gl,E),d.setDirty(),l.setBaseState()}return}l.setCustomLayerDefaults(),d.setColorMode(l.colorModeForRenderPass()),d.setStencilMode(oi.disabled);const _=m.renderingMode==="3d"?new Bt(l.context.gl.LEQUAL,Bt.ReadWrite,l.depthRangeFor3D):l.depthModeForSublayer(0,Bt.ReadOnly);if(d.setDepthMode(_),l.transform.projection.name==="globe"){const x=l.transform.pointMerc;m.render(d.gl,l.transform.customLayerMatrix(),l.transform.getProjection(),l.transform.globeToMercatorMatrix(),o.aj(l.transform.zoom),[x.x,x.y],l.transform.pixelsPerMeterRatio)}else m.render(d.gl,l.transform.customLayerMatrix());d.setDirty(),l.setBaseState(),d.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(l,t,n,c){if(l.renderPass==="opaque")return;const d=n.paint.get("model-opacity").constantOr(1),m=n.paint.get("model-elevation-reference"),_=m==="ground",x=m==="ground";if(d===0)return;const b=n.paint.get("model-cast-shadows");if(l.renderPass==="shadow"&&(!b||l.terrain&&d<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const E=l.shadowRenderer,I=n.paint.get("model-receive-shadows");E&&(E.useNormalOffset=!0,I||(E.enabled=!1));const L=()=>{E&&(E.useNormalOffset=!0,I||(E.enabled=!0))},D=t.getSource();if(l.renderPass==="light-beam"&&D.type!=="batched-model")return;if(D.type==="vector"||D.type==="geojson")return function(X,ce,ne,ae,re){const ee=X.transform,ue=ee.projection.name==="globe",be=ee.getFreeCameraOptions().position;if(!X.modelManager)return;const xe=X.modelManager;ne.modelManager=xe;const De=X.shadowRenderer;if(!ne._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Le=ne._unevaluatedLayout._values["model-id"],Ue=Object.assign({},ne.layout.get("model-id").parameters),it=X.style.order.indexOf(ne.fqid),Ce=ne.paint.get("model-opacity").constantOr(1);for(const _e of ae){const Fe=ce.getTile(_e).getBucket(ne);if(!Fe||Fe.projection.name!==ee.projection.name)continue;const Pe=Fe.getModelUris();if(Pe&&!Fe.modelsRequested&&(xe.addModelsFromBucket(Pe,re),Fe.modelsRequested=!0),ue)Ue.zoom=_e.overscaledZ;else{const xt=xs(_e,ee);Ue.zoom=xt}const We=Le.possiblyEvaluate(Ue);if(n_(X,Fe,_e),Go.shadowUniformsInitialized=!1,Go.useSingleShadowCascade=!!De&&De.getMaxCascadeForTile(_e.toUnwrapped())===0,X.renderPass==="shadow"&&De){if(X.currentShadowCascade===1&&Fe.isInsideFirstShadowMapFrustum)continue;const xt=ee.calculatePosMatrix(_e.toUnwrapped(),ee.worldSize);if(Go.tileMatrix.set(xt),Go.shadowTileMatrix=Float32Array.from(De.calculateShadowPassMatrixFromMatrix(xt)),Go.aabb.min=[0,0,0],Go.aabb.max[0]=Go.aabb.max[1]=o.al,Go.aabb.max[2]=0,Ty(Fe,Go,X,ne.scope))continue}const dt=1<<_e.canonical.z,Tt=[((be.x-_e.wrap)*dt-_e.canonical.x)*o.al,(be.y*dt-_e.canonical.y)*o.al,be.z*dt*o.al];X.conflationActive&&Object.keys(Fe.instancesPerModel).length>0&&X.style.isLayerClipped(ne,ce.getSource())&&Fe.updateReplacement(_e,X.replacementSource,it,ne.scope)&&(Fe.uploaded=!1,Fe.upload(X.context));let ct=0;const nt=new Array,kt=new Array,Dt=new Array;for(let xt in Fe.instancesPerModel){const Et=Fe.instancesPerModel[xt];Et.features.length>0&&!ue&&(xt=We.evaluate(Et.features[0].feature,{}));const $t=xe.getModel(xt,re);if($t||xe.hasURLBeenRequested(xt)||Fe.modelUris.includes(xt)||(Fe.modelUris.push(xt),Fe.modelsRequested=!1),$t&&$t.uploaded)if(ue){const di=o.c5([],[be.x,be.y,be.z],X.transform.worldSize);o.ew(di,di);for(let Ri=0;Ri<Et.instancedDataArray.length;++Ri){const Yi=[0,0,0],Ft=[1,1,1],Zi=o.ex(),ui=Et.tileCoordinatesForInstance(Ri),tr=Et.transformForInstance(Ri);o.ey(Ft,tr),o.ez(Zi,tr),o.eA(Yi,Zi);const hr=Et.translationForInstance(Ri),ar=new o.aT(0,0);o.eB(Fe.canonical,ar,ui.x,ui.y);const $i=o.bC();o.eC($i,$t,X.transform,ar,Yi,Ft,hr,!0,!1,!1);const xi=Et.colorForInstance(Ri),er=o.bA([]),$r=o.ef(ar.lat,X.transform.zoom),Or=o.bq([],[1,1,1/$r]);o.br(er,er,di),Dt.push({zScaleMatrix:Or,negCameraPosMatrix:er});for(const ir of $t.nodes)Al(X,ir,$i,X.transform.expandedFarZProjMatrix,ct,nt,kt,$t.materialOverrides,Ce,xi);++ct}}else for(const di of $t.nodes)s_(X,ne,di,Et,Tt,_e,Go)}if(ue)if(X.renderPass==="shadow"){for(const xt of kt)So(xt.mesh,xt.nodeModelMatrix,X,ne);for(const xt of nt)So(xt.mesh,xt.nodeModelMatrix,X,ne)}else r_(X,ne,nt,kt,Dt)}}(l,t,n,c,lu(l,n)),void L();if(!D.loaded())return;if(D.type==="batched-model")return function(X,ce,ne,ae){ne.resetLayerRenderingStats(X);const re=X.context,ee=X.transform,ue=X.style.fog,be=X.shadowRenderer;if(ee.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${ee.projection.name} projection is not yet implemented`);const xe=X.transform.getFreeCameraOptions().position,De=o.c5([],[xe.x,xe.y,xe.z],X.transform.worldSize),Le=o.ew([],De),Ue=o.bA([]),it=o.ef(ee.center.lat,ee.zoom),Ce=o.bq([],[1,1,1/it]);o.br(Ue,Ue,Le);const _e=ne.paint.get("model-opacity").constantOr(1),Fe=new Bt(re.gl.LEQUAL,Bt.ReadWrite,X.depthRangeFor3D),Pe=new Bt(re.gl.LEQUAL,Bt.ReadOnly,X.depthRangeFor3D),We=new o.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),dt=X.renderPass==="shadow",Tt=dt&&be?be.getCurrentCascadeFrustum():ee.getFrustum(ee.scaleZoom(ee.worldSize)),ct=ne.paint.get("model-front-cutoff"),nt=ct[2]<1,kt=za(X,ne.paint.get("model-cutoff-fade-range")),Dt=ne.getLayerRenderingStats();(function(xt,Et,$t,di){const Ri=xt.terrain?xt.terrain.exaggeration():0,Yi=xt.transform.zoom;for(const Ft of di){const Zi=Et.getTile(Ft).getBucket($t);Zi&&(Zi.setFilter($t.filter),xt.conflationActive&&Zi.updateReplacement(Ft,xt.replacementSource),Zi.evaluateTransform(xt,$t),xt.terrain&&Ri>0&&Zi.elevationUpdate(xt.terrain,Ri,Ft,$t.source),Zi.needsReEvaluation(xt,Yi,$t)&&Zi.evaluate($t))}})(X,ce,ne,ae),function(){let xt,Et,$t;nt?(xt=ae.length-1,Et=-1,$t=-1):(xt=0,Et=ae.length,$t=1);const di=new Float64Array(16),Ri=o.cA(),Yi=new o.P(0,0);for(let Ft=xt;Ft!==Et;Ft+=$t){const Zi=ae[Ft],ui=ce.getTile(Zi).getBucket(ne);if(!ui||!ui.uploaded)continue;let tr=!1;be&&(tr=be.getMaxCascadeForTile(Zi.toUnwrapped())===0);const hr=ee.calculatePosMatrix(Zi.toUnwrapped(),ee.worldSize),ar=ui.modelTraits;!dt&&nt&&(o.bl(di,hr),o.af(Ri,De,di),Yi.x=Ri[0],Yi.y=Ri[1]);const $i=[];ui.setFilter(ne.filter);for(const xi of ui.getNodesInfo()){if(xi.hiddenByReplacement||!xi.node.meshes)continue;const er=xi.node;let $r=0;X.terrain&&er.elevation&&($r=er.elevation*X.terrain.exaggeration());const Or=(()=>{const ss=xi.aabb;return We.min=[...ss.min],We.max=[...ss.max],We.min[2]+=$r,We.max[2]+=$r,o.af(We.min,We.min,hr),o.af(We.max,We.max,hr),We})(),ir=xi.evaluatedScale;if(ir[0]<=1&&ir[1]<=1&&ir[2]<=1&&Or.intersects(Tt)===0)continue;if(!dt&&nt){const ss=.16666666666666666;xi.cameraCollisionOpacity=De[0]>Or.min[0]&&De[0]<Or.max[0]&&De[1]>Or.min[1]&&De[1]<Or.max[1]&&De[2]*it<Or.max[2]&&er.footprint&&o.c0(Yi,er.footprint)?Math.max(xi.cameraCollisionOpacity-ss,0):Math.min(1,xi.cameraCollisionOpacity+ss)}const ji=[...hr],vi=1/o.d7(Zi.canonical),Lr=er.anchor?er.anchor[0]:0,en=er.anchor?er.anchor[1]:0;o.br(ji,ji,[Lr*(ir[0]-1)+xi.evaluatedTranslation[0]*vi,en*(ir[1]-1)+xi.evaluatedTranslation[1]*vi,$r+xi.evaluatedTranslation[2]]),o.cq(ir,o.eE)||o.cS(ji,ji,ir);const Vr=o.aB([],ji,er.globalMatrix),gr=o.aB([],ee.expandedFarZProjMatrix,Vr),vs=o.aB([],ee.expandedFarZProjMatrix,ji),Kn=o.aC([],[Lr,en,$r,1],gr)[2];er.hidden=!1;let Sn=_e;dt||(nt&&(Sn*=xi.cameraCollisionOpacity,Sn*=Ii(ji,ee,xi.aabb,ct)),Sn*=zr(kt,Kn)),Sn!==0?$i.push({nodeInfo:xi,depth:Kn,opacity:Sn,wvpForNode:gr,wvpForTile:vs,nodeModelMatrix:Vr,tileModelMatrix:ji}):er.hidden=!0}dt||$i.sort((xi,er)=>!nt||xi.opacity===1&&er.opacity===1?xi.depth<er.depth?-1:1:xi.opacity===1?-1:er.opacity===1?1:xi.depth>er.depth?-1:1);for(const xi of $i){const er=xi.nodeInfo,$r=er.node;let Or=o.aB([],Ce,xi.tileModelMatrix);o.aB(Or,Ue,Or);const ir=o.bl([],Or);o.eg(ir,ir),o.cS(ir,ir,cu),Or=o.aB(Or,Or,$r.globalMatrix);const ji=X.renderPass==="light-beam",vi=ne.paint.get("model-color-use-theme").constantOr("default")==="none",Lr=ar&o.eI.HasMapboxMeshFeatures,en=Lr?0:er.evaluatedRMEA[0][2];for(let Vr=0;Vr<$r.meshes.length;++Vr){const gr=$r.meshes[Vr],vs=Vr===$r.lightMeshIndex;let Kn=xi.wvpForNode;if(vs){if(!ji&&!X.terrain&&X.shadowRenderer){X.currentLayer<X.firstLightBeamLayer&&(X.firstLightBeamLayer=X.currentLayer);continue}Kn=xi.wvpForTile}else if(ji)continue;const Sn={defines:[]},ss=[];if(!dt&&be&&(be.useNormalOffset=!!gr.normalBuffer),Oh(Sn.defines,ss,gr,X,vi?null:ne.lut),Lr||Sn.defines.push("DIFFUSE_SHADED"),tr&&Sn.defines.push("SHADOWS_SINGLE_CASCADE"),Dt&&(dt?Dt.numRenderedVerticesInShadowPass+=gr.vertexArray.length:Dt.numRenderedVerticesInTransparentPass+=gr.vertexArray.length),dt){So(gr,xi.nodeModelMatrix,X,ne);continue}let os=null;if(ue){const nn=zh(xi.nodeModelMatrix,X.transform);if(os=new Float32Array(nn),ee.projection.name!=="globe"){const yr=gr.aabb.min,dn=gr.aabb.max,[Wr,Ur]=ue.getOpacityForBounds(nn,yr[0],yr[1],dn[0],dn[1]);Sn.overrideFog=Wr>=Ge||Ur>=Ge}}const Wn=gr.material;let qs;Wn.occlusionTexture&&Wn.occlusionTexture.offsetScale&&(qs=Wn.occlusionTexture.offsetScale,Sn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const ao=X.getOrCreateProgram("model",Sn);!dt&&be&&be.setupShadowsFromMatrix(xi.tileModelMatrix,ao,be.useNormalOffset),X.uploadCommonUniforms(re,ao,null,os);const Is=Wn.pbrMetallicRoughness;Is.metallicFactor=.9,Is.roughnessFactor=.5;const Kr=vl(new Float32Array(Kn),new Float32Array(Or),new Float32Array(ir),new Float32Array($r.globalMatrix),X,xi.opacity,Is.baseColorFactor,Wn.emissiveFactor,Is.metallicFactor,Is.roughnessFactor,Wn,en,ne,[0,0,0],qs);!vs&&(er.hasTranslucentParts||xi.opacity<1)&&ao.draw(X,re.gl.TRIANGLES,Fe,oi.disabled,gi.disabled,si.backCCW,Kr,ne.id,gr.vertexBuffer,gr.indexBuffer,gr.segments,ne.paint,X.transform.zoom,void 0,ss),ao.draw(X,re.gl.TRIANGLES,vs?Pe:Fe,oi.disabled,vs||xi.opacity<1||er.hasTranslucentParts?gi.alphaBlended:gi.unblended,si.backCCW,Kr,ne.id,gr.vertexBuffer,gr.indexBuffer,gr.segments,ne.paint,X.transform.zoom,void 0,ss)}}}}()}(l,t,n,c),void L();if(D.type!=="model")return;const z=D.getModels(),B=[],F=l.transform.getFreeCameraOptions().position,H=o.c5([],[F.x,F.y,F.z],l.transform.worldSize);o.ew(H,H);const G=[],Z=[];let Y=0;for(const X of z){const ce=t.getFeatureState("",X.id),ne={type:"Unknown",id:X.id,properties:X.featureProperties},ae=n.paint.get("model-rotation").evaluate(ne,ce),re=n.paint.get("model-scale").evaluate(ne,ce),ee=n.paint.get("model-translation").evaluate(ne,ce),ue=n.paint.get("model-opacity").evaluate(ne,ce);t_(n,X.id,ce,X.featureProperties,X.nodeOverrideNames,X.nodeOverrides),i_(n,X.id,ce,X.featureProperties,X.materialOverrideNames,X.materialOverrides),X.nodeOverrides.size>0&&X.computeBoundsAndApplyParent(),X.computeModelMatrix(l,ae,re,ee,x,_,!1);const be=o.bA([]),xe=o.ef(X.position.lat,l.transform.zoom),De=o.bq([],[1,1,1/xe]);o.br(be,be,H),B.push({zScaleMatrix:De,negCameraPosMatrix:be});for(const Le of X.nodes)Al(l,Le,X.matrix,l.transform.expandedFarZProjMatrix,Y,G,Z,X.materialOverrides,ue);Y++}if(G.sort((X,ce)=>ce.depth-X.depth),l.renderPass!=="shadow")r_(l,n,G,Z,B),L();else{for(const X of Z)So(X.mesh,X.nodeModelMatrix,l,n);for(const X of G)So(X.mesh,X.nodeModelMatrix,l,n);L()}}},Nh={line:function(l,t,n){if(l.hasElevatedBuckets=!1,l.hasNonElevatedBuckets=!1,l._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||l._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const c=t.getVisibleCoordinates();for(const d of c){const m=t.getTile(d).getBucket(l);if(m&&(m.elevationType!=="none"?l.hasElevatedBuckets=!0:l.hasNonElevatedBuckets=!0,l.hasElevatedBuckets&&l.hasNonElevatedBuckets))break}}}else l.hasNonElevatedBuckets=!0},model:function(l,t,n){const c=t.getSource();if(!c.loaded())return;if(c.type==="vector"||c.type==="geojson")return void(n.modelManager&&n.modelManager.upload(n,lu(n,l)));if(c.type==="batched-model"||c.type!=="model")return;const d=c.getModels();for(const m of d)m.upload(n.context)},raster:function(l,t,n){const c=t.getSource();if(!(c instanceof hs&&c.loaded()))return;const d=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!d)return;const m=l.paint.get("raster-array-band")||c.getInitialBand(d);if(m==null)return;const _=t.getIds().map(x=>t.getTileByID(x));for(const x of _)x.updateNeeded(l.id,m)&&c.prepareTile(x,d,l.id,m)},"raster-particle":function(l,t,n){const c=t.getSource();if(!(c instanceof hs&&c.loaded()))return;const d=l.sourceLayer||c.rasterLayerIds&&c.rasterLayerIds[0];if(!d)return;const m=l.paint.get("raster-particle-array-band")||c.getInitialBand(d);if(m==null)return;const _=t.getIds().map(x=>t.getTileByID(x));for(const x of _)x.updateNeeded(l.id,m)&&c.prepareTile(x,d,l.id,m)}},Hs={fill:Eh},Vh={fill:function(l,t,n,c){if(!n.layout||n.layout.get("fill-elevation-reference")==="none"||n.paint.get("fill-opacity").constantOr(1)===0)return;const d=l.context.gl,m=new Bt(d.LEQUAL,Bt.ReadOnly,l.depthRangeFor3D),_=new oi({func:d.ALWAYS,mask:255},255,255,d.KEEP,d.KEEP,d.REPLACE),x=l.transform.getFreeCameraOptions().position,b=l.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const E of c){const I=t.getTile(E),L=I.getBucket(n);if(!L)continue;const D=L.elevatedStructures;if(!D||D.depthSegments.segments[0].primitiveLength===0)continue;const z=$m(E.toUnwrapped(),x),B=l.translatePosMatrix(E.projMatrix,I,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),F=xl(B,z,0,1,0);b.draw(l,d.TRIANGLES,m,_,gi.disabled,si.disabled,F,n.id,D.vertexBuffer,D.indexBuffer,D.depthSegments,n.paint,l.transform.zoom)}}};class Uh{constructor(t,n,c,d,m){this.context=new nc(t,n),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const _=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const b of _)this._debugParams.enabledLayers[b]=!0;for(const b of _);this.occlusionParams=new oc,this.setup(),this.numSublayers=Ds.maxUnderzooming+Ds.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new $l(this),this._wireframeDebugCache=new Ha,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const x=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,x,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=d,this.worldview=m,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,n){const c=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(c||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new _f(this,t));const d=this._terrain;this.transform.elevation=c?d:null,d.update(t,this.transform,n),this.transform.elevation&&!d.enabled&&(this.transform.elevation=null)}_updateFog(t){const n=t.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[c,d]=n.getFovAdjustedRange(this.transform._fov);if(c>d)return void(this.transform.fogCullDistSq=null);const m=c+.78*(d-c);this.transform.fogCullDistSq=m*m}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new _f(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,n){if(this.width=t*o.o.devicePixelRatio,this.height=n*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style.order)this.style._mergedLayers[c].resize()}setup(){const t=this.context,n=new o.bd;n.emplaceBack(0,0),n.emplaceBack(o.al,0),n.emplaceBack(0,o.al),n.emplaceBack(o.al,o.al),this.tileExtentBuffer=t.createVertexBuffer(n,o.bf.members),this.tileExtentSegments=o.bg.simpleSegment(0,0,4,2);const c=new o.bd;c.emplaceBack(0,0),c.emplaceBack(o.al,0),c.emplaceBack(0,o.al),c.emplaceBack(o.al,o.al),this.debugBuffer=t.createVertexBuffer(c,o.bf.members),this.debugSegments=o.bg.simpleSegment(0,0,4,5);const d=new o.bd;d.emplaceBack(-1,-1),d.emplaceBack(1,-1),d.emplaceBack(-1,1),d.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(d,o.bf.members),this.viewportSegments=o.bg.simpleSegment(0,0,4,2);const m=new o.b1;m.emplaceBack(0,0,0,0),m.emplaceBack(o.al,0,o.al,0),m.emplaceBack(0,o.al,0,o.al),m.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=t.createVertexBuffer(m,o.bi.members),this.mercatorBoundsSegments=o.bg.simpleSegment(0,0,4,2);const _=new o.b0;_.emplaceBack(0,1,2),_.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(_);const x=new o.be;for(const E of[0,1,3,2,0])x.emplaceBack(E);this.debugIndexBuffer=t.createIndexBuffer(x),this.emptyTexture=new o.T(t,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bC();const b=this.context.gl;this.stencilClearMode=new oi({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Bt.disabled,this.stencilClearMode,gi.disabled,si.disabled,eu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,n,c){if(!n||this.currentStencilSource===n.id||!t.isTileClipped()||!c||c.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let x=!1;for(const b of c)if(this._tileClippingMaskIDs[b.key]===void 0){x=!0;break}if(!x)return}this.currentStencilSource=n.id;const d=this.context,m=d.gl;this.nextStencilID+c.length>256&&this.clearStencil(),d.setColorMode(gi.disabled),d.setDepthMode(Bt.disabled);const _=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of c){const b=n.getTile(x),E=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,{tileBoundsBuffer:I,tileBoundsIndexBuffer:L,tileBoundsSegments:D}=this.getTileBoundsBuffers(b);_.draw(this,m.TRIANGLES,Bt.disabled,new oi({func:m.ALWAYS,mask:0},E,255,m.KEEP,m.KEEP,m.REPLACE),gi.disabled,si.disabled,eu(x.projMatrix),"$clipping",I,L,D)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,n=this.context.gl;return new oi({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const n=this.context.gl;return new oi({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(t){const n=this.context.gl,c=t.sort((_,x)=>x.overscaledZ-_.overscaledZ),d=c[c.length-1].overscaledZ,m=c[0].overscaledZ-d+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const _={};for(let x=0;x<m;x++)_[x+d]=new oi({func:n.GEQUAL,mask:255},x+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=m,[_,c]}return[{[d]:oi.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new gi([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?gi.unblended:gi.alphaBlended}colorModeForDrapableLayerRenderPass(t){const n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new gi([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new gi([n.ONE,n.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,n.ONE_MINUS_SRC_ALPHA],o.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,n,c,d=!1){if(this.depthOcclusion)return new Bt(this.context.gl.GREATER,Bt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!d)return Bt.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Bt(c||this.context.gl.LEQUAL,n,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,n=Math.ceil(this.width),c=Math.ceil(this.height),d=this.context.bindFramebuffer.get(),m=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===n&&this.depthFBO.height===c||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),n!==0&&c!==0&&(this.depthFBO=new qm(this.context,n,c,0,"texture"),this.depthTexture=new o.T(this.context,{width:n,height:c,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(d),t.bindTexture(t.TEXTURE_2D,m),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,n,c,0,0,n,c,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,n)=>t+n/this._fpsHistory.length,0))}render(t,n){const c=o.o.now();this._dt=c-this._timeStamp,this._timeStamp=c,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=n;const d=this.style._mergedLayers,m=!(!this.terrain||!this.terrain.enabled),_=()=>this.style._getOrder(m).filter(Ce=>{const _e=d[Ce];return!(_e.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[_e.type]});let x=_(),b=!1,E=!1,I=null,L=0,D=!1;for(const Ce of x){const _e=d[Ce];_e.visibility!=="none"&&(_e.type==="circle"?b=!0:_e.type==="building"?(I=_e,++L):_e.type==="symbol"&&(_e.hasOcclusionOpacityProperties?E=!0:b=!0))}this.updateEmissiveMode();let z=x.map(Ce=>d[Ce]);const B=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();for(const Ce in B){const _e=B[Ce];_e.used&&(_e.prepare(this.context),_e.getSource().usedInConflation&&++L)}let F=!1;for(const Ce of z)Ce.isHidden(this.transform.zoom)||(Ce.type==="clip"&&(F=!0),this.prepareLayer(Ce));const H={},G={},Z={},Y={},X={};for(const Ce in B){const _e=B[Ce];H[Ce]=_e.getVisibleCoordinates(),G[Ce]=H[Ce].slice().reverse(),Z[Ce]=_e.getVisibleCoordinates(!0).reverse(),Y[Ce]=_e.getShadowCasterCoordinates(),X[Ce]=_e.sortCoordinatesByDistance(H[Ce])}const ce=Ce=>{const _e=this.style.getLayerSourceCache(Ce);return _e&&_e.used?_e.getSource():null};if(L||F||this._clippingActiveLastFrame){const Ce=[],_e=[];let Fe=0;for(const Pe of z)this.isSourceForClippingOrConflation(Pe,ce(Pe))&&(Ce.push(Pe),_e.push(Fe)),Fe++;if(Ce&&(F||Ce.length>1)||this._clippingActiveLastFrame){F=!1;const Pe=[];for(let We=0;We<Ce.length;We++){const dt=Ce[We],Tt=_e[We],ct=this.style.getLayerSourceCache(dt);if(!ct||!ct.used||!ct.getSource().usedInConflation&&dt.type!=="clip"&&dt.type!=="building")continue;let nt=o.eQ,kt=o.b_.None;const Dt=[];let xt=!0;if(dt.type==="building")nt=o.eS;else if(dt.type==="clip"){nt=Tt;for(const Et of dt.layout.get("clip-layer-types"))kt|=Et==="model"?o.b_.Model:Et==="symbol"?o.b_.Symbol:o.b_.FillExtrusion;for(const Et of dt.layout.get("clip-layer-scope"))Dt.push(Et);dt.isHidden(this.transform.zoom)?xt=!1:F=!0}xt&&Pe.push({layer:dt.fqid,cache:ct,order:nt,clipMask:kt,clipScope:Dt})}this.replacementSource.setSources(Pe),D=!0}}this._clippingActiveLastFrame=F,D||this.replacementSource.clear(),this.conflationActive=D,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Ce=0;Ce<z.length;Ce++){const _e=z[Ce];if(_e.visibility==="none")continue;const Fe=_e.cutoffRange();if(this.longestCutoffRange=Math.max(Fe,this.longestCutoffRange),Fe>0){const Pe=ce(_e);Pe&&(this.minCutoffZoom=Math.max(Pe.minzoom,this.minCutoffZoom)),_e.minzoom&&(this.minCutoffZoom=Math.max(_e.minzoom,this.minCutoffZoom))}_e.is3D(m)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Ce),this._lastOcclusionLayer=Ce)}const ne=this.style&&this.style.fog;ne?(this._fogVisible=ne.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ne.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0,x=_(),z=x.map(Ce=>d[Ce]));const ae=this._shadowRenderer;if(ae){ae.updateShadowParameters(this.transform,this.style.directionalLight);for(const Ce in B)for(const _e of H[Ce]){let Fe={min:0,max:0};this.terrain&&(Fe=this.terrain.getMinMaxForTile(_e)||Fe),ae.addShadowReceiver(_e.toUnwrapped(),Fe.min,Fe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new e_(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const re=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ee=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(re&&!this._snow&&(this._snow=new Df(this)),!re&&this._snow&&(this._snow.destroy(),delete this._snow),ee&&!this._rain&&(this._rain=new Bh(this)),!ee&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),I){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Lh);const Ce=this.style.getLayerSourceCache(I);this.buildingTileBorderManager.updateBorders(Ce,I)}if(!Ct.has(this.context.gl))return;this.renderPass="offscreen";for(const Ce of z){const _e=t.getLayerSourceCache(Ce);if(!Ce.hasOffscreenPass()||Ce.isHidden(this.transform.zoom))continue;const Fe=_e?G[_e.id]:void 0;(Ce.type==="custom"||Ce.type==="raster"||Ce.type==="raster-particle"||Ce.isSky()||Fe&&Fe.length)&&this.renderLayer(this,_e,Ce,Fe)}this.depthRangeFor3D=[0,1-(z.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,Y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const ue=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),be=(()=>{if(n.showOverdrawInspector)return o.ao.black;const Ce=this.style.fog;if(Ce&&this.transform.projection.supportsFog){const _e=this.style.getLut(Ce.scope);if(!ue){const Fe=Ce.properties.get("color-use-theme")==="none",Pe=Ce.properties.get("color").toNonPremultipliedRenderColor(Fe?null:_e).toArray01();return new o.ao(...Pe)}if(ue){const Fe=Ce.properties.get("space-color-use-theme")==="none",Pe=Ce.properties.get("space-color").toNonPremultipliedRenderColor(Fe?null:_e).toArray01();return new o.ao(...Pe)}}return o.ao.transparent})();if(this.context.clear({color:be,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=x.length-1;this.currentLayer>=0;this.currentLayer--){const Ce=z[this.currentLayer],_e=t.getLayerSourceCache(Ce);if(Ce.isSky())continue;const Fe=_e?(Ce.is3D(m)?X:G)[_e.id]:void 0;this._renderTileClippingMasks(Ce,_e,Fe),this.renderLayer(this,_e,Ce,Fe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&ue&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<x.length;this.currentLayer++){const Ce=z[this.currentLayer],_e=t.getLayerSourceCache(Ce);Ce.isSky()&&this.renderLayer(this,_e,Ce,_e?G[_e.id]:void 0)}function xe(Ce,_e){let Fe;return _e&&(Fe=(Ce.type==="symbol"?Z:Ce.is3D(m)?X:G)[_e.id]),Fe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<x.length;){const Ce=z[this.currentLayer];if(Ce.type==="raster"||Ce.type==="raster-particle"){const _e=t.getLayerSourceCache(Ce);this.renderLayer(this,_e,Ce,xe(Ce,_e))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let De=0;ae&&(De=ae.getShadowCastingLayerCount());let Le=!1,Ue=-1;for(let Ce=0;Ce<x.length;++Ce){const _e=z[Ce];_e.isHidden(this.transform.zoom)||_e.is3D(m)&&(Ue=Ce)}E&&Ue===-1&&(b=!0);let it=!1;for(;this.currentLayer<x.length;){const Ce=z[this.currentLayer],_e=t.getLayerSourceCache(Ce);if(Ce.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Ce)){if(Ce.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!it&&Ce.is3D(m)&&!m){const Fe=this.currentLayer,Pe=We=>{for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const dt=z[this.currentLayer];if(Hs[dt.type]){const Tt=this.style.getLayerSourceCache(dt);Hs[dt.type](this,Tt,dt,xe(dt,Tt),We)}}};Pe("initialize"),Pe("reset"),this.currentLayer=Fe,it=!0}if(b&&!Le&&this.terrain&&!this.transform.isOrthographic&&(Le=!0,this.blitDepth()),E&&Ue!==-1&&this.currentLayer===Ue+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Ce,_e,_e?H[_e.id]:void 0),this.renderLayer(this,_e,Ce,xe(Ce,_e)),!this.terrain&&ae&&De>0&&Ce.hasShadowPass()&&--De==0){{this.clearStencil(),this.resetStencilClippingMasks();const Fe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<z.length;this.currentLayer++){const Pe=z[this.currentLayer];if(Vh[Pe.type]){const We=this.style.getLayerSourceCache(Pe);Vh[Pe.type](this,We,Pe,xe(Pe,We))}}this.currentLayer=Fe}if(ae.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Fe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Fe;this.currentLayer++){const Pe=z[this.currentLayer];if(!Pe.hasLightBeamPass())continue;const We=t.getLayerSourceCache(Pe);this.renderLayer(this,We,Pe,We?G[We.id]:void 0)}this.currentLayer=Fe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Fe=this.currentLayer;this.depthOcclusion=!0;for(const Pe of this.layersWithOcclusionOpacity){this.currentLayer=Pe;const We=z[this.currentLayer],dt=t.getLayerSourceCache(We),Tt=dt?G[dt.id]:void 0;this.terrain||this._renderTileClippingMasks(We,dt,dt?H[dt.id]:void 0),this.renderLayer(this,dt,We,Tt)}this.depthOcclusion=!1,this.currentLayer=Fe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Ce=null;z.forEach(_e=>{const Fe=t.getLayerSourceCache(_e);Fe&&!_e.isHidden(this.transform.zoom)&&Fe.getVisibleCoordinates().length&&(!Ce||Ce.getSource().maxzoom<Fe.getSource().maxzoom)&&(Ce=Fe)}),Ce&&this.options.showTileBoundaries&&lt(this,Ce,Ce.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&lt(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Ce){const _e=Ce.transform.padding;Sl(Ce,Ce.transform.height-(_e.top||0),3,Xm),Sl(Ce,_e.bottom||0,3,Km),Xr(Ce,_e.left||0,3,Ym),Xr(Ce,Ce.transform.width-(_e.right||0),3,wl);const Fe=Ce.transform.centerPoint;(function(Pe,We,dt,Tt){Se(Pe,We-1,dt-10,2,20,Tt),Se(Pe,We-10,dt-1,20,2,Tt)})(Ce,Fe.x,Ce.transform.height-Fe.y,Tl)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),D||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:n}=this.transform.projection,c=!n||!n.includes(t.type);if(Nh[t.type]&&(c||this.terrain&&t.type==="custom")){const d=this.style.getLayerSourceCache(t);Nh[t.type](t,d,this)}this.gpuTimingEnd()}renderLayer(t,n,c,d){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="sky"||c.type==="custom"||c.type==="model"||c.type==="raster"||c.type==="raster-particle"||d&&d.length)&&(this.id=c.id,this.gpuTimingStart(c),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(c.type)&&(!t.terrain||c.type!=="custom")||c.type==="clip"||qa[c.type](t,n,c,d,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const n=this.context.extTimerQuery,c=this.context.gl;let d=this.gpuTimers[t.id];d||(d=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:c.createQuery()}),d.calls++,c.beginQuery(n.TIME_ELAPSED_EXT,d.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,n=this.context.gl,c=n.createQuery();this.deferredRenderGpuTimeQueries.push(c),n.beginQuery(t.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const n={};for(const c in t){const d=t[c],m=this.context.extTimerQuery,_=m.getQueryParameter(d.query,this.context.gl.QUERY_RESULT)/1e6;m.deleteQueryEXT(d.query),n[c]=_}return n}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const n=this.context.gl;let c=0;for(const d of t)c+=n.getQueryParameter(d,n.QUERY_RESULT)/1e6,n.deleteQuery(d);return c}translatePosMatrix(t,n,c,d,m){if(!c[0]&&!c[1])return t;const _=m?d==="map"?this.transform.angle:0:d==="viewport"?-this.transform.angle:0;if(_){const E=Math.sin(_),I=Math.cos(_);c=[c[0]*I-c[1]*E,c[0]*E+c[1]*I]}const x=[m?c[0]:o.ay(n,c[0],this.transform.zoom),m?c[1]:o.ay(n,c[1],this.transform.zoom),0],b=new Float32Array(16);return o.br(b,t,x),b}saveTileTexture(t){if(t.context!==this.context)return;const n=t.size[0],c=this._tileTextures[n];c?c.push(t):this._tileTextures[n]=[t]}getTileTexture(t){const n=this._tileTextures[t];return n&&n.length>0?n.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,n,c){const d=c===void 0?this.terrain&&this.terrain.renderingToTexture:c,m=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(m.push("LIGHTING_3D_MODE"),m.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):d||m.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||m.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(m.push("TERRAIN"),this.linearFloatFilteringSupported()&&m.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&m.push("GLOBE"),!this._fogVisible||d||n!==void 0&&!n||m.push("FOG","FOG_DITHERING"),d&&m.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&m.push("OVERDRAW_INSPECTOR"),m}getOrCreateProgram(t,n){this.cache=this.cache||{};const c=n&&n.defines||[],d=n&&n.config,m=this.currentGlobalDefines(t,n&&n.overrideFog,n&&n.overrideRtt).concat(c),_=Lm.cacheKey(rf[t],t,m,d);return this.cache[_]||(this.cache[_]=new Lm(this.context,t,rf[t],d,Sh[t],m)),this.cache[_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,n){if(this.style.enable3dLights()){const c=this.style.directionalLight,d=this.style.ambientLight;if(c&&d){const m=((_,x,b)=>{const E=_.properties.get("direction"),I=_.properties.get("color-use-theme")==="none",L=_.properties.get("color").toNonPremultipliedRenderColor(I?null:b.getLut(_.scope)).toArray01(),D=_.properties.get("intensity"),z=x.properties.get("color-use-theme")==="none",B=x.properties.get("color").toNonPremultipliedRenderColor(z?null:b.getLut(x.scope)).toArray01(),F=x.properties.get("intensity"),H=[E.x,E.y,E.z],G=o.dN(B,F),Z=o.dN(L,D);return{u_lighting_ambient_color:G,u_lighting_directional_dir:H,u_lighting_directional_color:Z,u_ground_radiance:tc(H,Z,G)}})(c,d,this.style);n.setLightsUniformValues(t,m)}}}uploadCommonUniforms(t,n,c,d,m){if(this.uploadCommonLightUniforms(t,n),this.terrain&&this.terrain.renderingToTexture)return;const _=this.style.fog;if(_){const x=_.getOpacity(this.transform.pitch),b=((E,I,L,D,z,B,F,H,G,Z,Y,X)=>{const ce=E.transform,ne=I.properties.get("color-use-theme")==="none",ae=I.properties.get("color").toNonPremultipliedRenderColor(ne?null:E.style.getLut(I.scope)).toArray01();ae[3]=D;const re=E.frameCounter/1e3%1,[ee,ue]=I.properties.get("vertical-range");return{u_fog_matrix:L?ce.calculateFogTileMatrix(L):X||E.identityMat,u_fog_range:I.getFovAdjustedRange(ce._fov),u_fog_color:ae,u_fog_horizon_blend:I.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ee,ue),ue],u_fog_temporal_offset:re,u_frustum_tl:z,u_frustum_tr:B,u_frustum_br:F,u_frustum_bl:H,u_globe_pos:G,u_globe_radius:Z,u_viewport:Y,u_globe_transition:o.aj(ce.zoom),u_is_globe:+(ce.projection.name==="globe")}})(this,_,c,x,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],d);n.setFogUniformValues(t,b)}m&&n.setCutoffUniformValues(t,m.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,n=t.createTexture();return t.bindTexture(t.TEXTURE_2D,n),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,n=this._backgroundTiles={},c=this.transform.coveringTiles({tileSize:512});for(const d of c)n[d.key]=t[d.key]||new dl(d,512,this.transform.tileZoom,this,void 0,this.worldview);return n}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,n){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!n||n.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[t.key];return n||(this._cachedTileFogOpacities[t.key]=n=this.style.fog.getOpacityForTile(t)),n[0]>=Ge||n[1]>=Ge}setupDepthForOcclusion(t,n,c){const d=this.context,m=d.gl,_=!!c;var x;c||(c={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),d.activeTexture.set(m.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),c.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],c.u_depth_range_unpack=[2/((x=this.depthRangeFor3D)[1]-x[0]),-1-2*x[0]/(x[1]-x[0])],c.u_occluder_half_size=.5*this.occlusionParams.occluderSize,c.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE),d.activeTexture.set(m.TEXTURE0),_||n.setTerrainUniformValues(d,c)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function jh(l,t){let n=!1,c=null;const d=()=>{c=null,n&&(l(),c=setTimeout(d,t),n=!1)};return()=>(n=!0,c||d(),c)}class Lf{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=jh(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const n=wn(t);if(this._hashName){const c=this._hashName;let d=!1;const m=location.hash.slice(1).split("&").map(_=>{const x=_.split("=")[0];return x===c?(d=!0,`${x}=${n}`):_}).filter(_=>_);return d||m.push(`${c}=${n}`),`#${m.join("&")}`}return`#${n}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let n;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(n=c)}),(n&&n[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const n=this._getCurrentHash();if(n.length>=3&&!n.some(c=>isNaN(Number(c)))){const c=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(n[3]||0):t.getBearing();return t.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:c,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function wn(l,t){const n=l.getCenter(),c=Math.round(100*l.getZoom())/100,d=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,d),_=Math.round(n.lng*m)/m,x=Math.round(n.lat*m)/m,b=l.getBearing(),E=l.getPitch();let I=t?`/${_}/${x}/${c}`:`${c}/${x}/${_}`;return(b||E)&&(I+="/"+Math.round(10*b)/10),E&&(I+=`/${Math.round(E)}`),I}const lc={linearity:.3,easing:o.eT(0,0,.3,1)},zf=Object.assign({deceleration:2500,maxSpeed:1400},lc),Of=Object.assign({deceleration:20,maxSpeed:1400},lc),Cl=Object.assign({deceleration:1e3,maxSpeed:360},lc),kf=Object.assign({deceleration:1e3,maxSpeed:90},lc);class Ff{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,n=o.o.now();for(;t.length>0&&n-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const n={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)n.zoom+=m.zoomDelta||0,n.bearing+=m.bearingDelta||0,n.pitch+=m.pitchDelta||0,m.panDelta&&n.pan._add(m.panDelta),m.around&&(n.around=m.around),m.pinchAround&&(n.pinchAround=m.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,d={};if(n.pan.mag()){const m=Ho(n.pan.mag(),c,Object.assign({},zf,t||{}));d.offset=n.pan.mult(m.amount/n.pan.mag()),d.center=this._map.transform.center,cc(d,m)}if(n.zoom){const m=Ho(n.zoom,c,Of);d.zoom=this._map.transform.zoom+m.amount,cc(d,m)}if(n.bearing){const m=Ho(n.bearing,c,Cl);d.bearing=this._map.transform.bearing+o.aA(m.amount,-179,179),cc(d,m)}if(n.pitch){const m=Ho(n.pitch,c,kf);d.pitch=this._map.transform.pitch+m.amount,cc(d,m)}if(d.zoom||d.bearing){const m=n.pinchAround===void 0?n.around:n.pinchAround;d.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),d.noMoveStart=!0,d}}function cc(l,t){(!l.duration||l.duration<t.duration)&&(l.duration=t.duration,l.easing=t.easing)}function Ho(l,t,n){const{maxSpeed:c,linearity:d,deceleration:m}=n,_=o.aA(l*d/(t/1e3),-c,c),x=Math.abs(_)/(m*d);return{easing:n.easing,duration:1e3*x,amount:_*(x/2)}}class As extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,c,d={}){const m=vn(n.getCanvasContainer(),c),_=n.unproject(m);super(t,Object.assign({point:m,lngLat:_,originalEvent:c},d)),this._defaultPrevented=!1,this.target=n}}class $a extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n,c){const d=t==="touchend"?c.changedTouches:c.touches,m=Zn(n.getCanvasContainer(),d),_=m.map(b=>n.unproject(b)),x=m.reduce((b,E,I,L)=>b.add(E.div(L.length)),new o.P(0,0));super(t,{points:m,point:x,lngLats:_,lngLat:n.unproject(x),originalEvent:c}),this._defaultPrevented=!1}}class Bf extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,n){super("wheel",{originalEvent:n}),this._defaultPrevented=!1}}class Gh{constructor(t,n){this._map=t,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Bf(this._map,t))}mousedown(t,n){return this._mousedownPos=n,this._firePreventable(new As(t.type,this._map,t))}mouseup(t){this._map.fire(new As(t.type,this._map,t))}preclick(t){const n=new MouseEvent("preclick",t);this._map.fire(new As(n.type,this._map,n))}click(t,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(t),this._map.fire(new As(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new As(t.type,this._map,t))}mouseover(t){this._map.fire(new As(t.type,this._map,t))}mouseout(t){this._map.fire(new As(t.type,this._map,t))}touchstart(t){return this._firePreventable(new $a(t.type,this._map,t))}touchmove(t){this._map.fire(new $a(t.type,this._map,t))}touchend(t){this._map.fire(new $a(t.type,this._map,t))}touchcancel(t){this._map.fire(new $a(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nf{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new As(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new As("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new As(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hh{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,n){this.isEnabled()&&t.shiftKey&&t.button===0&&(Zt(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(t,n){if(!this._active)return;const c=n,d=this._startPos,m=this._lastPos;if(!d||!m||m.equals(c)||!this._box&&c.dist(d)<this._clickTolerance)return;this._lastPos=c,this._box||(this._box=rt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const _=Math.min(d.x,c.x),x=Math.max(d.x,c.x),b=Math.min(d.y,c.y),E=Math.max(d.y,c.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${_}px,${b}px)`,this._box.style.width=x-_+"px",this._box.style.height=E-b+"px")})}mouseupWindow(t,n){if(!this._active)return;const c=this._startPos,d=n;if(c&&t.button===0){if(this.reset(),mr(),c.x!==d.x||c.y!==d.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:t})),{cameraAnimation:m=>m.fitScreenCoordinates(c,d,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Li(),delete this._startPos,delete this._lastPos}_fireEvent(t,n){return this._map.fire(new o.z(t,{originalEvent:n}))}}function qh(l,t){const n={};for(let c=0;c<l.length;c++)n[l[c].identifier]=t[c];return n}class a_{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,n,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(d){const m=new o.P(0,0);for(const _ of d)m._add(_);return m.div(d.length)}(n),this.touches=qh(c,n)))}touchmove(t,n,c){if(this.aborted||!this.centroid)return;const d=qh(c,n);for(const m in this.touches){const _=d[m];(!_||_.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(t,n,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const d=!this.aborted&&this.centroid;if(this.reset(),d)return d}}}class $h{constructor(t){this.singleTap=new a_(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,n,c){this.singleTap.touchstart(t,n,c)}touchmove(t,n,c){this.singleTap.touchmove(t,n,c)}touchend(t,n,c){const d=this.singleTap.touchend(t,n,c);if(d){const m=t.timeStamp-this.lastTime<500,_=!this.lastTap||this.lastTap.dist(d)<30;if(m&&_||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=d,this.count===this.numTaps)return this.reset(),d}}}class l_{constructor(){this._zoomIn=new $h({numTouches:1,numTaps:2}),this._zoomOut=new $h({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,n,c){this._zoomIn.touchstart(t,n,c),this._zoomOut.touchstart(t,n,c)}touchmove(t,n,c){this._zoomIn.touchmove(t,n,c),this._zoomOut.touchmove(t,n,c)}touchend(t,n,c){const d=this._zoomIn.touchend(t,n,c),m=this._zoomOut.touchend(t,n,c);return d?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()+1,around:_.unproject(d)},{originalEvent:t})}):m?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:_=>_.easeTo({duration:300,zoom:_.getZoom()-1,around:_.unproject(m)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const c_={0:1,2:2},Vf={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Wh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,n){return!1}_move(t,n){return{}}mousedown(t,n){if(this._lastPoint)return;const c=fs(t);this._correctButton(t,c)&&(this._lastPoint=n,this._eventButton=c)}mousemoveWindow(t,n){const c=this._lastPoint;if(c){if(t.preventDefault(),this._eventButton!=null&&function(d,m){const _=c_[m];return d.buttons===void 0||(d.buttons&_)!==_}(t,this._eventButton))this.reset();else if(this._moved||!(n.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(c,n)}}mouseupWindow(t){this._lastPoint&&fs(t)===this._eventButton&&(this._moved&&mr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class u_ extends Wh{mousedown(t,n){super.mousedown(t,n),this._lastPoint&&(this._active=!0)}_correctButton(t,n){return n===0&&!t.ctrlKey}_move(t,n){return{around:n,panDelta:n.sub(t)}}}class Uf extends Wh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Vf[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const c=.8*(n.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class jf extends Wh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Vf[t.pitchRotateKey]:void 0}_correctButton(t,n){return this._pitchRotateKey?n===0&&t[this._pitchRotateKey]:n===0&&t.ctrlKey||n===2}_move(t,n){const c=-.5*(n.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class h_{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,n,c){return this._calculateTransform(t,n,c)}touchmove(t,n,c){if(this._active&&!(c.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(c.length===1&&!o.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,n,c)}}touchend(t,n,c){this._calculateTransform(t,n,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,n,c){c.length>0&&(this._active=!0);const d=qh(c,n),m=new o.P(0,0),_=new o.P(0,0);let x=0;for(const E in d){const I=d[E],L=this._touches[E];L&&(m._add(I),_._add(I.sub(L)),x++,d[E]=I)}if(this._touches=d,x<this._minTouches||!_.mag())return;const b=_.div(x);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(x),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=rt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Zh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,n,c){return{}}touchstart(t,n,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([n[0],n[1]]))}touchmove(t,n,c){const d=this._firstTwoTouches;if(!d)return;t.preventDefault();const[m,_]=d,x=uu(c,n,m),b=uu(c,n,_);if(!x||!b)return;const E=this._aroundCenter?null:x.add(b).div(2);return this._move([x,b],E,t)}touchend(t,n,c){if(!this._firstTwoTouches)return;const[d,m]=this._firstTwoTouches,_=uu(c,n,d),x=uu(c,n,m);_&&x||(this._active&&mr(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function uu(l,t,n){for(let c=0;c<l.length;c++)if(l[c].identifier===n)return t[c]}function d_(l,t){return Math.log2(l/t)}class Sy extends Zh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,n){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(d_(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:d_(this._distance,c),pinchAround:n}}}function f_(l,t){return 180*l.angleWith(t)/Math.PI}class Nr extends Zh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,n){const c=this._vector;if(this._vector=t[0].sub(t[1]),c&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:f_(this._vector,c),pinchAround:n}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const n=25/(Math.PI*this._minDiameter)*360,c=this._startVector;if(!c)return!1;const d=f_(t,c);return Math.abs(d)<n}}function Xh(l){return Math.abs(l.y)>Math.abs(l.x)}class Ey extends Zh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,Xh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,n,c){const d=this._lastPoints;if(!d)return;const m=t[0].sub(d[0]),_=t[1].sub(d[1]);return this._map._cooperativeGestures&&!o.eU()&&c.touches.length<3||(this._valid=this.gestureBeginsVertically(m,_,c.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(m.y+_.y)/2*-.5})}gestureBeginsVertically(t,n,c){if(this._valid!==void 0)return this._valid;const d=t.mag()>=2,m=n.mag()>=2;if(!d&&!m)return;if(!d||!m)return this._firstMove==null&&(this._firstMove=c),c-this._firstMove<100&&void 0;const _=t.y>0==n.y>0;return Xh(t)&&Xh(n)&&_}}const Ay={panStep:100,bearingStep:15,pitchStep:10};class Iy{constructor(){const t=Ay;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let n=0,c=0,d=0,m=0,_=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),m=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),m=1);break;case 38:t.shiftKey?d=1:(t.preventDefault(),_=-1);break;case 40:t.shiftKey?d=-1:(t.preventDefault(),_=1);break;default:return}return this._rotationDisabled&&(c=0,d=0),{cameraAnimation:x=>{const b=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:hu,zoom:n?Math.round(b)+n*(t.shiftKey?2:1):b,bearing:x.getBearing()+c*this._bearingStep,pitch:x.getPitch()+d*this._pitchStep,offset:[-m*this._panStep,-_*this._panStep],center:x.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hu(l){return l*(2-l)}const Gf=4.000244140625,Hf=1/450;class Kh{constructor(t,n){this._map=t,this._el=t.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Hf,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=o.o.now(),d=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,n!==0&&n%Gf==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":d>400?(this._type=null,this._lastValue=n,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(d*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const n=vn(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const n=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const E=this._type==="wheel"&&Math.abs(this._delta)>Gf?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&I!==0&&(I=1/I);const L=n(),D=Math.pow(2,L),z=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):D;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(z*I))),this._type==="wheel"&&(this._startZoom=L,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:n(),d=this._startZoom,m=this._easing;let _,x=!1;if(this._type==="wheel"&&d&&m){const E=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),I=m(E);_=o.ak(d,c,I),E<1?this._frameId||(this._frameId=!0):x=!0}else _=c,x=!0;this._active=!0,x&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let b=_-n();return b*this._lastDelta<0&&(b=0),{noInertia:!0,needsRenderFrame:!x,zoomDelta:b,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let n=o.eV;if(this._prevEase){const c=this._prevEase,d=(o.o.now()-c.start)/c.duration,m=c.easing(d+.01)-c.easing(d),_=.27/Math.sqrt(m*m+1e-4)*.01,x=Math.sqrt(.0729-_*_);n=o.eT(_,x,.25,1)}return this._prevEase={start:o.o.now(),duration:t,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=rt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class ha{constructor(t,n){this._clickZoom=t,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yh{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,n){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(n)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tn{constructor(){this._tap=new $h({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,n,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=n[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,n,c))}touchmove(t,n,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const d=n[0],m=d.y-this._swipePoint.y;return this._swipePoint=d,t.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(t,n,c)}touchend(t,n,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,n,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qo{constructor(t,n,c){this._el=t,this._mousePan=n,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class du{constructor(t,n,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Jh{constructor(t,n,c,d){this._el=t,this._touchZoom=n,this._touchRotate=c,this._tapDragZoom=d,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fu=l=>l.zoom||l.drag||l.pitch||l.rotate;class Cy extends o.z{}class pu{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,n){const c=o.av([],n,t);this.radius=o.ag(c[2]<0?o.eX([],c,this.constants):[c[0],c[1],0])}projectRay(t){o.eX(t,t,this.constants),o.aw(t,t),o.eY(t,t,this.constants);const n=o.c5([],t,this.radius);if(n[2]>0){const c=o.c5([],[0,0,1],o.bJ(n,[0,0,1])),d=o.c5([],o.aw([],[n[0],n[1],0]),this.radius),m=o.d8([],n,o.c5([],o.av([],o.d8([],d,c),n),2));n[0]=m[0],n[1]=m[1]}return n}}function Qh(l){return l.panDelta&&l.panDelta.mag()||l.zoomDelta||l.bearingDelta||l.pitchDelta}class Py{constructor(t,n){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ff(t),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new pu,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),o.aY(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[d,m,_]of this._listeners){const x=d===document?this.handleWindowEvent:this.handleEvent;d.addEventListener(m,x,_)}}destroy(){for(const[t,n,c]of this._listeners){const d=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(n,d,c)}}_addDefaultHandlers(t){const n=this._map,c=n.getCanvasContainer();this._add("mapEvent",new Gh(n,t));const d=n.boxZoom=new Hh(n,t);this._add("boxZoom",d);const m=new l_,_=new Yh;n.doubleClickZoom=new ha(_,m),this._add("tapZoom",m),this._add("clickZoom",_);const x=new Tn;this._add("tapDragZoom",x);const b=n.touchPitch=new Ey(n);this._add("touchPitch",b);const E=new Uf(t),I=new jf(t);n.dragRotate=new du(t,E,I),this._add("mouseRotate",E,["mousePitch"]),this._add("mousePitch",I,["mouseRotate"]);const L=new u_(t),D=new h_(n,t);n.dragPan=new qo(c,L,D),this._add("mousePan",L),this._add("touchPan",D,["touchZoom","touchRotate"]);const z=new Nr,B=new Sy;n.touchZoomRotate=new Jh(c,B,z,x),this._add("touchRotate",z,["touchPan","touchZoom"]),this._add("touchZoom",B,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nf(n));const F=n.scrollZoom=new Kh(n,this);this._add("scrollZoom",F,["mousePan"]);const H=n.keyboard=new Iy;this._add("keyboard",H);for(const G of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[G]&&n[G].enable(t[G])}_add(t,n,c){this._handlers.push({handlerName:t,handler:n,allowed:c}),this._handlersById[t]=n}stop(t){if(!this._updatingCamera){for(const{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fu(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,n,c){for(const d in t)if(d!==c&&(!n||n.indexOf(d)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const n=[];for(const c of t)this._el.contains(c.target)&&n.push(c);return n}handleEvent(t,n){this._updatingCamera=!0;const c=t.type==="renderFrame",d=c?void 0:t,m={needsRenderFrame:!1},_={},x={},b=t.touches?this._getMapTouches(t.touches):void 0,E=b?Zn(this._el,b):c?void 0:vn(this._el,t);for(const{handlerName:D,handler:z,allowed:B}of this._handlers){if(!z.isEnabled())continue;let F;this._blockedByActive(x,B,D)?z.reset():z[n||t.type]&&(F=z[n||t.type](t,E,b),this.mergeHandlerResult(m,_,F,D,d),F&&F.needsRenderFrame&&this._triggerRenderFrame()),(F||z.isActive())&&(x[D]=z)}const I={};for(const D in this._previousActiveHandlers)x[D]||(I[D]=d);this._previousActiveHandlers=x,(Object.keys(I).length||Qh(m))&&(this._changes.push([m,_,I]),this._triggerRenderFrame()),(Object.keys(x).length||Qh(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:L}=m;L&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],L(this._map))}mergeHandlerResult(t,n,c,d,m){if(!c)return;Object.assign(t,c);const _={handlerName:d,originalEvent:c.originalEvent||m};c.zoomDelta!==void 0&&(n.zoom=_),c.panDelta!==void 0&&(n.drag=_),c.pitchDelta!==void 0&&(n.pitch=_),c.bearingDelta!==void 0&&(n.rotate=_)}_applyChanges(){const t={},n={},c={};for(const[d,m,_]of this._changes)d.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(d.panDelta)),d.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+d.zoomDelta),d.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+d.bearingDelta),d.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+d.pitchDelta),d.around!==void 0&&(t.around=d.around),d.aroundCoord!==void 0&&(t.aroundCoord=d.aroundCoord),d.pinchAround!==void 0&&(t.pinchAround=d.pinchAround),d.noInertia&&(t.noInertia=d.noInertia),Object.assign(n,m),Object.assign(c,_);this._updateMapTransform(t,n,c),this._changes=[]}_updateMapTransform(t,n,c){const d=this._map,m=d.transform,_=Z=>[Z.x,Z.y,Z.z];if((Z=>{const Y=this._eventsInProgress.drag;return Y&&!this._handlersById[Y.handlerName].isActive()})()&&!Qh(t)){const Z=m.zoom;m.cameraElevationReference="sea",this._originalZoom!=null&&m._orthographicProjectionAtLowPitch&&m.projection.name!=="globe"&&m.pitch===0?(m.cameraElevationReference="ground",m.zoom=this._originalZoom):(m.recenterOnTerrain(),m.cameraElevationReference="ground"),Z!==m.zoom&&this._map._update(!0)}if(m._isCameraConstrained&&d._stop(!0),!Qh(t))return void this._fireEvents(n,c,!0);let{panDelta:x,zoomDelta:b,bearingDelta:E,pitchDelta:I,around:L,aroundCoord:D,pinchAround:z}=t;m._isCameraConstrained&&(b>0&&(b=0),m._isCameraConstrained=!1),z!==void 0&&(L=z),(b||(Z=>n[Z]&&!this._eventsInProgress[Z])("drag"))&&L&&(this._dragOrigin=_(m.pointCoordinate3D(L)),this._originalZoom=m.zoom,this._trackingEllipsoid.setup(m._camera.position,this._dragOrigin)),m.cameraElevationReference="sea",d._stop(!0),L=L||d.transform.centerPoint,E&&(m.bearing+=E),I&&(m.pitch+=I),m._updateCameraState();const B=[0,0,0];if(x)if(m.projection.name==="mercator"){const Z=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(L).dir),Y=this._trackingEllipsoid.projectRay(m.screenPointToMercatorRay(L.sub(x)).dir);B[0]=Y[0]-Z[0],B[1]=Y[1]-Z[1]}else{const Z=m.pointCoordinate(L);if(m.projection.name==="globe"){x=x.rotate(-m.angle);const Y=m._pixelsPerMercatorPixel/m.worldSize;B[0]=-x.x*o.eW(o.a$(Z.y))*Y,B[1]=-x.y*o.eW(m.center.lat)*Y}else{const Y=m.pointCoordinate(L.sub(x));Z&&Y&&(B[0]=Y.x-Z.x,B[1]=Y.y-Z.y)}}const F=m.zoom,H=[0,0,0];if(b){const Z=_(D||m.pointCoordinate3D(L)),Y={dir:o.aw([],o.av([],Z,m._camera.position))};if(Y.dir[2]<0){const X=m.zoomDeltaToMovement(Z,b);o.c5(H,Y.dir,X)}}const G=o.d8(B,B,H);m._translateCameraConstrained(G),b&&Math.abs(m.zoom-F)>1e-4&&m.recenterOnTerrain(),m.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,c,!0)}_fireEvents(t,n,c){const d=fu(this._eventsInProgress),m=fu(t),_={};for(const I in t){const{originalEvent:L}=t[I];this._eventsInProgress[I]||(_[`${I}start`]=L),this._eventsInProgress[I]=t[I]}!d&&m&&this._fireEvent("movestart",m.originalEvent);for(const I in _)this._fireEvent(I,_[I]);m&&this._fireEvent("move",m.originalEvent);for(const I in t){const{originalEvent:L}=t[I];this._fireEvent(I,L)}const x={};let b;for(const I in this._eventsInProgress){const{handlerName:L,originalEvent:D}=this._eventsInProgress[I];this._handlersById[L].isActive()||(delete this._eventsInProgress[I],b=n[L]||D,x[`${I}end`]=b)}for(const I in x)this._fireEvent(I,x[I]);const E=fu(this._eventsInProgress);if(c&&(d||m)&&!E){this._updatingCamera=!0;const I=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),L=D=>D!==0&&-this._bearingSnap<D&&D<this._bearingSnap;I?(L(I.bearing||this._map.getBearing())&&(I.bearing=0),this._map.easeTo(I,{originalEvent:b})):(this._map.fire(new o.z("moveend",{originalEvent:b})),L(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,n){this._map.fire(new o.z(t,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Cy("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const ed="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class qf extends o.E{constructor(t,n){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,n){return this.jumpTo({center:t},n)}panBy(t,n,c){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},n),c)}panTo(t,n,c){return this.easeTo(Object.assign({center:t},n),c)}getZoom(){return this.transform.zoom}setZoom(t,n){return this.jumpTo({zoom:t},n),this}zoomTo(t,n,c){return this.easeTo(Object.assign({zoom:t},n),c)}zoomIn(t,n){return this.zoomTo(this.getZoom()+1,t,n),this}zoomOut(t,n){return this.zoomTo(this.getZoom()-1,t,n),this}getBearing(){return this.transform.bearing}setBearing(t,n){return this.jumpTo({bearing:t},n),this}getPadding(){return this.transform.padding}setPadding(t,n){return this.jumpTo({padding:t},n),this}rotateTo(t,n,c){return this.easeTo(Object.assign({bearing:t},n),c)}resetNorth(t,n){return this.rotateTo(0,Object.assign({duration:1e3},t),n),this}resetNorthPitch(t,n){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),n),this}snapToNorth(t,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,n):this}getPitch(){return this.transform.pitch}setPitch(t,n){return this.jumpTo({pitch:t},n),this}cameraForBounds(t,n){t=o.aI.convert(t);const c=n&&n.bearing||0,d=n&&n.pitch||0,m=t.getNorthWest(),_=t.getSouthEast();return this._cameraForBounds(this.transform,m,_,c,d,n)}_extendPadding(t){const n={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},n,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},n,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,n){const c=n.max[0]-n.min[0],d=n.max[1]-n.min[1];return c/d>t.aspect?c/(2*Math.tan(.5*t.fovX)*t.aspect):d/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,n,c,d,m,_){const x=t.clone(),b=this._extendCameraOptions(_);x.bearing=d,x.pitch=m;const E=o.aT.convert(n),I=o.aT.convert(c),L=.5*(E.lat+I.lat),D=.5*(E.lng+I.lng),z=o.eZ(L,D),B=o.aw([],z),F=o.aw([],o.bI([],B,[0,1,0])),H=o.bI([],F,B),G=[F[0],F[1],F[2],0,H[0],H[1],H[2],0,B[0],B[1],B[2],0,0,0,0,1],Z=[z,o.eZ(E.lat,E.lng),o.eZ(I.lat,E.lng),o.eZ(I.lat,I.lng),o.eZ(E.lat,I.lng),o.eZ(L,E.lng),o.eZ(L,I.lng),o.eZ(E.lat,D),o.eZ(I.lat,D)];let Y=o.d9.fromPoints(Z.map(Pe=>[o.bJ(F,Pe),o.bJ(H,Pe),o.bJ(B,Pe)]));const X=o.af([],Y.center,G);o.e_(X)===0&&o.e$(X,0,0,1),o.aw(X,X),o.c5(X,X,o.aD),x.center=o.f0(X);const ce=x.getWorldToCameraMatrix(),ne=o.bl(new Float64Array(16),ce);Y=o.d9.applyTransform(Y,o.aB([],ce,G));const ae=this._extendAABB(Y,x,b,d);if(!ae)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");Y=ae,o.af(X,X,ce);const re=.5*(Y.max[2]-Y.min[2]),ee=this._minimumAABBFrustumDistance(x,Y),ue=o.c5([],[0,0,1],re),be=o.d8(ue,X,ue),xe=ee+(x.pitch===0?0:o.bG(X,be)),De=x.globeCenterInViewSpace,Le=o.av([],X,[De[0],De[1],De[2]]);o.aw(Le,Le),o.c5(Le,Le,xe);const Ue=o.d8([],X,Le);o.af(Ue,Ue,ne);const it=o.eM/o.aD,Ce=o.ag(Ue),_e=o.cf(Math.max(Ce*it-o.eM,Number.EPSILON),0),Fe=Math.min(x.zoomFromMercatorZAdjusted(_e),b.maxZoom);return Fe>.5*(o.c_+o.cL)?(x.setProjection({name:"mercator"}),x.zoom=Fe,this._cameraForBounds(x,n,c,d,m,_)):{center:x.center,zoom:Fe,bearing:d,pitch:m}}_extendAABB(t,n,c,d){const m=.5*((c.padding.left||0)+(c.padding.right||0)),_=.5*((c.padding.top||0)+(c.padding.bottom||0)),x=_,b=m,E=m,I=_,L=n.width-(b+E),D=n.height-(x+I),z=o.av([],t.max,t.min),B=Math.min(L/z[0],D/z[1]),F=Math.min(n.scaleZoom(n.scale*B),c.maxZoom);if(isNaN(F))return null;const H=n.scale/n.zoomScale(F),G=new o.d9([t.min[0]-b*H,t.min[1]-I*H,t.min[2]],[t.max[0]+E*H,t.max[1]+x*H,t.max[2]]),Z=(typeof c.offset.x=="number"&&typeof c.offset.y=="number"?new o.P(c.offset.x,c.offset.y):o.P.convert(c.offset)).rotate(-o.an(d));return G.center[0]-=Z.x*H,G.center[1]+=Z.y*H,G}queryTerrainElevation(t,n){const c=this.transform.elevation;return c?(n=Object.assign({},{exaggerated:!0},n),c.getAtPoint(o.ae.fromLngLat(t),null,n.exaggerated)):null}_cameraForBounds(t,n,c,d,m,_){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,n,c,d,m,_);const x=t.clone(),b=this._extendCameraOptions(_);x.bearing=d,x.pitch=m;const E=o.aT.convert(n),I=o.aT.convert(c),L=new o.aT(E.lng,I.lat),D=new o.aT(I.lng,E.lat),z=x.project(E),B=x.project(I),F=this.queryTerrainElevation(E),H=this.queryTerrainElevation(I),G=this.queryTerrainElevation(L),Z=this.queryTerrainElevation(D),Y=[[z.x,z.y,Math.min(F||0,H||0,G||0,Z||0)],[B.x,B.y,Math.max(F||0,H||0,G||0,Z||0)]];let X=o.d9.fromPoints(Y);const ce=x.getWorldToCameraMatrix(),ne=o.bl(new Float64Array(16),ce);X=o.d9.applyTransform(X,ce);const ae=this._extendAABB(X,x,b,d);if(!ae)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");X=ae;const re=.5*o.av([],X.max,X.min)[2],ee=this._minimumAABBFrustumDistance(x,X),ue=[0,0,1,0];o.aC(ue,ue,ce),o.f1(ue,ue);const be=o.c5([],ue,ee+re),xe=o.d8([],X.center,be);o.af(X.center,X.center,ne),o.af(xe,xe,ne);const De=x.unproject(new o.P(X.center[0],X.center[1])),Le=o.f2(x.projection,De),Ue=Math.pow(2,Le),it=Math.min(x._zoomFromMercatorZ(xe[2]*x.pixelsPerMeter*Ue/x.worldSize),b.maxZoom);return x.mercatorFromTransition&&it<.5*(o.c_+o.cL)?(x.setProjection({name:"globe"}),x.zoom=it,this._cameraForBounds(x,n,c,d,m,_)):{center:De,zoom:it,bearing:d,pitch:m}}fitBounds(t,n,c){const d=this.cameraForBounds(t,n);return this._fitInternal(d,n,c)}fitScreenCoordinates(t,n,c,d,m){const _=o.P.convert(t),x=o.P.convert(n),b=new o.P(Math.min(_.x,x.x),Math.min(_.y,x.y)),E=new o.P(Math.max(_.x,x.x),Math.max(_.y,x.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(_,x))return this;const I=this.transform.pointLocation3D(b),L=this.transform.pointLocation3D(E),D=this.transform.pointLocation3D(new o.P(b.x,E.y)),z=this.transform.pointLocation3D(new o.P(E.x,b.y)),B=[Math.min(I.lng,L.lng,D.lng,z.lng),Math.min(I.lat,L.lat,D.lat,z.lat)],F=[Math.max(I.lng,L.lng,D.lng,z.lng),Math.max(I.lat,L.lat,D.lat,z.lat)],H=d&&d.pitch?d.pitch:this.getPitch(),G=this._cameraForBounds(this.transform,B,F,c,H,d);return this._fitInternal(G,d,m)}_fitInternal(t,n,c){return t?(n=Object.assign(t,n)).linear?this.easeTo(n,c):this.flyTo(n,c):this}jumpTo(t,n){this.stop();const c=t.preloadOnly?this.transform.clone():this.transform;let d=!1,m=!1,_=!1;"zoom"in t&&c.zoom!==+t.zoom&&(d=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=o.aT.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(m=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(_=!0,c.pitch=+t.pitch);const x=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!c.isPaddingEqual(x))if(t.retainPadding===!1){const b=c.clone();b.padding=x,c.setLocationAtPoint(c.center,b.centerPoint)}else c.padding=x;return t.preloadOnly?(this._preloadTiles(c),this):(this.fire(new o.z("movestart",n)).fire(new o.z("move",n)),d&&this.fire(new o.z("zoomstart",n)).fire(new o.z("zoom",n)).fire(new o.z("zoomend",n)),m&&this.fire(new o.z("rotatestart",n)).fire(new o.z("rotate",n)).fire(new o.z("rotateend",n)),_&&this.fire(new o.z("pitchstart",n)).fire(new o.z("pitch",n)).fire(new o.z("pitchend",n)),this.fire(new o.z("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(ed),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,n){const c=this.transform;if(!c.projection.supportsFreeCamera)return o.w(ed),this;this.stop();const d=c.zoom,m=c.pitch,_=c.bearing;c.setFreeCameraOptions(t);const x=d!==c.zoom,b=m!==c.pitch,E=_!==c.bearing;return this.fire(new o.z("movestart",n)).fire(new o.z("move",n)),x&&this.fire(new o.z("zoomstart",n)).fire(new o.z("zoom",n)).fire(new o.z("zoomend",n)),E&&this.fire(new o.z("rotatestart",n)).fire(new o.z("rotate",n)).fire(new o.z("rotateend",n)),b&&this.fire(new o.z("pitchstart",n)).fire(new o.z("pitch",n)).fire(new o.z("pitchend",n)),this.fire(new o.z("moveend",n)),this}easeTo(t,n){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:o.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const c=this.transform,d=this.getZoom(),m=this.getBearing(),_=this.getPitch(),x=this.getPadding(),b="zoom"in t?+t.zoom:d,E="bearing"in t?this._normalizeBearing(t.bearing,m):m,I="pitch"in t?+t.pitch:_,L=this._extendPadding(t.padding),D=o.P.convert(t.offset);let z,B,F;if(c.projection.name==="globe"){const ue=o.ae.fromLngLat(c.center),be=D.rotate(-c.angle);ue.x+=be.x/c.worldSize,ue.y+=be.y/c.worldSize;const xe=ue.toLngLat(),De=o.aT.convert(t.center||xe);this._normalizeCenter(De),z=c.centerPoint.add(be),B=new o.P(ue.x,ue.y).mult(c.worldSize),F=new o.P(o.aF(De.lng),o.aJ(De.lat)).mult(c.worldSize).sub(B)}else{z=c.centerPoint.add(D);const ue=c.pointLocation(z),be=o.aT.convert(t.center||ue);this._normalizeCenter(be),B=c.project(ue),F=c.project(be).sub(B)}const H=c.zoomScale(b-d);let G,Z;t.around&&(G=o.aT.convert(t.around),Z=c.locationPoint(G));const Y=this._zooming||b!==d,X=this._rotating||m!==E,ce=this._pitching||I!==_,ne=!c.isPaddingEqual(L),ae=t.retainPadding===!1?c.clone():c,re=ue=>be=>{if(Y&&(ue.zoom=o.ak(d,b,be)),X&&(ue.bearing=o.ak(m,E,be)),ce&&(ue.pitch=o.ak(_,I,be)),ne&&(ae.interpolatePadding(x,L,be),z=ae.centerPoint.add(D)),G)ue.setLocationAtPoint(G,Z);else{const xe=ue.zoomScale(ue.zoom-d),De=b>d?Math.min(2,H):Math.max(.5,H),Le=Math.pow(De,1-be),Ue=ue.unproject(B.add(F.mult(be*Le)).mult(xe));ue.setLocationAtPoint(ue.renderWorldCopies?Ue.wrap():Ue,z)}return t.preloadOnly||this._fireMoveEvents(n),ue};if(t.preloadOnly){const ue=this._emulate(re,t.duration,c);return this._preloadTiles(ue),this}const ee={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=Y,this._rotating=X,this._pitching=ce,this._padding=ne,this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,ee),this._ease(re(c),ue=>{c.cameraElevationReference==="sea"&&c.recenterOnTerrain(),this._afterEase(n,ue)},t),this}_prepareEase(t,n,c={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||c.moving||this.fire(new o.z("movestart",t)),this._zooming&&!c.zooming&&this.fire(new o.z("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new o.z("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new o.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.z("move",t)),this._zooming&&this.fire(new o.z("zoom",t)),this._rotating&&this.fire(new o.z("rotate",t)),this._pitching&&this.fire(new o.z("pitch",t))}_afterEase(t,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const c=this._zooming,d=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new o.z("zoomend",t)),d&&this.fire(new o.z("rotateend",t)),m&&this.fire(new o.z("pitchend",t)),this.fire(new o.z("moveend",t))}flyTo(t,n){if(this._prefersReducedMotion(t)){const Pe=o.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Pe,n)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eV},t);const c=this.transform,d=this.getZoom(),m=this.getBearing(),_=this.getPitch(),x=this.getPadding(),b="zoom"in t?o.aA(+t.zoom,c.minZoom,c.maxZoom):d,E="bearing"in t?this._normalizeBearing(t.bearing,m):m,I="pitch"in t?+t.pitch:_,L=this._extendPadding(t.padding),D=c.zoomScale(b-d),z=o.P.convert(t.offset);let B=c.centerPoint.add(z);const F=c.pointLocation(B),H=o.aT.convert(t.center||F);this._normalizeCenter(H);const G=c.project(F),Z=c.project(H).sub(G);let Y=t.curve;const X=Math.max(c.width,c.height),ce=X/D,ne=Z.mag();if("minZoom"in t){const Pe=o.aA(Math.min(t.minZoom,d,b),c.minZoom,c.maxZoom),We=X/c.zoomScale(Pe-d);Y=Math.sqrt(We/ne*2)}const ae=Y*Y;function re(Pe){const We=(ce*ce-X*X+(Pe?-1:1)*ae*ae*ne*ne)/(2*(Pe?ce:X)*ae*ne);return Math.log(Math.sqrt(We*We+1)-We)}function ee(Pe){return(Math.exp(Pe)-Math.exp(-Pe))/2}function ue(Pe){return(Math.exp(Pe)+Math.exp(-Pe))/2}const be=re(0);let xe=function(Pe){return ue(be)/ue(be+Y*Pe)},De=function(Pe){return X*((ue(be)*(ee(We=be+Y*Pe)/ue(We))-ee(be))/ae)/ne;var We},Le=(re(1)-be)/Y;if(Math.abs(ne)<1e-6||!isFinite(Le)){if(Math.abs(X-ce)<1e-6)return this.easeTo(t,n);const Pe=ce<X?-1:1;Le=Math.abs(Math.log(ce/X))/Y,De=function(){return 0},xe=function(We){return Math.exp(Pe*Y*We)}}t.duration="duration"in t?+t.duration:1e3*Le/("screenSpeed"in t?+t.screenSpeed/Y:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ue=m!==E,it=I!==_,Ce=!c.isPaddingEqual(L),_e=t.retainPadding===!1?c.clone():c,Fe=Pe=>We=>{const dt=We*Le,Tt=1/xe(dt);Pe.zoom=We===1?b:d+Pe.scaleZoom(Tt),Ue&&(Pe.bearing=o.ak(m,E,We)),it&&(Pe.pitch=o.ak(_,I,We)),Ce&&(_e.interpolatePadding(x,L,We),B=_e.centerPoint.add(z));const ct=We===1?H:Pe.unproject(G.add(Z.mult(De(dt))).mult(Tt));return Pe.setLocationAtPoint(Pe.renderWorldCopies?ct.wrap():ct,B),Pe._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(n),Pe};if(t.preloadOnly){const Pe=this._emulate(Fe,t.duration,c);return this._preloadTiles(Pe),this}return this._zooming=!0,this._rotating=Ue,this._pitching=it,this._padding=Ce,this._prepareEase(n,!1),this._ease(Fe(c),()=>this._afterEase(n),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const c=this._onEaseEnd;this._onEaseEnd=void 0,c.call(this,n)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,n,c){c.animate===!1||c.duration===0?(t(1),n()):(this._easeStart=o.o.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,n){t=o.bT(t,-180,180);const c=Math.abs(t-n);return Math.abs(t-360-n)<c&&(t-=360),Math.abs(t+360-n)<c&&(t+=360),t}_normalizeCenter(t){const n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;const c=t.lng-n.center.lng;t.lng+=c>180?-360:c<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,n,c){const d=Math.ceil(15*n/1e3),m=[],_=t(c.clone());for(let x=0;x<=d;x++){const b=_(x/d);m.push(b.clone())}return m}_preloadTiles(t,n){}}class mu{constructor(t={}){this.options=t,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const n=this.options&&this.options.compact,c=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=rt("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",c);const d=rt("span","mapboxgl-ctrl-icon",this._compactButton);return d.setAttribute("aria-hidden","true"),d.setAttribute("title",c),this._innerContainer=rt("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const c=n.reduce((d,m,_)=>(m.value&&(d+=`${m.key}=${m.value}${_<n.length-1?"&":""}`),d),"?");t.href=`${o.e.FEEDBACK_URL}/${c}#${wn(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const d=this._map.style.stylesheet;this.styleOwner=d.owner,this.styleId=d.id}const n=this._map.style._mergedSourceCaches;for(const d in n){const m=n[d];if(m.used){const _=m.getSource();_.attribution&&t.indexOf(_.attribution)<0&&t.push(_.attribution)}}t.sort((d,m)=>d.length-m.length),t=t.filter((d,m)=>{for(let _=m+1;_<t.length;_++)if(t[_].indexOf(d)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const c=t.map(d=>function(m){const _=new DOMParser().parseFromString(m,"text/html");return Array.from(_.body.querySelectorAll("*")).forEach(x=>{const b=x.textContent||"";if(x.tagName!=="A")return void x.replaceWith(_.createTextNode(b));const E=x.getAttribute("href");if(!E||!/^(https?:|mailto:)/i.test(E))return void x.replaceWith(_.createTextNode(b));const I=_.createElement("a");I.href=E,I.textContent=b,I.rel="noopener nofollow";const L=x.getAttribute("class");L&&(I.className=L),x.replaceWith(I)}),_.body.innerHTML}(d)).join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class _u{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=rt("div","mapboxgl-ctrl");const n=rt("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const n in t){const c=t[n].getSource();if(c.hasOwnProperty("mapbox_logo")&&!c.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const n=t[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class uc{constructor(){o.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",n=>this._onIndoorUpdate(n)),this._container}_createButton(t,n){const c=rt("button",t,this._container);return c.type="button",c.addEventListener("click",n),c}_createSeparator(){return rt("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,n){this._map&&(t.setAttribute("aria-label",n),t.textContent=n)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const n=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",n&&Array.from(this._container.children).forEach(c=>c.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const n=this._map;this._model&&n&&n._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});rt("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,n){for(let c=0;c<t.length;c++){const d=t[c],m=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(d.id)});this._setButtonTitle(m,d.zIndex.toString()),this._model&&d.id===this._model.selectedFloorId&&n&&m.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(m),c<t.length-1&&this._createSeparator()}}}class da{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const n=++this._id;return this._queue.push({callback:t,id:n,cancelled:!1}),n}remove(t){const n=this._currentlyRunning,c=n?this._queue.concat(n):this._queue;for(const d of c)if(d.id===t)return void(d.cancelled=!0)}run(t=0){const n=this._currentlyRunning=this._queue;this._queue=[];for(const c of n)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class fa{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const n=o.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,n,c){this._start=this.getValue(n),this._end=t,this._startTime=n,this._endTime=n+c}}const pa={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Wa extends o.z{constructor(t,n,c,d){const{point:m,lngLat:_,originalEvent:x,target:b}=t;super(t.type,{point:m,lngLat:_,originalEvent:x,target:b}),this.preventDefault=()=>{t.preventDefault()},this.id=n,this.interaction=c,this.feature=d}}class Eo{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,n){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const c=n.filter;let d=n.type;c&&this.filters.set(t,o.b6(c)),d==="mouseover"&&(d="mouseenter"),d==="mouseout"&&(d="mouseleave");const m=this.interactionsByType.get(d)||new Map;d==="mouseenter"||d==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,n)):m.size===0&&this.map.on(d,this.handleType),m.size===0&&this.interactionsByType.set(d,m),m.set(t,n),this.typeById.set(t,d)}get(t){const n=this.typeById.get(t);if(!n)return;const c=this.interactionsByType.get(n);return c?c.get(t):void 0}remove(t){const n=this.typeById.get(t);if(!n)return;this.typeById.delete(t),this.filters.delete(t);const c=this.interactionsByType.get(n);c&&(c.delete(t),n==="mouseenter"||n==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):c.size===0&&this.map.off(n,this.handleType))}queryTargets(t,n){const c=[];for(const[d,m]of n)m.target&&c.push({targetId:d,target:m.target,filter:this.filters.get(d)});return this.map.style.queryRenderedTargets(t,c,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const n=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());n.length&&(t.type="mouseenter",this.handleType(t,n));const c=new Map;for(const[d,{feature:m}]of this.prevHoveredFeatures)this.hoveredFeatures.has(d)||c.set(m.id,m);c.size&&(t.type="mouseleave",this.handleType(t,Array.from(c.values())))}handleOut(t){const n=Array.from(this.hoveredFeatures.values()).map(({feature:c})=>c);n.length&&(t.type="mouseleave",this.handleType(t,n)),this.hoveredFeatures.clear()}handleType(t,n){const c=t.type==="mouseenter";if(c&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const d=Array.from(this.interactionsByType.get(t.type)).reverse(),m=!!n;n=n||this.queryTargets(t.point,d);let _=!1;const x=new Set;for(const b of n){for(const[E,I]of d){if(!I.target)continue;const L=b.variants?b.variants[E]:null;if(L){for(const D of L){if(jl(D,b,x,E))continue;const z=new o.dx(b,D),B=ul(D,b,E);m&&z.id!==void 0&&(z.state=this.map.getFeatureState(z));const F=c?this.prevHoveredFeatures.get(B):null,H=new Wa(t,E,I,z),G=F?F.stop:I.handler(H);if(c&&this.hoveredFeatures.set(B,{feature:b,stop:G}),G!==!1){_=!0;break}}if(_)break}}if(_)break}if(!_)for(const[b,E]of d){const{handler:I,target:L}=E;if(!L&&I(new Wa(t,b,E,null))!==!1)break}}}function My(l,t){if(Array.isArray(l)&&Array.isArray(t)){const n=new Set(l),c=new Set(t);return n.size===c.size&&l.every(d=>c.has(d))}return o.by(l,t)}const Ry={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Dy={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ly{constructor(t,n,c=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new Uf({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new jf({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,n){this.mouseRotate.mousedown(t,n),this.mousePitch&&this.mousePitch.mousedown(t,n),Zt()}move(t,n){const c=this.map,d=this.mouseRotate.mousemoveWindow(t,n),m=d&&d.bearingDelta;if(m&&c.setBearing(c.getBearing()+m),this.mousePitch){const _=this.mousePitch.mousemoveWindow(t,n),x=_&&_.pitchDelta;x&&c.setPitch(c.getPitch()+x)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Li(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),vn(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,vn(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Zn(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=Zn(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function $f(l,t,n){if(l=new o.aT(l.lng,l.lat),t){const c=new o.aT(l.lng-360,l.lat),d=new o.aT(l.lng+360,l.lat),m=360*Math.ceil(Math.abs(l.lng-n.center.lng)/360),_=n.locationPoint3D(l).distSqr(t),x=t.x<0||t.y<0||t.x>n.width||t.y>n.height;n.locationPoint3D(c).distSqr(t)<_&&(x||Math.abs(c.lng-n.center.lng)<m)?l=c:n.locationPoint3D(d).distSqr(t)<_&&(x||Math.abs(d.lng-n.center.lng)<m)&&(l=d)}for(;Math.abs(l.lng-n.center.lng)>180;){const c=n.locationPoint3D(l);if(c.x>=0&&c.y>=0&&c.x<=n.width&&c.y<=n.height)break;l.lng>n.center.lng?l.lng-=360:l.lng+=360}return l}const ns={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},no={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class td extends o.E{constructor(t,n){super(),(t instanceof HTMLElement||n)&&(t=Object.assign({element:t},n)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:c="center",color:d="#3FB1CE",scale:m=1,draggable:_=!1,clickTolerance:x=0,rotation:b=no.rotation,rotationAlignment:E=no.rotationAlignment,pitchAlignment:I=no.pitchAlignment,occludedOpacity:L=no.occludedOpacity,altitude:D=no.altitude}=t||{};this._anchor=c,this._color=d,this._scale=m,this._draggable=_,this._clickTolerance=x,this._rotation=b,this._rotationAlignment=E,this._pitchAlignment=I,this._occludedOpacity=L,this._altitude=D,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",F=>{F.preventDefault()}),this._element.addEventListener("mousedown",F=>{F.preventDefault()});const z=this._element.classList;for(const F in ns)z.remove(`mapboxgl-marker-anchor-${F}`);z.add(`mapboxgl-marker-anchor-${this._anchor}`);const B=t&&t.className?t.className.trim().split(/\s+/):[];z.add(...B),this._popup=null}_createDefaultMarker(){const t=rt("div"),n=mt("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const c=mt("radialGradient",{id:"shadowGradient"},mt("defs",{},n));mt("stop",{offset:"10%","stop-opacity":.4},c),mt("stop",{offset:"100%","stop-opacity":.05},c),mt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},n)}return mt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},n),mt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},n),mt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},n),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||no.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const d=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[d,-1*(38.1-13.5+d)],"bottom-right":[-d,-1*(38.1-13.5+d)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const n=t.code,c=t.charCode||t.keyCode;n!=="Space"&&n!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const n=t.originalEvent.target,c=this._element;this._popup&&(n===c||c.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,n=this._pos;if(!t||!n)return!1;const c=t.unproject(n,this._altitude),d=t.getFreeCameraOptions();if(!d.position)return!1;const m=d.position.toLngLat();return m.distanceTo(c)<.9*m.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const n=this._pos;if(!n||n.x<0||n.x>t.transform.width||n.y<0||n.y>t.transform.height)return void this._clearFadeTimer();const c=t.unproject(n,this._altitude);let d;t._showingGlobe()&&o.f5(t.transform,this._lngLat)?d=0:(d=1-t._queryFogOpacity(c),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(d*=this._occludedOpacity)),this._element.style.opacity=`${d}`,this._element.style.pointerEvents=d>0?"auto":"none",this._popup&&this._popup._setOpacity(d),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${ns[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){const t=this._pos,n=this._map,c=this.getPitchAlignment();if(!n||!t||c!=="map")return"";if(!n._showingGlobe()){const b=n.getPitch();return b?`rotateX(${b}deg)`:""}const d=o.cX(o.f6(n.transform,this._lngLat)),m=t.sub(o.f7(n.transform)),_=Math.abs(m.x)+Math.abs(m.y);if(_===0)return"";const x=d/_;return`rotateX(${-m.y*x}deg) rotateY(${m.x*x}deg)`}_calculateZTransform(){const t=this._pos,n=this._map;if(!n||!t)return"";let c=0;const d=this.getRotationAlignment();if(d==="map")if(n._showingGlobe()){const m=n.project(new o.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),_=n.project(new o.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(m);c=o.cX(Math.atan2(_.y,_.x))-90}else c=-n.getBearing();else if(d==="horizon"){const m=o.ah(4,6,n.getZoom()),_=o.f7(n.transform);_.y+=m*n.transform.height;const x=t.sub(_),b=o.cX(Math.atan2(x.y,x.x));c=(b>90?b-270:b+90)*(1-m)}return c+=this._rotation,c?`rotateZ(${c}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=$f(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const n=this._map;if(!n)return;const c=this._pointerdownPos,d=this._positionDelta;if(c&&d){if(!this._isDragging){const m=this._clickTolerance||n._clickTolerance;if(t.point.dist(c)<m)return;this._isDragging=!0}this._pos=t.point.sub(d),this._lngLat=n.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(t){const n=this._map,c=this._pos;n&&c&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(c),this._pointerdownPos=t.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const n=this._map;return n&&(t?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||no.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||no.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||no.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||no.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const zy={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},hc={maxWidth:100,unit:"metric"},Wf={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},so={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},oo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Pl(l=new o.P(0,0),t="bottom"){if(typeof l=="number"){const n=Math.round(Math.sqrt(.5*Math.pow(l,2)));switch(t){case"top":return new o.P(0,l);case"top-left":return new o.P(n,n);case"top-right":return new o.P(-n,n);case"bottom":return new o.P(0,-l);case"bottom-left":return new o.P(n,-n);case"bottom-right":return new o.P(-n,-n);case"left":return new o.P(l,0);case"right":return new o.P(-l,0)}return new o.P(0,0)}return l instanceof o.P||Array.isArray(l)?o.P.convert(l):o.P.convert(l[t]||[0,0])}return{version:Q,supported:ft.supported,setRTLTextPlugin:o.fb,getRTLTextPluginStatus:o.fa,Map:class extends qf{constructor(l){he.mark(pe.create);const t=l;if((l=Object.assign({},Ry,l)).minZoom!=null&&l.maxZoom!=null&&l.minZoom>l.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(l.minPitch!=null&&l.maxPitch!=null&&l.minPitch>l.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(l.minPitch!=null&&l.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(l.maxPitch!=null&&l.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(l.antialias&&o.f3(window)&&(l.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Xd(l.minZoom,l.maxZoom,l.minPitch,l.maxPitch,l.renderWorldCopies,null,null),l),this._repaint=!!l.repaint,this._interactive=l.interactive,this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._failIfMajorPerformanceCaveat=l.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=l.preserveDrawingBuffer,this._antialias=l.antialias,this._trackResize=l.trackResize,this._bearingSnap=l.bearingSnap,this._refreshExpiredTiles=l.refreshExpiredTiles,this._fadeDuration=l.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=l.crossSourceCollisions,this._collectResourceTiming=l.collectResourceTiming,this._language=this._parseLanguage(l.language),this._worldview=l.worldview,this._renderTaskQueue=new da,this._domRenderTaskQueue=new da,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b2(),this._locale=Object.assign({},pa,l.locale),this._clickTolerance=l.clickTolerance,this._cooperativeGestures=l.cooperativeGestures,this._performanceMetricsCollection=l.performanceMetricsCollection,this._tessellationStep=l.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=l.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fa(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=l.scaleFactor,this._requestManager=new Ro(l.transformRequest,l.accessToken,l.testMode),this._silenceAuthErrors=!!l.testMode,this._contextCreateOptions=l.contextCreateOptions?Object.assign({},l.contextCreateOptions):{},typeof l.container=="string"){const n=document.getElementById(l.container);if(!n)throw new Error(`Container '${l.container.toString()}' not found.`);this._container=n}else{if(!(l.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=l.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),l.maxBounds&&this.setMaxBounds(l.maxBounds),this._spriteFormat=l.spriteFormat,o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Py(this,l),this._localFontFamily=l.localFontFamily,this._localIdeographFontFamily=l.localIdeographFontFamily,(l.style||!l.testMode)&&this.setStyle(l.style||o.e.DEFAULT_STYLE,{config:l.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),l.projection&&this.setProjection(l.projection),l.hash&&(this._hash=new Lf(typeof l.hash=="string"&&l.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:l.center,zoom:l.zoom,bearing:l.bearing,pitch:l.pitch});const n=l.bounds;n&&(this.resize(),this.fitBounds(n,Object.assign({},l.fitBoundsOptions,{duration:0})))}this.resize(),l.attributionControl&&this.addControl(new mu({customAttribution:l.customAttribution})),this._logoControl=new _u,this.addControl(this._logoControl,l.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new o.z(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new o.z(`${n.dataType}dataloading`,n))}),this._interactions=new Eo(this)}_getMapId(){return this._mapId}addControl(l,t){if(t===void 0&&(t=l.getDefaultPosition?l.getDefaultPosition():"top-right"),!l||!l.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=l.onAdd(this);this._controls.push(l);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(n,c.firstChild):c.appendChild(n),this}removeControl(l){if(!l||!l.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(l);return t>-1&&this._controls.splice(t,1),l.onRemove(this),this}hasControl(l){return this._controls.indexOf(l)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(l){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),this.fire(new o.z("resize",l)),t&&this.fire(new o.z("moveend",l)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(l){return this.transform.setMaxBounds(o.aI.convert(l)),this._update()}setMinZoom(l){if((l=l??-2)>=-2&&l<=this.transform.maxZoom)return this.transform.minZoom=l,this._update(),this.getZoom()<l?this.setZoom(l):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(l){if((l=l??22)>=this.transform.minZoom)return this.transform.maxZoom=l,this._update(),this.getZoom()>l?this.setZoom(l):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(l){if((l=l??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(l>=0&&l<=this.transform.maxPitch)return this.transform.minPitch=l,this._update(),this.getPitch()<l?this.setPitch(l):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(l){if((l=l??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(l>=this.transform.minPitch)return this.transform.maxPitch=l,this._update(),this.getPitch()>l?this.setPitch(l):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(l){return this._scaleFactor=l,this.painter.scaleFactor=l,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(l){return this.transform.renderWorldCopies=l,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(l){return l==="auto"?navigator.language:Array.isArray(l)?l.length===0?void 0:l.map(t=>t==="auto"?navigator.language:t):l}setLanguage(l){const t=this._parseLanguage(l);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(l){return this.style&&l!==this._worldview?(this._worldview=l,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(l){return this._lazyInitEmptyStyle(),l?typeof l=="string"&&(l={name:l}):l=null,this._useExplicitProjection=!!l,this._prioritizeAndUpdateProjection(l,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const l=this.transform,t=l.projection.name;let n;t==="globe"&&l.zoom>=o.cL?(l.setMercatorFromTransition(),n=!0):t==="mercator"&&l.zoom<o.cL&&(l.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(l,t){return this._updateProjection(l||t||{name:"mercator"})}_updateProjection(l){let t;const n=this.transform.mercatorFromTransition;t=l.name==="globe"&&this.transform.zoom>=o.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(l),this.style.applyProjectionUpdate();const c=this.transform.getProjection().name==="mercator"&&n!==this.transform.mercatorFromTransition;return(t||c)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(l,t){return this.transform.locationPoint3D(o.aT.convert(l),t)}unproject(l,t){return this.transform.pointLocation3D(o.P.convert(l),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(l,t,n){const c=d=>{let m=[];if(Array.isArray(t)){const _=t.filter(x=>this.getLayer(x));m=_.length?this.queryRenderedFeatures(d,{layers:_}):[]}else m=this.queryRenderedFeatures(d,{target:t});return m};if(l==="mouseenter"||l==="mouseover"){let d=!1;return{listener:n,targets:t,delegates:{mousemove:_=>{const x=c(_.point);x.length?d||(d=!0,n.call(this,new As(l,this,_.originalEvent,{features:x}))):d=!1},mouseout:()=>{d=!1}}}}if(l==="mouseleave"||l==="mouseout"){let d=!1;return{listener:n,targets:t,delegates:{mousemove:x=>{c(x.point).length?d=!0:d&&(d=!1,n.call(this,new As(l,this,x.originalEvent)))},mouseout:x=>{d&&(d=!1,n.call(this,new As(l,this,x.originalEvent)))}}}}{const d=m=>{const _=c(m.point);_.length&&(m.features=_,n.call(this,m),delete m.features)};return{listener:n,targets:t,delegates:{[l]:d}}}}on(l,t,n){if(typeof t=="function"||n===void 0)return super.on(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[l]=this._delegatedListeners[l]||[],this._delegatedListeners[l].push(c);for(const d in c.delegates)this.on(d,c.delegates[d]);return this}once(l,t,n){if(typeof t=="function"||n===void 0)return super.once(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._createDelegatedListener(l,t,n);for(const d in c.delegates)this.once(d,c.delegates[d]);return this}off(l,t,n){if(typeof t=="function"||n===void 0)return super.off(l,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const c=this._delegatedListeners?this._delegatedListeners[l]:void 0;return c&&(d=>{for(let m=0;m<d.length;m++){const _=d[m];if(_.listener===n&&My(_.targets,t)){for(const x in _.delegates)this.off(x,_.delegates[x]);return d.splice(m,1),this}}})(c),this}queryRenderedFeatures(l,t){if(!this.style)return[];if(l===void 0||l instanceof o.P||Array.isArray(l)||t!==void 0||(t=l,l=void 0),l=l||[[0,0],[this.transform.width,this.transform.height]],!t){const m=this.style.queryRenderedFeatures(l,void 0,this.transform),_=this.style.queryRenderedFeatureset(l,void 0,this.transform);return m.concat(_)}let n=!0;if(t.target&&(n=this._isTargetValid(t.target),n&&!t.layers))return this.style.queryRenderedFeatureset(l,t,this.transform);let c=!0;if(t.layers&&Array.isArray(t.layers)){for(const m of t.layers)if(!this._isValidId(m)){c=!1;break}if(c&&!t.target)return this.style.queryRenderedFeatures(l,t,this.transform)}let d=[];return c&&(d=d.concat(this.style.queryRenderedFeatures(l,t,this.transform))),n&&(d=d.concat(this.style.queryRenderedFeatureset(l,t,this.transform))),d}querySourceFeatures(l,t){return!l||typeof l=="string"&&!this._isValidId(l)?[]:this.style.querySourceFeatures(l,t)}queryRasterValue(l,t,n){return this._isValidId(l)?this.style.queryRasterValue(l,t,n):Promise.resolve(null)}isPointOnSurface(l){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(l))}addInteraction(l,t){return this._interactions.add(l,t),this}removeInteraction(l){return this._interactions.remove(l),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(l){return this._cooperativeGestures=l,this}setStyle(l,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&l&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(l,(n,c)=>{if(n){const d=typeof n=="string"?n:n instanceof Error?n.message:n.error;o.w(`Unable to perform style diff: ${d}. Rebuilding the style from scratch.`),this._updateStyle(l,t)}else c&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(l,t))}_getUIString(l){const t=this._locale[l];if(t==null)throw new Error(`Missing UI string '${l}'`);return t}_updateStyle(l,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),l){const n=Object.assign({},t);t&&t.config&&(n.initialConfig=t.config,delete n.config),this.style=new ro(this,n).load(l),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(l){return l==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dr(l)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${l}".`))),!1)}_isTargetValid(l){return"featuresetId"in l?this._isValidId("importId"in l?l.importId:l.featuresetId):"layerId"in l&&this._isValidId(l.layerId)}_areTargetsValid(l){if(Array.isArray(l)){for(const t of l)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(l)}addSource(l,t){return this._isValidId(l)?(this._lazyInitEmptyStyle(),this.style.addSource(l,t),this._update(!0)):this}isSourceLoaded(l){return!!this._isValidId(l)&&!!this.style&&this.style._isSourceCacheLoaded(l)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(l,t,n){this._lazyInitEmptyStyle(),this.style.addSourceType(l,t,n)}removeSource(l){return this._isValidId(l)?(this.style.removeSource(l),this._updateTerrain(),this._update(!0)):this}getSource(l){return this._isValidId(l)?this.style.getOwnSource(l):null}addImage(l,t,{pixelRatio:n=1,sdf:c=!1,stretchX:d,stretchY:m,content:_}={}){this._lazyInitEmptyStyle();const x=o.I.from(l);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:b,height:E,data:I}=o.o.getImageData(t);this.style.addImage(x,{data:new o.q({width:b,height:E},I),pixelRatio:n,stretchX:d,stretchY:m,content:_,sdf:c,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:b,height:E}=t,I=t;this.style.addImage(x,{data:new o.q({width:b,height:E},new Uint8Array(I.data)),pixelRatio:n,stretchX:d,stretchY:m,content:_,sdf:c,usvg:!1,version:0,userImage:I}),I.onAdd&&I.onAdd(this,l)}}updateImage(l,t){this._lazyInitEmptyStyle();const n=o.I.from(l),c=this.style.getImage(n);if(!c)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const d=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.o.getImageData(t):t,{width:m,height:_,data:x}=d;if(m===void 0||_===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==(c.usvg?c.icon.usvg_tree.width:c.data.width)||_!==(c.usvg?c.icon.usvg_tree.height:c.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${m}, ${_})
                must be that same as the previous version of the image
                (${c.data.width}, ${c.data.height})`)));const b=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let E=!1;c.usvg?(c.data=new o.q({width:m,height:_},new Uint8Array(x)),c.usvg=!1,c.icon=void 0,E=!0):c.data.replace(x,b),this.style.updateImage(n,c,E)}hasImage(l){return l?!!this.style&&!!this.style.getImage(o.I.from(l)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(l){this.style.removeImage(o.I.from(l))}loadImage(l,t){o.n(this._requestManager.transformRequest(l,o.R.Image),(n,c)=>{t(n,c instanceof HTMLImageElement?o.o.getImageData(c):c)})}listImages(){return this.style.listImages().map(l=>l.name)}addModel(l,t){this._lazyInitEmptyStyle(),this.style.addModel(l,t)}hasModel(l){return l?this.style.hasModel(l):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(l){this.style.removeModel(l)}listModels(){return this.style.listModels()}addLayer(l,t){return this._isValidId(l.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(l,t),this._update(!0)):this}getSlot(l){const t=this.getLayer(l);return t&&t.slot||null}setSlot(l,t){return this.style.setSlot(l,t),this.style.mergeLayers(),this._update(!0)}addImport(l,t){return this.style.addImport(l,t).catch(n=>this.fire(new o.y(new Error("Failed to add import",n)))),this}updateImport(l,t){return typeof t!="string"&&t.id!==l?(this.removeImport(l),this.addImport(t)):(this.style.updateImport(l,t),this._update(!0))}removeImport(l){return this.style.removeImport(l),this}moveImport(l,t){return this.style.moveImport(l,t),this._update(!0)}moveLayer(l,t){return this._isValidId(l)?(this.style.moveLayer(l,t),this._update(!0)):this}removeLayer(l){return this._isValidId(l)?(this.style.removeLayer(l),this._update(!0)):this}getLayer(l){if(!this._isValidId(l))return null;const t=this.style.getOwnLayer(l);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(l,t,n){return this._isValidId(l)?(this.style.setLayerZoomRange(l,t,n),this._update(!0)):this}setFilter(l,t,n={}){return this._isValidId(l)?(this.style.setFilter(l,t,n),this._update(!0)):this}getFilter(l){return this._isValidId(l)?this.style.getFilter(l):null}setPaintProperty(l,t,n,c={}){return this._isValidId(l)?(this.style.setPaintProperty(l,t,n,c),this._update(!0)):this}getPaintProperty(l,t){return this._isValidId(l)?this.style.getPaintProperty(l,t):null}setLayoutProperty(l,t,n,c={}){return this._isValidId(l)?(this.style.setLayoutProperty(l,t,n,c),this._update(!0)):this}getLayoutProperty(l,t){return this._isValidId(l)?this.style.getLayoutProperty(l,t):null}setLayerProperty(l,t,n,c={}){return this._isValidId(l)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(l,t,n,c),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(l){return this.style.setGlyphsUrl(l),this._update(!0)}getSchema(l){return this.style.getSchema(l)}setSchema(l,t){return this.style.setSchema(l,t),this._update(!0)}getConfig(l){return this.style.getConfig(l)}setConfig(l,t){return this.style.setConfig(l,t),this._update(!0)}getConfigProperty(l,t){return this.style.getConfigProperty(l,t)}setConfigProperty(l,t,n){return this.style.setConfigProperty(l,t,n),this._update(!0)}getFeaturesetDescriptors(l){return this.style.getFeaturesetDescriptors(l)}setLights(l){if(this._lazyInitEmptyStyle(),l&&l.length===1&&l[0].type==="flat"){const t=l[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(l),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const l=this.style.getLights()||[];return l.length===0&&l.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),l}setLight(l,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:l}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(l){return this._lazyInitEmptyStyle(),!l&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(l),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(l){return this._lazyInitEmptyStyle(),this.style.setFog(l),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(l){return this._lazyInitEmptyStyle(),this.style.setSnow(l),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(l){return this._lazyInitEmptyStyle(),this.style.setRain(l),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(l){return this._lazyInitEmptyStyle(),this.style.setColorTheme(l),this._update(!0)}setImportColorTheme(l,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(l,t),this._update(!0)}setCamera(l){return this.style.setCamera(l),this._triggerCameraUpdate(l)}_triggerCameraUpdate(l){return this._update(this.transform.setOrthographicProjectionAtLowPitch(l["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(l){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aT.convert(l),this.transform):0}setFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.setFeatureState(l,t),this._update())}removeFeatureState(l,t){return l.source&&!this._isValidId(l.source)?this:(this.style.removeFeatureState(l,t),this._update())}getFeatureState(l){return l.source&&!this._isValidId(l.source)?null:this.style.getFeatureState(l)}_selectIndoorFloor(l){this.indoor.selectFloor(l)}_setIndoorActiveFloorsVisibility(l){this.indoor.setActiveFloorsVisibility(l)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new uc),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const l=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let n,c,d,m=this._container;for(;m&&(!c||!d);){const _=window.getComputedStyle(m).transform;_&&_!=="none"&&(n=_.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(c=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(d=n[3])),m=m.parentElement}this._containerWidth=c?Math.abs(l/c):l,this._containerHeight=d?Math.abs(t/d):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new bm(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const l=this._container;l.classList.add("mapboxgl-map"),(this._missingCSSCanary=rt("div","mapboxgl-canary",l)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=rt("div","mapboxgl-canvas-container",l);this._canvas=rt("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=rt("div","mapboxgl-control-container",l),c=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(d=>{c[d]=rt("div",`mapboxgl-ctrl-${d}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(l,t){const n=o.o.devicePixelRatio||1;this._canvas.width=n*Math.ceil(l),this._canvas.height=n*Math.ceil(t),this._canvas.style.width=`${l}px`,this._canvas.style.height=`${t}px`}_addMarker(l){this._markers.push(l)}_removeMarker(l){const t=this._markers.indexOf(l);t!==-1&&this._markers.splice(t,1)}_addPopup(l){this._popups.push(l)}_removePopup(l){const t=this._popups.indexOf(l);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const l=Object.assign({},ft.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",l);t?(bt(t,!0),this.painter=new Uh(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.k.testSupport(t)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(l){l.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:l}))}_contextRestored(l){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:l}))}_onMapScroll(l){if(l.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(l){return this.style?(this._styleDirty=this._styleDirty||l,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(l){return this._update(),this._renderTaskQueue.add(l)}_cancelRenderFrame(l){this._renderTaskQueue.remove(l)}_requestDomTask(l){!this.loaded()||this.loaded()&&!this.isMoving()?l():this._domRenderTaskQueue.add(l)}_render(l){let t;this.fire(new o.z("renderstart")),++this._frameId;const n=this.painter.context.extTimerQuery,c=o.o.now(),d=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=d.createQuery(),d.beginQuery(n.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(l),this._domRenderTaskQueue.run(l),this._removed)return;this._updateProjectionTransition();const m=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,I=this.transform.pitch,L=o.o.now(),D=new o.ac(E,{now:L,fadeDuration:m,pitch:I,transition:this.style.transition,worldview:this._worldview});this.style.update(D)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let _=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),_=this._updateAverageElevation(c),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):_=this._updateAverageElevation(c);const x=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,m,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),x&&(this._placementDirty=x.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:m,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,he.mark(pe.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const E=o.o.now()-c;d.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{const I=d.getQueryParameter(t,d.QUERY_RESULT)/1e6;d.deleteQuery(t),this.fire(new o.z("gpu-timing-frame",{cpuTime:E,gpuTime:I}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const I=this.painter.queryGpuTimers(E);this.fire(new o.z("gpu-timing-layer",{layerTimes:I}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const I=this.painter.queryGpuTimeDeferredRender(E);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:I}))},50)}const b=this._sourcesDirty||this._styleDirty||this._placementDirty||_;if(b||this._repaint)this.triggerRepaint();else{const E=this.idle();if(E&&(_=this._updateAverageElevation(c,!0)),_)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const I=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:I})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||b||(this._fullyLoaded=!0,he.mark(pe.fullLoad),this._performanceMetricsCollection&&Ae(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(l){for(const t of this._markers)l&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!l||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(l,t=!1){const n=d=>(this.transform.averageElevation=d,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);const c=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(c||(t||l-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(l)){const d=this.transform.averageElevation;let m=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(m)?m=0:this._averageElevationLastSampledAt=l;const _=Math.abs(d-m);if(_>1){if(this._isInitialLoad||c)return this._averageElevation.jumpTo(m),n(m);this._averageElevation.easeTo(m,l,300)}else if(_>1e-4)return this._averageElevation.jumpTo(m),n(m)}return!!this._averageElevation.isEasing(l)&&n(this._averageElevation.getValue(l))}_authenticate(){It(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,l=>{if(l&&(l.message===Fi||l.status===401)){const t=this.painter.context.gl;bt(t,!1),this._logoControl instanceof _u&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Jo(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Rt(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&zt(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){sr(this._requestManager._customAccessToken)}_updateTerrain(){const l=this._isDragging();this.painter.updateTerrain(this.style,l)}_calculateSpeedIndex(){const l=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const n=this.painter.context.gl,c=n.createFramebuffer();function d(m){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,m,0);const _=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,_),_}return n.bindFramebuffer(n.FRAMEBUFFER,c),this._canvasPixelComparison(d(l),t.canvasCopies.map(d),t.timeStamps)}_canvasPixelComparison(l,t,n){let c=n[1]-n[0];const d=l.length/4;for(let m=0;m<t.length;m++){const _=t[m];let x=0;for(let b=0;b<_.length;b+=4)_[b]===l[b]&&_[b+1]===l[b+1]&&_[b+2]===l[b+2]&&_[b+3]===l[b+3]&&(x+=1);c+=(n[m+2]-n[m+1])*(1-x/d)}return c}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const l=this.painter.context.gl.getExtension("WEBGL_lose_context");l&&l.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Ct.delete(this.painter.context.gl),$e.remove(),qn.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(l){this._renderNextFrame=this._renderNextFrame||l,this.style&&!this._frame&&(this._frame=o.o.frame(t=>{const n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(t)}))}_preloadTiles(l){const t=this.style?this.style.getSourceCaches():[];return o.bw(t,(n,c)=>n._preloadTiles(l,c),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(l){this._trackResize&&this.resize({originalEvent:l})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(l){this._showTileBoundaries!==l&&(this._showTileBoundaries=l,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(l){this._showParseStatus!==l&&(this._showParseStatus=l,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(l){this._showTerrainWireframe!==l&&(this._showTerrainWireframe=l,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(l){this._showLayers2DWireframe!==l&&(this._showLayers2DWireframe=l,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(l){this._showLayers3DWireframe!==l&&(this._showLayers3DWireframe=l,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(l){this._speedIndexTiming!==l&&(this._speedIndexTiming=l,this._update())}get showPadding(){return!!this._showPadding}set showPadding(l){this._showPadding!==l&&(this._showPadding=l,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(l){this._showCollisionBoxes!==l&&(this._showCollisionBoxes=l,this.style&&l?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(l){this._showOverdrawInspector!==l&&(this._showOverdrawInspector=l,this._update())}get repaint(){return!!this._repaint}set repaint(l){this._repaint!==l&&(this._repaint=l,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(l){this._vertices=l,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(l){this._showTileAABBs!==l&&(this._showTileAABBs=l,l&&this._update())}_setCacheLimits(l,t){o.f4(l,t)}get version(){return Q}},NavigationControl:class{constructor(l={}){this.options=Object.assign({},Dy,l),this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),rt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),rt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:t}):n.resetNorth({},{originalEvent:t}))}),this._compassIcon=rt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const l=this._map;if(!l)return;const t=l.getZoom(),n=t===l.getMaxZoom(),c=t===l.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const l=this._map;if(!l)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(l.transform.pitch*(Math.PI/180)),.5)}) rotateX(${l.transform.pitch}deg) rotateZ(${l.transform.angle*(180/Math.PI)}deg)`:`rotate(${l.transform.angle*(180/Math.PI)}deg)`;l._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(l){return this._map=l,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),l.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&l.on("pitch",this._rotateCompassArrow),l.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ly(l,this._compass,this.options.visualizePitch)),this._container}onRemove(){const l=this._map;l&&(this._container.remove(),this.options.showZoom&&l.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&l.off("pitch",this._rotateCompassArrow),l.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(l,t){const n=rt("button",l,this._container);return n.type="button",n.addEventListener("click",t),n}_setButtonTitle(l,t){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${t}`);l.setAttribute("aria-label",n),l.firstElementChild&&l.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends o.E{constructor(l={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},zy,l),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=jh(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(l){return this._map=l,this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(l){const t=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,l(n)};this._supportsGeolocation!==void 0?l(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(n=>t(n.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(l){const t=this._map.getMaxBounds(),n=l.coords;return!!t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:l.coords,timestamp:l.timestamp},l.toJSON?{toJSON:l.toJSON.bind(l)}:{}))),this._finish()}}_updateCamera(l){const t=new o.aT(l.coords.longitude,l.coords.latitude),n=l.coords.accuracy,c=this._map.getBearing(),d=Object.assign({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(n),d,{geolocateSource:!0})}_updateMarker(l){if(l){const t=new o.aT(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const l=this._map.transform,t=o.cf(1,l._center.lat)*l.worldSize,n=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",l)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(l){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=rt("button","mapboxgl-ctrl-geolocate",this._container),rt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",l===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=rt("div","mapboxgl-user-location"),this._dotElement.appendChild(rt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(rt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new td({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=rt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new td({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(l){this._userLocationDotMarker&&(l.webkitCompassHeading?this._heading=l.webkitCompassHeading:l.absolute===!0&&(this._heading=-1*l.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(l={maximumAge:6e5,timeout:0},this._noTimeout=!0):(l=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,l),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const l=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&l()}).catch(console.error):l()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:mu,ScaleControl:class{constructor(l={}){this.options=Object.assign({},hc,l),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const l=this.options.maxWidth||100,t=this._map,n=t._containerHeight/2,c=t._containerWidth/2-l/2,d=t.unproject([c,n]),m=t.unproject([c+l,n]),_=d.distanceTo(m);if(this.options.unit==="imperial"){const x=3.2808*_;x>5280?this._setScale(l,x/5280,"mile"):this._setScale(l,x,"foot")}else this.options.unit==="nautical"?this._setScale(l,_/1852,"nautical-mile"):_>=1e3?this._setScale(l,_/1e3,"kilometer"):this._setScale(l,_,"meter")}_setScale(l,t,n){this._map._requestDomTask(()=>{const c=function(m){const _=Math.pow(10,`${Math.floor(m)}`.length-1);let x=m/_;return x=x>=10?10:x>=5?5:x>=3?3:x>=2?2:x>=1?1:function(b){const E=Math.pow(10,Math.ceil(-Math.log(b)/Math.LN10));return Math.round(b*E)/E}(x),_*x}(t),d=c/t;this._container.innerHTML=n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(c):`${c}&nbsp;${Wf[n]}`,this._container.style.width=l*d+"px"})}onAdd(l){return this._map=l,this._language=l.getLanguage(),this._container=rt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",l.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(l){this._language=l,this._update()}setUnit(l){this.options.unit=l,this._update()}},FullscreenControl:class{constructor(l={}){this._fullscreen=!1,l&&l.container&&(l.container instanceof HTMLElement?this._container=l.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(l){return this._map=l,this._container||(this._container=this._map.getContainer()),this._controlContainer=rt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const l=this._fullscreenButton=rt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);rt("span","mapboxgl-ctrl-icon",l).setAttribute("aria-hidden","true"),l.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const l=this._getTitle();this._fullscreenButton.setAttribute("aria-label",l),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",l)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:uc,Popup:class extends o.E{constructor(l){super(),this.options=Object.assign(Object.create(so),l),this._altitude=this.options.altitude,o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(l&&l.className?l.className.trim().split(/\s+/):[])}addTo(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&l.on("preclick",this._onClose),this.options.closeOnMove&&l.on("move",this._onClose),l.on("remove",this.remove),this._update(),l._addPopup(this),this._focusFirstElement(),this._trackPointer?(l.on("mousemove",this._onMouseEvent),l.on("mouseup",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")):l.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const l=this._map;return l&&(l.off("move",this._update),l.off("move",this._onClose),l.off("preclick",this._onClose),l.off("click",this._onClose),l.off("remove",this.remove),l.off("mousemove",this._onMouseEvent),l.off("mouseup",this._onMouseEvent),l.off("drag",this._onMouseEvent),l._canvasContainer&&l._canvasContainer.classList.remove("mapboxgl-track-pointer"),l._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(l){this._lngLat=o.aT.convert(l),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(l){return this._altitude=l,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const l=this._map;return l&&(l.off("move",this._update),l.on("mousemove",this._onMouseEvent),l.on("drag",this._onMouseEvent),l._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(l){return this.setDOMContent(document.createTextNode(l))}setHTML(l){const t=document.createDocumentFragment(),n=document.createElement("body");let c;for(n.innerHTML=l;c=n.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(l){return this.options.maxWidth=l,this._update(),this}setDOMContent(l){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=rt("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(l),this.options.closeButton){const n=this._closeButton=rt("button","mapboxgl-popup-close-button",t);n.type="button",n.setAttribute("aria-label","Close popup"),n.innerHTML='<span aria-hidden="true">&#215;</span>',n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(l){return this._classList.add(l),this._updateClassList(),this}removeClassName(l){return this._classList.delete(l),this._updateClassList(),this}setOffset(l){return this.options.offset=l,this._update(),this}toggleClassName(l){let t;return this._classList.delete(l)?t=!1:(this._classList.add(l),t=!0),this._updateClassList(),t}_onMouseEvent(l){this._update(l.point)}_getAnchor(l){if(this.options.anchor)return this.options.anchor;const t=this._map,n=this._container,c=this._pos;if(!t||!n||!c)return"bottom";const d=n.offsetWidth,m=n.offsetHeight,_=c.x<d/2,x=c.x>t.transform.width-d/2;if(c.y+l<m)return _?"top-left":x?"top-right":"top";if(c.y>t.transform.height-m){if(_)return"bottom-left";if(x)return"bottom-right"}return _?"left":x?"right":"bottom"}_updateClassList(){const l=this._container;if(!l)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),l.className=t.join(" ")}_update(l){const t=this._map,n=this._content;if(!t||!this._lngLat&&!this._trackPointer||!n)return;let c=this._container;if(c||(c=this._container=rt("div","mapboxgl-popup",t.getContainer()),this._tip=rt("div","mapboxgl-popup-tip",c),c.appendChild(n)),this.options.maxWidth&&c.style.maxWidth!==this.options.maxWidth&&(c.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=$f(this._lngLat,this._pos,t.transform)),!this._trackPointer||l){const d=this._pos=this._trackPointer&&l instanceof o.P?l:t.project(this._lngLat,this._altitude),m=Pl(this.options.offset),_=this._anchor=this._getAnchor(m.y),x=Pl(this.options.offset,_),b=d.add(x).round();t._requestDomTask(()=>{this._container&&_&&(this._container.style.transform=`${ns[_]} translate(${b.x}px,${b.y}px)`)})}if(!this._marker&&t._showingGlobe()){const d=o.f5(t.transform,this._lngLat)?0:1;this._setOpacity(d)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const l=this._container.querySelector(oo);l&&l.focus()}_onClose(){this.remove()}_setOpacity(l){this._container&&(this._container.style.opacity=`${l}`),this._content&&(this._content.style.pointerEvents=l?"auto":"none")}},Marker:td,Style:ro,LngLat:o.aT,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:gs,Evented:o.E,config:o.e,prewarm:o.f9,clearPrewarmedResources:o.f8,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(l){o.e.ACCESS_TOKEN=l},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(l){o.e.API_URL=l},get workerCount(){return o.fi.workerCount},set workerCount(l){o.fi.workerCount=l},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(l){o.e.MAX_PARALLEL_IMAGE_REQUESTS=l},clearStorage(l){o.fh(l)},get workerUrl(){return o.fg.workerUrl},set workerUrl(l){o.fg.workerUrl=l},get workerClass(){return o.fg.workerClass},set workerClass(l){o.fg.workerClass=l},get workerParams(){return o.fg.workerParams},set workerParams(l){o.fg.workerParams=l},get dracoUrl(){return o.ff()},set dracoUrl(l){o.fe(l)},get meshoptUrl(){return o.fd()},set meshoptUrl(l){o.fc(l)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var j=M;return j})}(vg)),vg.exports}var vk=xk();const A2=gk(vk),bk="/api/",wk={name:"Detail",data(){return{propertyData:null,showGallery:!1,currentImageIndex:0}},computed:{allImages(){if(!this.propertyData)return[];const f=[];return this.propertyData.main_image&&f.push({src:this.propertyData.main_image}),this.propertyData.additional_images&&this.propertyData.additional_images.forEach(g=>f.push({src:g.image,caption:g.caption})),f},currentImage(){return this.allImages[this.currentImageIndex]||{}}},methods:{openGallery(f){this.currentImageIndex=f,this.showGallery=!0,document.body.style.overflow="hidden"},closeGallery(){this.showGallery=!1,document.body.style.overflow="auto"},nextImage(){this.currentImageIndex=(this.currentImageIndex+1)%this.allImages.length},previousImage(){this.currentImageIndex=(this.currentImageIndex-1+this.allImages.length)%this.allImages.length},initMap(){this.propertyData?.latitude}},async created(){const f=this.$route.params.id;try{const g=await Jn.get(`${bk}properties/${f}/`);this.propertyData=g.data,GS({title:`${this.propertyData.title} | Casa del Sol - Malaga Rentals`,meta:[{name:"description",content:this.propertyData.descripcion.substring(0,160)},{property:"og:title",content:this.propertyData.title},{property:"og:description",content:this.propertyData.descripcion.substring(0,160)},{property:"og:image",content:this.propertyData.main_image},{name:"twitter:card",content:"summary_large_image"}],script:[{type:"application/ld+json",children:JSON.stringify({"@context":"https://schema.org","@type":"VacationRental",name:this.propertyData.title,description:this.propertyData.long_description,image:this.propertyData.main_image,priceRange:`${this.propertyData.precio}`,address:{"@type":"PostalAddress",addressLocality:"Malaga",addressCountry:"ES"}})}]}),this.$nextTick(()=>{this.initMap()})}catch(g){console.error(g)}}},Tk={key:0,class:"max-w-4xl mx-auto py-10 px-4"},Sk=["src","alt"],Ek={class:"flex flex-col md:flex-row gap-8"},Ak={class:"flex-1"},Ik={class:"text-3xl md:text-4xl font-bold mb-2 text-gray-900"},Ck={class:"text-lg text-gray-600 mb-4 flex items-center"},Pk={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-xl border border-gray-100"},Mk={class:"text-center"},Rk={class:"text-2xl font-bold text-gray-900"},Dk={class:"text-center"},Lk={class:"text-2xl font-bold text-gray-900"},zk={class:"text-center"},Ok={class:"text-2xl font-bold text-gray-900"},kk={class:"text-center"},Fk={class:"text-2xl font-bold text-primary-600"},Bk={class:"prose max-w-none text-gray-700 mb-8 whitespace-pre-line"},Nk={key:0,class:"mb-8"},Vk={class:"grid grid-cols-2 md:grid-cols-3 gap-3"},Uk=["onClick"],jk=["src","alt"],Gk={class:"w-full md:w-1/3 space-y-6"},Hk={class:"bg-white p-6 rounded-xl shadow-lg border border-gray-100 sticky top-24"},qk={class:"text-2xl font-bold text-primary-600 mb-1"},$k=["href"],Wk={key:0,class:"bg-gray-100 rounded-xl overflow-hidden h-64 shadow-inner relative"},Zk=["src"],Xk={class:"absolute bottom-4 text-white"};function Kk(f,g,T,C,M,k){return M.propertyData?(Rn(),Fn("div",Tk,[M.propertyData.main_image?(Rn(),Fn("img",{key:0,src:M.propertyData.main_image,alt:M.propertyData.title,class:"w-full h-64 md:h-96 object-cover rounded-xl shadow-lg mb-8 cursor-pointer hover:opacity-95 transition-opacity",onClick:g[0]||(g[0]=j=>k.openGallery(0))},null,8,Sk)):Ea("",!0),ot("div",Ek,[ot("div",Ak,[ot("h1",Ik,an(M.propertyData.title),1),ot("div",Ck,[g[5]||(g[5]=ot("svg",{class:"w-5 h-5 mr-1 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[ot("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),ot("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),uo(" "+an(M.propertyData.location),1)]),ot("div",Pk,[ot("div",Mk,[ot("div",Rk,an(M.propertyData.capacity),1),g[6]||(g[6]=ot("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Personas",-1))]),ot("div",Dk,[ot("div",Lk,an(M.propertyData.habitaciones),1),g[7]||(g[7]=ot("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Habitaciones",-1))]),ot("div",zk,[ot("div",Ok,an(M.propertyData.banos),1),g[8]||(g[8]=ot("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Baos",-1))]),ot("div",kk,[ot("div",Fk,""+an(M.propertyData.precio),1),g[9]||(g[9]=ot("div",{class:"text-xs text-gray-500 uppercase tracking-wide"},"Por noche",-1))])]),ot("div",Bk,an(M.propertyData.long_description||M.propertyData.descripcion),1),M.propertyData.additional_images&&M.propertyData.additional_images.length>0?(Rn(),Fn("div",Nk,[g[10]||(g[10]=ot("h3",{class:"text-xl font-bold mb-4"},"Galera de fotos",-1)),ot("div",Vk,[(Rn(!0),Fn(Xo,null,iv(M.propertyData.additional_images,(j,o)=>(Rn(),Fn("div",{key:j.id,class:"aspect-w-4 aspect-h-3 rounded-lg overflow-hidden cursor-pointer hover:opacity-90 transition",onClick:Q=>k.openGallery(o+1)},[ot("img",{src:j.image,class:"object-cover w-full h-full",alt:j.caption},null,8,jk)],8,Uk))),128))])])):Ea("",!0)]),ot("div",Gk,[ot("div",Hk,[ot("div",qk,[uo(""+an(M.propertyData.precio)+" ",1),g[11]||(g[11]=ot("span",{class:"text-sm font-normal text-gray-500"},"/ noche",-1))]),g[12]||(g[12]=ot("div",{class:"text-green-600 text-sm font-medium mb-6"},"Mejor precio garantizado",-1)),g[13]||(g[13]=ot("a",{href:"https://wa.me/message/LN7BEZCQDMBWP1",target:"_blank",class:"block w-full bg-green-500 text-white text-center font-bold py-3 rounded-lg hover:bg-green-600 transition mb-3 flex items-center justify-center gap-2"},[ot("svg",{class:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24"},[ot("path",{d:"M.057 24l1.687-6.163c-1.041-1.804-1.588-3.849-1.587-5.946.003-6.556 5.338-11.891 11.893-11.891 3.181.001 6.167 1.24 8.413 3.488 2.245 2.248 3.481 5.236 3.48 8.414-.003 6.557-5.338 11.892-11.893 11.892-1.99-.001-3.951-.5-5.688-1.448l-6.305 1.654zm6.597-3.807c1.676.995 3.276 1.591 5.392 1.592 5.448 0 9.886-4.434 9.889-9.885.002-5.462-4.415-9.89-9.881-9.892-5.452 0-9.887 4.434-9.889 9.884-.001 2.225.651 3.891 1.746 5.634l-.999 3.648 3.742-.981zm11.387-5.464c-.074-.124-.272-.198-.57-.347-.297-.149-1.758-.868-2.031-.967-.272-.099-.47-.149-.669.149-.198.297-.768.967-.941 1.165-.173.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.297-.347.446-.521.151-.172.2-.296.3-.495.099-.198.05-.372-.025-.521-.075-.148-.669-1.611-.916-2.206-.242-.579-.487-.501-.669-.51l-.57-.01c-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.095 3.2 5.076 4.487.709.306 1.263.489 1.694.626.712.226 1.36.194 1.872.118.571-.085 1.758-.719 2.006-1.413.248-.695.248-1.29.173-1.414z"})]),uo(" WhatsApp Directo ")],-1)),M.propertyData.airbnb_link?(Rn(),Fn("a",{key:0,href:M.propertyData.airbnb_link,target:"_blank",class:"block w-full text-center text-gray-600 font-medium py-3 rounded-lg border hover:bg-gray-50 transition"}," Reservar en Airbnb ",8,$k)):Ea("",!0)]),M.propertyData.latitude?(Rn(),Fn("div",Wk,g[14]||(g[14]=[ot("div",{id:"detail-map",class:"w-full h-full"},null,-1)]))):Ea("",!0)])]),M.showGallery?(Rn(),Fn("div",{key:1,class:"fixed inset-0 bg-black bg-opacity-95 z-50 flex items-center justify-center",onClick:g[4]||(g[4]=(...j)=>k.closeGallery&&k.closeGallery(...j))},[ot("button",{onClick:g[1]||(g[1]=(...j)=>k.closeGallery&&k.closeGallery(...j)),class:"absolute top-4 right-4 text-white p-2"},""),k.allImages.length>1?(Rn(),Fn("button",{key:0,onClick:g[2]||(g[2]=VT((...j)=>k.previousImage&&k.previousImage(...j),["stop"])),class:"absolute left-4 top-1/2 text-white p-4 text-3xl"},"")):Ea("",!0),ot("img",{src:k.currentImage.src,class:"max-h-[90vh] max-w-[90vw] object-contain"},null,8,Zk),k.allImages.length>1?(Rn(),Fn("button",{key:1,onClick:g[3]||(g[3]=VT((...j)=>k.nextImage&&k.nextImage(...j),["stop"])),class:"absolute right-4 top-1/2 text-white p-4 text-3xl"},"")):Ea("",!0),ot("div",Xk,an(M.currentImageIndex+1)+" / "+an(k.allImages.length),1)])):Ea("",!0)])):Ea("",!0)}const Yk=kd(wk,[["render",Kk]]),Jk="/api/",Qk={name:"PropertiesView",data(){return{map:null,markers:{},properties:[],showFilters:!1,filters:{capacity:2,habitaciones:0,banos:0}}},async mounted(){await this.fetchProperties(),this.initMap()},methods:{async fetchProperties(){try{const f=new URLSearchParams;this.filters.capacity>0&&f.append("capacity",this.filters.capacity),this.filters.habitaciones>0&&f.append("habitaciones",this.filters.habitaciones),this.filters.banos>0&&f.append("banos",this.filters.banos);const g=await fetch(`${Jk}properties/?${f.toString()}`);this.properties=await g.json(),this.updateMapMarkers()}catch(f){console.error("Error fetching properties",f)}},initMap(){{console.warn("Mapbox Token missing!");return}},updateMapMarkers(){this.map&&(Object.values(this.markers).forEach(f=>f.remove()),this.markers={},this.properties.forEach(f=>{if(!f.latitude||!f.longitude)return;const g=document.createElement("div");g.className="marker bg-white text-palette-taupe font-bold text-sm px-3 py-1 rounded-full shadow-md border border-gray-200 hover:scale-110 transition cursor-pointer hover:bg-palette-taupe hover:text-white hover:border-transparent",g.innerHTML=`${f.precio}`;const T=new A2.Popup({offset:25,closeButton:!1}).setHTML(`
                <div class="text-sm p-1">
                    <div class="font-bold text-gray-900 mb-1">${f.title}</div>
                    <div class="text-gray-500 text-xs mb-2">${f.location}</div>
                    <a href="/apartments/${f.id}" class="block w-full text-center bg-palette-taupe text-white text-xs py-1 rounded hover:opacity-90 transition">Ver propiedad</a>
                </div>
            `),C=new A2.Marker({element:g}).setLngLat([f.longitude,f.latitude]).setPopup(T).addTo(this.map);this.markers[f.id]=C}))},updateFilter(f,g){f==="capacity"&&(this.filters.capacity=Math.max(1,this.filters.capacity+g))},applyFilters(){this.fetchProperties(),window.innerWidth<768&&(this.showFilters=!1)},resetFilters(){this.filters={capacity:1,habitaciones:0,banos:0},this.fetchProperties()},highlightMarker(f){if(this.markers[f]){const g=this.markers[f].getElement();g.classList.add("bg-palette-taupe","text-white","scale-110"),g.classList.remove("bg-white","text-palette-taupe"),g.style.zIndex=10}},unhighlightMarker(f){if(this.markers[f]){const g=this.markers[f].getElement();g.classList.remove("bg-palette-taupe","text-white","scale-110"),g.classList.add("bg-white","text-palette-taupe"),g.style.zIndex=1}},flyToProperty(f){f.latitude&&f.longitude&&this.map&&(this.map.flyTo({center:[f.longitude,f.latitude],zoom:15,essential:!0}),this.markers[f.id]&&this.markers[f.id].togglePopup())},getImageUrl(f){return f?f.startsWith("http")||f.startsWith("/media/")?f:`/media/${f.replace(/^\\|^\//,"")}`:""}}},eF={class:"h-screen flex flex-col pt-16 font-sans"},tF={class:"flex flex-1 overflow-hidden relative"},iF={class:"p-6"},rF={class:"flex justify-between items-center mb-6"},nF={class:"space-y-8"},sF={class:"flex items-center space-x-4"},oF={class:"text-xl w-6 text-center font-bold text-palette-taupe"},aF={class:"flex justify-between text-xs text-gray-500 mt-2"},lF={class:"font-bold text-palette-taupe"},cF={class:"flex justify-between text-xs text-gray-500 mt-2"},uF={class:"font-bold text-palette-taupe"},hF={class:"pt-4 space-y-3"},dF={class:"border-t border-gray-200 bg-palette-light"},fF={class:"p-4 text-sm font-medium text-gray-500 uppercase tracking-wider"},pF={class:"px-4 pb-20 space-y-4 overflow-y-auto max-h-[calc(100vh-500px)]"},mF=["onMouseenter","onMouseleave","onClick"],_F=["src"],gF={class:"flex-1 flex flex-col justify-between py-1"},yF={class:"font-bold text-palette-taupe line-clamp-1 text-lg"},xF={class:"text-xs text-gray-500 mb-2 flex items-center"},vF={class:"flex items-center text-xs text-gray-600 gap-3"},bF={class:"flex items-center"},wF={class:"font-bold mr-1"},TF={class:"flex items-center"},SF={class:"font-bold mr-1"},EF={class:"flex items-center"},AF={class:"font-bold mr-1"},IF={class:"font-bold text-palette-taupe text-lg text-right"},CF={key:0,class:"text-center py-10 text-gray-500"},PF={class:"flex-1 relative bg-gray-100"};function MF(f,g,T,C,M,k){return Rn(),Fn("div",eF,[ot("div",tF,[ot("div",{class:sm(["w-full md:w-1/3 lg:w-1/4 bg-white border-r border-gray-200 z-20 overflow-y-auto absolute md:relative h-full transition-transform transform shadow-xl md:shadow-none",M.showFilters?"translate-x-0":"-translate-x-full md:translate-x-0"])},[ot("div",iF,[ot("div",rF,[g[9]||(g[9]=ot("h2",{class:"text-2xl font-bold text-palette-taupe"},"Filtros",-1)),ot("button",{onClick:g[0]||(g[0]=j=>M.showFilters=!1),class:"md:hidden text-gray-500 hover:text-palette-taupe"},g[8]||(g[8]=[ot("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[ot("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),ot("div",nF,[ot("div",null,[g[10]||(g[10]=ot("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Huspedes",-1)),ot("div",sF,[ot("button",{onClick:g[1]||(g[1]=j=>k.updateFilter("capacity",-1)),class:"w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-palette-light hover:border-palette-beige transition text-palette-taupe text-xl"},"-"),ot("span",oF,an(M.filters.capacity),1),ot("button",{onClick:g[2]||(g[2]=j=>k.updateFilter("capacity",1)),class:"w-10 h-10 rounded-full border border-gray-300 flex items-center justify-center hover:bg-palette-light hover:border-palette-beige transition text-palette-taupe text-xl"},"+")])]),ot("div",null,[g[12]||(g[12]=ot("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Habitaciones (mn)",-1)),fT(ot("input",{type:"range",min:"0",max:"5","onUpdate:modelValue":g[3]||(g[3]=j=>M.filters.habitaciones=j),class:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-palette-taupe"},null,512),[[NT,M.filters.habitaciones,void 0,{number:!0}]]),ot("div",aF,[g[11]||(g[11]=ot("span",null,"Cualquiera",-1)),ot("span",lF,an(M.filters.habitaciones)+"+ hab.",1)])]),ot("div",null,[g[14]||(g[14]=ot("label",{class:"block text-sm font-semibold text-gray-700 mb-3"},"Baos (mn)",-1)),fT(ot("input",{type:"range",min:"0",max:"3","onUpdate:modelValue":g[4]||(g[4]=j=>M.filters.banos=j),class:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-palette-taupe"},null,512),[[NT,M.filters.banos,void 0,{number:!0}]]),ot("div",cF,[g[13]||(g[13]=ot("span",null,"Cualquiera",-1)),ot("span",uF,an(M.filters.banos)+"+ baos",1)])]),ot("div",hF,[ot("button",{onClick:g[5]||(g[5]=(...j)=>k.applyFilters&&k.applyFilters(...j)),class:"w-full bg-palette-taupe text-white py-3 rounded-lg font-semibold hover:bg-opacity-90 transition shadow-md"}," Aplicar Filtros "),ot("button",{onClick:g[6]||(g[6]=(...j)=>k.resetFilters&&k.resetFilters(...j)),class:"w-full text-gray-500 py-2 text-sm hover:text-palette-taupe transition underline"}," Restablecer bsqueda ")])])]),ot("div",dF,[ot("div",fF,an(M.properties.length)+" propiedades encontradas ",1),ot("div",pF,[(Rn(!0),Fn(Xo,null,iv(M.properties,j=>(Rn(),Fn("div",{key:j.id,class:"bg-white rounded-xl shadow-sm hover:shadow-md cursor-pointer transition p-3 flex gap-4 border border-transparent hover:border-palette-beige",onMouseenter:o=>k.highlightMarker(j.id),onMouseleave:o=>k.unhighlightMarker(j.id),onClick:o=>k.flyToProperty(j)},[ot("img",{src:k.getImageUrl(j.main_image),class:"w-28 h-28 object-cover rounded-lg flex-shrink-0 bg-gray-200"},null,8,_F),ot("div",gF,[ot("div",null,[ot("h3",yF,an(j.title),1),ot("div",xF,[g[15]||(g[15]=ot("svg",{class:"w-3 h-3 mr-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[ot("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),ot("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})],-1)),uo(" "+an(j.location),1)]),ot("div",vF,[ot("span",bF,[ot("span",wF,an(j.habitaciones),1),g[16]||(g[16]=uo(" hab"))]),ot("span",TF,[ot("span",SF,an(j.banos),1),g[17]||(g[17]=uo(" baos"))]),ot("span",EF,[ot("span",AF,an(j.capacity),1),g[18]||(g[18]=uo(" pers"))])])]),ot("div",IF,[uo(""+an(j.precio)+" ",1),g[19]||(g[19]=ot("span",{class:"text-xs font-normal text-gray-500"},"/noche",-1))])])],40,mF))),128)),M.properties.length===0?(Rn(),Fn("div",CF," No hay propiedades que coincidan con tu bsqueda. ")):Ea("",!0)])])],2),ot("div",PF,[g[21]||(g[21]=ot("div",{id:"map",class:"w-full h-full"},null,-1)),ot("button",{onClick:g[7]||(g[7]=j=>M.showFilters=!M.showFilters),class:"absolute top-4 left-4 md:hidden bg-palette-taupe text-white px-4 py-3 rounded-full shadow-lg z-10 font-medium flex items-center gap-2"},[g[20]||(g[20]=ot("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[ot("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"})],-1)),uo(" "+an(M.showFilters?"Ver Mapa":"Filtros"),1)])])])])}const RF=kd(Qk,[["render",MF]]),DF={template:'<div class="max-w-2xl mx-auto py-20 text-center text-xl">Acerca de este portal...</div>'},LF=[{path:"/",name:"homeview",component:Vz},{path:"/properties",name:"properties",component:RF},{path:"/apartments/:id",name:"property-detail",component:Yk,props:!0},{path:"/about",name:"about",component:DF},{path:"/:catchAll(.*)",redirect:"/"}],zF=BL({history:fL(),routes:LF,scrollBehavior(f,g,T){return T||{top:0}}}),dv=PR(kD),OF=TD();dv.use(zF);dv.use(OF);dv.mount("#app");
